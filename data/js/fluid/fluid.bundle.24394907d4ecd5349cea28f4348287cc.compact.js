(function e(b,h,d){function c(n,k){if(!h[n]){if(!b[n]){var j=typeof require=="function"&&require;if(!k&&j){return j(n,!0)}if(a){return a(n,!0)}var m=new Error("Cannot find module '"+n+"'");throw m.code="MODULE_NOT_FOUND",m}var i=h[n]={exports:{}};b[n][0].call(i.exports,function(l){var o=b[n][1][l];return c(o?o:l)},i,i.exports,e,b,h,d)}return h[n].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(b,c,a){var d={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(k){for(var f=0;f<k.length;f++){var h=k[f].string;var j=k[f].prop;this.versionSearchString=k[f].versionSearch||k[f].identity;if(h){if(h.indexOf(k[f].subString)!=-1){return k[f].identity}}else{if(j){return k[f].identity}}}},searchVersion:function(h){var f=h.indexOf(this.versionSearchString);if(f==-1){return}return parseFloat(h.substring(f+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};c.exports=d},{}],2:[function(c,b,d){var j=c("./class-storage");var h=c("./fluid/fluid.util");var k=c("./utils");var l=c("./fluid/lib/underscore");var m=c("./functions");var f=c("./class-userSettings");var a=c("./class-canvas");var i={syncPending:{},oldlogin:false,lastActivity:new Date().getTime(),safetyInterval:60000,loadingTimeout:null,signInProgressActive:false,defaultUserLibrary:"My Widgets",userLibraryGroup:"My Library",alerts:{projectLimitHit:{onAddActive:$("#tmplAlertProjectLimit_OnAddActive").tmpl({}),onNeedHigherThanStandard:$("#tmplAlertProjectLimit_OnNeedHigherThanStandard").tmpl({}),onDropToInactive:$("#tmplAlertProjectLimit_OnDropToInactive").tmpl({}),onScreensNonLite:$("#tmplAlertScreensNonLite").tmpl({}),onExportNonStandard:$("#tmplAlertExportNonStandard").tmpl({}),onFeaturePremium:$("#tmplAlertFeaturePremium").tmpl({}),onFeatureStandard:$("#tmplAlertFeatureStandard").tmpl({})},pageLimitHit:{onAddActive:$("#tmplAlertPageLimit_OnAddActive").tmpl({}),onNonSignedIn:$("#tmplAlertPageLimit_OnNonSignedIn").tmpl({})},uploadLimitHit:{onNonSignedIn:$("#tmplAlertUploadNonSignedIn").tmpl({})},projectAction:{onDelete:$("#tmplProjectAction_OnDelete").tmpl({})},editInactive:{canActivate:'This project is inactive and read-only. Please <span class="inlineLink alertLinkToSettings close">activate the project</span> in order to edit it.',needUpgrade:$("#tmplAlertProjectLimit_OnOpenInactive").tmpl({})}},checkIntegrity:function(){var p=i.get("id");var n=j.get(p);if(!n){return}if(i.get("loggedIn")==null){var r=(i.get("accType")=="New")?"no":"yes";i.set({loggedIn:r})}var o=n.lastOpenProject;var q=n.projectIds;if(!q||q.length==0){return}if($.inArray(o,q)==-1){i.set({lastOpenProject:q[0]})}if(i.get("maxActiveProjects")===null||i.get("maxActiveProjects")===undefined){i.set({maxActiveProjects:1})}if(i.get("maxPages")===null||i.get("maxPages")===undefined){i.set({maxPages:10})}if(i.get("upgradeDate")===null||i.get("upgradeDate")===undefined){i.set({upgradeDate:"0000-00-00 00:00:00"})}if(i.get("lastPaymentDate")===null||i.get("lastPaymentDate")===undefined){i.set({lastPaymentDate:"0000-00-00 00:00:00"})}if(i.get("nextPaymentDate")===null||i.get("nextPaymentDate")===undefined){i.set({nextPaymentDate:"0000-00-00 00:00:00"})}if(i.get("lastPaymentResult")===null||i.get("lastPaymentResult")===undefined){i.set({lastPaymentResult:"s"})}if(i.get("gridStatus")===null||i.get("gridStatus")===undefined){i.set({gridStatus:"off"})}if(i.get("gridSpacing")===null||i.get("gridSpacing")===undefined){i.set({gridSpacing:10})}if(i.get("snapToWidget")===null||i.get("snapToWidget")===undefined){i.set({snapToWidget:"on"})}if(i.get("customLibraryWidgets")===null||i.get("customLibraryWidgets")===undefined){i.set({customLibraryWidgets:{}})}},get:function(o){var p=j.get("accounts");if(!p){return null}var n=p.last;if(o=="currentUserId"||o=="id"){return n}var p=j.get(n);if(p==null||p[o]==null){return null}return p[o]},set:function(q){var n=i.get("currentUserId");var p=j.get(n);if(p==null){throw ("No set account object for "+q+"Caller:"+arguments.callee.caller+" Second level:"+arguments.callee.caller.caller+"loadSate"+loading_Stage_Check)}for(var r in q){p[r]=q[r]}j.set(n,p)},changeAccountId:function(q,p){var n=j.get("accounts");var o=j.get(q);n.user[0].id=p;if(n.last==q){n.last=p}j.set("accounts",n);fluid.main.account.id=p;fluid.main.account.set({accountId:p});j.set(p,o);j.remove(q)},setup:function(){var n={last:null,user:[]};j.set("accounts",n)},createUser:function(p){i.creatingUser=true;fluid.main.account=new fluid.models.Account(p,{parse:true});var n={email:"New",accType:"New",name:"",recurrance:"never",libraryWidth:426,loggedIn:"no",maxActiveProjects:1,maxPages:10,projectIds:[],uploads:[],lastOpenProject:"",createDate:new Date().getTime()};if(arguments.length===0){var r=k.guid("u");fluid.main.account.set("accountId",r)}else{var r=p.accountId;n.accName=p.accName;n.accType=p.accType;n.recurrance=p.recurrance;n.email=p.email;n.maxActiveProjects=~~p.maxActiveProjects;n.maxPages=~~p.maxPages}var o={id:r};var q=j.get("accounts");if(q==null){return}q.user.push(o);q.last=r;j.set("accounts",q);j.set(r,n);i.creatingUser=false;return r},login:function(p){i.isLoggingIn=true;localStorage.setItem("account.loginStarted",true);var o=j.get("accounts");i.beforeLoginId=o?o.last:null;if(p.a!="login"||p.r!="s"){i.drawSignup(p);return false}$("body").addClass("signed-in");i.createUser(p);if(!fluid.main.project.pages.length){fluid.main.projects.reset()}else{fluid.main.account.set({projectIds:[fluid.main.project.get("id")]})}var r=j.get("accounts");if(r.user.length==2&&r.user[0].id==i.beforeLoginId){r.user.splice(0,1);j.set("accounts",r)}var q=fluid.main.project.get("id");i.set({loggedIn:"yes",accName:p.accName,accType:p.accType,recurrance:p.recurrance,maxActiveProjects:p.maxActiveProjects,maxPages:p.maxPages,upgradeDate:p.upgradeDate,lastPaymentDate:p.lastPaymentDate,lastPaymentResult:p.lastPaymentResult,nextPaymentDate:p.nextPaymentDate,createDate:p.createDate,status:p.status});if(p.discount){i.set({discount:{amount:p.discount,bundleMonths:p.discountBundleMonths,code:p.discountCode,accType:p.discountAccType,recurrance:p.discountRecurrance,endDate:p.discountEndDate,message:p.discountMessage}})}else{i.set({discount:null})}if(p.settings!=""){var s=JSON.parse(p.settings);if(fluid.main.project.get("pages").length!==0){s.lastOpenProject=q}i.set(s);if(s.hint=="end"){hint.cleanup()}}if(p.libsWhitelist!=""){var n=JSON.parse(p.libsWhitelist);i.set(n)}fluid.api.accountState(i.afterStateValidated,i.afterStateValidatedFailed);i.draw(p);if(p.objects&&p.objects.length>0){$("#msgLoadingAfterLogin").show()}setTimeout(function(){i.sync(p.objects,true,q)},500);fluid.command.create("showButton").dispatchTo("fluid.controllers.timeline");localStorage.setItem("intercomUserHash",p.intercomUserHash);fluid.main.fire("editor.afterLogin");i.isLoggingIn=false;i.doAccountStatusAction()},sync:function(u,z,o){i.setLoadingStep(1);var t=[],w=[],v=[];for(var s=0;s<u.length;s++){var r=u[s];var n=r.id.substr(0,1);switch(n){case"p":t.push(r.id);break;case"i":w.push(r.id);break;case"b":v.push(r.id);break}}if(t.length>0){function p(){var A=j.get("accounts");A.last=i.beforeLoginId;j.set("accounts",A);localStorage.setItem("postloadMessage","loginSyncFailed");location.reload()}function q(B,H,C){var E=JSON.parse(B);if(E.r!=="s"){p();return}var D=E.t;if(!$.isArray(D)){D=[D]}var G=D.length;D.forEach(function(K,M){K=JSON.parse(K);var N=fluid.main.account.get("projectIds");var J;var I=K.uploads||{};for(var L in K){if(L!=="uploads"){J=L}}if(N.indexOf(J)===-1){N.push(J);fluid.main.account.set({projectIds:N.slice(0)});console.log("adding: ",J,fluid.main.account.get("projectIds"))}modelItem=l.clone(K[J]);modelItem.id=J;modelItem.uniqueUploads=Object.keys(I);fluid.main.projects.add(modelItem);projectModel=fluid.main.projects.get(J);i.addProjectId(J);if(I){l.each(I,function(O,P){if(!fluid.main.uploads.get(P)){K.uploads[P].id=P;fluid.main.uploads.add(K.uploads[P])}})}j.set(J,modelItem,false)});if(G>0){if(fluid.main.project.isEmpty()){var A=i.get("lastOpenProject");var F=i.get("projectIds");if(o){if(F.indexOf(o)!==-1){fluid.main.account.set({projectIds:F.splice(F.indexOf(o),1)})}j.remove(o);if(o==A){i.set({lastOpenProject:""})}}}}fluid.main.fire("projects.synced");fluid.main.fire("libs.syncing");i.syncLibs(v,function(){fluid.main.fire("libs.synced")});fluid.main.fire("uploads.syncing");w=l.union(w,fluid.main.uploads.map(function(I){return I.id}));i.syncUploads(w,function(){fluid.main.fire("uploads.synced",D);fluid.main.fire("afteruploadssynced")});localStorage.setItem("account.loginEnded",true)}fluid.main.fire("projects.syncing");fluid.api.syncDown(t.join(","),true,z,q,p)}else{i.createDefaultUserLib();fluid.main.fire("noprojectssynceddown");localStorage.setItem("account.loginEnded",true)}},_syncUserObjects:function(n,o){i.setLoadingStep(4);if(!n||n.length==0){fluid.main.fire("syncdownlibrefreshneeded");fluid.main.account.save();if(o){o()}i.syncedUploads=true;return true}i._syncDownAttempt=1;fluid.api.syncDown(n.join(","),true,false,o,o)},_syncDownErrorCallback:function(p,q,o){var n=j.get("accounts");n.last=i.beforeLoginId;j.set("accounts",n);localStorage.setItem("postloadMessage","loginSyncFailed");location.reload()},syncUploads:function(n,o){i.syncingUploads=true;i._syncUserObjects(n,function(s,p,z){i.syncedUploads=true;if(s){var r=JSON.parse(s);if(r.r!=="s"){i._syncDownErrorCallback(n,o);return}var q=JSON.parse(s).t;var u=0;if(!$.isArray(q)){q=[q]}var v=[];for(var A=0;A<q.length;A++){try{var B=JSON.parse(q[A])}catch(t){continue}i.addUploadId(B.id,true);try{var w=$.extend({font:"",color:"",upload:"y",g:["Uploads"],t:["Uploads"],data:B.id,wh:[B.width,B.height],title:B.name},B);delete w.name;delete w.width;delete w.height;j.set(B.id,w);widgets.summary[B.id]=w;u++}catch(t){}}fluid.main.account.save();fluid.main.fire("syncdownlibrefreshneeded");i.syncingUploads=false;if(u>1){i.syncedUploads=true}}if(o){o()}})},createDefaultUserLib:function(q){var p=k.guid("b"),n={id:p,name:i.defaultUserLibrary,widgets:{}},o={};o[p]=n;i.set({defaultUserLibrary:p,libraries:[p]});j.set(p,n);fluid.main.fire("libraryadded",n);fluid.api.libSync(p,n,q,q)},hideUserLibs:function(){var q=i.get("libraries");if(q){for(var o=0,n=q.length;o<n;o++){var p=j.get(q[o]);if(p){fluid.main.fire("libremovalneeded",p.name);j.remove(q[o])}}}},syncLibs:function(n,o){if(i.isStandard()){i.syncingLibs=true;i._syncUserObjects(n,function(w,q,C){var F=false;i.syncedLibs=true;if(w){var t=JSON.parse(w);if(t.r!=="s"){i._syncDownErrorCallback(n,o);return}var v={},u=[],B=JSON.parse(w).t;if(!$.isArray(B)){B=[B]}for(var A=0;A<B.length;A++){var E=JSON.parse(B[A]);j.set(E.id,E);v[E.id]=E;u.push(E.id)}i.set({libraries:u});var p=v[i.get("defaultUserLibrary")];if(!p){for(var z in v){if(v.hasOwnProperty(z)){p=v[z];i.set({defaultUserLibrary:z});break}}}var r=i.get("libraries"),D;if(r.length){for(var s=0;s<r.length;s++){D=j.get(r[s]);fluid.main.fire("libraryadded",D)}fluid.main.fire("syncdownlibrefreshneeded")}else{F=true}}else{F=true}if(F){i.createDefaultUserLib();fluid.main.fire("syncdownlibrefreshneeded",i.defaultUserLibrary)}})}else{i.set({libraries:n})}},register:function(n){if(n&&n.r=="s"){i.set({email:n.email,accType:n.accType,accName:n.accName,recurrance:n.recurrance,loggedIn:"yes",maxActiveProjects:n.maxActiveProjects,maxPages:n.maxPages,upgradeDate:n.upgradeDate,lastPaymentDate:n.lastPaymentDate,nextPaymentDate:n.nextPaymentDate,lastPaymentResult:n.lastPaymentResult});if(n.accountId!=i.get("id")){i.changeAccountId(i.get("id"),n.accountId)}i.draw(n);localStorage.setItem("intercomUserHash",n.intercomUserHash);fluid.main.fire("editor.afterAccountRegister")}else{return false}},isAccountForever:function(){if((i.get("loggedIn")=="yes")&&(i.get("accType")=="premium1")){return true}return false},defaultAvatarURL:location.href.replace(/[#?].*$/,"")+"img/default-avatar.png",storeGravatar:function(n){var o=document.createElement("canvas"),q=o.getContext("2d");o.width=n.width;o.height=n.height;q.drawImage(n,0,0,n.width,n.height);try{var p=o.toDataURL("data:image/jpg;base64,");localStorage.setItem("gravatarHash",p)}catch(r){console.log("Storage failed: "+r)}},drawGravatar:function(){var n=i.get("email");var o=document.getElementById("gravatar");if(n&&n!=="New"){var q=localStorage.getItem("gravatarHash");if(q){o.src=q;document.getElementById("startMenu").classList.add("has-gravatar")}var p="//www.gravatar.com/avatar/"+fluid.util.getGravatarHash(n)+".jpg?s=140&d="+window.escape(i.defaultAvatarURL);o.onload=function(r){i.storeGravatar(o);document.getElementById("startMenu").classList.add("has-gravatar")};o.onerror=function(){var s=$(this);var t=s.parent(".icon-container");s.remove();var r=new Image();r.src=i.defaultAvatarURL;$(r).attr("id","gravatar").appendTo(t)};o.crossOrigin="Anonymous";o.src=p}},removeGravatarIcon:function(){document.getElementById("startMenu").classList.remove("has-gravatar");document.getElementById("gravatar").src=i.defaultAvatarURL;localStorage.setItem("gravatarHash","")},draw:function(n){$("#profile .createForm").hide();$("#profile #account-wrapper").remove();if($("#profile .createForm").length){$("#profile .createForm").replaceWith($("#tmplAccount").tmpl(n))}else{$("#tmplAccount").tmpl(n).appendTo("#profile")}fluid.main.fire("account.formDrawn");i.setUpgradeLinkStatus();i.drawGravatar();$("#fluidDropdownSubmenu").hide()},drawSignup:function(n){k.ensureInstanceId();var p={index:1,uid:i.get("currentUserId"),email:"",instanceId:g_instanceId};if(n){p.email=n.email;p.error=n.t;p.checked="checked"}$("#fluidDropdownSubmenu").hide();$("#profile .createForm").show();if(i.oldlogin){$("#loadingScreen .createForm").remove();$("#tmplCreate").tmpl(p).appendTo("#profile");var o=$("#profile")}else{setTimeout(function(){i.showSignInScreen()},1000);var o=$("#loadingScreen")}$(".createForm input[name=uid]",o).val(p.uid);$(".createForm input[name=instanceId]",o).val(p.instanceId);$(".createForm input[name=email]",o).val(p.email);$(".createForm input[name=tandc]",o).attr("id",p.index);$(".createForm #createPassword",o).val("");p.index=2;if(n){m.setValid(o.find("[type=email]"));m.setValid(o.find("[type=checkbox]"));setFocus(o.find("[type=password]"))}$("#account-wrapper").remove()},isBrandNewUser:function(){var o=j.get("accounts");if(!o){return true}var n=i.get("id");if(!n){return true}var p=j.get(n);if(!p){return true}return false},checkEmailExists:function(n){var o=$("form.createForm");if(n.length>0){fluid.api.emailRegd(n,function(p){i.emailChecked(p)})}},emailChecked:function(p){var o=$("form.createForm");var p=JSON.parse(p);var n=false;if(p.t===true||p.t==="true"){n=true;o.data("existing",true).find("input[type=submit]").attr("value","Sign In").attr("data-label","Sign In").data("creating",false).removeClass("newAccount")}else{o.data("existing",false).find("input[type=submit]").attr("value","Go").attr("data-label","Go").data("creating",true).addClass("newAccount")}if(f.isOpen){fluidEvent.triggerEditor("emailChecked",{exists:n},true);return}},addProjectId:function(o){var n=i.get("projectIds");if(n.indexOf&&n.indexOf(o)===-1){n=[o].concat(n);i.set({projectIds:n})}},addUploadId:function(p,o){var n=i.get("uploads");n=[{id:p,s:Boolean(o)}].concat(n);i.set({uploads:n})},uploadSynced:function(s,r){var p=i.get("uploads");for(var o=0,n=p.length;o<n;o++){var q=p[o];if(q.id==s){q.s=Boolean(r);i.set({uploads:p});break}}},findUpload:function(q){var p;var n=i.get("uploads");for(var o=0;o<n.length;o++){if(q==n[o].id){p={index:o,upload:n[o]};break}}return p},removeUpload:function(s,r){var q=0;fluid.main.projects.models.forEach(function(t){if(!t.attributes.removed&&t.attributes.uniqueUploads.indexOf(s)!==-1){q+=1}});if(q){if(q===1){suffix=" project."}else{suffix=" projects."}$("#trash").removeClass("droppableStyle");notification.add("alert","Cannot remove upload. It's used in "+q+suffix);return}var o=this.findUpload(s);if(o){var p=$.extend({},o);p.upload=j.get(s);var n=i.get("uploads");ajax.apiCall("img","delete",s,{},function(){if(r){r.call(null,p)}});p.upload.removed=1;j.set(s,p.upload);if(widgets.summary&&widgets.summary[s]){widgets.summary[s].removed=1}$("#libraryWidgetDragging").remove();$("[data-id='"+s+"']").remove();fluid.main.trigger("updateUploadCounters");if(n.length<=0){fluid.main.fire("libraryredrawneeded","Uploads")}}$("#trash").removeClass("droppableStyle")},startCreate:function(o,n){i.displayAccountFrame("upgrade/","create",n||null)},startUpgrade:function(t,o,n,r){var q=typeof n!="undefined"?"Offer":"fluidMenu";var s=$(this).parents(".messages");if(s.length>0){q="Notification"}i.displayAccountFrame("upgrade/",null,o,n,r)},upgradeSuccess:function(p){if(p.a.indexOf("upgrade")==0&&p.r=="s"){i.set({accName:p.accName,accType:p.accType,recurrance:p.recurrance,maxActiveProjects:p.maxActiveProjects,maxPages:p.maxPages,upgradeDate:p.upgradeDate,lastPaymentDate:p.lastPaymentDate,lastPaymentResult:p.lastPaymentResult,nextPaymentDate:p.nextPaymentDate,billingCompany:p.billingCompany,billingAddress:p.billingAddress,billingCountry:p.billingCountry,billingVAT:p.billingVAT});i.set({discount:p.discount?{amount:p.discount,bundleMonths:p.discountBundleMonths,code:p.discountCode,accType:p.discountAccType,recurrance:p.discountRecurrance,endDate:p.discountEndDate,message:p.discountMessage}:null});var n=i.get("id");var q=j.get(n);i.draw(q);if(project.activeProjectCount()>p.maxActiveProjects){project.load()}else{project.setNumber();projectSettings.resetFilter()}if(i.isStandard()){var o=i.get("libraries");i.syncLibs(o)}else{i.hideUserLibs()}fluid.main.fire("accountupgraded")}},recoverPassword:function(){i.displayAccountFrame("recoverPassword/")},displayAccountFrame:function(n,s,u,r,t){i.upgradeFormTriggerTime=new Date().getTime();function v(){o.show();o[0].contentWindow.focus();fluidEvent.triggerEditor("iFrameLoaded",{},true);if(n.indexOf("upgrade/")!==-1){fluid.main.fire("upgradeframeloaded",new Date().getTime()-i.upgradeFormTriggerTime)}a.setEditorVisibility(false);o.unbind("load")}fluid.main.deferReload=true;var o=$("#accountFrame");i.resetAccountFrame();o.load(v);var q={mode:s,type:u,offer:r};for(var p in q){if(typeof q[p]!="undefined"&&q[p]!==null){n+=(n.indexOf("?")==-1?"?":"&")+p+"="+window.encodeURIComponent(q[p])}}if(t){n+=(n.indexOf("?")==-1?"?":"&")+"stayOnFirstScreen=true"}o.attr("src",n);return false},resetAccountFrame:function(){var o=document.getElementById("accountFrame");var n=o.contentDocument||o.contentWindow.document;n.documentElement.innerHTML=""},logout:function(s){if(i.loggingOut){return}i.showLoadingScreen("logout");i.loggingOut=true;page.detachFrame();var o=i.get("email");var n=i.get("uploads");var r=i.get("gridStatus");var p=i.get("gridSpacing");var q=i.get("snapToWidget");i.removeGravatarIcon();$("#msgSyncOnLogout").show();i.syncUp();project.sync(null,function(v,w,u){$("#msgSyncOnLogout").fadeOut(300);if(v.synced&&v.data){if(typeof(v.data)==="string"){v=JSON.parse(v.data)}if(v.r=="f"){notification.add("alert","Unable to save your data. Please try to sign out again.");return}}i.hideUserLibs();projectSettings.resetFilter();project.close();fluid.main.projects.reset();if(widgets.summary){for(var t=0;t<n.length;t++){delete widgets.summary[n[t].id]}l.each(widgets.summary,function(B,A){if(B.g&&B.g==="My Widgets"){delete widgets.summary[A];if(B.ad){l.each(B.ad,function(C){if(C&&C[0]&&widgets.summary[C[0]]){delete widgets.summary[C[0]]}})}}})}j.clear();localStorage.setItem("instanceId",g_instanceId);fluid.controllers.bin.clear();fluid.main.uploads.reset();i.setup();i.createUser();i.set({currentUserId:null,projectIds:[],uploads:[],libraries:[],defaultUserLibrary:"",gridStatus:r,gridSpacing:p,snapToWidget:q,loggedIn:"no"});var z=project.add(s,"Project 1");i.drawSignup();i.loggingOut=false;project.load();fluid.command.create("open",{id:z}).dispatchTo("fluid.controllers.project");$("#previewHolder, #previewHolder2").hide();$("#library").hide();$("#searchBox").val("");i.set({uploads:[],defaultUserLibrary:"",libraries:[],whitelist:null});i.set({uploads:[]});notification.removeAll();i.setLoadingStep(5);i.resetAccountFrame();$("body").removeClass("signed-in");fluid.main.fire("editor.afterLogout");fluid.main.fire("libraryredrawneeded","Wireframe");fluidMenu.hide()});return false},recordActivity:function(q,p){var n=new Date().getTime();var o=n-i.lastActivity;if(q.type==="focus"){i.validateState()}else{if(o>i.safetyInterval){i.validateState()}}i.lastActivity=n},afterStateValidated:function(p,n){if(!$.isFunction(p)&&p!==undefined){n=p}n=$.parseJSON(n);if(n.r==="s"){var o=i.get("status");i.set({status:n.status});i.doAccountStatusAction(o);$("body").addClass("signed-in")}else{$("body").removeClass("signed-in")}i.requireRefresh(n);if(p&&$.isFunction(p)){p()}},afterStateValidatedFailed:function(n){$("body").removeClass("signed-in");i.requireRefresh(n)},validateState:function(o,n){if((i.get("loggedIn")!="yes")||i.get("accType")==="New"){if(o){o()}return}fluid.api.accountState(i.afterStateValidated.bind(this,o),i.afterStateValidatedFailed);return true},requireRefresh:function(n){if(n.a!="accountState"||n.r!="s"){return false}if(n.clientAction=="refresh"){}else{if(n.clientAction=="logout"){i.logout();localStorage.setItem("restoreMyInstanceId","true");k.reloadWithMessage("serverLogout")}else{if(n.clientAction=="warnClose"){k.reloadWithMessage("tab")}}}},setLoadingStep:function(o){var p=($("#previewHolder:visible").size()>0);if(p){return}var n=$(".fluidFillingContainer");var q=5;if(o==0){if($("#loadingScreen").hasClass("close")){i.showLoadingScreen()}return}n.removeClass("loadingStep1 loadingStep2 loadingStep3 loadingStep4 loadingStep5");n.addClass("loadingStep"+o);if(o==q){i.autoOpenFluidMenu();if(i.get("loggedIn")==="yes"){$("#viewport").show();if(!i.signInProgressActive){i.hideLoadingScreen()}}else{if(i.oldlogin){i.hideLoadingScreen()}else{setTimeout(function(){i.showSignInScreen()},1000)}}}},autoOpenFluidMenu:l.once(function(){var n=document.referrer;var o=false;if(n.indexOf("recoverPassword")>-1){o=true}if(o){setTimeout(fluidMenu.show,1000)}}),showLoadingScreen:function(p){var n=$("#loadingScreen");n.removeClass("signIn");if(p){if(p==="logout"){i.changeLoadingMessage("Signing out")}else{if(p==="signing"){i.changeLoadingMessage("Signing in");i.initLoadingProgress($("#loadingScreen"),i.hideLoadingScreen)}else{if(p==="creating"){i.changeLoadingMessage("Creating Account")}}}}n.removeClass("close").addClass("show").show();$("#canvas").hide();var o=i.get("accType");if(!o||o=="New"){}},hideLoadingScreen:function(){a.setEditorVisibility(true);$("#loadingScreen").addClass("close").removeClass("show").removeClass("signIn");i.changeLoadingMessage("Loading");$("#viewport").show();$("#canvas").fadeIn(200,i.afterLoading);if(i.oldlogin){var n=i.get("loggedIn")=="yes"?false:true;if(n){fluidMenu.setButtonStyle($("#startMenu"),n)}}else{fluid.zoom.zoomToAllPages({instantSwitch:true})}},showSignInScreen:function(){if(i.oldlogin){fluidMenu.show()}else{$("#loadingScreen").addClass("signIn")}},hideSignInScreen:function(){$("#loadingScreen").removeClass("signIn")},changeLoadingMessage:function(n){i.hideSignInScreen();$("#loadingScreen .text").text(n)},_loadingSteps:[{start:"projects.syncing",end:"projects.synced",message:"Syncing your projects"},{start:"libs.syncing",end:"uploads.synced",message:"Syncing your library"},{start:"projects.loading",end:"projects.loaded",progress:"project.loaded",message:"Loading projects"},{start:"project.opening",end:"project.opened",message:"Opening last project"},{start:"images.loading",end:"images.loaded",progress:"image.loaded",message:"Loading project images"}],initLoadingProgress:function(n,o){(function(s){var r,t,v=false;function w(B,C){if(!i.signInProgressActive){return}r=0;t=C?C.count:undefined;v=typeof i._loadingSteps[this.step].end=="undefined";$(".text",s).text(i._loadingSteps[this.step].message);if(t){$(".progressBar",s).show().children(".progress").css({width:0})}else{$(".progressBar",s).hide()}}function z(E){if(!i.signInProgressActive){return}if(!E&&i._loadingSteps.progress&&r<t-1){v=true}else{if(this.step==i._loadingSteps.length-1){i.signInProgressActive=false;for(var C=0,B=i._loadingSteps.length;C<B;C++){var D=i._loadingSteps[C];D.start&&fluid.main.off(D.start,w);D.end&&fluid.main.off(D.end,z);D.progress&&fluid.main.off(D.progress,p)}$(".progressBar",s).hide();if($.isFunction(o)){window.setTimeout(o,100)}}}}function p(B,C){if(!i.signInProgressActive){return}if(typeof C.count!="undefined"){t=C.count}else{t=typeof t!="undefined"?Math.max(C.step+1,t):C.step+1}r=C.countdown?t-C.step-1:C.step;$(".progressBar",s).show().children(".progress").css({width:((r+1)/t*100)+"%"});if(v&&r>=t-1){z()}}for(var A=0,u=i._loadingSteps.length;A<u;A++){var q=i._loadingSteps[A];q.start&&fluid.main.on(q.start,w,{step:A});q.end&&fluid.main.on(q.end,z,{step:A});q.progress&&fluid.main.on(q.progress,p,{step:A})}})(n);i.signInProgressActive=true},afterLoading:function(){$(".fluidFillingContainer").removeClass("loadingStep1 loadingStep2 loadingStep3 loadingStep4 loadingStep5");clearTimeout(i.loadingTimeout)},bundleSettings:function(){var n={hint:i.get("hint"),tutorialLevel:i.get("tutorialLevel"),billingCompany:i.get("billingCompany"),billingAddress:i.get("billingAddress"),billingCountry:i.get("billingCountry"),billingVAT:i.get("billingVAT"),gridStatus:i.get("gridStatus"),gridSpacing:i.get("gridSpacing"),snapToWidget:i.get("snapToWidget"),receiptEmails:i.get("receiptEmails"),emailReceiptEnabled:i.get("emailReceiptEnabled"),lastOpenProject:i.get("lastOpenProject"),defaultUserLibrary:i.get("defaultUserLibrary")};return n},syncUp:function(o){if(i.get("loggedIn")!="yes"){return}var n=fluid.main.account.bundle();fluid.api.accountSettingsSync(n,o,o)},needHints:function(){return i.get("hint")=="end"?false:true},setUpgradeLinkStatus:function(){var o=i.get("accName");var p=i.get("accType");var n=p=="Free"||o==""||o==undefined?"Upgrade":o;$(".currentAccType").text(o);$("#upgradeLink").val(n);if(i.isAccountForever()){$("#upgradeLink, #userSettingsChangeAccount").hide()}else{$("#upgradeLink, #userSettingsChangeAccount").show()}},canAddProjects:function(){return true},isFreeAccount:function(){return i.get("accType")=="Free"},isStandard:function(){return i.get("loggedIn")==="yes"&&!/^Free$|lite|lite_2$/.test(i.get("accType"))},isPro:function(){return i.get("loggedIn")==="yes"&&!/^Free$|lite|lite_2|silver$/.test(i.get("accType"))},hasUpload:function(p){if(!p){return false}var n=i.get("uploads");if(!n){return true}for(var o=0;o<n.length;o++){if(n[o].id===p){return true}}return false},doAccountStatusAction:function(o){var p=i.get("status");var n=false;switch(p){case"pendingCardUpdate":n=true;$("#updateCardForced").show();f.hideCloseButton();if(!$("#userSettingsPanelCard").is(":visible")){f.open(null,$("#userSettingsPanelCard"));f.goToCardUpdate()}break}if(o=="pendingCardUpdate"&&!n){f.showCloseButton();f.close();$("#updateCardForced").hide()}},alertEditInactive:function(){var n=i.canAddProjects()?i.alerts.editInactive.canActivate:i.alerts.editInactive.needUpgrade;notification.add("alert",n,{scope:"projectInactive",permanent:true,stopBuggingCallBack:true})},validateProjectsCount:function(){if(i.get("loggedIn")!=="yes"){return}fluid.api.listProjects(i.get("id"),function(n){n=JSON.parse(n);if(n.r==="f"){i.logout();notification.add("alert","An unknown error has occurred. Please log in again to view your projects.");return}var p=JSON.parse(n.t);var o=fluid.main.projects.filter(function(r,q,s){if(r.get("removed")){return false}return true});if(o.length<p.length){i.logout();notification.add("alert","An unknown error has occurred. Please log in again to view your projects.")}})},checkUserSession:function(n){if(!localStorage){return}var p,o="session";var u=document.cookie.split(/;\s*/);for(var t=0,q=u.length;t<q;t++){var v=u[t].split("=");if(v[0]==o){p=v[1];break}}var s=localStorage.getItem(o);if(s){if(s!=p){if(i.get("loggedIn")==="yes"){try{i.logout();localStorage.clear()}catch(r){}if(n){localStorage.setItem("postloadMessage","loginAgain")}location.reload()}else{if(p){localStorage.setItem(o,p)}else{localStorage.setItem("postloadMessage","panicRefresh");location.reload()}}}}else{localStorage.setItem(o,p)}},watchUserSession:function(n){if(!localStorage){return}window.setTimeout(function(){i.checkUserSession(n);i.watchUserSession(n)},2000)}};fluid.main.on("accountParamsChanged",i.syncUp);b.exports=i},{"./class-canvas":4,"./class-storage":24,"./class-userSettings":26,"./fluid/fluid.util":43,"./fluid/lib/underscore":46,"./functions":58,"./utils":60}],3:[function(c,d,a){var b=(function(){var q={},i={iPadRetina:{width:1024,height:768,pixelRatio:2,icon:152,splashP:"1536x2008",splashL:"2048x1496"},iPad:{width:768,height:1024,pixelRatio:1,icon:152,splashP:"768x1004",splashL:"1024x748"},iPhone5:{width:320,height:568,pixelRatio:2,icon:120,splash:"640x1096"},iPhone4:{width:320,height:480,pixelRatio:2,icon:120,splash:"640x920"},iPhone:{width:320,height:480,pixelRatio:1,icon:120,splash:"320x460"},iPhone6:{width:375,height:667,pixelRatio:1,icon:120,splash:"750x1334"},"iPhone6+":{width:414,height:736,pixelRatio:3,icon:180,splash:"1242x2208"}},s={splashPiPad:[{x:768,y:1004},{x:1536,y:2008}],splashLiPad:[{x:1024,y:748},{x:2048,y:1496}],splashiPhone5:[{x:640,y:1096}],splashiPhone6:[{x:1242,y:2208}],"splashiPhone6+":[{x:640,y:1096}],splashiPhone:[{x:320,y:460},{x:640,y:920}]},p={};function j(){var u,t;for(u in i){if(i.hasOwnProperty(u)&&screen.width===i[u].width&&screen.height===i[u].height&&window.devicePixelRatio===i[u].pixelRatio){t=u;break}}return t?{device:t,screen:i[t]}:{device:"",screen:{splashP:"",splashL:""}}}function m(G,F,D,w){w=w||projectSettings.getLastSelectedObject();if(G){if(q[G]!==null&&q[G]!==undefined){var u=G+"Branding",H=!project.isOpen(w.id),z=H?w:{};if(q[G]){var E=s[G]&&s[G].length,A=0;if(E){z[u]=w[u]||{};for(;A<E;A++){var I=s[G][A],v=utils.guid("j"),C=fluid.util.dataUrlToBlob(fluid.util.resizeImage(q[G].dataUrl,I.x,I.y),{type:"image/png"}),t=[I.x+"x"+I.y],B=H?z[u]:project.get(u);p[v]={remove:(B instanceof Object)?B[t]:B,key:G,onSuccess:F,onError:D,proj:w};ajax.apiCall("img","post",v,C,o,r);z[u][t]=v}}else{var v=utils.guid("i");p[v]={remove:H?z[u]:project.get(u),key:G,onSuccess:F,onError:D,proj:w};ajax.apiCall("img","post",v,q[G].file,o,r);z[u]=v}q[G]=null}else{z[u]="";q[G]=null}if(H){project.sync(w.id,null)}else{project.set(z)}}return}for(G in q){if(q.hasOwnProperty(G)){m(G,F,D,w)}}}function o(v,w){var t=p[w],u=t&&t.proj||projectSettings.getLastSelectedObject();if(t&&t.remove){ajax.apiCall("img","delete",t.remove)}p[w]=null;typeof t.onSuccess==="function"&&t.onSuccess.apply(this,arguments)}function r(w,A){var t=p[A],v=t&&t.proj||projectSettings.getLastSelectedObject(),z=!project.isOpen(v.id),u=z?v:{};notification.add("alert",l(t.key)+" branding image could not be uploaded. Please try again.");if(t&&t.remove){if(t.details){u[t.key+"Branding"]=u[key+"Branding"]||{};u[t.key+"Branding"][details]=t.remove}else{u[t.key+"Branding"]=t.remove}typeof t.onError==="function"&&t.onError.apply(this,arguments)}if(z){project.sync(projObject.id,null)}else{project.set(u)}p[A]=null}function n(u,t,w){var v=(w?w:projectSettings.getLastSelectedObject())[u+"Branding"];if(v instanceof Object){if(t===undefined||t===null||t===""){t=s[u]&&s[u][0].x+"x"+s[u][0].y}v=v[t]}return v?ajax.apiObjectUrl("img",v):""}function k(u,t,w){var v=(w?w:projectSettings.getLastSelectedObject())[u+"Branding"];if(v instanceof Object){if(t===undefined||t===null||t===""){t=s[u]&&s[u][0];return v[t]||v}return v[t]}return v}function l(t){if(/icon/.test(t)){return"App Icon"}if(/iPhone/.test(t)){return"Loading image"}if(/splashP/.test(t)){return"Portrait Splash image"}if(/splashL/.test(t)){return"Landscape Splash image"}return}function f(u,w,z,v){if(w){if(!/^image\/(png|jpeg)$/i.test(w.type)){notification.add("alert","You may only upload JPEG and PNG images");return}var t=new FileReader();t.onloadend=function(A){if(A.target.readyState===FileReader.DONE){q[u]={file:w,dataUrl:A.target.result};if(typeof z==="function"){z(A.target.result)}}else{if(typeof v==="function"){v(A)}}};t.onerror=v;t.readAsDataURL(w)}else{q[u]=""}}function h(t){if(t){q[t]=null}else{for(t in q){if(q.hasOwnProperty(t)){q[t]=null}}}}return{changeImage:f,resetChange:h,update:m,getUrl:n,get:k,screens:i,sizes:s,getTitle:l,deviceScreen:j}}());d.exports=b},{}],4:[function(c,h,b){var a=c("./utils");var j=c("./class-fluidMenu");var f=c("./class-grid");var d=c("./class-contextMenu");var i={setContainment:function(){var l=a.getTLWH("#viewport");var k=a.getTLWH("#canvas");var m=10;var n=[l.left+l.width-k.width-m,l.top+l.height-k.height-m,l.left+m,l.top+m];return n},setScreenContainment:function(){var m=$("#canvasPages .screen");if(m.length==0){return}var l=a.getTLWH("#canvas");var k=fluid.zoom.getCurrentScale();m.each(function(){i.setPageContainment(this,l,k)})},setPageContainment:function(n,l,k){if(!$(n).data("initDraggable")){return}l=l||a.getTLWH("#canvas");k=fluid.zoom.getCurrentScale();var m=a.getTLWH(n);var o=[l.left,l.top,l.left+Math.floor((l.width))-(m.width*k),l.top+Math.floor((l.height))-(m.height*k)];$(n).draggable("option","containment",o)},dragStart:function(l){if($("#canvas").data("zooming")){return false}d.place("hide");if(fluid.zoom.isEditMode()){$("#canvasLinks").hide()}var k=document.getElementById("canvas");k.style.cursor="-webkit-grabbing";k.style.cursor="-moz-grabbing";k.style.cursor="grabbing"},drag:function(k){},dragStop:function(k){if(!fluid.zoom.isEditMode()){fluid.main.project.set({canvasPosY:-parseInt($("#viewport").get(0).scrollTop),canvasPosX:-parseInt($("#viewport").get(0).scrollLeft)})}i.setScreenContainment();$("#canvasLinks").fadeIn(200);if(fluid.zoom.getCtx()!=="project"){project.updatePages();project.updateLinks()}d.place();document.getElementById("canvas").style.cursor=""},isZoomedOut:function(){return $("#canvas").hasClass("zoomedOut")},isEditorVisible:function(){return $("#canvas").hasClass("editing")},setEditorVisibility:function(k){if(k){$("#canvas").addClass("editing");j.setCanvasFirstPage();f.selectBackground()}else{$("#canvas").removeClass("editing");fluid.controllers.bin.hide()}}};h.exports=i},{"./class-contextMenu":5,"./class-fluidMenu":8,"./class-grid":9,"./utils":60}],5:[function(c,f,b){var a=c("./class-propertyInspector");var h=c("./class-page");var d={buttonCollapsedSize:32,buttonExpandedSize:68,dragStart:function(){$("#contextMenuItems").toggleClass("locked").data("preventClick",true)},dragStop:function(){setTimeout(function(){$("#contextMenuItems").data("preventClick",false)},1)},linkClickDragStart:function(j){var i=$("#cmLink").data("lastClicked")||0;if((new Date()).getTime()>i+600){$("#cmLink2").simulate("mousedown").simulate("mousemove",{clientX:j.clientX,clientY:j.clientY})}$("#cmLink").data("lastClicked",(new Date()).getTime());return false},toggleReplace:function(){},place:function(l){var q=fluid.selection.getSelectionModel();if(l=="hide"||q.length==0){d.hide();return true}if($("#contextMenuItems").data("open")!==false){d.open()}if($("#contextMenuItems").hasClass("locked")||l=="dontMovePosition"){var i=parseFloat($("#contextMenu2").css("left"));var p=parseFloat($("#contextMenu2").css("top"));var m=parseFloat($("#contextMenuItems").css("left"))+i;var n=parseFloat($("#contextMenuItems").css("top"))+p;var j=utils.getTLWH("#viewport");if(m<j.width-100&&n<j.height-100){$("#contextMenu2").show();return true}}var k=d.getCmCoords(q);$("#contextMenu2").show().find("#contextMenuItems").addClass("trans150").css({top:k.top,left:k.left});function o(){$("#contextMenuItems").removeClass("trans150");a.position();staticWidgets.positionMenu();h.displayMenu(false)}setTimeout(o,160)},getCmCoords:function(j){var k=j.getRoots().getElements();var n=utils.getBoundingArea(k);var m,l,i=$("#library");m=n.left+170;l=n.top-47;if(n.top<90){l=60;if(n.bottom<$("#viewport").height()/2){l=n.bottom+70}}if(n.left<400){m=550}if(parseInt(i.css("left"))===0){m=i.width()+550}return{left:m,top:l}},hide:function(){d.setButtonStyle($("#cmLink"),false,false);$("#contextMenu2").hide();a.hideInspectors();h.displayMenu()},open:function(){function j(A){var z=0;A.each(function(){var C=$(this).attr("id");var B=widget.get(C);if(B.seg||B.segment){z+=1}});return z}h.displayMenu(false);var w=fluid.selection.getSelectionModel().getRoots().getElements();var q=w.length;var v=3;var i={up:-41,left:-44,down:0,right:47};$(".subExpander").not(".open").css({top:""}).hide();var u=fluid.selection.getSelectionModel().getElements();var n=j(w);var s;var r=group.enableGroupBtns(w);$("#contextMenuItems .cm").hide().each(function(){var B=$(this);if(q<2&&B.hasClass("multiSelectOnly")){return true}if(q>1&&B.hasClass("singleWidgetOnly")){return true}if(B.hasClass("multiSelectOnly")&&r=="ungroup"){return true}if(B.hasClass("widgGroupOnly")){if(r){if(r==false||r=="ungroup"){return true}}else{return true}}if(B.hasClass("widgUngroupOnly")&&r!="ungroup"){return true}if(B.hasClass("multiSegmentOnly")&&n>1){return true}if(B.hasClass("multiSegmentOnly")){if(r&&r=="ungroup"){return true}}if(B.hasClass("multiSegmentOnly")&&(!widget._isMultiSegment(u.attr("id")))){return true}if(B.hasClass("zAlignOnly")&&(!u.hasClass("rootWidget")||u.hasClass("backgroundWidget"))){return true}if(B.hasClass("replaceGroupOnly")){return true}if(B.hasClass("duplicatableOnly")&&u.hasClass("backgroundWidget")){return true}var A=widget.get(u.attr("id"));if(A.tc&&B.hasClass("backgroundBorderOnly")){return true}if(!A.bgc&&!A.b&&!A.seg&&!A.upload&&B.hasClass("backgroundBorderOnly")){return true}if(B.hasClass("uploadOnly")&&A.upload!=="y"){return true}if(A.st=="b"&&B.hasClass("staticWidgetsOnly")){return true}if((!widget.containsText(u))&&(B.hasClass("textOnly"))){return true}if(B.hasClass("standardAccountOnly")&&!account.isStandard()){return true}if(B.hasClass("proAccountOnly")&&!account.isPro()){return true}if(B.hasClass("saveToLibOnly")&&!fluid.controllers.widget.canSaveSelectionToLib()){return true}B.show();var z=B.find(".icon2");var D;if(z.find(".buttonText").text()==""){D=z.width()}else{D=z.width()}var C=v+D+9;var E=D-d.buttonCollapsedSize;if(B.hasClass("up")){B.css({top:i.up});i.up-=C}if(B.hasClass("left")){B.css({left:i.left-E});i.left-=C}if(B.hasClass("down")){B.css({top:i.down});i.down+=C}if(B.hasClass("right")){B.css({left:i.right});i.right+=C}});$("#contextMenuItems").data("open",true);a.update();staticWidgets.updateMenu();hint.show("link");var l=document.getElementById("cmAutofitButtons");if(w[0]){var m=storage.get(w[0].id);if(m.upload==="y"){var p=storage.get(document.querySelector(".canvasObject.active").id),o=widgets.summary[m.data]?widgets.summary[m.data].wh:storage.get(m.data).wh,k=document.getElementById("cmFitToPage"),t;if(o[0]<p.width&&o[1]<p.height){k.classList.add("expand");t="Expand to Fit"}else{k.classList.remove("expand");t="Shrink to Fit"}k.setAttribute("title",t);k.setAttribute("alt",t)}}},close:function(){staticWidgets.hideMenu();a.resetPropInspector();a.hideInspectors();$("#contextMenuItems div, #contextMenuItems a").not(".up, #hint").css({left:0,top:0});$("#contextMenuItems").data("open",false);$(".subExpander").removeClass("open");d.closeSubmenu($(".subExpander"));d.resetButtonsToOriginal(true);h.displayMenu()},markAsLastClicked:function(){if($(this).hasClass("subExpander")){$(this).siblings().not(".subExpander, .lastClicked").removeClass("lastClicked")}else{$(this).siblings().not(this).not(".subExpander").removeClass("lastClicked")}$(this).addClass("lastClicked")},toggleSubmenu:function(){d.eraseSubmenu(this);if($(this).hasClass("open")){d.closeSubmenu(this)}else{d.openSubmenu(this)}return false},openSubmenu:function(j){$(j).addClass("open");var i=0;$(j).parent().children().removeClass("hidden").each(function(){$(this).css("top",i);i+=40});$(j).parent().css("height",i-29);$(j).siblings().show()},closeSubmenu:function(i){var j=$(i).siblings();$(i).removeClass("open").css("top","");j.css("top",0);$(i).parent().css("height","");setTimeout(function(){j.not(".lastClicked").addClass("hidden")},250)},eraseSubmenu:function(i){var j=$(".cm").filter(".left");var k=$([]);j.each(function(){var m=$(this);var o=parseInt(m.css("height"));var n=44;if(o>n){var l=m.children().not(i);k=k.add(l);m.css({height:n})}});k.each(function(){var m=$(this);if(m.hasClass("subExpander")){var l=m.siblings();m.removeClass("open").css("top","");l.css("top",0);m.parent().not(".lastClicked").css("height","");setTimeout(function(){l.not(".lastClicked").addClass("hidden")},250)}})},toggle:function(i){if($("#contextMenuItems").data("preventClick")==true){return false}if($("#contextMenuItems").data("open")){d.close()}else{d.open()}},cmZAlign:function(j,i){fluid.command.create("setZOrder",{id:fluid.selection.getSelectionModel().getRoots().map(function(k){return k.id}),dir:i}).dispatchTo("fluid.controllers.widget")},cmZAlign2:function(l,i,k){k=k||$(l.target).parent().attr("id");i=i||fluid.selection.getSelectionModel().getRoots().getElements();var j=null;i.each(function(){obj=$(this);var m=$('[data-lockto="'+obj.attr("id")+'"]');j=obj.parent();if(k=="cmFront"){m.detach().appendTo(j)}else{if(k=="cmBack"){if(j.find(".backgroundWidget").length>0){m.detach().insertAfter(j.find(".backgroundWidget"))}else{var q=account.get("gridStatus");if(q=="on"){m.detach().insertAfter("#gridSquares")}else{if(q=="off"){m.detach().prependTo(j)}}}}else{if(k=="cmFrontOne"){var n=obj.nextAll(".rootWidget").not(".ui-selected").first();if(n.length==0){return false}var p=$('[data-lockto="'+n.attr("id")+'"]').last();m.detach().insertAfter(p)}else{if(k=="cmBackOne"){var o=obj.prevAll(".rootWidget").not(".ui-selected").not("#canvasPages .backgroundWidget").first();if(o.length==0){return false}var p=$('[data-lockto="'+o.attr("id")+'"]').first();m.detach().insertBefore(p)}}}}});if(j!=null){h.orderWidgets(j)}return false},cmAlign:function(j,i){fluid.command.create("align",{id:fluid.selection.getSelectionModel().getRoots().filter(function(k){if(k.get("st")==="b"){return false}return true}).map(function(k){return k.id}),dir:i}).dispatchTo("fluid.controllers.widget")},cmAlign2:function(l,i,k){var k=k||$(l.target).parent().attr("id");var i=i||fluid.selection.getSelectionModel().getRoots().filter(function(m){if(m.get("st")==="b"){return false}return true}).getElements();var j=utils.getBoundingAreaRelative(i);i.each(function(){var o=null,q=null;var p=$(this);var s=p.attr("id");var n=group.calculateAlign(s,p);switch(k){case"cmAlignLeft":o=parseFloat(p.css("left"))-j.left-n.left;break;case"cmAlignCenter":o=parseFloat(p.css("left"))+(parseFloat(p.outerWidth()))/2-(j.left+j.right)/2;if(n.width>0){o=n.groupLeft+(n.width/2)-(j.right+j.left)/2}break;case"cmAlignRight":o=parseFloat(p.css("left"))+p.outerWidth()-j.right+n.right;break;case"cmAlignTop":q=parseFloat(p.css("top"))-j.top-n.top;break;case"cmAlignMiddle":q=parseFloat(p.css("top"))+(parseFloat(p.outerHeight()))/2-(j.bottom+j.top)/2;if(n.height>0){q=n.groupTop+(n.height/2)-(j.top+j.bottom)/2}break;case"cmAlignBottom":q=parseFloat(p.css("top"))+p.outerHeight()-j.bottom+n.top;break;default:return false}if(o===0&&q===0){return true}var m=$('[data-lockto="'+$(this).attr("id")+'"]');var r=widget.get($(this).attr("id"));m.each(function(){var z=$(this).attr("id");var w=widget.get(z);var t=$.extend([],w.tlwh);if(o!=null){var v=parseFloat($(this).css("left"))-o;$(this).addClass("trans150").css("left",v);if(t[1].toString().indexOf("%")==-1&&$(this).attr("id")==$(this).attr("data-lockto")){t[1]=v;widget.set({tlwh:t},$(this).attr("id"))}}if(q!=null){var u=parseFloat($(this).css("top"))-q;$(this).addClass("trans150").css("top",u);if(t[0].toString().indexOf("%")==-1&&$(this).attr("id")==$(this).attr("data-lockto")){t[0]=u;widget.set({tlwh:t},$(this).attr("id"))}}})});setTimeout(function(m){$(".trans150").removeClass("trans150");d.changeSelSize(i)},160);return false},changeSelSize:function(i){var j=propInspectorCtrl.currentSelection;var i=i||widget.getRoots(j).not(".backgroundWidget");var k=utils.getBoundingAreaRelative(i);updateTLWH(k);widget.addResizeSettings()},setButtonStyle:function(o,l,n){var i=l?0:1;var k=n==undefined?true:n;var j=$(o).hasClass("cm")?$(o):$(o).parent();var p=$(o).hasClass("icon2")?$(o):$(o).children("a");var r=$(".buttonText",p);if(i==0){if(p.hasClass("cmButtonExpanded")){d.resetButtonsToOriginal(false,j);d.adjustButtonsPosition(j,false,false)}}else{if(!p.hasClass("cmButtonExpanded")){d.adjustButtonsPosition(j,true,k);p.addClass("cmButtonExpanded");var q=p.attr("data-text-alt");if(k){function m(){r.text(q);p.animate({width:d.buttonExpandedSize+"px"},500,"swing")}p.css({width:d.buttonCollapsedSize+"px"});setTimeout(m,500)}else{p.css({width:d.buttonExpandedSize+"px"});r.text(q)}}}},resetButtonsToOriginal:function(i,j){var k=j==undefined?$(".cm"):j;if(i){k.css({left:"0px"})}$.each(k,function(m,l){var n=$(l).children("a");$(".buttonText",n).text("");n.css({width:d.buttonCollapsedSize+"px"}).removeClass("cmButtonExpanded")})},adjustButtonsPosition:function(i,l,j){if(i==null){d.open();return}var p=d.buttonExpandedSize-d.buttonCollapsedSize;var n=$(i);var q=n.hasClass("left")?"left":"right";var m=$(".cm."+q);var o=l?p:p;var k=parseInt($(n).css("left"));k=q=="left"?k:k+1;$.each(m,function(s,t){var u=parseInt($(t).css("left"));if((u!=0)&&(Math.abs(u)>=Math.abs(k))){var r=q=="left"?-1:1;var v=u+(o*r);if(j){$(t).animate({left:v+"px"},1000,"swing")}else{$(t).css({left:v+"px"})}}})},removeOtherCmMenus:function(k){for(var j=0;j<k.length;j++){if(k[j]){switch(k[j]){case"staticWidgets":staticWidgets.hideMenu();break;case"propertyInspector":a.hideInspectors();a.resetPropInspector();break}}}}};f.exports=d},{"./class-page":15,"./class-propertyInspector":21}],6:[function(c,d,b){var a={dbAvailable:null,db:null,readyListeners:[],versionNumber:44,onReady:function(f){if(a.db||a.dbAvailable===false){f()}else{a.readyListeners.push(f)}},init:function(){if(location.origin==="file://"){a.dbAvailable=false;return}var f;if(window.indexedDB){f=window.indexedDB.open("fluidDB",a.versionNumber)}else{f=window.shimIndexedDB.open("fluidDB",a.versionNumber)}f.onupgradeneeded=function(i){a.dbAvailable=true;if(!this.result.objectStoreNames.contains("rastPages")){var h=this.result.createObjectStore("rastPages",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data");h.createIndex("by_project","project")}if(!this.result.objectStoreNames.contains("uploads")){h=this.result.createObjectStore("uploads",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(!this.result.objectStoreNames.contains("projects")){h=this.result.createObjectStore("projects",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(!this.result.objectStoreNames.contains("uiIcons")){h=this.result.createObjectStore("uiIcons",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(!this.result.objectStoreNames.contains("uploadThumbs")){h=this.result.createObjectStore("uploadThumbs",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(!this.result.objectStoreNames.contains("uploadHeaders")){h=this.result.createObjectStore("uploadHeaders",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(!this.result.objectStoreNames.contains("wdgDefinitions")){h=this.result.createObjectStore("wdgDefinitions",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(!this.result.objectStoreNames.contains("accounts")){h=this.result.createObjectStore("accounts",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(i.oldVersion!==0){a.clearStores=true}};f.onsuccess=function(h){a.dbAvailable=true;a.db=this.result;if(localStorage.getItem("account.loginStarted")==="true"&&localStorage.getItem("account.loginEnded")===null){a.clearStores=true}if(a.clearStores){var j;for(var k=0;k<a.db.objectStoreNames.length;k++){j=a.getObjectStore(a.db.objectStoreNames[k],"readwrite");j.clear()}a.db.close();localStorage.clear();localStorage.setItem("indexedDBreloaded",true);localStorage.setItem("postloadMessage","updateLogout");setTimeout(function(){window.location.reload()},3000);return}for(var k=0;k<a.readyListeners.length;k++){a.readyListeners[k]()}localStorage.setItem("indexedDBreloaded",false)};f.onerror=function(h){a.dbAvailable=false;if(!localStorage.getItem("clearedIndexedDb")){setTimeout(function(){window.indexedDB.deleteDatabase("fluidDB");localStorage.clear();localStorage.setItem("clearedIndexedDb",true);window.location.reload()},2000)}else{localStorage.removeItem("clearedIndexedDb")}if(h.target.error.name&&localStorage.getItem("indexedDBreloaded")==="false"){setTimeout(function(){a.clear();localStorage.clear();localStorage.setItem("indexedDBreloaded",true);localStorage.setItem("postloadMessage","updateLogout");window.location.reload()},5000)}};f.onblocked=function(h){a.dbAvailable=false};setTimeout(function(){if(!a.db){notification.add("alert","Unable to initialise local database. Please restart your browser.",{permanent:true})}},6000)},getObjectStore:function(f,i){var h=a.db.transaction(f,i);return h.objectStore(f)},clear:function(){window.indexedDB.deleteDatabase("fluidDB")},set:function(j,l,m){if(l.length===undefined){l=[l]}if(l.length===0||a.dbAvailable===false){console.log("not saved: ",l.length,a.dbAvailable);if(m){m()}return}var h=a.getObjectStore(j,"readwrite");for(var k=0;k<l.length;k++){var f=h.put(l[k]);f.onsuccess=function(){if(k===l.length&&m){m({success:true})}};f.onerror=function(){if(k===l.length&&m){m({success:false})}}}},remove:function(h,k,l){if(k.length===undefined){k=[k]}if(k.length===0||a.dbAvailable===false){if(l){l()}return}var f=a.getObjectStore(h,"readwrite");for(var j=0;j<k.length;j++){f["delete"](k[j]).onsuccess=function(i,n,m){if(i===n.length-1&&m){m()}}.bind(this,j,k,l)}},list:function(f,k){var i=a.db.transaction(f);var j=i.objectStore(f);var h=[];j.openCursor().onsuccess=function(l){var m=l.target.result;if(m){h.push(m.key);m["continue"]()}else{if(k){k(h)}}}},get:function(f,l,o){var k={failed:[],fetched:[],resultsArr:[],resultsObj:{}};if(l.length===undefined||typeof(l)==="string"){l=[l]}if(l.length===0||a.dbAvailable===false){if(o){o(k)}return}var j=a.db.transaction(f);var n=j.objectStore(f);var m;for(var h=0;h<l.length;h++){m=n.get(l[h]);m.onsuccess=function(i,p){if(this.result){k.fetched.push(i);k.resultsObj[i]=this.result}else{k.failed.push(i);k.resultsObj[i]=null}k.resultsArr.push(k.resultsObj[i]);if(o&&k.resultsArr.length===l.length){o(k)}}.bind(m,l[h])}}};d.exports=a},{}],7:[function(c,d,b){var a={lastEvent:"",lastTrigger:new Date().getTime(),triggerEditor:function(f,i,h){a._trigger($("#canvas"),f,i,h)},bindEditor:function(f,h){a._bind($("#canvas"),f,h)},triggerPreview:function(f,i,h){a._trigger($("#home"),f,i,h)},_trigger:function(j,f,l,k){var i=false;var h=new Date().getTime();var m=k||false;if((a.lastEvent!=f)||(h-a.lastTrigger>500)||m){i=true}if(i){j.trigger(f,l);a.lastEvent=f;a.lastTrigger=h}},_bind:function(h,f,i){h.live(f,i)}};d.exports=a},{}],8:[function(d,h,c){var f=d("./class-contextMenu");var a=d("./utils");if(!fluid.controllers){fluid.controllers={}}fluid.controllers.bin=d("./fluid/controllers/bin");var b=["orange","red","lightBlue","green","darkBlue","yellow"];var i={openDuration:300,closeDuration:300,click:function(k){var j=$(k.target);if(k.target.id=="tsandcsLabel"||k.target.id=="tsandcs1"||j.hasClass("createAccount")||j.parent().hasClass("GSWidget")||j.parent().hasClass("helpButton")||j.hasClass("projectSettingsButton")||j.parent().hasClass("projectSettingsButton")){return true}if(k.target.tagName=="INPUT"&&j.hasClass("title")){j.focus();j.select()}if((k.target.id=="upgradeLink")||(k.target.id.indexOf("userSettingsLink")>-1)){return true}if(((j.parent().attr("id")=="logout")||(j.attr("id")=="logout"))){account.logout();if(!window.watchingSignupForm){i.watchSignupForm()}}if(k.target.tagName=="A"&&!j.hasClass("submenuLink")){return true}},toggle:function(){if($("#fluidDropdown").is(":visible")){f.place();i.hide()}else{f.place("hide");i.show(this)}widget._stopEditingText()},feedbackAjaxResponse:function(j){$("#feedbackForm").empty()},setupFeedback:function(l){$("#feedbackForm").empty();var k=account.get("email");if(k==null||k=="New"){k=""}var j=account.get("name");if(j==null){j=""}$("#tmplFeedback").tmpl({name:j,email:k}).appendTo("#feedbackForm");$("#feedbackForm input").not("[type=hidden]").each(function(){validateInput(l,this)})},hide:function(){if($("#startMenu").hasClass("open")){$("#hud").data("openMenu",false);$("#startMenu").removeClass("open");var j=$("#fluidDropdown");a.animateRaf(function(k){j.css({"-webkit-transform":"scale("+(1-k)+")","-moz-transform":"scale("+(1-k)+")"})},i.closeDuration,"easeInOutQuad",function(){j.removeAttr("style").hide()});$(".messageError").hide();i.resetSelectedMenu()}},show:function(m){var j=arguments[0];fluid.main.fire("closeallpopups",null,$("#fluidDropdown"));$("#fluidDropdown .overview article").hide();if($("#fluidDropdown .fluidSubmenuActive").length>0){var m=$("#fluidDropdown .fluidSubmenuActive").attr("data-for")}$(".loginMessage").hide();$("#"+m).show();$("#startMenu").addClass("open");var l=$("#fluidDropdown").css({"-webkit-transform":"scale(0.05)","-moz-transform":"scale(0.05)"}).show();a.animateRaf(function(n){l.css({"-webkit-transform":"scale("+n+")","-moz-transform":"scale("+n+")"})},i.openDuration,"easeOutBack",function(){l.removeAttr("style").show();if(j){project.renderPreview(account.get("lastOpenProject"))}});var k=account.get("accType");if(!k||k=="New"){i.watchSignupForm()}if(document.getElementById("createEmail")){document.getElementById("createEmail").focus()}},watchSignupForm:function(){window.watchingSignupForm=true;var n=$("#createEmail");var k=$("#createPassword");var l=n.add(k);function j(o){if(o.which){$(this).data("keyDown",true)}}l.on("keydown",j);function m(){var o;if(!$("#fluidDropdown").is(":visible")){l.off("keydown",j);return}if(n.data("lastVal")!=n.val()){n.data("lastVal",n.val());if(!n.data("keyDown")){validateInput.call(n.get(0));account.checkEmailExists(n.val())}}if(k.data("lastVal")!=k.val()){k.data("lastVal",k.val());if(!k.data("keyDown")){validateInput.call(k.get(0))}}l.data("keyDown",false);window.setTimeout(m,300)}m()},openDropdown:function(l){$(".loginMessage").hide();var k=$(this);var m=k.attr("data-for");var j=$("#"+m);$("#fluidDropdownSubmenu a").removeClass("fluidSubmenuActive").filter("[data-for="+m+"]").addClass("fluidSubmenuActive");$("#fluidDropdown article").not("#"+k.attr("data-for")).hide();j.fadeIn(200)},resetSelectedMenu:function(j){var l=$(".fluidSubmenuActive").attr("data-for");var k=j||false;if(!k){if((account.get("loggedIn")=="no")&&(l!="profile")){k=true}else{if(l=="help"){k=true}}}if(k){$(".submenuLink").removeClass("fluidSubmenuActive");$(".submenuLink[data-for='profile']").addClass("fluidSubmenuActive")}},setButtonStyle:function(m,l,o){var n=l?0:1;var j=o==undefined?true:o;var p=n==0?"data-style-ori":"data-style-alt";var k=n==0?"data-text-ori":"data-text-alt";$.each(m,function(u,z){if($(z).hasClass("hud-button")){var r=$(z);if(l){r.addClass("expanded")}else{r.removeClass("expanded")}return}var q=$(".icon",$(z));var t=$(z).parent();var v=q.attr(p);var s=q.attr(k);if((v)&&(v!="")){var w=$(".iconAvatarContainer",q);w.attr("class","iconAvatarContainer "+v)}var A=$(".buttonText",q);if((s)&&(s!="")&&t.hasClass("hudButtonPlaceHolderCollapsed")){t.removeClass("hudButtonPlaceHolderCollapsed");q.removeClass("iconCollapsed");$(z).removeClass("buttonCollapsed");t.addClass(j?"hudButtonPlaceHolderExpanding":"hudButtonPlaceHolderExpanded");q.addClass(j?"iconExpanding":"iconExpanded");$(z).addClass(j?"buttonExpanding":"buttonExpanded");A.text(s);A.addClass("textVisible")}else{if((!(t.hasClass("hudButtonPlaceHolderCollapsed")))&&(n==0)){t.addClass(j?"hudButtonPlaceHolderCollapsing":"hudButtonPlaceHolderCollapsed");q.addClass(j?"iconCollapsing":"iconCollapsed");$(z).addClass(j?"buttonCollapsing":"buttonCollapsed");A.text("");A.removeClass("textVisible")}}})},removeButtonAnimation:function(j){$(this).parent().hasClass("hudButtonPlaceHolderExpanding")?$(this).parent().removeClass("hudButtonPlaceHolderExpanding").addClass("hudButtonPlaceHolderExpanded"):null;$(this).parent().hasClass("hudButtonPlaceHolderCollapsing")?$(this).parent().removeClass("hudButtonPlaceHolderCollapsing").addClass("hudButtonPlaceHolderCollapsed"):null;$(this).hasClass("buttonExpanding")?$(this).removeClass("buttonExpanding").addClass("buttonExpanded"):null;$(this).hasClass("buttonCollapsing")?$(this).removeClass("buttonCollapsing").addClass("buttonCollapsed"):null;$(this).hasClass("iconExpanding")?$(this).removeClass("iconExpanding").addClass("iconExpanded"):null;$(this).hasClass("iconCollapsing")?$(this).removeClass("iconCollapsing").addClass("iconCollapsed"):null;if($(this).hasClass("shiningLight")){$(this).remove()}$(".buttonText").removeClass("textVisible")},highlightButton:function(j){$.each(j,function(k,l){$(".shiningLight",$(l)).remove();$("<div class='shiningLight'></div>").appendTo($(l));$(".shiningLight").addClass("start")})},setCanvasNoPages:function(k){var j=$("#createNewPage, #previewView, #createNewPageButton, #preview, #pagePreview, #shareMenu");fluid.controllers.bin.hideEmpty();j.addClass("hud-hidden");if(k){setTimeout(hint.restart,300)}},setCanvasFirstPage:function(){if(!fluid.main.project.get("active")&&fluid.main.project.get("pages")&&fluid.main.project.get("pages").length){$("#createNewPage, #createNewPageButton").removeClass("hud-hidden");if(fluid.zoom.getCtx()!=="project"){$("#zoomOut").removeClass("hud-hidden")}fluid.controllers.bin.show()}else{$("#createNewPage, #createNewPageButton").addClass("hud-hidden");fluid.controllers.bin.hideEmpty()}if(fluid.main.project.widgets.length){$("#previewView, #preview, #pagePreview, #shareMenu").removeClass("hud-hidden");$("#pagePreview").parent().show()}else{$("#previewView, #preview, #pagePreview, #shareMenu").addClass("hud-hidden").removeClass("expanded");$("#pagePreview").parent().hide()}}};fluid.main.on("closeallpopups",function(j,l,k){if(!k||!k.length){k=$([]);if($(l.target).closest("#fluidDropdown").length>0||l.target.tagName=="A"||$(l.target).is(".open-fluid-menu, .open-fluid-menu *")||$(l.target).is("#startMenu, #startMenu *")){k=k.add("#fluidDropdown")}}if(!$("#fluidDropdown").is(k)){i.hide()}});h.exports=i},{"./class-contextMenu":5,"./fluid/controllers/bin":32,"./utils":60}],9:[function(b,d,a){var c={toggle:function(){var f=account.get("gridStatus");(f=="on")?c.hideGridSettingsMenu():c.showGridSettingsMenu();return false},hideGridSettingsMenu:function(){$("#gridSwitchOn, #gridControls, #gridControlHeading, #gridSpaceSlider, #gridSpacingInput").hide();$("#gridSwitchOff").show();c.hideGrid();snap.disableGridSnap();account.set({gridStatus:"off"})},showGridSettingsMenu:function(){$("#gridSwitchOff, #gridControls").hide();$("#gridSwitchOn").show();$("#gridControls, #gridControlHeading, #gridSpaceSlider, #gridSpacingInput").show();account.set({gridStatus:"on"});c.getGridSpacing();snap.setSnapToGrid();c.showGrid()},changeGridSpacing:function(h,f){account.set({gridSpacing:f.value});snap.checkSnapStatus();snap.setSnapToGrid();c.drawGrid();$("#gridSpaceSlider").find(".ui-slider-handle").text(f.value+"px")},getGridSpacing:function(){var f=account.get("gridSpacing");snap.setSnapToGrid();c.updateSliderPos(f)},updateSliderPos:function(f){$("#gridSpaceSlider").slider("value",f).find(".ui-slider-handle").text(f+"px")},pageDims:false,currentPageID:false,currentPageGridHolder:false,getPageProps:function(){var k=project.getActivePageId();var h=$("#"+k).find(".page").find(".widgetHolder");c.currentPageID=k;c.currentPageGridHolder=h;var i=page.get(k,"width");var f=page.get(k,"height");var j={width:i,height:f};c.pageDims=j;return h},showGrid:function(h,f){if(project.readOnly()){return false}$("#gridSquares").remove();var j=c.getPageProps();var i=j.find(".backgroundWidget").attr("id");if(i){$("#tmplGrid").tmpl(c.pageDims).appendTo("#"+i)}else{$("#tmplGrid").tmpl(c.pageDims).prependTo(j)}c.drawGrid()},drawGrid:function(){function f(){m.beginPath();m.strokeStyle="rgb(127,185,240)";m.lineWidth=l;for(var i=(k*5);i<c.pageDims.height;i+=(k*5)){m.moveTo(0,i);m.lineTo(c.pageDims.width,i)}for(var i=(k*5);i<c.pageDims.width;i+=(k*5)){m.moveTo(i,0);m.lineTo(i,c.pageDims.height)}m.stroke()}if(account.get("gridStatus")!="on"){return}var k=account.get("gridSpacing");var h=$("#gridSquares");if(h.size()==0){return}var m=(h[0]).getContext("2d");m.clearRect(0,0,c.pageDims.width,c.pageDims.height);if(k<4){m.clearRect(0,0,c.pageDims.width,c.pageDims.height);return}var l=1;m.beginPath();m.strokeStyle="rgb(176,217,255)";m.lineWidth=l;for(var j=k;j<c.pageDims.height;j+=k){m.moveTo(0,j);m.lineTo(c.pageDims.width,j)}for(var j=k;j<c.pageDims.width;j+=k){m.moveTo(j,0);m.lineTo(j,c.pageDims.height)}m.stroke();f(k)},hideGrid:function(){$("#gridSquares").remove()},selectBackground:function(){if(fluid.zoom.isEditMode()){var f=account.get("gridStatus");if(f=="on"){c.showGrid()}else{return}}},zoomIn:function(){if(project.readOnly()){return}var f=account.get("gridStatus");if(f=="on"){c.showGridSettingsMenu()}else{if(f=="off"){c.hideGridSettingsMenu()}}snap.checkSnapStatus()}};d.exports=c},{}],10:[function(b,c,a){var d={drawExisting:function(j){function l(v,u){for(var s in u){var o=u[s];var t=s;var q=_.last(o);if(v==q){var r=d.getCommonArray(t,u);var p=_.last(r);if(t==p){d.draw(t,u)}}}}d.erase();if(fluid.zoom.isEditMode()){var j=(j)?j:$("#canvasPages").find(".screen.active").attr("id");if(!j){return}var f=$.extend({},storage.get(j));var n=f.widgets;if(!n){return}for(var h=0;h<n.length;h++){var m=n[h];var k=project.get("widgetGroups");l(m,k)}}},enableGroupBtns:function(p){var p=p.not(".backgroundWidget");var o=p.length;var l=project.get("widgetGroups");var m=(o>1)?true:false;if(l){var k=d.createSelArray(p,l);var q=[];for(var f=0;f<k.length;f++){var h=k[f];if(h.charAt(0)=="g"){var j=d.getCommonArray(h,l);var n=_.last(j);q.push(n)}else{if(h.charAt(0)=="w"){q.push(h)}}}var q=fluid.util._.uniq(q);if(q.length>=1){if(q.length==1){var m=(q[0].charAt(0)=="w")?false:"ungroup"}else{var m=true}}}return m},calculateAlign:function(s,q){var i=project.get("widgetGroups");var f={left:0,right:0,top:0,bottom:0};for(var l in i){var k=i[l];var w=k.indexOf(s);if(w>-1){var D=$("#"+l);var m=_.last(k);var B=parseFloat($("#"+m).css("top"));var A=parseFloat($("#"+m).css("left"));var p=parseFloat(D.css("width"));var r=parseFloat(D.css("height"));var n=A+parseFloat(D.css("left"));var j=B+parseFloat(D.css("top"));var o=r+B;var v=p+n;var u=parseFloat(q.css("left"));var z=parseFloat(q.css("top"));var h=parseFloat(q.css("width"))+u;var C=parseFloat(q.css("height"))+z;f.left=u-n;f.top=z-j;f.right=v-h;f.bottom=o-C;f.height=r;f.width=p;f.groupLeft=n;f.groupTop=j}}return f},copyGroups:false,copy:function(k){d.copyGroups=false;var i=project.get("widgetGroups");var h=$.extend([],k);if(i){var j=d.createSelFromArray(h);var f=widget.getRoots(j);f.each(function(n){var m=$(this).attr("id");for(var o in i){var l=i[o];var q=l.indexOf(m);if(q>-1){var p=h.indexOf(m);if(p>-1){h[p]=o}}}})}d.copyGroups=h},allGroups:false,paste:function(n,o){function j(w,s,v){var u=[];for(var t=0;t<(v.length+1);t++){if(v[t]==s){u.push(q[t])}}d.allGroups[w]=u}var p=project.get("widgetGroups");d.allGroups=false;d.allGroups=$.extend({},p);var q=$.extend([],n);var r=$.extend([],o);var h=_.uniq(r);for(var l=0;l<h.length;l++){var k=h[l];if(k.charAt(0)=="g"||k.charAt(0)=="G"){var m=d.createGroupIndex(d.allGroups);j(m,k,r,q)}}var f=d.allGroups;project.set({widgetGroups:f});d.drawExisting()},select:function(){d.deselect();var m=project.get("widgetGroups");if(m){var h=$("#"+fluid.selection.getSelectionModel().getRoots().getIds().join(", #"));var n=d.createSelArray(h,m);for(var k=0;k<n.length;k++){var o=n[k];if(o.charAt(0)=="g"){var j=d.getCommonArray(o,m);var f=_.last(j);if(o==f){var l=$("#"+o);if(l){l.addClass("selectedGroup")}}}}}return fluid.selection.getSelectedEls()},createSelFromArray:function(j){var h=$([]);for(var f=0;f<j.length;f++){h=h.add($("#"+j[f]))}return h},store:function(){return JSON.stringify(project.get("widgetGroups"))},removeOnDelete:function(l){var j=project.get("widgetGroups");if(j){var k=d.createSelFromArray(l);var m=$.extend({},j);var f=widget.getRoots(k);var n=d.createSelArray(f,j);for(var h=0;h<n.length;h++){var o=n[h];if(o.charAt(0)=="g"){delete m[o]}}}project.set({widgetGroups:m})},restore:function(h){var i=project.get("widgetGroups");var f=JSON.parse(h.widgetGroups);if(f){var j=h.id;project.set({widgetGroups:f});d.drawExisting(h.pageId)}},selArray:[],deleteIds:[],createSelArray:function(f,h){var f=f.not(".backgroundWidget");d.selArray=[];d.deleteIds=[];f.each(function(){var m=$(this);var o=m.attr("id");d.selArray.push(o);for(var l in h){var k=h[l];var n=k.indexOf(o);if(n>-1){d.selArray.push(l);d.deleteIds.push(o)}}});var j=_.uniq(d.selArray);var i=_.uniq(d.deleteIds);j=_.difference(j,i);return j},getCommonArray:function(h,k){l=[];var k=(!k)?project.get("widgetGroups"):k;var j=k[h];for(var f in k){var m=_.intersection(j,k[f]);if(m.length>0){l.push(f)}}var l=_.uniq(l);return l},draw:function(l,r){function u(z){var C=$([]);for(var B=0;B<z.length;B++){var A=$("#"+z[B]);C=C.add(A)}return C}var j=l;var t=r[j];var i=u(t);var o=i.last();var n=widget.getLockTos(o);var h=(n.length>0)?n:o;var f=utils.getBoundingAreaRelative(i);var k=f.right-f.left;var q=f.bottom-f.top;var p=parseInt(h.css("top"));var s=parseInt(h.css("left"));var m=(p-f.top)*-1;var w=(s-f.left)*-1;var v={top:m,left:w,width:k,height:q,groupId:j};$("#tmplWidgGroup").tmpl(v).appendTo("#"+h.attr("id"))},addWidgets:function(f){function i(){var j=$(this);var k=j.attr("id");h.push(k)}var h=new Array;var f=f.not(".backgroundWidget");f.each(i);return h},createGroupIndex:function(l){(l)?l:project.get("widgetGroups");for(var j in l){var h=j}var k=h.replace("g","");var f=parseInt(k);f="g"+(f+1);return f},create:function(j){function f(){$("#multiSelBox").remove();d.drawExisting();$("#"+l).addClass("selectedGroup");contextMenu.hide();contextMenu.place();updateTLWH();widget.drawMultiSelBox(p)}var p=widget.getRoots(j||$("#canvasPages .ui-selected")).not(".backgroundWidget");var k=project.get("widgetGroups");var i=d.addWidgets(p);var n=d.enableGrouping(p,k,i);if(n==true){if(!k||jQuery.isEmptyObject(k)==true){var l="g1";var m={g1:i}}else{var l=d.createGroupIndex(k);var h=$.extend({},k);h[l]=i;var m=h}var o=new fluid.models.WidgetGroup({id:l,widgets:[].concat(i)});fluid.main.project.wdgGroups.add(o);project.set({widgetGroups:m});setTimeout(f,100)}return l},enableGrouping:function(q,j,f){var o=true;if(f.length<2){var o=false;return o}if(j){var n=d.createSelArray(q,j);var p=false;var k=false;for(var m=0;m<n.length;m++){var l=n[m];if(l.charAt(0)=="g"){var r=j[l];var h=_.difference(r,f);if(h.length<1&&(f.length==r.length)){var p=true}}}if(p==true){var o=false}}return o},erase:function(){$("#canvasPages .groupWidgetHolder").remove()},deselect:function(){$("#canvasPages .groupWidgetHolder").removeClass("selectedGroup")},getIdFromGroup:function(l,m){var k=false;for(var j in l){var f=l[j];var h=_.difference(f,m);if(h.length<1){k=j}}return k},ungroup:function(l){function m(){d.drawExisting();$("#multiSelBox").remove();contextMenu.hide();contextMenu.place();updateTLWH();widget.drawMultiSelBox(l);d.select(l)}var k=project.get("widgetGroups");if(k){var l=(l)?l:$("#canvasPages .ui-selected");var f=widget.getRoots(l);var f=f.not(".backgroundWidget");var n=d.addWidgets(f);var h=d.enableGrouping(f,k,n);if(h==false){var j=d.getIdFromGroup(k,n);if(j){var i=$.extend([],k);delete i[j];project.set({widgetGroups:i});fluid.main.project.wdgGroups.remove(j);setTimeout(m,100)}}else{return}}}};fluid.main.on("closeallpopups",d.deselect);c.exports=d},{}],11:[function(c,f,a){var d=c("./fluid/fluid.module");var b=c("./fluid/lib/underscore");d.define("fluid.hoverListMenu",function(h){h.getMenuFromChild=function(i){return $(i).closest(".hover-list-menu")[0]};h.expand=function(l,q,o){q=q||l._newActiveList;if(!q||q===l._activeList){return}var p;if(!o&&l._activeList&&l._activeList!==q){var r=$(l._activeList);r=r.add(r.parents(".expandable.expanded"));for(p=r.length-1;p>=0;p--){k=r[p];if(k===q){break}shrink(l,k)}}var m=$(q),j=m.add(m.parents(".expandable"));for(p=j.length-1;p>=0;p--){var k=j[p];var n=k.querySelector(".hover-menu-group").clientHeight;k.style.height=40+n+"px";k.classList.add("expanded")}l._activeList=q;l._newActiveList=null;l._staleList=null};h.shrink=function(k,j){j=j||k._activeList;if(!j){return}j.style.height="";$(j).removeClass("expanded").find(".expanded").removeClass("expanded");var i=$(j).parents(".expandable.expanded");if(i.length){h.expand(k,i[0],true)}if(j===k._activeList){k._activeList=null}fluid.main.fire("libMenuShrinking")};h.select=function(j,i){i=i||j._activeList;if(!i||$(i).hasClass("locked")){return}h.expand(j,$(i).closest(".expandable")[0]);$(j).find(".selected").removeClass("selected");$(i).addClass("selected").parents(".expandable").addClass("selected")};h.shrinkStaleList=function(j,i){i=i||j._staleList;if(!i){return}if(tip.hovering){return}shrink(j,i);j._staleList=j._activeList=null};h.clearState=function(i){i._activeList=i._newActiveList=i._staleList=i._prevMouseMove=i._prevMouseDown=null};h.debounceExpand=b.debounce(h.expand,100);h.debounceshrinkStaleList=b.debounce(h.shrinkStaleList,400);h.init=function(){$(document).on("click",".expandable",function(i){var k=i.currentTarget,j=h.getMenuFromChild(k);if(i===j._prevMouseMove){return}j._newActiveList=k;j._prevMouseMove=i;if($(k).hasClass("expanded")){h.shrink(j,k)}else{h.expand(j,k)}}).on("click",".selectable",function(i){var k=i.currentTarget,j=h.getMenuFromChild(k);h.select(j,k)})}})},{"./fluid/fluid.module":41,"./fluid/lib/underscore":46}],12:[function(c,b,f){var l=c("./class-dbStorage");var i=c("./class-account");var h=c("./class-widget");var a=c("./fluid/fluid.templating");var m=c("./class-search");var d=c("./class-hoverListMenu");var k=c("./class-tracker");var j={cached:{},fadeInSpeed:300,thumbPos:{},currentDisplay:"",drawTimeout:null,defaultGroup:0,allDefinitions:["common","android","wireframe","android5","android4","ios","ios7","ios8","windows8","desktop","googleGlass","galaxyGear","androidWear","pebble","appleWatch"],loadedDefinitions:[],defaultDefinition:"wireframe",groupList:[],loadDefinition:function(p){var q=new XMLHttpRequest();q.open("GET","js/fluid/data/widgets/"+p+".json?ver="+l.versionNumber,false);try{q.send(null);var n=JSON.parse(q.responseText);l.set("wdgDefinitions",{id:p,data:n});return n}catch(o){q.responseType="json";try{q.send(null)}catch(s){}l.set("wdgDefinitions",{id:p,data:q.response});return q.response}},loadWdgDefinitions:function(n){if(!n){l.onReady(function(){var o=["groups","categories","common"].concat(j.allDefinitions);l.get("wdgDefinitions",o,function(u){var v,r,s,p=u.resultsObj,t;if(!(p.groups||p.categories||p[j.defaultDefinition])){window.widgets={g:j.loadDefinition("groups"),t:j.loadDefinition("categories"),summary:{}};v=j.loadDefinition(j.defaultDefinition);for(s in v){if(v.hasOwnProperty(s)){window.widgets.summary[s]=v[s]}}r=j.loadDefinition("common");for(s in r){if(r.hasOwnProperty(s)){window.widgets.summary[s]=r[s]}}j.loadedDefinitions.push(j.defaultDefinition)}else{window.widgets={g:p.groups.data,t:p.categories.data,summary:{}};for(t=0;t<u.fetched.length;t++){if(u.fetched[t]!=="groups"&&u.fetched[t]!=="categories"){for(s in p[u.fetched[t]].data){if(p[u.fetched[t]].data.hasOwnProperty(s)){window.widgets.summary[s]=p[u.fetched[t]].data[s]}}j.loadedDefinitions.push(u.fetched[t])}}}for(var q in widgets.g){widgets.g[q].groups.forEach(function(w){j.groupList.push(w.id)})}j.preloadBgImages();j.init();j.ready=true;fluid.main.trigger("libready")})})}},addLibrary:function(p){var q=p.widgets;for(var r in q){window.widgets.summary[r]=q[r]}delete j.cached[p.name];var o=$('#lib-menu li[data-for="'+i.userLibraryGroup+'"] li.lib-link'),n=false;o.each(function(s,t){if($(t).data("for")==p.name){n=true;return false}});if(!n){$("#tmplLibMenuItem").tmpl({id:p.name,icon:"your-library",title:i.defaultUserLibrary}).insertAfter(o.last())}},removeLibrary:function(q){var s=window.widgets.summary,r=[];for(var t in s){if(s[t].g&&s[t].g[0]==q){r.push(t)}}for(var p=0,o=r.length;p<o;p++){delete window.widgets.summary[r[p]]}delete j.cached[q];var n=$('#lib-menu li[data-for="'+i.userLibraryGroup+'"] li.lib-link');n.each(function(u,v){if($(v).data("for")==q){if(j.currentDisplay==q){j.setActiveCategory("Wireframe")}$(v).remove();return false}})},addWidget:function(o,n){window.widgets.summary[o]=n;if(_.isArray(n.g)){n.g=n.g[0]}if(n.g&&j.cached[n.g]){if(j.currentDisplay==n.g){$("ol[data-groupName='"+n.g+"']").append(j.getWidgetHtml(o,n));page.renderer.afterPageRendered=j.afterUserWdgRender;page.renderer.renderWdg(o,n)}else{delete j.cached[n.g]}}},removeWidget:function(p,o){var n=window.widgets.summary[p];delete window.widgets.summary[p];if(n.g&&j.cached[n.g]){$("#"+p).remove()}},afterUserWdgRender:function(p,o){var n=new Image();n.width=50;n.height=50;n.src=o;setTimeout(function(){$("#"+p).prepend(n)},100)},preloadBgImages:function(p){if(p>j.groupList.length-2){return}var n=j.groupList[(p!==undefined?p:this.defaultGroup)].replace(".","_").toLowerCase();var o=new Image();o.onload=function(r){var q;if(p===undefined){q=0}else{q=p+1}if(q==j.defaultGroup){q++}setTimeout(function(){j.preloadBgImages(q)},300)};o.src="img/libBg/libBg-"+n+".png?ver="+l.versionNumber},closed:function(){return $("#library").find("#tabLibrary").hasClass("closed")},toggle:function(){var r=$("#library");function o(){var u=r.find("#tabLibrary");u.toggleClass("closed open");var s=u.hasClass("closed");var t=(s)?"Open Library":"Close Library";n.attr("title",t);if(fluid.zoom.getCtx()==="page"){fluid.zoom.zoomToPage({pageId:$(".screen.active").attr("id"),libToggled:true,keepZoomCenter:true})}else{fluid.zoom.onSelectionChanged()}}var n=r.find("#tabLibrary");var q=r.outerWidth();var p=(n.hasClass("open"))?-q:0;r.animate({left:p},j.fadeInSpeed,"easeInOutQuad",o);if(closed){fluid.main.fire("libraryClosing")}},show:function(n){var p=$("#library");if(j.closed()){p.show();if(n&&$.isFunction(n)){n()}}else{if(p.position().left!=0||!p.is(":visible")){var o=i.get("libraryWidth");p.css({left:"-"+o+"px",display:"block",width:o});utils.animateRaf(function(q){p.css({left:(o*(q-1))+"px"})},j.fadeInSpeed,"easeInOutQuad",function(){if(p.children("#widgets").find(".thumb").height()===0||(j.currentDisplay==="Uploads"&&(!j.lastAccount||j.lastAccount!==i.get("id")))){j.lastAccount=i.get("id");j.updateScrollbar()}if(n&&$.isFunction(n)){n();j.updateScrollbarRelative()}})}}},resize:function(q,o){var n=o.size.width;i.set({libraryWidth:n});var p=$("#canvasPages .active");if(p.length==1){fluid.zoom.zoomToPage(p)}j.updateScrollbar()},setHeaderHoverIn:function(n){$(this).find("h6").stop(true,true).delay(300).fadeTo(200,1);setTimeout(function(){$(this).css("background","#ccc")},600)},setHeaderHoverOut:function(n){$(this).find("h6").stop(true,true).hide();setTimeout(function(){$(this).css("background","rgba(205,205,205,0.0)")},600)},collapseSection:function(t){var p=$(this).parents(".basicBG").attr("id");var q=$("#"+p);var u=q.children(".scrollbar");var n=u.children(".track");var o=n.children(".thumb");var s=parseFloat(o.css("top"));if($(this).hasClass("closed")){$(this).removeClass("closed").html("Hide")}else{$(this).addClass("closed").html("Show")}$(this).parent("header").siblings("ol").toggleClass("hidden");$(this).parent("header").siblings(".hideButton").toggleClass("hidden");$(q).tinyscrollbar();var r=(s+o.height())-n.height();if(r<0){r=0}q.tinyscrollbar_update(s-r)},updateScrollbar:function(){$("#widgets").tinyscrollbar()},updateScrollbarRelative:function(){$("#widgets").tinyscrollbar_update("relative")},scrollBottom:function(){$("#widgets").tinyscrollbar_update("bottom")},init:function(){j.drawMenu();fluid.main.on("editor.afterLogin",j.refreshLockedLibsStatus);fluid.main.on("editor.afterLogout",j.drawMenu);fluid.main.on("afteruploadssynced",function(){if(j.currentDisplay=="Uploads"){j.draw(j.currentDisplay)}});fluid.main.on("syncdownlibrefreshneeded",function(q,s){$("#msgLoadingAfterLogin").hide();var r=$("#widgetGroupTitle").text();if(s&&r==s){j.draw(r)}i.setLoadingStep(5)});fluid.main.on("libraryredrawneeded",function(q,r){j.draw(r)});fluid.main.on("libraryadded",function(q,r){j.addLibrary(r)});fluid.main.on("accountupgraded",j.refreshLockedLibsStatus);fluid.main.on("libremovalneeded",function(q,r){j.removeLibrary(r)});j.draw(j.groupList[this.defaultGroup]);j.currentDisplay=j.groupList[this.defaultGroup];h.addUploads();var n=[];var p=i.get("uploads");if(p){for(var o=0;o<p.length;o++){n.push(p[o].id)}}l.onReady(function(){l.get("uploadThumbs",n,function(r){if(!window.uploadThumbsCache){window.uploadThumbsCache={}}for(var q=0;q<r.fetched.length;q++){uploadThumbsCache[r.fetched[q]]=r.resultsObj[r.fetched[q]].data}})});fluid.main.projects.on("add remove",j.updateProjectsList);fluid.main.uploads.on("add",function(t,q){var s=q.attributes;var r=fluid.util.tpl("uploadMarkup",{id:s.id,title:s.title,uploadThumbsCacheExists:!!uploadThumbsCache[s.id],src:uploadThumbsCache[s.id]});j.canvasToLoad($('[data-groupname="Uploads"],#project-notInAny .uploadTabs-project').prepend(r).find("canvas.toLoad"));j.setCounter("notInAny",parseInt($("#project-notInAny").find(".tab-count").text(),10)+1)});fluid.main.uploads.on("change:removed",function(u,q,t){if(t===0){var s=q.attributes;var r=fluid.util.tpl("uploadMarkup",{id:s.id,title:s.title,uploadThumbsCacheExists:!!uploadThumbsCache[s.id],src:uploadThumbsCache[s.id]});j.canvasToLoad($('[data-groupname="Uploads"],#project-notInAny .uploadTabs-project').prepend(r).find("canvas.toLoad"));j.setCounter("notInAny",parseInt($("#project-notInAny").find(".tab-count").text(),10)+1)}else{$('[data-id="'+q.id+'"]').remove();j.setCounter("notInAny",parseInt($("#project-notInAny").find(".tab-count").text(),10)-1)}})},_createDragHelper:function(s){var q=$(this).attr("id");if(!q){q=$(this).attr("data-id")}var n=$.extend(true,{isHelperWidget:true,widgetId:q},h.get(q));n.wh=n.wh||[80,120];n.wh[0]=(n.wh[0]=="a")?"100%":n.wh[0];n.wh[1]=(n.wh[1]=="a")?"100%":n.wh[1];if(n.upload==="y"){var r=storage.get(document.querySelector(".canvasObject.active").id),p=utils.getFitSize({object:{width:n.wh[0],height:n.wh[1]},frame:{width:r.width,height:r.height}});n.wh=[p.width,p.height]}n.wh[0]=(typeof n.wh[0]==="string")?$("#canvasPages .active .widgetHolder").width()*parseInt(n.wh[0])/100:n.wh[0];n.wh[1]=(typeof n.wh[1]==="string")?$("#canvasPages .active .widgetHolder").height()*parseInt(n.wh[1])/100:n.wh[1];var o=(n.st&&n.st=="b")?[0,0,80,120]:[0,0,n.wh[0],n.wh[1]];var t=$("#tmplDraggingWidgetContainer").tmpl(n);if(n.upload=="y"){t.addClass("upload")}else{if($(this).hasClass("userWidget")){t.addClass("userWidget")}}h._drawFromRoot($(this).attr("id")||$(this).attr("data-id"),t.find(".widgetParts"),o,n);t.find(".container").css("transform","scale("+fluid.zoom.getCurrentScale()+")");return t},setActiveCategory:function(n,p){var o=parseFloat($("#widgets").children(".scrollbar").find(".thumb").css("top"));j.thumbPos[j.currentDisplay]=o;j.closeMenu();fluid.hoverListMenu.select($("#lib-menu")[0],$('#lib-menu [data-for="'+n+'"]')[0]);setTimeout(function(){var q=j.currentDisplay!=n;if(q){j.draw(n);j.currentDisplay=n}if(p){window.setTimeout(function(){j.scrollBottom()},100);if(q){window.setTimeout(function(){j.scrollBottom()},4000)}}else{$("#widgets").tinyscrollbar_update(j.thumbPos[n])}k.record("LibarySetChange"+n,1)},10)},adjustToCssClass:function(n){n=n.replace(".","_").toLowerCase();return n},draw:function(v,A){var q={Wireframe:"wireframe",Desktop:"desktop","Android-5":"android5",iOS8:"ios8","iOS8-tablet":"ios8",iOS7:"ios7",iPad:"ios",iPhone:"ios","Android-4.4":"android4","Android-Tablet":"android4",Android:"android","Google-Glass":"googleGlass","Galaxy-Gear":"galaxyGear","Android-Wear":"androidWear",Pebble:"pebble","Apple-Watch":"appleWatch","Windows-8":"windows8"};if(q[v]&&j.loadedDefinitions.indexOf(q[v])===-1){var o=j.loadDefinition(q[v]),r;for(r in o){if(o.hasOwnProperty(r)){window.widgets.summary[r]=o[r]}}j.loadedDefinitions.push(q[v])}if(v===undefined||v===null){v=j.currentDisplay}var n=j.currentDisplay;var t=$("#library").removeClass(this.adjustToCssClass(n)).addClass(this.adjustToCssClass(v));var p=v.toLowerCase()=="uploads";var u=v==n;j.currentDisplay=v;var z=$("#widgets .viewport");z.find(".overview").hide().remove();if(p){if(j.cached.hasOwnProperty(v)){delete j.cached[v]}}var s=j.cached.hasOwnProperty(v);if(!s&&!u){$("#libraryLoading").show()}function w(){function B(){if($.isFunction(A)){A()}}$("#libraryLoading").hide();if(!s){if(v==="Uploads"){j.cacheUploads()}else{j.cache(v)}}j.cached[v].appendTo(z);if(u){j.cached[v].show()}else{j.cached[v].fadeIn(this.fadeInSpeed,B)}m.filter();j.drawTimeout=null;if(u){B()}}if(u){w()}else{if(j.drawTimeout){window.clearTimeout(j.drawTimeout)}j.drawTimeout=window.setTimeout(w,10)}return false},drawSingleUpload:function(u,t){var s=$("[data-groupName='Uploads']");if(s.length){var n=$("<li id="+u+' class="libraryWidget" title="Click or drag-and-drop to add" style="background-image: none;">');var o=$('<div class="pageWidget" style="top:2px;left:2px;width:50px;height:50px;">');n.append(o);o.append('<canvas width="50" height="50" id="'+u+'-thumb"></canvas>');o.append('<div class="widgetTitle">'+t+"</div>");var q=o[0].querySelector("canvas");q.style.backgroundImage="url(img/ajax-loader.gif)";q.style.backgroundSize="100%";s.prepend(n);var p=new Image(),r=storage.get(u);p.onload=j.onUploadLoad;p.onerror=j.onUploadError;if(r&&r.storage!=="db"){p.crossOrigin="Anonymous";p.src=imgCloudUrl+(widgets.summary[u].data||u)+".png"}else{p.src="data/img/"+u}}else{j.draw("Uploads")}},onUploadComplete:function(n){if(n.success){j.onUploadLoad(n)}else{j.onUploadError(n)}},_onUploadLoad:function(n){var p=n.image,r=n.id;var o=widgets.summary[r];var q=document.querySelectorAll('canvas[data-id="'+r+'-thumb"]');if(o){if(!o.wh[0]){o.wh[0]=this.width}if(!o.wh[1]){o.wh[1]=this.height}if(!o.groups){o.groups=[]}}if(q.length){Array.prototype.forEach.call(q,function(t){t.style.backgroundImage="none";var s=t.getContext("2d");s.fillStyle="#cccccc";s.fillRect(0,0,50,50);if(p.width===0&&p.height===0){s.drawImage(p,0,0)}else{if(p.width<=50&&p.height<=50){s.drawImage(p,25-p.width/2,25-p.height/2-Math.max((34-p.height)/2,0))}else{if(p.width<p.height){s.drawImage(p,0,0,50*p.width/p.height,50)}else{s.drawImage(p,0,0,50,50*p.height/p.width)}}}})}},onUploadLoad:function(n){if(i.get("loggedIn")==="no"){return}if(n.image){j._onUploadLoad(n)}else{if(n.imgData){n.image=new Image();n.image.onload=j._onUploadLoad.bind(n.image,n);n.image.onerror=function(o){};n.image.src=n.imgData}}},onUploadError:function(){},createLibOrder:function(s){var r=[];var p=$.extend(true,{},widgets.summary);for(var n in p){if(p.hasOwnProperty(n)){r.push(n)}}var o=r;if(s=="Desktop"){var q=widgetLibOrder.createOrder();if(q.length>0){o=q}}if(s==="Uploads"){o.reverse()}return o},cacheUploads:function(){var u=$('<nav class="overview" style="display:none;"></nav>');if(i.get("loggedIn")==="yes"){u.append($("#tmplUpload").tmpl())}else{u.append($("#tmplUploadDisabled").tmpl());j.cached.Uploads=u;return}var r="";var t="";var p="";var q="";var s=fluid.main.projects.models.sort(function(w,v){return w.attributes.updated<v.attributes.updated});var o=[];var n=[];fluid.main.uploads.models.forEach(function(w){var v=w.attributes;if(!v.removed){r+=fluid.util.tpl("uploadMarkup",{id:v.id,title:v.title,uploadThumbsCacheExists:!!uploadThumbsCache[v.id],src:uploadThumbsCache[v.id],count:fluid.main.uploads.length})}});t=fluid.util.tpl("uploadTabsTpl",{allUploads:r,openAllUploads:true});s.forEach(function(z){var w=z.attributes.name;var A=z.attributes.id;var v=_.map(z.attributes.uniqueUploads,function(B){return fluid.main.uploads.get(B).attributes});v.forEach(function(B){n.push(B.id)});p+=fluid.util.tpl("uploadTabsProject",{id:A,name:w,currentProject:(z.id===fluid.main.project.id),activeProject:(z.id===fluid.main.project.id),empty:(v.length===0),uploads:v,count:v.length})});fluid.main.uploads.models.forEach(function(v){if(v.attributes.removed){return}if(n.indexOf(v.id)===-1){o.push(v)}});q+=fluid.util.tpl("uploadTabsProject",{id:"notInAny",name:"Not in any projects",notInAny:true,activeProject:true,empty:(o.length===0),uploads:_.map(o,function(v){return v.attributes}),count:o.length});u.append(t);u.find("#perProjectGroupContainer").prepend(p);u.find("#perProjectGroupContainer").prepend(q);j.cached.Uploads=u;j.canvasToLoad(u.find("canvas.toLoad"))},canvasToLoad:function(o){o.each(function(r,t){var s=$(t);var u=s.attr("data-id").replace("-thumb","");var p=new Image();var q=fluid.main.uploads.get(u).attributes;p.onload=function(){n(s,u,p)};p.onerror=j.onUploadError;if(uploadThumbsCache[u]){p.src=uploadThumbsCache[u]}else{if(q&&q.storage==="cloud"){p.crossOrigin="Anonymous";p.src=imgCloudUrl+u+".png"}else{p.src="data/img/"+u}}s.removeClass("toLoad")});function n(t,u,q){var s=t[0];var r=widgets.summary[u];if(r){if(!r.wh[0]){r.wh[0]=s.width}if(!r.wh[1]){r.wh[1]=s.height}}s.style.backgroundImage="none";var p=s.getContext("2d");p.fillStyle="#cccccc";p.fillRect(0,0,50,50);if(q.width===0&&q.height===0){p.drawImage(q,0,0)}else{if(q.width<=50&&q.height<=50){p.drawImage(q,25-q.width/2,25-q.height/2-Math.max((34-q.height)/2,0))}else{if(q.width<q.height){p.drawImage(q,0,0,50*q.width/q.height,50)}else{p.drawImage(q,0,0,50,50*q.height/q.width)}}}l.set("uploadThumbs",{id:u,data:s.toDataURL("image/jpeg",0.9)})}},cache:function(E){var B=$('<nav class="overview" style="display:none;"></nav>');var A=[];var v;for(var t=0;t<widgets.t.length;t++){A[t]=""}var p=j.createLibOrder(E);var F={};for(var C=0;C<p.length;C++){var D=p[C];var z=widgets.summary[D];if(z&&z.g&&z.g.indexOf(E)!=-1){F[D]=z;var s=z.t;if(!s){continue}v=widgets.t.indexOf(s[0]);if(widgets.summary[D].removed){continue}if(!widgets.summary[D].upload){var q=z.g==i.defaultUserLibrary?"userWidget":"";A[v]+=fluid.util.tpl("widgetMarkup",{id:D,title:z.title,widgetClass:q})}}}var o="";var r=[];for(t=0;t<A.length;t++){if(A[t]!=""){if(widgets.t[t]!=="Uploads"){o+='<section class="setHeader"><header><h2>'+widgets.t[t]+"</h2><h6>Hide</h6></header>";o+='<ol data-groupName="'+widgets.t[t]+'">';o+=A[t];o+="</ol></section>"}}}B.get(0).innerHTML=o;if(E===i.defaultUserLibrary){B.get(0).innerHTML=fluid.util.tpl("tmplMyWidgets",{title:"My Widgets"});var u=B.find('[data-groupname="My Widgets"]');for(var n in F){u.append(fluid.util.tpl("widgetMarkup",{id:n,title:F[n].title,widgetClass:"userWidget"}))}page.renderer.afterPageRendered=j.afterUserWdgRender;for(var n in F){page.renderer.renderWdg(n,F[n])}}j.cached[E]=B},getWidgetHtml:function(p,n){var o="libraryWidget";if(n.g==i.defaultUserLibrary){o+=" userWidget"}return'<li id="'+p+'" class="'+o+'" title="Click or drag-and-drop to add"><div class="widgetTitle">'+n.title+"</div></li>"},showUploads:function(){j.setActiveCategory("Uploads")},esc:function(){if(canvas2.isEditorVisible()){if(!canvas2.isZoomedOut()){fluid.zoom.zoomOut()}}else{if($("#previewHolder").hasClass("open")){preview.close()}else{$("#accountFrame").fadeOut();fluidMenu.show()}}},addUploadToProjectTab:function(o,q){var p=$("#project-"+o+" .uploadTabs-project");var n=$('#project-notInAny [data-id="'+q+'"]');if(n.length){n.detach().appendTo(p);j.setCounter("notInAny",parseInt($("#project-notInAny").find(".tab-count").text(),10)-1)}else{j.canvasToLoad($('[data-id="'+q+'"]').first().clone().appendTo(p).find("canvas").addClass("toLoad"))}j.updateScrollbarRelative()},removeUploadFromProjectTab:function(p,s){var r=$("#project-"+p);var q=r.find('[data-id="'+s+'"]').detach();var o=[];var n=[];fluid.main.projects.models.forEach(function(t){t.attributes.uniqueUploads.forEach(function(u){o.push(u)})});fluid.main.uploads.models.forEach(function(t){if(t.attributes.removed){return}if(o.indexOf(t.id)===-1){n.push(t.id)}});if(n.indexOf(s)!==-1){$("#project-notInAny .uploadTabs-project").append(q)}j.setCounter("notInAny",n.length);j.updateScrollbarRelative()},setCounter:function(p,o){var n=$("#project-"+p);n.find(".tab-count").text(o);if(o===0){n.addClass("empty")}else{n.removeClass("empty")}},changeNameOfActiveTab:function(o,n){$("#project-"+o+" .tab-name").text(n)},changeActiveTab:function(n){$("#perProjectGroupContainer .projectTab.current").removeClass("current active");$("#perProjectGroupContainer #project-"+n).addClass("current active").detach().insertAfter("#project-notInAny")},openMenu:function(){var n=$("#lib-menu"),o=n.find('.hover-menu-level-1[data-for="'+j.currentDisplay+'"]');n.removeClass("closed");fluid.hoverListMenu.clearState(n[0]);fluid.hoverListMenu.select(n[0],o[0])},closeMenu:function(){$("#lib-menu").addClass("closed");fluid.main.fire("libMenuClosing")},menuClosed:function(){return $("#lib-menu").hasClass("closed")},toggleMenu:function(){if(j.menuClosed()){return j.openMenu()}return j.closeMenu()},drawMenu:function(){var n=i.get("whitelist");if(!n){n=["Wireframe","Desktop","iPhone","Android"];i.set({whitelist:n})}$("#lib-menu").empty();fluid.util._.each(widgets.g,function(p,o){p.groups=fluid.util._.map(p.groups,function(q){q.locked=n.indexOf(q.id)===-1;return q});if(p.archive){p.archive=fluid.util._.map(p.archive,function(q){q.locked=n.indexOf(q.id)===-1;return q})}$("#tmplLibMenu").tmpl({section:o,icon:p.icon,items:p.groups,archive:p.archive}).appendTo("#lib-menu");$('[data-for="Wireframe"]').click()})},refreshLockedLibsStatus:function(){fluid.api.getLibrariesWhitelist(function(n){var o=JSON.parse(n).whitelist;i.set({whitelist:o});j.drawMenu()})},updateProjectsList:function(t,s){var r=arguments[3];var n=$("#perProjectGroupContainer");var p=s.attributes;if(r.add){n.find(".projectTab.current").removeClass("current");var q=n.find("#project-"+p.id);if(!q.length){var o=fluid.util.tpl("uploadTabsProject",{id:p.id,name:p.name,currentProject:true,activeProject:true,empty:true,uploads:[],count:0});q=$(o);q.insertAfter($("#project-notInAny"))}q.addClass("current")}if(r.remove){fluid.main.projects.filter(function(u){if(u.removed){return true}}).forEach(function(u){var v=u.get("id");n.find("#project-"+v).remove()})}}};b.exports=j},{"./class-account":2,"./class-dbStorage":6,"./class-hoverListMenu":11,"./class-search":23,"./class-tracker":25,"./class-widget":28,"./fluid/fluid.templating":42}],13:[function(b,c,a){var f=b("./class-storage");var d={mouseTimeoutForHover:false,isLinking:false,toggleRemoveTimeout:{},showahrefs:function(h){if(h){var i=(new Date).getTime();if(i-d.mouseTimeoutForHover<h){setTimeout(d.showahrefs,300,[h]);return}}$(".linkTemplate").stop(true,true).delay(500).fadeOut(400)},hoverIn:function(z){if(project.readOnly()){return}var q=$(this).attr("id");if(!f.get(q)){return}$(this).addClass("front");var F=$(this).find(".linkToggle"),t=this;clearTimeout(d.toggleRemoveTimeout[q]);if(F.length===0){F=$('<a class="linkToggle tooltip4" title="Gestures and transitions" alt="Gestures and transitions"></a>');$(t).append(F)}F.tooltip({effect:"fade",delay:0,offset:[-10,0],opacity:0.8,tipClass:"tooltip4Text",predelay:50});d.toggleRemoveTimeout[q]=setTimeout(function(){F.stop(true,false).fadeTo(10,1,d.showLinkMenuIntro)},200);var I=d.comesFrom($(this).attr("id"));var v=d.goesTo($(this).attr("id"));var s=$("#"+I);var D=f.get(I,{returnModel:true}).getPage().id;if(fluid.zoom.isEditMode()){s.css("outline","3px solid rgba(25,163,255,1.0)");var C=$("#"+D);var j=C.hasClass("active");var l=$("#"+v);var H=C.find(".page");var u=parseInt(C.css("top"))+parseInt(s.css("top"))+parseInt(s.css("height"))/2;var G=parseInt(C.css("left"))+parseInt(s.css("left"))+parseInt(s.css("width"))/2;var E=(parseInt(l.css("top"))+parseInt(l.css("height"))/2);var m=(parseInt(l.css("left"))+parseInt(l.css("width"))/2);var n=13;var p=60;if(!j){p=0}var i=0;if(G<m){i=parseInt(C.css("left"))+parseInt(H.css("width"))+p}else{i=parseInt(C.css("left"))-p}var o=(((E-u)/(m-G))*(i-G))+u;var k=parseInt(C.css("top"))-p;var r=parseInt(C.css("top"))+parseInt(H.css("height"))+p;if((o<=k)||(o>=r)){if(u<E){o=parseInt(C.css("top"))+parseInt(H.css("height"))+p}else{o=parseInt(C.css("top"))-p-20;if(G<m){n=-20}}i=(((o-u)/(E-u))*(m-G))+G}var B=o-u;var w=i-G;var A=Math.sqrt(B*B+w*w)+25;$(this).find(".linkToggle").css({"margin-left":A+"px","margin-top":n+"px"})}else{var h=page.isLinked(v,D);if(h&&z){d.hoverIn.apply(document.getElementById(h),[false])}}},hoverOut:function(j){$(".tooltip4Text").hide();if(!$("#canvas").hasClass("loaded")){return}var n=$(this).attr("id");if(!f.get(n)){return}var l=d.goesTo(n);var k=d.comesFrom(n);var m=this;if(j){d.draw($(this),k,l,"ahref")}var h=$(".link").not(".open-link-menu").find(".linkToggle");if(!j||!($(j.target).hasClass("open-link-menu")||$(j.target).hasClass("openLinkMenu"))){clearTimeout(d.toggleRemoveTimeout[n]);d.toggleRemoveTimeout[n]=setTimeout(function(){h.fadeTo(200,0);d.toggleRemoveTimeout[n]=setTimeout(function(){$(m).find("*").remove();$(".link").removeClass("front");delete d.toggleRemoveTimeout[n]},300)},2000)}$("#"+k).css("outline","");d.draw($(this),k,l,"ahref");var i=k?f.get(k,{returnModel:true}).getPage().id:false;var o=page.isLinked(l,i);if(o&&j){d.hoverOut.apply(document.getElementById(o),[false])}return false},closeMenu:function(){$(".openLinkMenu").removeClass("openLinkMenu");$(".open-link-menu").removeClass("open-link-menu");$(".linkMenu").hide();return false},setLinkMenuText:function(){$("#smallRemoveLink, #zoomedOutLinks, #linkAmount").hide();if(!fluid.zoom.isEditMode()){$("#zoomedOutLinks").show();var i=project.get("links")["linkCanvId"].length;$("#linkAmount").show().text(i);var h=(i>1)?("remove "+i+" links"):("remove 1 link");$("#removeLinkTxt").text(h)}else{$("#smallRemoveLink").show()}},toggleMenu:function(i){if($(this).hasClass("openLinkMenu")){d.closeMenu()}$(".openLinkMenu").removeClass("openLinkMenu");$(this).addClass("openLinkMenu");$(this).parents(".link").addClass("open-link-menu");$("body").bind("click.linkToggle",function(l){if($(l.target).parents(".linkMenu").length>0){return}var k=$(".openLinkMenu");if(l.target!=k.get(0)){k.removeClass("openLinkMenu").parent(".link").removeClass("open-link-menu");$(l.target).addClass("openLinkMenu").parent(".link").addClass("open-link-menu")}else{$(".openLinkMenu").removeClass("openLinkMenu");$(".open-link-menu").removeClass("open-link-menu")}d.hoverOut();$(".linkMenu").hide();$("body").unbind("click.linkToggle");if(l.target!=k.get(0)){$(l.target).click()}return utils.prevent(l)});var h=f.get($(this).parents(".link").attr("id"));var j=$(this).offset();$(".linkMenu .transitionSelector").find("[value='"+h.transType+"']").attr("selected","selected");$(".linkMenu .linkTriggerSelector").find("[value='"+h.triggerType+"']").attr("selected","selected");$(".linkMenu").css({top:j.top,left:j.left}).show();return false},follow:function(k){if(fluid.zoom.isEditMode()&&$(".connectorHelper").length==0){$(this).find(".linkToggle").hide(10,d.hideLinkMenuIntro);var h=d.goesTo($(this).attr("id"));var j=project.getActivePageId();if(j==h){h=d.comesFromPage($(this).attr("id"))}var i=$("#"+h);if(i.length===0){page.drawDetailed(h,"init");i=$("#"+h)}page.activate(i);fluid.zoom.zoomToPage(h)}},template:function(k,h,j){$("#"+k).remove();var i=$("#tmplLinkNew").tmpl({id:k}).appendTo("#canvasLinks");if(h=="ahref"){i.fadeIn(400)}else{i.addClass("linkTemplate")}return i},dragStart:function(j,h){$(document.body).addClass("dragging_link");if($("#dragCanvas").length==0){$("#tmplDragCanv").tmpl({}).appendTo($("#canvas"))}page.calculateWdgPositions($(".screen.active").attr("id"));hint.show("draggingLink");d.isLinking=true;if((typeof h=="boolean"&&h)||!$(this).data("dragOnClickStarted")){contextMenu.hide();propInspector.resetPropInspector();var i=fluid.zoom.getCurrentScale();$("#canvas").data("revertZoom",i);$("#canvasLinks").filter(":visible").hide();if($(this).attr("id")=="cmLink2"){d.remove(".ui-selected")}fluid.zoom.zoomOutForLink($(this))}if(h){$(this).data("dragOnClickStarted",true);$(".ui-draggable").not(this).not(".pageWidget").draggable("disable")}},drag:function(j){if(!d.$dragCanvas){d.$dragCanvas=$("#dragCanvas");d.$dragCanvas.add($(".connectorHelper"))}var i=getHoverPageParams(j);var h=i.pageId?i.pageId:false;if(h){if(h!=$(".pageLinkableCandidate").attr("id")){d.removeHighlightedPage(j);if(h!=$(".activeZoomedOut").attr("id")){$("#scaled-"+h).addClass("pageLinkableCandidate")}}}else{d.removeHighlightedPage(j)}d.draw($("#dragCanvas"),fluid.zoom.getselectedBeforeZoomOut(),$(".connectorHelper"),"ahref")},dragStop:function(h){$(document.body).removeClass("dragging_link");fluid.zoom.afterLinkDone();if(fluid.zoom.isZoomingNow()){d.dragAborted=true;$("#dragCanvas").addClass("hide")}$(this).data("dragOnClickStarted",false);$(".ui-draggable").not(this).not(".pageWidget").draggable("enable");$(".scaled-screen").removeClass("pageLinkable pageLinkableCandidate");d.isLinking=false;fluid.main.fire("linkdone")},drawSome:function(h,l){var j;for(var k=0;k<h.linkOrigin.length;k++){j=f.get(h.linkOrigin[k],{returnModel:true});if(j&&h.linkDest[k]!==j.getPage().id){d.draw($("#"+h.linkCanvId[k]),h.linkOrigin[k],h.linkDest[k],h.linkType[k],l)}}},drawAll:function(h){fluid.main.project.links.forEach(function(j,i,k){d.draw($("#"+j.id),j.get("linkOrigin"),j.get("linkDest"),j.get("linkType"))})},update:function(i){var k=fluid.main.project.links.toJSON();var m=[];i.each(function(){var r=$(this).attr("id"),p;if(r.indexOf("scaled-")!==-1){r=r.split("-")[1]}for(var q=0,j=k.linkOrigin.length;q<j;q++){p=f.get(k.linkOrigin[q],{returnModel:true});if(!p){continue}var o=f.get(k.linkOrigin[q],{returnModel:true}).getPage().id;if(o===r||k.linkDest[q]===r){m.push(q)}}});for(var l=0,h=m.length;l<h;l++){var n=m[l];d.draw($("#"+k.linkCanvId[n]),k.linkOrigin[n],k.linkDest[n],k.linkType[n])}},overlapCheck:function(h,k){var j={left:h[0],right:h[0]+h[2],top:h[1],bottom:h[1]+h[3]};var i={left:k[0],right:k[0]+k[2],top:k[1],bottom:k[1]+k[3]};if((i.left>=j.left&&i.left<=j.right&&i.top>=j.top&&i.top<=j.bottom)||(i.right>=j.left&&i.right<=j.right&&i.top>=j.top&&i.top<=j.bottom)||(i.left>=j.left&&i.left<=j.right&&i.bottom>=j.top&&i.bottom<=j.bottom)||(i.right>=j.left&&i.right<=j.right&&i.bottom>=j.top&&i.bottom<=j.bottom)){return true}else{return false}},drawPageToPage:function(J,s,n,h){if(d.overlapCheck(s,n)){J.hide();return}var B;var i=15;var o,I,z,l;var E=0,C=0,k=0,j=0;var u,A,r;if(s[1]<n[1]){u=s;A=n;r=true}else{u=n;A=s;r=false}var p,G,m;if(s[0]<n[0]){p=s;G=n;m=true}else{p=n;G=s;m=false}if(A[1]-u[1]<u[3]){var q="";if(u[1]+u[3]>A[1]+A[3]){C=A[1]+A[3]/2}else{C=A[1]+(u[1]+u[3]-A[1])/2}if(m){E=s[0]+s[2];B=n[0]-s[0]-s[2];q="right"}else{E=n[0]+n[2];B=s[0]-n[0]-n[2];q="left"}J.css({top:C*h,left:E*h,width:B*h>i?B*h-i:0,height:"4px","-webkit-transform-origin":"0px 2px","-moz-transform-origin":"0px 2px","-webkit-transform":"none","-moz-transform":"none"}).removeClass("right up left down").addClass(q).show();return}else{if(G[0]-p[0]<p[2]){var q="";if(E>p[0]+p[2]||G[0]+G[2]>p[0]+p[2]){E=G[0]+(p[0]+p[2]-G[0])/2}else{E=G[0]+G[2]/2}if(r){C=s[1]+s[3];B=n[1]-s[1]-s[3];q="down"}else{C=n[1]+n[3];B=s[1]-n[1]-n[3];q="up"}J.css({top:r?C*h:C*h+i,left:E*h,height:B*h>i?B*h-i:0,"-webkit-transform-origin":"0px 2px","-moz-transform-origin":"0px 2px","-webkit-transform":"none","-moz-transform":"none"}).removeClass("right up left down").addClass(q).show();return}else{o=(s[1]+s[3]/2);I=(s[0]+s[2]/2);z=(n[1]+n[3]/2);l=(n[0]+n[2]/2);var H=l-I;var F=z-o;var w=F/H;if(Math.abs(w)>s[3]/s[2]){if(z<o){C=-s[3]/2}else{C=s[3]/2}E=C/w}else{if(l<I){E=-s[2]/2}else{E=s[2]/2}C=E*w}if(Math.abs(w)>n[3]/n[2]){if(z<o){j=F+n[3]/2}else{j=F-n[3]/2}k=j/w}else{if(l<I){k=H+n[2]/2}else{k=H-n[2]/2}j=w*k}E=(I+E)*h;C=(o+C)*h;k=(I+k)*h;j=(o+j)*h;var v=(k-E);var t=(j-C);var B=Math.sqrt(v*v+t*t);var D=v<0?(180/Math.PI)*Math.atan(-t/v):(180/Math.PI)*Math.atan(t/v);if(v<0){D=180-D}J.css({top:C,left:E,width:B>i?B-i:0,height:4,"-webkit-transform-origin":"0px 2px","-moz-transform-origin":"0px 2px","-webkit-transform":"rotate("+D+"deg)","-moz-transform":"rotate("+D+"deg)"}).removeClass("right up left down").show()}}},drawWdgToPage:function(D,l,o,z,h){if(d.overlapCheck(o,z)){D.hide();return}var t;var i=15;var n,C,s,m;var w=0,u=0,k=0,j=0;n=o[1]+l[1]+l[3]/2-5;C=o[0]+l[0]+l[2]/2-5;s=(z[1]+z[3]/2);m=(z[0]+z[2]/2);var B=m-C;var A=s-n;var r=A/B;if(Math.abs(r)>z[3]/z[2]){if(s>n){k=B-z[3]/(2*r)}else{k=B+z[3]/(2*r)}j=k*r}else{if(m>C){k=B-z[2]/2}else{k=B+z[2]/2}j=r*k}w=(C+w)*h;u=(n+u)*h;k=(C+k)*h;j=(n+j)*h;var q=(k-w);var p=(j-u);var v=q<0?(180/Math.PI)*Math.atan(-p/q):(180/Math.PI)*Math.atan(p/q);if(q<0){v=180-v}t=Math.sqrt(q*q+p*p);D.css({top:u,left:w,width:t-i,height:4,"-webkit-transform-origin":"0px 2px","-moz-transform-origin":"0px 2px","-webkit-transform":"rotate("+v+"deg)","-moz-transform":"rotate("+v+"deg)"}).removeClass("right up left down").show()},drawDragged:function(u,j,n,k,s){var i;var p=15;var m,r,l,o;m=Math.floor(n[1]+j[1]+j[3]/2)*s-5;r=Math.floor(n[0]+j[0]+j[2]/2)*s-5;l=Math.floor(k[1]+document.getElementById("viewport").scrollTop+k[3]/2)-5;o=Math.floor(k[0]+document.getElementById("viewport").scrollLeft+k[2]/2)-5;var t=(o-r);var q=(l-m);var h=t<0?(180/Math.PI)*Math.atan(-q/t):(180/Math.PI)*Math.atan(q/t);if(t<0){h=180-h}i=Math.sqrt(t*t+q*q);u.css({top:m,left:r,width:i-p,height:4,"-webkit-transform-origin":"0px 2px","-moz-transform-origin":"0px 2px","-webkit-transform":"rotate("+h+"deg)","-moz-transform":"rotate("+h+"deg)"})},draw:function(j,t,s,p,v){var l=[];var u=[];var m=[];if(!(t&&s)){return}v=fluid.zoom.getCurrentScale();var h=(s.hasClass&&s.hasClass("connectorHelper"))?true:false;if(typeof(t)==="string"){var o=f.get(t,{returnModel:true}),n=o&&o.getPage?o.getPage():null,k=f.get(s,{returnModel:true});if(n&&n.id===s){j.remove();return}l=o.getBox();u=n.getBox();if(!l||!u){return}if(k&&k.getBox){m=k.getBox()}else{if(h){m=[parseInt(s.css("left")),parseInt(s.css("top")),parseInt(s.css("width")),parseInt(s.css("height"))]}else{var i=$(t).closest(".screen");var r=$(".page",$(i));m=[parseInt($(s).css("left")),parseInt($(s).css("top")),parseInt(r.css("width")),parseInt(r.css("height"))]}}}else{if(f.get(t.attr("id"),{returnModel:true}).getPage().id===s){j.remove();return}var i=$(t).closest(".screen");var r=$(".page",$(i));var q=$(".page",$(s));l=[parseInt($(t).css("left")),parseInt($(t).css("top")),parseInt($(t).css("width")),parseInt($(t).css("height"))];u=[parseInt(i.css("left")),parseInt(i.css("top")),parseInt(r.css("width")),parseInt(r.css("height"))];m=[parseInt($(s).css("left")),parseInt($(s).css("top")),parseInt(q.css("width")),parseInt(q.css("height"))]}if(p=="ahref"&&h){d.drawDragged(j,l,u,m,v);return}else{if(!fluid.zoom.isEditMode()){d.drawPageToPage(j,u,m,v);return}else{if(fluid.zoom.isEditMode()){d.drawWdgToPage(j,l,u,m,v);return}else{return null}}}if(window.intercom){intercom.updateIfNotSet("everUsedLink",true)}},from:function(i){var h=fluid.main.project.links.where({linkOrigin:i},true);return h?h.id:false},goesTo:function(i){if(!i){return false}var h=f.get(i);return h?h.linkDest:false},comesFrom:function(i){if(!i){return false}var h=f.get(i);return h?h.linkOrigin:false},comesFromPage:function(i){if(!i){return false}var h=f.get(i);if(!h){return false}return f.get(h.linkOrigin,{returnModel:true}).getPage().id},add:function(q,r,o,h,n,j){var i=n!=undefined?n:project.get("defaultTransition");var k=j!=undefined?j:project.get("defaultGesture");$(".page","#"+r).addClass("linkDropSuccess");setTimeout(function(){$(".page","#"+r).removeClass("linkDropSuccess")},500);var p=h||utils.guid("l");if(!project.hasLinks()){var m=$("#"+f.get(q,{returnModel:true}).getPage().id);page.makeHome(null,m)}fluid.main.project.links.add({linkOrigin:q,linkDest:r,linkCanvId:p,linkType:o,transType:i,triggerType:k});fluid.main.project.set({links:fluid.main.project.links.toJSON()});var l=fluid.main.project.get("links");l.linkOrigin.push(q);l.linkDest.push(r);l.linkCanvId.push(p);l.linkType.push(o);l.transType.push(i);l.triggerType.push(k);fluid.main.project.set({links:l});var s=d.template(p,o,i);s.find(".linkToggle").stop(true,true).fadeTo(300,1,d.showLinkMenuIntro);return s},load:function(h,m){var k;if(m){var j="";for(var l=0;l<h.linkOrigin.length;l++){if(h.linkDest[l]===f.get(h.linkOrigin[l],{returnModel:true}).getPage().id){continue}j+='<div id="'+h.linkCanvId[l]+'" class="link link-new"></div>'}document.getElementById("canvasLinks").innerHTML=j}else{for(var l=0;l<h.linkOrigin.length;l++){k=f.get(h.linkOrigin[l],{returnModel:true});if(k&&h.linkDest[l]===k.getPage().id){continue}d.template(h.linkCanvId[l],h.linkType[l],h.transType[l])}}},del:function(i){if(typeof i==="object"){i=$(".openLinkMenu").closest(".link").attr("id")}if(!i){return false}var h=fluid.main.project.links.get(i);$("#"+h.id).fadeOut(450,function(){$("#"+h.id).remove()});fluid.main.project.links.remove(h.id);d.closeMenu();hint.show("selectWidget");if(fluid.zoom.getCtx==="project"){$("#canvas").click()}},remove:function(i){var h=fluid.main.project.links.toJSON();$(i).each(function(){var p=$(this).attr("id");function o(q){q.remove()}for(var l in h.linkOrigin){var j=f.get(h.linkOrigin[l],{returnModel:true});if(!j){continue}var k=j.getPage().id;if(h.linkOrigin[l]==p||k==p||h.linkDest[l]==p){var n=h.linkCanvId[l];var m=$("#"+h.linkCanvId[l]);m.fadeOut(450,o(m));fluid.main.project.links.remove(n);d.remove(i);break}}})},spliceOut:function(h,j){h.linkOrigin.splice(j,1);h.linkDest.splice(j,1);h.linkCanvId.splice(j,1);h.linkType.splice(j,1);h.transType.splice(j,1);h.triggerType.splice(j,1);project.save()},getCanvasHeight:function(){var h=18;return h/d.getCanvasScale()},getHeadHeight:function(){var h=14;return h/d.getCanvasScale()},getPadding:function(){var h=7;return h/d.getCanvasScale()},getCanvasScale:function(){return fullCanvas.currentScale},removeHighlightedPage:function(h){$(".scaled-screen").removeClass("pageLinkableCandidate")},hideLinkMenuIntro:function(){$(this).removeClass("linkToggleIntro")},showLinkMenuIntro:function(){$(this).addClass("linkToggleIntro")},serialize:function(h){return JSON.stringify(fluid.main.project.links.toJSON())},deserialize:function(h){fluid.main.project.links.deserialize(h);d.load(fluid.main.project.links.toJSON());d.drawAll("all")}};fluid.main.on("closeallpopups",d.hoverOut);c.exports=d},{"./class-storage":24}],14:[function(b,c,a){var d={config:{displayDuration:4500,alertDisplayDuration:9000,alertTypes:["alert","testAlert"],alertResumeThreshold:1000,messageExpiration:2000,pageSize:3,expandMessageDelay:30,fadeInDuration:300,fadeOutDuration:150,openDuration:300,closeDuration:150,moveDuration:300,summaryOrientation:"horizontal",summaryShowDuration:1000,summaryFadeInDuration:150},messages:[],alerts:[],summaries:{total:{count:0}},expandedType:null,expandedPage:0,currentMessage:null,currentPage:0,messageTimeout:null,summaryTimeout:null,interrupted:false,init:function(){$("#tmplNotifications").tmpl({}).appendTo("body");var f=$("#notifications > .summaries");f.mouseover(function(){d._stopSummaries()}).mouseout(function(){if(!d.expandedType){d._hideSummariesDelayed()}})},add:function(h,i,j,f){if($.isPlainObject(j)){f=j;j=undefined}else{f|={}}var k={type:h,message:i,scope:f.scope,detailedInfo:f.detailedInfo?f.detailedInfo:null,permanent:Boolean(f.permanent),stopBuggingCallBack:f.stopBuggingCallBack};if(k.stopBuggingCallBack!=undefined){d.removeAll(h,k.scope)}if($.inArray(h,this.config.alertTypes)>-1){this.alerts.push(k);this._drawAlerts()}else{this._stopSummaries();this.messages.push($.extend(k,{info:j||f.info}));if(this.summaries.hasOwnProperty(h)){this.summaries[h].count++}else{this.summaries[h]={count:1}}this._updateTotal();this._drawMessages();this._drawSummaries()}},remove:function(i){if(!i.removed){if(this.currentMessage&&this.currentMessage===i){this._stopMessages()}this._stopMessageExpiration(i);var f=$.inArray(i.type,d.config.alertTypes)>-1;if(f){this.alerts.splice($.inArray(i,this.alerts),1)}else{this.messages.splice($.inArray(i,this.messages),1);this.summaries[i.type].count--}this._updateTotal();i.removed=true;if(i.element.is(":visible")){i.element.fadeOut(this.config.fadeOutDuration,function(){i.element.remove();if(f){if(d.alerts.length==0){d._continueInterrupted()}}else{if(!d.expandedType){d._drawNextCollapsed()}}});if(this.alerts.length>0){d._drawAlerts()}}else{i.element.remove()}if(!f){if(this.expandedType&&this.alerts.length==0){var h=this._pageOfType(this.expandedType,this.currentPage);$(h).map(function(){return this.element}).not(":visible").fadeIn(this.config.fadeInDuration);this._drawMessages()}this._drawSummaries();if(this.expandedType&&this.summaries[this.expandedType].count==0){this.expandedType=null;this._hideSummariesDelayed()}}}},removeAll:function(k,j){if(j&&!$.isArray(j)){j=[j]}var h;if(k){h=[$.inArray(k,this.config.alertTypes)>-1?this.alerts:this.messages]}else{h=[this.messages,this.alerts]}for(var i=0;i<h.length;i++){var l=h[i];for(var f=l.length-1;f>=0;f--){var m=l[f];if(!j||$.inArray(m.scope,j)>-1){this.remove(m)}}}},expand:function(h){if(this.alerts.length==0){this._stopMessages();this._stopSummaries();if(this.expandedType){this.collapse(function(){d.expand(h)})}else{this.expandedType=h;this.currentPage=0;if(this.currentMessage){function f(){d.currentMessage=null;window.setTimeout(function(){d._showMessages(h)},10)}if(this.currentMessage.element.data("stopped")){this.currentMessage.element.queue(f)}else{this.currentMessage.element.fadeOut(this.config.fadeOutDuration,f)}}else{this._showMessages(h)}}}},_showMessages:function(j,k,i,f){if(!k){this._drawPager();var h=this._pageCount();f=h>1?-1*$("#notifications .pager").outerHeight(true):0;if(this.currentPage>=h){this.currentPage=h-1}k=this._pageOfType(j,this.currentPage);i=0}var l=k[i];this._drawMessage(l,f);f-=l.element.outerHeight();this.messageTimeout=new Timeout(this.config.expandMessageDelay,function(){if(i<k.length-1){d._showMessages(j,k,i+1,f)}})},_pageOfType:function(k,f){var i=[];var j=f*this.config.pageSize;var m=j+this.config.pageSize-1;if(!k||k=="total"){var l=this.messages.length-m-1;i=this.messages.slice(Math.max(l,0),l+this.config.pageSize)}else{var n=0;for(var o=this.messages.length-1;o>=0;o--){var h=this.messages[o];if(h.type==k){if(n>=j){i.unshift(h)}if(n==m){break}n++}}}return i},collapse:function(f){this._stopMessages();this.expandedType=null;this._hideMessages(f);this._hideSummariesDelayed()},_hideMessages:function(k,j,i){if(i===undefined&&typeof j=="boolean"){i=j;j=undefined}if(!j){j=this._prevVisible()}var f=$(j.element);var h=d._prevVisible(j);if(!h&&!i){f=f.add("#notifications .pager")}$.when(f.fadeOut(this.config.fadeOutDuration)).then(function(){if(j.expanded){d._toggleInfo(j)}if(!h&&k){j.element.queue(function(){j.element.dequeue();k.call(d)})}});if(h){this.messageTimeout=new Timeout(this.config.expandMessageDelay,function(){d._hideMessages(k,h,i)})}},_prevVisible:function(i){var j;var h=i?$.inArray(i,this.messages):this.messages.length;for(var f=h-1;f>=0;f--){var k=this.messages[f];if(k.element&&k.element.is(":visible")){j=k;break}}return j},_drawMessages:function(){if(this.alerts.length==0){if(this.expandedType){this._drawExpanded()}else{this._drawCollapsed()}}},_drawExpanded:function(f,m){var k;if(m){k={idx:0,next:function(){return this.idx<d.alerts.length?d.alerts[this.idx++]:null}}}else{k={page:this._pageOfType(this.expandedType,this.currentPage),idx:0,next:function(){return this.idx<this.page.length?this.page[this.idx++]:null}}}var o=0;var n=f||0;this._drawPager();if(this._pageCount()>1){n-=$("#notifications .pager").outerHeight(true)}var h,l;while((o<this.config.pageSize)&&(h=k.next())){if(!l){l=h}if(!h.removed){if(h.shown){var j=n-h.element.outerHeight();var i=h.element.is(":visible");if(j!=h.element.position().top){if(i){h.element.animate({top:j},this.config.moveDuration)}else{h.element.css({top:j}).fadeIn(this.config.fadeInDuration)}}else{if(!i){h.element.fadeIn(this.config.fadeInDuration)}}n=j}else{this._drawMessage(h,n);if(m&&!h.permanent){h.timeout=new Timeout(this.config.alertDisplayDuration,(function(p){return function(){d.remove(p)}})(h))}n-=h.element.outerHeight()}}o++}if(!m){h=l;while(h=this._prevVisible(h)){h.element.fadeOut(this.config.fadeOutDuration)}}},_drawCollapsed:function(){if(!this.currentMessage&&(!this.messageTimeout||this.messageTimeout.complete())){for(var h=0,f=this.messages.length;h<f;h++){var i=this.messages[h];if(!i.removed&&!i.shown){this.currentMessage=i;break}}if(this.currentMessage){this._drawMessage(this.currentMessage,0);this.messageTimeout=new Timeout(this.config.displayDuration,function(){d._drawNextCollapsed()})}else{this._hideSummariesDelayed()}}},_drawNextCollapsed:function(){if(this.currentMessage&&this.currentMessage.element&&!this.interrupted){if(this.currentMessage.element.is(":visible")){this.currentMessage.element.fadeOut(this.config.fadeOutDuration,function(){var f=d.currentMessage;d.currentMessage=null;if(!f||!f.element||!f.element.data("stopped")){d._drawCollapsed()}})}else{d.currentMessage=null;d._drawCollapsed()}}},_drawAlerts:function(){var f=0;var h=this._expandedMessage();if(h){f=-1*h.element.outerHeight();if(h.element.position().top!=f){h.element.animate({top:f+"px"},this.config.moveDuration)}}this._interrupt(function(){d._drawExpanded(f,true)})},_drawMessage:function(i,f){var h=$("#notifications .messages ul");if(!i.element){i.element=$("#tmplNotification").tmpl({type:i.type,text:typeof i.message=="string"?i.message:$(i.message).html(),info:typeof i.info=="string"?i.info:$(i.info).html(),stopBugging:false}).addClass("collapsed").click((function(j){if($.inArray(j.type,d.config.alertTypes)==-1){return function(k){d._toggleInfo(j)}}else{return function(){}}})(i)).prependTo(h);i.element.find(".close").click((function(j){return function(k){d.remove(j)}})(i));i.element.find("input[type=submit], input[type=button], button").click((function(j){return function(k){fluid.main.fire("upgradepromptclicked",j);d.remove(j)}})(i))}else{i.element.show()}fluid.main.fire("promptdisplayed",i);i.element.stop(true,true).dequeue().css({width:i.element.closest("div").width()-i.element.outerWidth()+i.element.width()}).css({top:f-i.element.outerHeight()}).hide().fadeIn(this.config.fadeInDuration);i.shown=true},_pageCount:function(){return this.expandedType?Math.ceil(this.summaries[this.expandedType].count/this.config.pageSize):1},_drawPager:function(){var i=$("#notifications .pager");var h=i.find(".pager-page");var j=this._pageCount();if(h.size()!=j){i.empty();for(var f=0;f<j;f++){var k=$("#tmplNotificationPage").tmpl({}).click((function(l){return function(){d._toPage(l)}})(f)).appendTo(i);if(f==this.currentPage){k.addClass("active")}}}else{h.filter(".active").removeClass("active");h.eq(this.currentPage).addClass("active")}if(j>1){i.fadeIn(this.config.fadeInDuration)}else{i.fadeOut(this.config.fadeOutDuration)}},_toPage:function(f){this._hideMessages(function(){this.currentPage=f;this._showMessages(this.expandedType)},true)},_updateTotal:function(){this.summaries.total.count=0;for(var f in this.summaries){if(f!="total"){this.summaries.total.count+=this.summaries[f].count}}},_drawSummaries:function(){var l=$("#notifications .summaries ul");var m=0;var n=this.config.summaryOrientation!="vertical";for(var k in this.summaries){var j=this.summaries[k];if(j.element){if(j.count>0){j.element.children(".summary").text(j.count.toString());var f=j.element.is(":visible");var h=j.element.position();if(m!=(n?h.left:h.top)){var i=n?{left:m}:{top:m};if(!f){j.element.css({opacity:0.001}).show();i.opacity=1}j.element.animate(i,this.config.moveDuration)}else{if(!f){j.element.fadeIn(this.config.fadeInDuration)}}if(k=="total"&&j.element.hasClass("totalHidden")){j.element.switchClass("totalHidden","",this.config.fadeInDuration)}}else{j.element.fadeOut(this.config.fadeOutDuration)}}else{if(j.count>0){j.element=$("#tmplNotificationSummary").tmpl({type:k,text:j.count.toString()}).css(n?{left:m}:{top:m}).click((function(p,o){return function(q){if(o=="total"&&p.element.hasClass("totalHidden")){d._showSummaries()}else{if(d.expandedType==o){d.collapse()}else{d.expand(o)}}}})(j,k)).hide().appendTo(l).fadeIn(this.config.fadeInDuration)}}if(j.count>0&&j.element){m+=n?j.element.outerWidth():j.element.outerHeight()}}},_toggleInfo:function(m){this._stopMessages();var j=m.element.find(".message .content");var k;if(this.expandedType&&!this.interrupted){var l=this._pageOfType(this.expandedType,this.currentPage);k=$(l).map(function(){return this.element[0]}).not(m.element)}if(m.expanded){if(m.element.is(":visible")){if(k){k.fadeIn(this.config.fadeInDuration)}var h=m.element.outerHeight()-j.height();j.animate({height:m.height},{duration:this.config.closeDuration,complete:function(){d._hideInfo(m);if(!d.expandedType){d._drawNextCollapsed()}}});m.element.animate({top:this.alerts.length>0?-1*(m.height+h):m.top},this.config.closeDuration)}else{d._hideInfo(m)}m.expanded=false;d._startMessageExpiration(m)}else{if(k){k.fadeOut(this.config.fadeOutDuration)}m.top=m.element.position().top;m.height=j.height();m.element.removeClass("collapsed").addClass("expanded");j.find(".info").show();var f=-1*m.element.outerHeight();if(this._pageCount()>0){f-=$("#notifications .pager").outerHeight(true)}if(f<m.top){m.element.animate({top:f},this.config.openDuration)}var i=j.height();j.css({height:m.height+"px"}).animate({height:i},this.config.openDuration);m.expanded=true}if(this.alerts.length>0){m.element.fadeOut(this.config.fadeOutDuration);this._drawAlerts()}},_interrupt:function(k){var i=this.interrupted;if(!i){this.interrupted=true;if(this.messageTimeout&&!this.messageTimeout.complete()&&!this.messageTimeout.paused()){this.messageTimeout.pause();for(var h=0,f=this.messages.length;h<f;h++){var j=this.messages[h];if(j.expirationTimeout){j.expirationTimeout.pause()}}}if(this.expandedType){i=Boolean(this._expandedMessage());if(!i){this._hideMessages(function(){k.call()})}}else{if(this.currentMessage&&!this.currentMessage.expanded&&!this.currentMessage.removed){this.currentMessage.element.fadeOut(this.config.fadeOutDuration,function(){k.call()})}else{i=true}}}if(i){k.call()}},_continueInterrupted:function(){var i=true;this.interrupted=false;if(this.messageTimeout&&!this.messageTimeout.complete()&&this.messageTimeout.paused()){if(this.messageTimeout.timeRemaining()>=this.config.alertResumeThreshold){this.messageTimeout.resume()}else{this.messageTimeout.exec();i=false}}for(var h=0,f=this.messages.length;h<f;h++){var j=this.messages[h];if(j.expirationTimeout&&j.expirationTimeout.paused()){j.expirationTimeout.resume()}}if(this.expandedType){if(!this._expandedMessage()){this._showMessages(this.expandedType)}}else{if(this.currentMessage&&i){if(this.currentMessage.removed){this._drawNextCollapsed()}else{this.currentMessage.element.fadeIn(this.config.fadeInDuration)}}}},_startMessageExpiration:function(f){this._stopMessageExpiration(f);f.expirationTimeout=new Timeout(this.config.messageExpiration,function(){f.element.addClass("expired")})},_stopMessageExpiration:function(f){if(f.expirationTimeout){f.expirationTimeout.stop();f.expirationTimeout=null}},_hideInfo:function(h){var f=h.element.find(".message .content");f.find(".info").hide();f.css({height:""});h.element.removeClass("expanded").addClass("collapsed")},_expandedMessage:function(){var i;for(var h=0,f=this.messages.length;h<f;h++){var j=this.messages[h];if(j.expanded&&!j.removed){i=j;break}}return i},_stopMessages:function(){if(this.messageTimeout&&!this.messageTimeout.complete()){this.messageTimeout.stop()}else{if(this.currentMessage&&this.currentMessage.element&&this.currentMessage.element.is(":animated")){this.currentMessage.element.data("stopped",true)}}},_showSummaries:function(){this._stopSummaries();for(var h in this.summaries){var f=this.summaries[h];if(f.element){if(h=="total"){f.element.switchClass("totalHidden","",this.config.summaryFadeInDuration)}else{if(f.count>0){f.element.fadeIn(this.config.summaryFadeInDuration)}}}}},_hideSummaries:function(){this._stopSummaries();var f=$("#notifications > .summaries");f.find("li.total").switchClass("visible","totalHidden",this.config.fadeOutDuration);f.find("li").filter(":not(.total)").fadeOut(this.config.fadeOutDuration)},_hideSummariesDelayed:function(){this._stopSummaries();this.summaryTimeout=new Timeout(this.config.summaryShowDuration,function(){d._hideSummaries();d.summaryTimeout=null})},_stopSummaries:function(){if(this.summaryTimeout){this.summaryTimeout.stop();this.summaryTimeout=null}}};c.exports=d},{}],15:[function(b,c,a){var j=b("./class-storage");var h=b("./class-widget");var f=b("./class-canvas");var i=b("./class-group");var d={frame:null,frameVisible:false,menu:null,displayingMenu:false,orient:function(){var k=$(".screen.active");var m=k.attr("id");var l=$(this).val();d.update({orientation:l},m);k.each(d.resizeAfterOrient);d.updateOptionsMenu();hint.show("library");grid.showGrid()},resizeAfterOrient:function(){var m=$(this);var k=m.attr("id");var l=[d.get(k,"height"),d.get(k,"width")];m.css({width:l[0],height:l[1]});m.find(".page").css({width:l[0],height:l[1]});m.find(".page").children(".widgetHolder").css({width:l[0],height:l[1]});d.update({width:l[0],height:l[1]},k);if(fluid.zoom.isEditMode()&&m.hasClass("active")){if($("#"+k).hasClass("active")){d.drawDetailed(k,"init")}}else{d.draw(k,"init")}link.update(m)},updateOptionsMenu:function(){var m=project.getActivePageId();if(typeof m==="undefined"){return}var u=fluid.main.project.get("pageWH");var z=fluid.main.project.get("homepage");var n=d.get(m,"orientation");var s=fluid.main.project.get("orientation");var t=$("#pageMenu");var v=z==m?"This is the start page":"Make this the start page";var A=z==m?"Start Page":"Make Start Page";var r=z==m?"homePageOn":"homePageOff";var w=d.get(m,"name");w=w==undefined?"":w;$(".homePageStatusText").text(v);$(".homePageStatusText").attr("alt",A).attr("title",A);$(".iconPageSettingsIndicator").not(".gridOff, .gridOn, .snapToWidgetsOff, .snapToWidgetsOn").removeClass("homePageOn homePageOff").addClass(r).attr("alt",A).attr("title",A);t.find(".pageSize.rangeWidget.width>input").val(d.get(m,"width"));t.find(".pageSize.rangeWidget.height>input").val(d.get(m,"height"));t.find(".orientationSelector2").find("[value='"+s+"']").attr("selected","selected");var l=t.find(".buttonSwitchContainer");l.children().removeClass("activeOption");l.find("[data-for='"+n+"']").addClass("activeOption");$(".inputPageTitle").val(w);var k=fluid.main.project.get("deviceModel");var p=$("#DeviceSizeTmpl");var q=$("#deviceModelTemplate");if(k){$("option[data-type='"+k+"']",p).attr("selected","selected");$("option[data-type='"+k+"']",q).attr("selected","selected")}else{var B=fluid.main.project.get("pageWH");var o=false;$.each(p.children(),function(C,F){if($(F).val()!="Custom"){var D=$(F).val().split(",");if(((B[0]==D[0])&&(B[1]==D[1]))||((B[0]==D[1])&&(B[1]==D[0]))){$(F).attr("selected","selected");var E=$(F).attr("data-type");$("option[data-type='"+E+"']",q).attr("selected","selected");o=true;return false}}});if(!o){$("option[data-type='Custom']",p).attr("selected","selected");$("option[data-type='Custom']",q).attr("selected","selected")}}if($("option:selected",p).val()=="Custom"){$(".screenSize").parents("tr").children().show()}else{$(".screenSize").parents("tr").children().hide()}updateTLWH();var w=d.get(m,"name");grid.selectBackground()},addViaLinkDrop:function(o,u,t,m,s,q){var n=$("#viewport");var k=d.add({x:(n.get(0).scrollLeft+n.width()*0.75),y:(n.get(0).scrollTop+n.height()*0.5)},m,s);if(!k){return}var p="ahref";var r=fluid.zoom.getselectedBeforeZoomOut();var l=link.add(r,k,p);link.draw(l,r,k,p);$(l).fadeIn(600);return k},click:function(m){i.deselect();if(!fluid.zoom.isZoomingNow()&&m.target.tagName!=="TEXTAREA"){var l=$(this).closest(".screen").attr("id");if(!l){l=$(this).closest(".scaled-screen").attr("id").split("-")[1]}var k=m.originalEvent&&$(m.originalEvent.target);if(k&&(k.hasClass("track")||k.hasClass("thumb"))){return}if(fluid.selection.getSelectionModel().length===0){fluid.zoom.zoomToPage({pageId:l,clientX:m.clientX,clientY:m.clientY})}fluid.controllers.bin.show()}},makeHome:function(l,k){if(typeof k==="undefined"){k=$(this).closest(".screen")}if($(k).hasClass("template")){return}var m=$(k).attr("id");fluid.main.project.set({homepage:m});d.updateOptionsMenu();$(".scaled-screen").removeClass("homePage");$(k).addClass("homePage")},removeHome:function(k){fluid.main.project.set({homepage:k||null});if(k){$("#scaled-"+k+".scaled-screen").addClass("homePage")}d.updateOptionsMenu()},add:function(o,l,n){if(project.readOnly()){account.alertEditInactive();return false}if(fluid.zoom.isEditMode()){return}var k=$("#cmLink").data("lastClicked")||0;if((new Date()).getTime()<k+600){return}var m=d.create(o.y/fluid.zoom.getCurrentScale(),o.x/fluid.zoom.getCurrentScale());if(fluid.main.fluid.main.project.get("pages").length===1){fluidMenu.setCanvasFirstPage()}return m},correctPageCoords:function(p,o){var k=fluid.zoom.getCurrentScale();var m=fluid.main.project.get("canvasWidth");var n=fluid.main.project.get("canvasHeight");var l=fluid.main.project.get("pageWH");if(o+l[1]>n){o=n-l[1]}if(p+l[0]*k>m){p=m-l[0]}return{left:p,top:o}},create:function(o,p,q,n){var r=fluid.main.project.get("pageWH");var m=fluid.main.project.get("orientation");if(n){if(d.lastCameraY){if(d.lastCameraY===viewport.scrollTop){if(m==="Portrait"){p=d.lastPageX+r[0]+20}else{p=d.lastPageX+r[1]+20}d.lastPageX=p}else{d.lastCameraY=viewport.scrollTop;d.lastPageX=p}}else{d.lastCameraY=viewport.scrollTop;d.lastPageX=p}}var t=d.correctPageCoords(p,o);if(!fluid.main.fire("page.beforeAdd")){return}var k={x:t.left,y:t.top,width:r[0],height:r[1],orientation:m,widgets:[]};var l=utils.guid("x");project.addPage(l);j.set(l,k);d.template(k,l,q);$("#zoomedOutPages").append('<div id="scaled-'+l+'" class="scaled-screen"></div>');var s=fluid.zoom.getCurrentScale();$("#scaled-"+l).css({top:j.get(l).y*s,left:j.get(l).x*s,width:j.get(l).width*s,height:j.get(l).height*s});if(!q){$("#scaled-"+l).bounce()}return l},hideOptionsMenu:function(k){d.hideNotes();d.pageMenuClick();$("#pageMenus").children().addClass("hide")},toggleOptionsMenu:function(l){var k=document.getElementById("pageMenu"),m;if(!k){return}m=!k.classList.contains("hide");d.pageMenuClick();d.updateOptionsMenu();d.toggleMenus();if(!m){k.classList.remove("hide")}},toggleSettingsMenu:function(l){var k=document.getElementById("deviceSettingsMenu"),m=!k.classList.contains("hide");d.pageMenuClick();d.updateSettingsMenu();d.toggleMenus();if(!m){k.classList.remove("hide")}},hideSettingsMenu:function(){var k=document.getElementById("deviceSettingsMenu"),l;l=!k?false:!k.classList.contains("hide");if(l){k.classList.remove("hide")}},updateSettingsMenu:function(){var q=project.getActivePageId();var l=fluid.main.project.get("pageWH");var m=d.get(q,"orientation");var o=fluid.main.project.get("orientation");$("#currentDeviceSize").text(l[0]+"X"+l[1]);var k=fluid.main.project.get("deviceModel");if($("#deviceModelTemplate").attr("data-type")!=k){var n=$("#deviceModelTemplate").attr("data-type",k).val();$("#deviceModelTemplate").val(n)}var p=$("#deviceSettingsMenu").find(".buttonSwitchContainer");p.children().removeClass("activeOption");p.find("[data-for='"+o+"']").addClass("activeOption")},toggleSnapSettings:function(){var k=document.getElementById("snapSettingsPanel"),l;l=!k.classList.contains("hide");if(l){d.hideOptionsMenu();return}d.showDefaultSnapOptions()},showDefaultSnapOptions:function(){d.toggleMenus();document.getElementById("snapSettingsPanel").classList.remove("hide");var l=account.get("gridStatus");var k=account.get("snapToWidget");(l=="on")?$("#gridSwitchOn").show():$("#gridSwitchOff").show();(k=="on")?$("#snapSwitchOn").show():$("#snapSwitchOff").show()},resize:function(o,m,s){var q=fluid.main.project.get("pageWH");var r=fluid.main.project.get("orientation");var p=d.get(o,"orientation");if(p!=r){q=[q[1],q[0]]}if((m<q[0])||(isNaN(m))){m=q[0]}else{if(m>q[0]){$(".pageSize").filter(".width").val(m)}}if((s<q[1])||(isNaN(s))){s=q[1]}else{if(s<q[1]){$(".pageSize").filter(".height").val(s)}}var l=$("#"+o+" .page");d.update({width:m,height:s},o);hint.show("library");l.parent(".screen").css({width:m,height:s});l.css({width:m,height:s});l.children(".widgetHolder").css({width:m,height:s});var k=$("#"+o+" .backgroundWidget");var n={top:0,left:0,width:m,height:s};d.autoWidth(l.parent(".screen"));grid.showGrid();return false},get:function(k,m){if(typeof k!="string"){return""}var l=j.get(k);if(typeof l==="undefined"||!l){return""}return l[m]},updateDragPos:function(p){var q=$(p);var s=fluid.zoom.getCurrentScale();var n=q.attr("id").indexOf("scaled-")!==-1?true:false;var m=n?q.attr("id").split("-")[1]:q.attr("id");if(!q.data().draggable){return}var r=n?q.data().draggable.position.top:Math.round(q.data().draggable.position.top/s);var l=n?q.data().draggable.position.left:Math.round(q.data().draggable.position.left/s);q.data().draggable.position.top=r;q.data().draggable.position.left=l;var k=fluid.main.project.get(m,{returnModel:true});var o=k.getBox();o[0]=l/fluid.zoom.getCurrentScale();o[1]=r/fluid.zoom.getCurrentScale();k.set({box:o},{silent:true});link.update(q);if(intersectTrash(q)==true){$("#trash").addClass("droppableStyle")}else{$("#trash").removeClass("droppableStyle")}},dragStart:function(k){if(!fluid.main.project.get("active")||fluid.zoom.isZoomingNow()){return false}if(fluid.zoom.isEditMode()){$("#canvasLinks").hide()}},drag:function(){d.updateDragPos(this)},dragStop:function(r){var q=$(this);var u=q.position();var p=q.attr("id").indexOf("scaled-")!==-1?true:false;var o=p?q.attr("id").split("-")[1]:q.attr("id");var m=$("#scaled-"+o);var t=j.get(o);var s=fluid.main.project.toJSON();var n=s.canvasWidth-t.width;var l=s.canvasHeight-t.height;var v=fluid.zoom.getCurrentScale();var k=Math.min(Math.max(Math.round(u.left/v),0),n);var w=Math.min(Math.max(Math.round(u.top/v),0),l);fluid.command.create("move",{id:o,x:k,y:w}).dispatchTo("fluid.controllers.page");q.appendTo(q.parent("#canvasPages"));m.appendTo(m.parent("#zoomedOutPages"));link.showahrefs();fluid.zoom.updatePagesBounding();if(fluid.zoom.getCtx()==="page"){fluid.zoom.zoomToPage(o)}if(u.top<0){q.css({top:0})}else{if(u.top/v>l){q.css({top:(s.canvasHeight-t.height)*v})}}if(u.left<0){q.css({left:0})}else{if(u.left/v>n){q.css({left:(s.canvasWidth-t.width)*v})}}},selectStart:function(k){if(project.readOnly()){k.preventDefault();k.stopPropagation();return false}},selectStop:function(l){var k=document.querySelectorAll("#canvasPages .ui-selected");fluid.main.fire("dragselection",k);fluid.zoom.onSelectionChanged();contextMenu.place()},updatePageName:function(){var l=$(this).val(),k=$(this).parents(".screen");if(k.length){d.update({name:l},k.attr("id"))}},template:function(l,q,p){var o=$.extend(true,{},l);o.id=q;var n=d.get(q,"width");var k=d.get(q,"height");o.screenWH=[n,k];var m=$("#tmplPage").tmpl(o).appendTo("#canvasPages");if(o.id===fluid.main.project.get("homepage")){m.addClass("homePage")}},updatePagePreviewButton:function(){var n=$("#pagePreview"),m=fluid.zoom.getCurrentScale(),l=$(".canvasObject.active").attr("id"),k=j.get(l).width*m;pageButtonsWidth=243;if(l&&j.get(l).widgets.length===0){n.parent().hide()}else{if(k<pageButtonsWidth){if($("#pageExpander").hasClass("expanded")){n.parent().show()}else{n.parent().hide()}}else{n.parent().show()}}},updateNotesIcon:function(){var l=document.querySelector(".canvasObject.active"),k=document.getElementById("pageAddNote");if(!l||!k){return}var m=j.get(l.id).notes;if(m&&m[3]){k.classList.add("written")}else{k.classList.remove("written")}},hideNotes:function(){var k=document.getElementById("pageNote");if(!k){return}if(!k.classList.contains("hide")){d.saveNotesInput()}k.classList.add("hide")},showNotes:function(){d.hideOptionsMenu();var k=document.getElementById("pageNote");if(!k){return}d.setNotesTextboxValue();k.classList.remove("hide")},saveNotesInput:function(){var l=$(".canvasObject.active").attr("id"),k=$("#pageNote textarea");d.update({notes:[k.width(),k.height(),"",k.val()]},l);d.updateNotesIcon()},setNotesTextboxValue:function(){var l=document.getElementById("pageNote"),k=document.querySelector(".canvasObject.active").id,m=d.get(k,"notes")||[200,120,"",""];$("textarea",l).css({width:m[0],height:m[1]}).val(m[3])},toggleNotes:function(){var k=document.getElementById("pageNote");if(k.classList.contains("hide")){d.showNotes()}else{d.hideNotes()}},toggleMenus:function(){d.hideOptionsMenu();$("#pageMenus").show()},activate:function(m,l,o,n){var k;if(typeof(m)==="string"){k=m;m=$("#"+m)[0]}else{if($(m).hasClass("scaled-screen")){k=$(m).attr("id").split("-")[1];m=$("#"+k)[0]}}d.deactivate({activatingId:k});function p(){if(f.isZoomedOut()){return}$("#canvasPages .screen.active").not($(m)).add(n).removeClass("active").each(function(){var s=$(this).attr("id");d.draw(s,"init")});$(m).addClass("active");var q=document.querySelector("#canvasPages .active");if(!project.readOnly()&&q){d.attachFrameTo(q)}grid.zoomIn();d.updateOptionsMenu();staticWidgets.zoomInBoundary();var r=l==undefined?true:l;d.displayMenu(r);if($(m).find(".page-preview").length){d.drawDetailed($(m).attr("id"),"init")}if(o==="wdgDrag"){h.afterSelectionChange()}i.drawExisting(k);fluid.main.fire("pageactivated",k)}p()},deactivate:function(k){var l=$("#canvasPages .screen.active");l.each(function(){if(!k||!k.activatingId||$(this).attr("id")!==k.activatingId){$(this).removeClass("active");$(this).selectable("destroy").removeData("initSelectable");$(this).draggable("destroy").removeData("initDraggable");var n=$(this).attr("id");var m=fluid.main.project.pages.get(n);if(m.attributes.imgData){d.draw(n,"useCache")}else{d.draw(n,"init")}}});d.detachFrame();h.resetCache()},detachFrame:function(){if(d.frameVisible){d.frame.parentNode.removeChild(d.frame);d.menu.parentNode.removeChild(d.menu);d.frameVisible=d.displayingMenu=false;d.frame.style.display="none"}},attachFrameTo:function(k){d.frame=d.frame||document.getElementById("pageFrame");d.menu=d.menu||document.getElementById("pageMenus");d.frame.style.display="none";k.appendChild(d.menu);k.querySelector(".page").appendChild(d.frame);d.adjustPageFrameScale(k);d.frameVisible=d.displayingMenu=true;d.setNotesTextboxValue();d.updatePagePreviewButton()},adjustPageFrameScale:function(k){if(!d.frame){return}requestAnimationFrame(function(){var u=fluid.zoom.getCurrentScale();var l=51;var m=$(d.frame).closest(".screen").attr("id");if(!m&&k&&k.id){var q=$(k).find(".page");q.append(d.frame);m=k.id}if(!m){return}var r=j.get(m);var s=r.width*u;var t=243;var o=50/u;var n=$("#pageExpander");if(s<t){$("#pageSettingsMenu li").each(function(v){if(v===0){$(this).css({"z-index":1});return}else{if($(this).find("#pageExpander").length){$(this).show();d.updatePagePreviewButton()}else{$(this).hide()}}});n.add(n.parent("li")).show();n.removeClass("expanded")}else{if(r.widgets.length){$("#pageSettingsMenu li").show()}else{$("#pageSettingsMenu li > a:not(#pagePreview)").parent().show()}n.addClass("expanded").add(n.parent("li")).hide();d.updatePagePreviewButton()}$(".pageBackground").css({"border-radius":(32/u)+"px"});$(".pageDragHandle").css({height:26/u,"border-bottom-width":1/u+"px","border-radius":(32/u)+"px "+(32/u)+"px 0 0"});d.frame.style.top=((-86)/u)+"px";d.frame.style.bottom=(-50/u)+"px";d.frame.style.left=(-l/u)+"px";d.frame.style.right=(-l/u)+"px";$("#pageSettingsMenuContainer").css({top:(((21+16)/u)+0)+"px",left:o+"px",transform:"scale("+1/u+")","transform-origin":"left top"});$("#pageMenus").css({transform:"scale("+(1/u)+")","transform-origin":"left top",left:(-47/u)+"px",top:(-78/u)+"px"});var p=$("#pageMenu").add("#deviceSettingsMenu");p.show();$("#"+d.focusedInputId).focus().select();$(d.frame).fadeIn(250)})},onExpanderHovered:function(l){var k=$("#pageExpander");if(l.type==="mouseenter"){k.addClass("visible")}else{if(!k.hasClass("expanded")){k.removeClass("visible")}}},toggleSettingsBtns:function(){var m=$("#pageSettingsMenu li");if(!$(this).hasClass("expanded")){var k=0;var l=$(this).parents(".screen").attr("id");m.each(function(){if($(this).find("#pageExpander").length&&j.get(l).widgets.length===0){$(this).css({left:k}).show()}else{$(this).css({left:k}).show();k=k+40}});$(this).addClass("expanded");d.updatePagePreviewButton()}else{m.each(function(){$(this).css({left:$(this).find("#pageExpander").length?40:0})});$(this).removeClass("expanded");setTimeout(function(){m.not($("#pageExpander").parents("li")).not($("#pageMenuToggle").parents("li")).hide()},300)}},displayMenu:function(l){var n=l==undefined?true:l;var o=true;if((!fluid.main.project.get("active")||(f.isZoomedOut()))){o=false}if(o){d.updateNotesIcon();d.updatePagePreviewButton()}if(n&&o){function m(){if((d.displayingMenu)&&($("#pageSettingsMenuContainer").css("display")=="none")){$("#pageSettingsMenuContainer").fadeIn(300)}d.displayingMenu=false}d.displayingMenu=true;d.displayMenuTimer=setTimeout(m,200)}else{if(o){var k=fluid.selection.getSelectionModel().getRoots().getElements();if((k.length==1)&&($(".ui-selected").hasClass("backgroundWidget"))){d.displayMenu();return}}d.displayingMenu=false;$("#pageSettingsMenuContainer").stop(true,true).hide()}},del:function(l){function k(n){$(n).remove();var m=fluid.main.project.get("pages");if(m.length==0){fluidMenu.setCanvasNoPages(true);fluid.zoom.updatePagesBounding();return}if(!project.hasWidgets()){$("#previewView, #preview, #pagePreview, #shareMenu").addClass("hud-hidden");$("#pagePreview").parent().hide()}if(f.isZoomedOut()){hint.restart()}fluid.zoom.updatePagesBounding()}l.each(function(){var m=$(this);var o=m.attr("id");var p=m.find("#canvasPages .widgetHolder > .pageWidget");p.each(function(){var r=$(this);h.del(r)});link.remove(m);project.deletePage(o);j.remove(o);if(o==fluid.main.project.get("homepage")){var q=fluid.main.project.get("pages");var n=q&&q.length?q[0]:null;d.removeHome(n)}m=m.add("#scaled-"+o);m.fadeOut(450,k(m))})},drawRasterised:function(o,n,k,m){d.checkIntegrity(o);var l=d.calculateWdgPositions(o);this.renderer.afterPageRendered=n;if(!l||l.widgets===0){return}this.renderer.renderPage(l,k,m)},draw:function(l,r){if(!l){return}d.checkIntegrity(l);var t=d.calculateWdgPositions(l);if(this.renderer.renderingQueue[t.id]&&this.renderer.renderingQueue[t.id].length){return}this.renderer.afterPageRendered=null;var s=$("#"+l);if(s.length===0){d.template(t,l,r);s=$("#"+l)}else{var k=s.find(".pageWidget");setTimeout(function(){k.remove()},650)}var m=s.find(".widgetHolder");if($("#scaled-"+l).length===0){$("#zoomedOutPages").append('<div id="scaled-'+l+'" class="scaled-screen"></div>');var u=fluid.zoom.getAllPagesParams().newScale;$("#scaled-"+l).css({top:j.get(l).y*u,left:j.get(l).x*u,width:j.get(l).width*u,height:j.get(l).height*u})}var v=j.get(l,{returnModel:true}).get("imgData");if(r==="useCache"&&v){s.find(".page-preview, .pageWidget").remove();var p=new Image();var o=new Image();p.src=v;o.src=v;m.append(p);m.find("img").addClass("page-preview");$("#scaled-"+l).get(0).innerHTML="";$("#scaled-"+l).append(o);return}if(!t){return}else{if(t.widgets.length===0){$("#scaled-"+l).empty();return}}var q=this.renderer.renderPage(t);i.erase();s.find(".page-preview").remove();if(q.length){var n;if(q[0].$shapeRendition){n=q[0].$shapeRendition}else{if(q[0].$textRendition){n=q[0].$textRendition}else{if(q.length&&q[0].segments){n=q[0].segments[0].$shapeRendition}}}if(n){n.addClass("page-preview");m.append(n)}}},calculateWdgPositions:function(n){if(!this.renderer){this.renderer=new fluid.wdgRenderer()}var k=j.get(n);if(k.widgets&&k.widgets.length>0){var m={};for(var l=0;l<k.widgets.length;l++){m[k.widgets[l]]=h.get(k.widgets[l])}}k.widgets=m||[];k.id=n;this.renderer.canvasSize=[k.width,k.height];return k},drawDetailed:function(q,p,n){d.calculateWdgPositions(q);var m=$.extend({},j.get(q));if(!m){return false}var k=$();var l=$("#"+q);if(l.length===0){d.template(m,q,p)}else{k=l.find(".pageWidget")}if(m.widgets.length>0){h.load(q,m.widgets);updateTLWH()}var o=$("#"+q).find(".page-preview");setTimeout(function(){o.remove()},200);k.remove();if(n&&n.restoreSelection){$("#"+n.restoreSelection).click()}},updateView:function(k,l){var m=true;if(l&&l.zoomedOutOnly){m=false}if(!m&&fluid.zoom.isEditMode()&&$("#"+k).hasClass("active")){d.drawDetailed(k,"init")}else{if(!fluid.zoom.isEditMode()){d.draw(k,"init")}}},move:function(p,k,o){d.update({x:k,y:o},p);var l=$("#"+p);var m=$("#scaled-"+p);var n=l.position();if(n.left!=k||n.top!=o){l.css({left:k+"px",top:o+"px"});m.css({left:(k*fluid.zoom.getCurrentScale())+"px",top:(o*fluid.zoom.getCurrentScale())+"px"});link.update(l)}},update:function(l,n){var k=j.get(n,{getAll:true});if(!k){return}for(var m in l){k[m]=l[m]}j.set(n,k)},orderWidgets:function(n){var l=$(n).parents("li.canvasObject").attr("id");var m=$(n).find(".pageWidget");var k=[];m.each(function(){k.push($(this).attr("id"))});d.update({widgets:k},l)},addWidget:function(l,n,k){var m=j.get(l,{getAll:true});if(k&&k.st&&k.st==="b"){m.widgets.unshift(n)}else{m.widgets.push(n)}j.set(l,m)},removeWidget:function(k,n){var m=j.get(k);if(!m){return}var l=$.inArray(n,m.widgets);m.widgets.splice(l,1);j.set(k,m)},enableSelectableWidgetHolder:function(k){if($(".selectArea").data("selectable")){var m=$(".selectArea").selectable("option","cancel").split(/\s*,\s*/);var l=m.indexOf(".widgetHolder");if(k||k===undefined){if(l>-1){m.splice(l,1);$(".selectArea").selectable("option","cancel",m.join(","))}}else{if(l==-1){m.push(".widgetHolder");$(".selectArea").selectable("option","cancel",m.join(","))}}}},isLinked:function(l,p){var n=fluid.main.project.links.toJSON();var k=d.get(l,"widgets");var o;for(var m=0;m<k.length;m++){o=n.linkOrigin.indexOf(k[m]);if(o!=-1){if(n.linkDest[o]==p){return n.linkCanvId[o]}}}return false},checkIntegrity:function(l){if(l){var m=d.get(l,"widgets");if(m){var k=j.get(l);$.each(m,function(n,o){if(!h.checkIntegrity(o,k)){return false}})}}},autoWidth:function(q){var m=$(q).children(".page");var o=$(q).attr("id");var r=m.children(".widgetHolder");var n=r.children(".rootWidget");for(var p=0;p<n.length;p++){var t=$(n[p]);var l=t.attr("id");var s=j.get(l);if((typeof(s.tlwh[0])==="string")||(typeof(s.tlwh[1])==="string")||(typeof(s.tlwh[2])==="string")||(typeof(s.tlwh[3])==="string")){var k=h._setTMPLVars(l,s,[0,0,m.width(),m.height()]);t.css({top:k.absTLWH[0],left:k.absTLWH[1],width:k.absTLWH[2],height:k.absTLWH[3]});h._resize(t,o,k.tlwh)}}link.update($(q))},duplicate:function(o){var k=$("#"+o);var n=$(".page",k);var m=d.get(o,"orientation");var l={top:parseFloat(k.css("top")),left:parseFloat(k.css("left"))+parseFloat(n.css("width"))+100};var p={width:parseFloat(n.css("width")),height:parseFloat(n.css("height"))};var t=d.get(o,"name");var q=t==undefined||t==""?"":t+" - Copy";var s=d.create(l.top,l.left,"init");if(s){var u=$("#"+s);d.update({orientation:m},s);d.update({name:q},s);d.resize(s,p.width,p.height);var v=$.extend(true,{},h._copies);h.resetSelection();var r=j.get(o,{returnModel:true}).get("widgets");h._copy(null,r,false,o);d.activate(u,false);fluid.zoom.zoomToPage(u);if(h._copies.oldId.length>0){h._paste(null)}h._copies=$.extend(true,[],v);v=null;h.resetSelection()}tracker.record("addPageClone",2,s,null);return s},createNew:function(o){var s=$("#canvas");var t=fluid.zoom.getCurrentScale();var l=(o==="button");var r=fluid.main.project.get("pages");var k;o=o||"init";if(fluid.zoom.isEditMode()){var m=$(".screen.active").attr("id");if(!m){if(r.length){m=r[r.length-1]}}if(m){var q=j.get(m);k={top:q.y,left:q.x+q.width+100}}else{var p=$("#viewport");k={top:Math.abs(parseInt(s.css("top"),10))+Math.round(p.height()/2),left:Math.abs(parseInt(s.css("left"),10))+Math.round(p.width()/2)+450}}}else{var p=$("#viewport");k={top:(p.get(0).scrollTop+Math.round(p.height()/2))/t,left:(p.get(0).scrollLeft+Math.round(p.width()/2))/t};o=""}var n=d.create(k.top,k.left,o,l);if(n){d.postCreate(n)}return n},postCreate:function(m,l){if(!f.isZoomedOut()){var k=$("#"+m);d.activate(k,undefined,l);fluid.zoom.zoomToPage(k);h.resetSelection()}if(fluid.main.project.get("pages").length==1){fluidMenu.setCanvasFirstPage()}},serialize:function(q){var n=j.get(q);if(!n){return}var m={id:q};m[q]=n;var p=n.widgets;for(var l=0,k=p.length;l<k;l++){var o=j.get(p[l]);if(!o){continue}m[p[l]]=o}return JSON.stringify(m)},deserialize:function(s,m){var u=JSON.parse(s);if(u){var k=u.id;var o=u[k],p=!fluid.main.project.get(k);if(!o){return}j.set(k,o);project.addPage(k);var q=o.widgets;for(var t=0,n=q.length;t<n;t++){var l=q[t];var r=u[l];if(r){j.set(l,r)}}if(f.isZoomedOut()){d.draw(k,m)}else{d.drawDetailed(k,m)}if(p){d.postCreate(k,m)}}},navigateWithKeys:function(q){if(f.isZoomedOut()||!f.isEditorVisible()){return true}var r=q!=undefined?utils.getNavigationKeyDirection(q.keyCode):"right";if(r==""){return true}var l=$(".ui-selected").not(".backgroundWidget");if(l.size()>0){return}var m=fluid.main.project.get("pages");if(m<2){return}var o={distance:Number.MAX_VALUE,id:""};var n={distance:0,id:""};var p=$(".screen.active").attr("id");var t={x:d.get(p,"x"),y:d.get(p,"y")};$.each(m,function(v,u){if(p!=u){var z={x:d.get(u,"x"),y:d.get(u,"y")};var w=d._getNavigationDistanceFrom(t,z,r);if((w>=0)&&(w<o.distance)){o={distance:w,id:u}}else{if((w<0)&&(w<n.distance)){n={distance:w,id:u}}}}});var k=o.id!=""?o.id:n.id;if(k!=""){hint.hide();var s=$("#"+k);$(".screen").removeClass("active").filter(s).addClass("active");fluid.zoom.zoomToPage(s);d.activate(s);h.resetSelection()}},_getNavigationDistanceFrom:function(k,n,m){if(k==n){return -1}var l=0;if((m=="left")||(m=="right")){l=n.x-k.x}else{l=n.y-k.y}if(((m=="left")||(m=="top"))&&(l<0)){return Math.abs(l)}else{if(((m=="right")||(m=="bottom"))&&(l>0)){return l}}return Math.abs(l)*-1},pageMenuClick:function(){$("input","#pageMenus").blur();return false},renderBlurs:function(k){k=k||((k=document.querySelector(".canvasObject.active"))&&k.id);if(!k){return}d.calculateWdgPositions(k);j.get(k).widgets.forEach(function(l){var m=document.getElementById(l);if(!m){return}if(j.get(l).blur){h.blurLayers[l]=h.renderBlurLayer(l,k);h.setBlurBG(m)}})},isInViewport:function(m,n){var r=n&&n.mode?n.mode:false;var q=n&&n.withPageFrame?n.withPageFrame:false;var o=fluid.zoom.getCurrentScale();var k=document.getElementById("viewport");var p={left:r==="init"?-fluid.main.project.get("canvasPosX")/o:k.scrollLeft/o,top:r==="init"?-fluid.main.project.get("canvasPosY")/o:k.scrollTop/o,width:window.innerWidth/o,height:window.innerHeight/o};p.right=p.left+p.width;p.bottom=p.top+p.height;if(q&&d.frame&&$(d.frame).parents("#"+m).length){p.left=p.left+50/o;p.right=p.right-50/o;p.bottom=p.bottom-50/o;p.top=p.top+85/o;p.height=p.bottom-p.top;p.width=p.right-p.left}var l=j.get(m);if(r!=="strict"&&((l.x<=p.right)&&(p.left<=l.x+l.width)&&(l.y<=p.bottom)&&(p.top<=l.y+l.height))){return true}else{if(r==="strict"&&((l.x+l.width<=p.right)&&(p.left<=l.x)&&(l.y+l.height<=p.bottom)&&(p.top<=l.y))){return true}}return false}};c.exports=d},{"./class-canvas":4,"./class-group":10,"./class-storage":24,"./class-widget":28}],16:[function(c,d,a){var b={isWorking:false,lastSubmitButton:null,hideTimeOut:null,errors:{"default":"Something went wrong... Please try again!",defaultShort:"ERROR!",emailUsed:"Your new email is already being used.",passInvalid:"The password is not valid.",oldPassInvalid:"The old password is not valid.",passNotChanged:"The new password cannot be equal to the old one.",upgradeFreeWrongPass:"Your password is not valid.  Please try again.",resetNoEmail:"We were unable to match that email address to an account. Please try again...",resetCantSendEmail:"Error sending email. Please try again...",resetPasswordMatch:"The two passwords you entered don't match. Please try again...",resetLinkExpired:"This link has expired (for security reasons, password recovery attempts expire after 1 hour)."},messages:{"default":"Your changes have been applied successfully.",defaultShort:"Changes applied!",resetPass:"We have sent an e-mail to your account with your password",promoCode:"The code has been applied to your account!",contact:"Thanks!  We will contact you soon!",recoverySuccess:"Please check your email. You will have a link to reset your password there.",resetSuccess:"Your password has been updated successfully. You can now sign in.",projectClone:"Project Cloned Successfully",projectTransfer:"Project Teleported Successfully",projectRestore:"Project Restore Successful",projectBranding:"Project Branding Changed"},processingMessages:{"default":"Processing...",projectClone:"Cloning...",projectTransfer:"Teleporting..."},setWorkArea:function(){$(".modalWindowContentArea").css({width:$(window).width()-50})},hideMessages:function(){b.hideErrors();b.hideSuccessMessage()},hideErrors:function(){clearTimeout(b.hideTimeOut);$(".messageError").fadeOut(250,b.placeMessageReset);b.enableLastButton(true)},displayError:function(h){var i=b.errors["default"];if(h!=undefined){i=b.errors[h]!=undefined?b.errors[h]:h}function f(){$(".userSettingsMessageContainer.messageError").text(i).fadeIn(250)}b.placeMessage(b.lastSubmitButton,f);b.enableLastButton(true);b.hideTimeOut=setTimeout(b.hideErrors,3000)},enableLastButton:function(i,f){if(!b.lastSubmitButton){return}var j=$(b.lastSubmitButton);if((i)||(i==undefined)){if(j.attr("data-label")!=undefined){b.changeButtonLabel(j,j.attr("data-label"))}j.removeAttr("disabled");return}else{j.attr("disabled","disabled");var h=j.prop("tagName")=="INPUT"?j.val():j.text();var l=f==undefined?"default":f;var k=b.processingMessages[l]?b.processingMessages[l]:b.processingMessages["default"];j.attr("data-label",h);b.changeButtonLabel(j,k)}},isLastButtonDisabled:function(){if(b.lastSubmitButton==null){return false}var f=$(b.lastSubmitButton);return f.attr("disabled")=="disabled"},hideSuccessMessage:function(){$(".userSettingsMessageContainer.messageSuccess").fadeOut(250,b.placeMessageReset);b.setSuccessMessage()},setSuccessMessage:function(j,h){var f=$(".userSettingsMessageContainer.messageSuccess");if(!j){f.text("").fadeOut(250,b.placeMessageReset);return}var i=b.messages[j]!=undefined?b.messages[j]:j;f.text(i);if(!h.length){h=b.lastSubmitButton}b.placeMessage(h);setTimeout(b.displaySuccessMessage,400)},displaySuccessMessage:function(){clearTimeout(b.hideTimeOut);if($(".userSettingsMessageContainer.messageSuccess").text()!=""){$(".userSettingsMessageContainer.messageSuccess").fadeIn(250);b.hideTimeOut=setTimeout(b.hideSuccessMessage,3000)}else{b.hideSuccessMessage()}},placeMessage:function(o,m){if(o==undefined||o.length===0){$(".userSettingsMessageWrapper").css({top:10,left:0,height:30,width:499});return}var j=o.attr("type")=="submit"||o.hasClass("toAlert")?0:30;var k=o.offset().top+j-3;var i=o.offset().left-2;var n=o.innerHeight()+8;var h=o.innerWidth()+7;var l=o.css("padding");l=o.attr("type")=="text"?"6px":l;l=isNaN(parseInt(l,10))?"6px":parseInt(l,10)<6?"6px":l;var f=$(".userSettingsMessageWrapper");f.css({top:k,left:i,height:n,width:h});f.children().css({padding:l});if($.isFunction(m)){m()}},placeMessageReset:function(){$(".userSettingsMessageWrapper").children().hide();$(".userSettingsMessageWrapper").css({height:0,width:0})},changeButtonLabel:function(h,f){if(h.prop("tagName")=="INPUT"){h.val(f)}else{h.text(f)}},getCloseExternalWindowButtonLabel:function(){var f="Close";if(top!=self){f=window.parent.userSettings.isOpen?"Back":f}return f},display:function(f,h,j){if(b.isWorking){return}b.isWorking=true;function i(){if(f.attr("id")==="projectSettingsPanelSettings"&&fluid.main.account.get("accType")==="Free"){$("#projectSettingsSwitchActivate").hide();$(".projectSettingsButtonClone").hide()}else{$("#projectSettingsSwitchActivate").show();$(".projectSettingsButtonClone").show()}f.parent().transition({width:f.innerWidth(),height:"auto",complete:function(){f.css({height:"auto"}).slideDown((h/2)+100);f.children().transition({opacity:1},h/4);b.isWorking=false;var k=$(".scrollbar",f);if(k.size()>0){b.adjustScroll(k.parent())}if($.isFunction(j)){j()}}},h*3/4)}if(f.parent().hasClass("hiding")){setTimeout(i,h*1.3)}else{setTimeout(i,100)}return},hide:function(f,h,i){if(f.size()>0){f.parent().addClass("hiding");f.children().transition({opacity:0},h/4);f.parent().css({height:f.innerHeight(),width:f.innerWidth()});f.parent().delay(h/4).transition({height:0,width:0,complete:function(){f.hide();$(this).removeClass("hiding");if($.isFunction(i)){i()}}},h*3/4)}else{if($.isFunction(i)){i()}}if(window.page){page.updateSettingsMenu()}},adjustScroll:function(f){function i(){f.tinyscrollbar();setTimeout(h,300)}function h(){f.tinyscrollbar_update("top")}setTimeout(i,100)},rateEditor:function(h){var f=$(h.currentTarget);$("#experienceRating").val(f.data("exp"));$(".experienceType").removeClass("selected");f.addClass("selected")},submitFree:function(){var h=$("#submitButtonFreeUpgrade");if(h.attr("disabled")=="disabled"){return false}var f=$("#cancelReason").val().length;var j=parseInt($("#experienceRating").val());if((j!==0&&j!==1&&j!==-1)||f<1){userSettings.hidePauseBillingErrors();$("#pauseBillingSubmitError").show();return false}b.lastSubmitButton=h;h.attr("disabled","disabled").data("origVal",h.val()).val("Applying changes");var i=fluid.main.account.get("email");var k={t:"upgradeFree",accountEmail:i,rating:$("#experienceRating").val(),cancelReason:$("#cancelReason").val(),password:$("#confirmPass").val()};$.ajax({url:"upgrade.php",type:"POST",data:k,complete:b.pauseComplete,error:b.pauseError});return false},pauseComplete:function(k,n){function m(){var j="Your account was paused successfully.";fluidEvent.triggerEditor("closeModalWindow",{successMsg:j},true);fluid.main.fire("deferReloadRelease")}function f(){b.display($("#upgradeError"),400)}try{var h=JSON.parse(k.responseText)}catch(l){userSettings.hidePauseBillingScreens();userSettings.hidePauseBillingErrors();userSettings.showPauseBillingFirstStep();$("#pauseBillingSystemError").show();return}if(h.r=="s"){account.upgradeSuccess(h);b.hide($("#userSettingsPanelPauseBilling"),400,m)}else{userSettings.hidePauseBillingScreens();userSettings.hidePauseBillingErrors();userSettings.showPauseBillingFirstStep();$("#pauseBillingPasswordError").show();var i=$("#submitButtonFreeUpgrade");i.removeAttr("disabled");i.val("Pause Billing")}},pauseError:function(f,h){userSettings.hidePauseBillingScreens();userSettings.hidePauseBillingErrors();userSettings.showPauseBillingFirstStep();$("#pauseBillingSystemError").show();return}};d.exports=b},{}],17:[function(b,c,a){var d={creditCardLength:{VISA:16,MC:16,AMEX:15},cvvLength:{VISA:3,MC:3,AMEX:4},diacriticsMap:[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],replaceDiacritics:function(k){var j=d.diacriticsMap;for(var h=0,f=j.length;h<f;h++){k=k.replace(j[h].letters,j[h].base)}return k},getCreditCardType:function(j){var i={VISA:/^4[0-9]{12}(?:[0-9]{3})?$/,MC:/^5[1-5][0-9]{14}$/,AMEX:/^3[47][0-9]{13}$/,DINERS:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,DISCOVER:/^6(?:011|5[0-9]{2})[0-9]{12}$/,JCB:/^(?:2131|1800|35\d{3})\d{11}$/};for(var f in i){if(i.hasOwnProperty(f)){var h=i[f];if(h.test(j)){return f}}}return""},luhnCheck:function(h){if(/[^0-9-\s]+/.test(h)){return false}var k=0,j=0,f=false;h=h.replace(/\D/g,"");for(var l=h.length-1;l>=0;l--){var i=h.charAt(l),j=parseInt(i,10);if(f){if((j*=2)>9){j-=9}}k+=j;f=!f}return(k%10)==0},populateCardYears:function(l,k){var m=new Date();var h=m.getFullYear();l.append('<option selected disabled hidden value="">Year</option>');for(var j=h;j<(h+k);j++){var f=j.toString().substr(2);l.append('<option value="'+f+'">'+j+"</option>")}},isVATApplicable:function(f){var h=["DK","EE","FI","FR","DE","GR","AT","BE","BG","CY","CZ","HR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];return $.inArray(f,h)>-1},getMoss:function(f){var h={BE:0.21,BG:0.2,CZ:0.21,DK:0.25,DE:0.19,EE:0.2,GR:0.23,ES:0.21,FR:0.2,HR:0.25,IE:0.23,IT:0.22,CY:0.19,LV:0.21,LT:0.21,LU:0.17,HU:0.27,MT:0.18,NL:0.21,AT:0.2,PL:0.23,PT:0.23,RO:0.24,SI:0.22,SK:0.2,FI:0.24,SE:0.25,GB:0.2};if(h.hasOwnProperty(f)){return h[f]}else{return 0}},getVatAmount:function(f,i){var h=0;if(d.isVATApplicable(f)){if(f=="IE"||!i){h=d.getMoss(f)}}return h},validation:{init:function(h){$("#month, #year").on("change",function(){$(this).trigger("blur")});$(h.elem.form).data("validationConfig",h);function f(j){return $(j.form).data("validationConfig")}$.validator.addMethod("creditcardValid",function(o,l){var k=f(l);var m=d.getCreditCardType(o);var n=d.creditCardLength[m]!=undefined?d.creditCardLength[m]:0;var j=d.luhnCheck(o);var p=n>0&&j;k.elem.type.val(m);if(p){$("#cardNumberSection .icon-card").hide();$("#cardNumberSection .icon-card."+m.toLowerCase()).show();k.elem.cvv.attr("maxlength",d.cvvLength[m])}else{k.elem.cvv.attr("maxlength",3)}return p});$.validator.addMethod("cardexpirefield",function(n,l){var p=$(l).parent().parent().parent().find("[name=year]"),j=$(l).parent().parent().parent().find("[name=month]");var o=new Date();var m=!!((p.val()>o.getFullYear()-2000&&j.val()!=="")||(parseInt(p.val(),10)===o.getFullYear()-2000&&j.val()>=o.getMonth()+1));if($(l).attr("id")==="year"){var k=$('.error[for="month"][generated="true"]');k.text("Please enter valid expiration date");k[(m?"hide":"show")]()}if($(l).attr("id")==="userSettingsCardYear"){if(m){$('[for="'+j.attr("id")+'"]').hide()}else{$('[for="'+j.attr("id")+'"]').show()}$('[for="'+p.attr("id")+'"]').hide()}return m},"Invalid date");$.validator.addMethod("cvvLength",function(o,l){var j=f(l);var m=j.elem.type.val();var n=d.cvvLength[m]?d.cvvLength[m]:3;var k=j.elem.form.data("validator");k.settings.messages.cvv.cvvLength=$.validator.format(k.settings.messages.cvv.cvvLengthTmpl,n);return o.length==n});$.validator.addMethod("alphabeticChars",function(k,j){k=d.replaceDiacritics(k).replace(/[^\sa-zA-Z]/g,"");$(j).val(k);return(k.search(/[^\sa-zA-Z]/)===-1)});$.validator.addMethod("requiredForVAT",function(m,l){var k=f(l);var j=$("#billingVATSection").is(":visible")||$("#userSettingsVATSection").is(":visible");return !j||!k.elem.billingVAT.val()||Boolean(m)});$.validator.addMethod("validVATNumber",function(p,l){var j=f(l);var k=$("#billingVATSection").is(":visible")||$("#userSettingsVATSection").is(":visible"),o=j.elem.billingCountry.get(0),m=o.options[o.selectedIndex].value,q=true;if(k&&p){for(var n=2;n>0;n--){var r=checkVATNumber(p,m);q=r.valid_country&&r.valid_vat;if(q){$(l).val(r.number);break}else{p=m+p}}}return q});var i=h.elem.form.validate({onsubmit:false,onkeyup:false,focusCleanup:true,ignore:":hidden",rules:{loginEmail:{required:true,email:true},loginPassword:{required:true},name:{required:true,alphabeticChars:true},number:{required:true,digits:true,creditcardValid:true},month:{cardexpirefield:true},year:{cardexpirefield:true},cvv:{required:true,digits:true,cvvLength:true},billingCountry:{required:true},billingAddress:{required:true},billingCompany:{requiredForVAT:true},billingVAT:{validVATNumber:true}},messages:{loginEmail:{required:"Please enter your login email address",email:"Please enter a valid email address"},loginPassword:{required:"Please enter your password"},name:{required:"Please enter the name on the card",alphabeticChars:"Please only use alphabetic characters"},number:{required:"Please enter the card number",digits:"Please enter digits only",creditcardValid:"Invalid card number or card not accepted"},month:{cardexpirefield:"Please enter valid expiration date"},year:{cardexpirefield:"Please enter valid expiration date"},cvv:{required:"Please enter security code from the back of the card",digits:"Please enter digits only",cvvLengthTmpl:"Please enter exactly {0} digits"},billingCountry:{required:"Please select your country of residence"},billingAddress:{required:"Please enter your billing address"},billingCompany:{requiredForVAT:"Please enter your company name"},billingVAT:{validVATNumber:"Invalid VAT number"}},invalidHandler:h.handler.invalidHandler,errorPlacement:h.handler.errorPlacement,success:h.handler.success})},reset:function(h){var f=h.data("validator");if(f){f.resetForm()}$("input, select",h).removeClass("error");this.stopValidateAll()},stopValidateAll:function(f){$("input, select",f).not("input[name=cvv]").unbind("blur")}}};c.exports=d},{}],18:[function(c,b,f){var o=c("./class-dbStorage");var l=c("./class-storage");var p=c("./utils");var r=p.getParentWindow;var d=c("./class-branding");var j=c("./class-widget");var i=c("./class-widgetEvents");var k=c("./class-widgetNewMoving");var a=c("./class-widgetNewDraw");var n=c("./browserdetect");var h=c("./class-scrollview");var m={url:null,printURL:null,embedURL:null,pageTransitioning:false,multiOrientations:false,projectWH:[320,480],delayStart:1000,loaded:false,pageScale:1,pageRotation:0,pageTranslation:[0,0],viewportScaled:false,currentFrameScale:1,navigationStackBack:[],navigationStackForward:[],navigationQueueNext:[],navigationQueueFlow:[],navigationCompleted:false,navigationEnabled:false,navigationDefaultTransition:null,parentWindow:null,parentDoc:null,useZoomSlider:false,pageNotes:{},isOpen:false,initExported:function(){if($("#previewPage").size()>0){$(window).on("message",m._crossDomainCallListener)}m._showPreviewPage(false)},scaleFrame:function(F,C,I){C=C||false;F=F||false;if(!m.loaded&&!C&&F){return}if(window.g_print||window.g_embedded){return}var u=p.getParentWindow()||window,z=u.document,t=$("#previewPage",z),B=window;if(t[0]){B=t[0].contentWindow}else{if(p.getParentWindow()){t=$("#previewPage",z)}else{if(window.parent!==window){m._crossDomainCall(window.parent,"scaleFrame",arguments);return}}}if(!F&&!t[0]){if(p.isMobileDevice()){m.scaleViewport()}return}var w,s=z.getElementById("previewZoomSlider");if(!I&&s&&B.preview&&B.preview.useZoomSlider){w=s.value}else{var E=t.outerWidth(),v=t.outerHeight(),J=Math.max(E,v),A=(I?{width:E,height:v}:{width:J,height:J}),H=(I?{width:u.innerWidth,height:u.innerHeight}:m.availableRect),G=p.getFitSize({object:A,frame:H,expand:I});w=G.width/A.width}if(!m.useZoomSlider&&s&&typeof w==="number"){var D=u.$(s);if(D){D.slider("value",w)}}if(I){if(u===window){t[0].contentWindow.preview.useZoomSlider=true}else{m.useZoomSlider=true}}t.css({"-webkit-transform":"scale("+w+")","-moz-transform":"scale("+w+")",transform:"scale("+w+")"});m.centerFrame(u);m.positionNotes();m.currentFrameScale=w;m._showPreviewPage(true)},scaleViewport:function(B){if(!m.viewportScaled){B=B||$(".ui-page-active");var z=$(".ui-content",B);var v=window.innerWidth;var A=m.getTrueHeight();var u=v>A?[A,v]:[v,A];var s=m.projectWH[0];var w=m.projectWH[1];var t=s>w?[w,s]:[s,w];m.pageScale=Math.min(u[0]/t[0],u[1]/t[1]);if(p.hideBrowserBar()){window.scrollTo(0,1)}}},applyPageTransforms:function(u){var w=m.pageScale!==1?"scale("+m.pageScale+") ":"";var t=m.pageRotation!=0?"rotate("+m.pageRotation+"deg)":"";var v=(m.pageTranslation[0]||m.pageTranslation[1])?" translate("+m.pageTranslation[0]+"px,"+m.pageTranslation[1]+"px)":"";var s=w+t+v;$(".widgetHolder",u).css({"-webkit-transform":s,"-moz-transform":s,transform:s})},_showPreviewPage:function(s){if(typeof s=="undefined"){s=true}var t=$("#previewPage");if(t.size()==0){if(p.getParentWindow()){t=$("#previewPage",window.parent.document)}else{if(window.parent!==window){m._crossDomainCall(window.parent,"_showPreviewPage",[s])}}}t.css({visibility:s?"visible":"hidden"})},updateExportUi:function(u){var v={Pages:$("#previewShareContainer .shareLinkExportImg").add("#projectSettingsShareTop .shareLinkExportImg"),Project:$("#previewShareContainer .shareLinkExportImgFull").add("#projectSettingsShareTop .shareLinkExportImgFull")};var B;var A=["Pages","Project"];var w;var t;for(var z=0,s=A.length;z<s;z++){w=u["export"+A[z]];B=v[A[z]].next(".msg");if(w&&w.snapshotId){if(w.status==="FINISHED"){B.html('<a class="export-link" rel="'+w.snapshotId+'">Download ('+w.processDate+")</a>");t=B.find(".export-link");t.click(function(C){window.open(document.location.origin+document.location.pathname+"snapshot/"+C,"_snapshot")}.bind(t,w.snapshotId));B.removeClass("pulsing")}else{if(w.status==="STARTED"||(w.status==="NEW"&&w.queue===0)){B.html("exporting...");B.addClass("pulsing");share.startExportPolling(w.snapshotId)}else{if(w.status==="NEW"){w;B.html("queued ("+w.queue+")...");B.addClass("pulsing");share.startExportPolling(w.snapshotId)}else{if(w.status==="FAILED"){B.html("export failed...");B.removeClass("pulsing")}}}}}else{B.html("");B.removeClass("pulsing")}}},open:function(u,t){var v=project.get("id");var s=project.bundle(v);contextMenu.hide();fluid.api.projectSync(v,s,function(){canvas2.setEditorVisibility(false);$("#previewPage").contents().find("body").remove();$("#hud .hud-buttons .hud-secondary").hide();fluid.command.create("hideButton").dispatchTo("fluid.controllers.timeline");hint.show("startedPreview");m.hideMenu();fluid.controllers.bin.hide();m.hideNotes();if(document.getElementById("previewShowNotes").checked){m.getNotesElement().style.display=""}else{m.getNotesElement().style.display="none"}m._showPreviewPage(false);var A=account.get("lastOpenProject");project.checkIntegrity(A);var C=project.get("pageWH");var z=project.isMultiOrientation();if(u&&(u.currentTarget.id=="preview"||u.currentTarget.id==="pagePreview")){project.save();project.sync();var D=(document.location.href).split("?");var B=A+"."+project.get("updated");share.init(A);m.embedURL=D[0]+"embed/"+B;var w=$("#tmplEmbedCode").tmpl({url:m.embedURL,width:z?Math.max(C[0],C[1]):C[0]+64,height:z?Math.max(C[0],C[1]):C[1],multiorient:z}).html();$("#embedCode").html(w)}if(account.get("loggedIn")!="yes"){$("#previewSignup").show();$("#previewShareContainer").hide()}$("#previewPage").css({width:C[0],height:C[1],webkitTransform:"scale(2)",transform:"scale(2)"}).attr("src","project/"+A);$("#previewHolder").fadeIn(200).addClass("open");$("#previewHolder2").fadeIn(200);$("#previewFrameParent").removeClass("to-landscape to-portrait");m.setAvailableRect(m.calcAvailableRect());m.centerFrame();m.isOpen=true},function(){notification.add("alert","Could not save your project to the server. Please check your connection.")})},close:function(){canvas2.setEditorVisibility(true);hint.restart();$("#hud .hud-buttons .hud-secondary").fadeIn(300);fluid.command.create("showButton").dispatchTo("fluid.controllers.timeline");$("#previewPage").find(".widgetHolder").empty();$("#previewSignup").hide();$("#previewShareContainer").show();$("#previewHolder").removeClass("open").fadeOut(200);$("#previewHolder2").fadeOut(200);$(".messageError").hide();signup.toggleTabMessage();window.globals.preview.startPage=null;fluid.controllers.bin.show();fluid.main.fire("previewclosed");previewMenu.close();m.isOpen=false},parseDownload:function(t,C,v){var A="Couldn't download correctly (has it been deleted/made inactive?)";try{var u=JSON.parse(t)}catch(B){try{var u=JSON.parse(v.responseText)}catch(B){$("body").html("Unable to parse download - unknown error (1)");throw ("Error Downloading "+item+"Caller:"+arguments.callee.caller+" Second level:"+arguments.callee.caller.caller+"loadSate"+loading_Stage_Check)}}if(u.r!="s"){m.displayErrorMessageOnLoad(A);return false}try{var z=JSON.parse(u.t.toString())}catch(B){m.displayErrorMessageOnLoad("Unable to download the mockup - download was interrupted.")}if(!fluid.main.project&&g_preview){fluid.main.project=new fluid.models.project(z,{parse:true,projectId:g_preview,syncOnChange:false})}var u=z[g_preview];if(u&&u.active===false){var s=(location.origin==="file://")?window:top;m.displayErrorMessageOnLoad("");m._crossDomainCall(window.parent,"setFrameSize",[324,500]);$("#projectInactive").tmpl().appendTo("body");return false}if(m.exported){m.afterPreviewLoad(z)}else{return z}},displayErrorMessageOnLoad:function(s){$("body").html(s);m.scaleFrame(true,true)},afterPreviewLoad:function(w){if(w===false){return}var F=[];var J=$("#homePage");if(innerWidth===300&&w[window.g_preview]&&w[window.g_preview].pageWH){F=w[window.g_preview].pageWH;if(F[0]<F[1]){J.css("background-size",F[0]+"px auto")}else{J.css("background-size","auto "+F[1]+"px")}}else{if(innerWidth<innerHeight){F[0]=innerWidth+"px";F[1]="auto"}else{F[0]="auto";F[1]=innerHeight+"px"}J.css("background-size",F[0]+" "+F[1])}var t=d.deviceScreen(),u=t.device,G=t.screen,z=w[window.g_preview]||w,D=z.deviceModel,C,I,B=window.innerWidth>window.innerHeight,v=document.getElementById("homePageStyle"),A='<link id="appIcon" rel="apple-touch-icon" href="'+(d.getUrl("icon",null,z)||"img/apple-touch-icon-144.png")+'" />';if(/iPhone/.test(D)){C=(d.getUrl("splash"+D,G.splash,z)||"img/fluidLoading"+d.screens[D].splash+".png");A+='<link id="splashP" rel="apple-touch-startup-image" href="'+C+'" />'}else{C=d.getUrl("splashP"+D,G.splashP,z)||(G.splashP?"img/fluidLoading"+G.splashP+".png":"");I=d.getUrl("splashL"+D,G.splashL,z)||(G.splashL?"img/fluidLoading"+G.splashL+".png":"");A+='<link id="splashP" rel="apple-touch-startup-image" sizes="'+G.splashP+'" media="(orientation: portrait)" href="'+C+'" /><link id="splashL" rel="apple-touch-startup-image" sizes="'+G.splashL+'" media="(orientation: landscape)" href="'+I+'" />'}var E=z&&z.pageWH[0]||"1024px 748px;";var K=z&&z.pageWH[1]||"748px 1024px;";if(v){v.innerHTML="#homePage { background: url("+(B&&I?I:C)+") no-repeat bottom; background-size: "+(/iPad/.test(D)?(B?"1024px 748px;":"764px 1004px;"):D==="iPhone5"?"320px 568px;":D==="iPhone"?"320px 460px;":E+"px "+K+"px;}")}if(!u){if(!C&&!I){document.head.removeChild(v);$("#default-branding-links").tmpl().appendTo("head")}}$("head").append(A);try{p.getParentWindow().preview.setAvailableRect()}catch(H){m._crossDomainCall(window.parent,"setAvailableRect")}$(document).ready(function s(L){if(p.isMobileDevice()){$("body").addClass("mobile")}j.useCanvas=true;m.runDraw(w);$(window).bind("orientationchange",function(){$("body").scrollTop(0).scrollLeft(0);loading_Stage_Check="preview Loaded"})})},load:function(s,u){if(location.origin==="file://"||!frameElement){t()}else{$(frameElement).load(t)}function t(){o.onReady(function(){l.init(function(){if(location.origin!=="file://"){$(frameElement).off("load")}var v=l.get(s);if(v&&v.unloaded!==true){if(typeof u==="function"){u(v)}if(window.g_print){m.runDraw(s)}}else{function w(z){var A=m.parseDownload.apply(this,arguments);if(typeof u==="function"){u(A)}z=JSON.parse(z);var B=JSON.parse(z.t);if(window.g_print){m.runDraw(B)}}fluid.api.syncDown(s,false,false,w,w)}})})}},draw:function(K){if(!K){return false}if($.mobile){$.mobile.defaultHomeScroll=0}for(var M in K){l.setTempItem(M,K[M])}var u=K[g_preview]||K;for(var E=0;E<u.pages.length;E++){var s=l.get([u.pages[E]]);m.pageNotes[u.pages[E]]=s&&s[3]||""}m.viewportScaled=window.navigator.hasOwnProperty("standalone")&&window.navigator.standalone;m.projectWH=[u.pageWH[0],u.pageWH[1]];var D=m.viewportScaled?m.projectWH[0]:$(window).width();var t=m.viewportScaled?m.projectWH[1]:m.getTrueHeight();if(p.isMobileDevice()&&D>t&&window.screen.width<window.screen.height){var I=D;D=t;t=I}var L=m.viewportScaled?Math.min(window.screen.width/D,window.screen.height/t):1;if(/iP(hone|od|ad)/.test(navigator.platform)){var A=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);if(A&&A[1]&&A[1]==="6"){$("#metaViewport").attr("content","initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no")}}else{$("#metaViewport").attr("content","width="+D+",height="+t+",minimum-scale="+L+",maximum-scale="+L+",initial-scale="+L+",user-scalable=0")}if(p.getParentWindow()){if(!window.g_embedded){try{var w=$("#previewPage",window.parent.document);if(w.size()>0){w.css({width:u.pageWH[0],height:u.pageWH[1]});$(".ui-mobile-viewport").css("overflow","hidden")}}catch(H){}}m.scaleFrame()}else{if(window.parent!==window){m._crossDomainCall(window.parent,"setFrameSize",u.pageWH);m._crossDomainCall(window.parent,"scaleFrame")}}if(location.origin==="file://"){$(".pageList:not(#homePage)").css("height",m.getTrueHeight()+"px")}else{$(".pageList").css("height",m.getTrueHeight()+"px")}document.title=u.name;document.projectLoaded=true;for(var E=0;E<u.pages.length;E++){if(!l.get(u.pages[E])){u.pages.splice(E,1);E--}}if(!l.get(u.homepage)){u.homepage=u.pages[0]}var C=u.orientation;m.multiOrientations=false;for(var E=0,F=u.pages.length;E<F;E++){if(l.get(u.pages[E]).orientation!=C){m.multiOrientations=true;break}}if(n.OS=="Android"&&m.multiOrientations){var J=$(window).width();var z=window.outerHeight||getTrueHeight();$(".ui-mobile-viewport").css({"min-height":Math.max(J,z)+"px"})}if(window.g_embedded&&(m.projectWH[0]>m.projectWH[1]||m.multiOrientations)){}if(window.g_print){for(var E=0,F=u.pages.length;E<F;E++){m.drawPage(u.pages[E],u)}$("#font-preloader").remove()}else{var B=p.getParentWindow()?p.getParentWindow().globals.preview.startPage:null,G=B||(u.homepage?u.homepage:u.pages[0]);m.homePage=G;m.drawPage(G,u);if(typeof g_previewMode!="undefined"&&g_previewMode==true){m.scaleViewport();m.bindMobileEvents(u.links);g_homepage=G;setTimeout(function(){m.changePage("#"+G,null,false,true)},m.delayStart)}}},showPage:function(s){$(".previewPage").hide();$("#"+s).show();if(typeof window.callPhantom==="function"){window.callPhantom({event:"shownPage",id:s})}},drawPage:function(t,w){if(!w){w=l.get(g_preview)}var z="transparent";var A=l.get(t);if(!A){return}var s=[A.width,A.height];var v={pageId:t,width:s[0],height:s[1],widthScreen:$(window).width(),heightScreen:m.getTrueHeight(),bgColor:z};if(window.g_embedded){if(m.multiOrientations){if(s[0]>s[1]){v.top=(s[0]-s[1])>>1}else{v.left=(s[1]-s[0])>>1}}else{v.left=$(".previewLogoHolder").outerWidth()}}if((window.g_print)&&(A.notes!=undefined)){v.notes=A.notes[3];v.title=A.name==undefined?"":A.name}var u=$("#tmplPreviewPage").tmpl(v).appendTo("body");m.drawWidgets(g_preview,t,w.links);m.showLinks(w.links,t);$("#"+t).bind("pageshow",m.navigateInit);if(window.g_print){if(A.width===w.pageWH[0]&&A.height===w.pageWH[1]){u.addClass("project-size")}}},changePage:function(A,B,w,s){var u=A.substr(1);if($(A).size()==0){m.drawPage(u);$(A).trigger("pageinit")}$(A).addClass("visited");var C=B;var t=s=="undefined"?true:!s;if((!C)&&(t)){var z=m.navigationDefaultTransition.split(":");var v=(z.length>1)?true:false;C={transition:z[0],reverse:v}}m.orient(null,$(A),$(".ui-page.ui-page-active"));if(p.isMobileDevice()){$.mobile.changePage(A,C)}else{setTimeout(function(){$.mobile.changePage(A,C)},300)}if(window.Android){Android.updateOrientation()}window.setTimeout(function(){m.preloadLinkedPages(u);m._fixNavigationStatus(u,B,w)},100)},_fixNavigationStatus:function(u,v,w){if((m.navigationStackBack.length>0)&&(w!=2)){var t=v;if(m.navigationQueueNext.length>0){if(m.navigationQueueNext[0].args){t=m.navigationQueueNext[0].args;t.reverse=!t.reverse}}m.navigationStackBack.push({pageId:u,args:t})}m.navigationQueueFlow=$.grep(m.navigationQueueFlow,function(A,z){return A.pageId!=u});var s=$("#"+u).hasClass("blank");if(!s){m.navigationQueueFlow.push({pageId:u,args:v})}m.navigationQueueNext=$.grep(m.navigationQueueNext,function(A,z){return A.pageId!=u})},_isPageVisited:function(s){var t=$("#"+s);if((t.size()>0)&&(t.hasClass("visited"))){return true}return false},preloadLinkedPages:function(t){if((m.navigationCompleted)&&(m.navigationQueueFlow.length>1)){var z=m.navigationQueueFlow.slice(0);var B=z.pop();m.navigationStackBack.push(B);return}var v=l.get(g_preview);var A=l.get(t);var s=v.links;var w=0;var u=0;$.each(s.linkOrigin,function(G,D){if(s.linkType[G]=="ahref"&&$("#"+D).closest(".page").attr("id")==t){var C=s.linkDest[G];var I=l.get(C);if(!I){return}var H=$("#"+C);if((H.size()==0)&&(I.widgets.length>0)){var J=s.transType[G].split(":");var F=(J.length>1)?true:false;var E={transition:J[0],reverse:F};m.navigationQueueNext.push({pageId:C,args:E});m.drawPage(C,v);w++}else{if(H.size()>0){if((m.navigationQueueFlow.length>0)&&(C==m.navigationQueueFlow[0].pageId)&&(!m.navigationQueueFlow[0].args)){var J=s.transType[G].split(":");var F=(J.length>1)?true:false;m.navigationQueueFlow[0].args={transition:J[0],reverse:F}}}}}if((m.navigationStackBack.length==0)&&(u<1)){if((s.linkType[G]=="ahref")&&(s.linkDest[G]==t)){var C=m.getPageIdForWidget(D);var I=l.get(C);if(!I){return}if((!m._isPageVisited(C))&&(I.widgets.length>0)){var J=s.transType[G].split(":");var F=(J.length>1)||J[0]=="none"?false:true;var E={transition:J[0],reverse:F};m.navigationStackBack.push({pageId:C,args:E});u++}}}});m.preloadNextUndisplayedPage(v);m.preloadPreviousUndisplayedPage(v)},preloadNextUndisplayedPage:function(s){return m.findUnlinkedPage(s,s.pages,m.navigationQueueNext,true)},preloadPreviousUndisplayedPage:function(s){var v=s.pages.slice(0);m.findUnlinkedPage(s,v.reverse(),m.navigationStackBack,false);if((m.navigationCompleted)&&(m.navigationQueueFlow.length>1)){var t=m.navigationQueueFlow.slice(0);var u=t.pop();m.navigationStackBack.push(u)}},findUnlinkedPage:function(u,s,w,t){if((m.navigationCompleted)||(w.length>0)){return false}var v=false;$.each(s,function(A,z){if(!m._isPageVisited(z)){var B=l.get(z);if(B.widgets.length>0){w.push({pageId:z,args:null});if(t){m.drawPage(z,u)}v=true;return false}}});if(!v){m.navigateSetCompleted()}return v},showLinks:function(t,s){$.each(t.linkOrigin,function(w,u){if(t.linkType[w]=="ahref"&&(!s||$("#"+u).closest(".page").attr("id")==s)){$("[id="+u+"]").addClass("widgetLink");var A=$("[id="+u+"]").attr("data-lockto");var z=$('[data-lockto="'+A+'"]').each(function(){var v=$(this).attr("id");if(m.linkShowRipple(v,u)){$("#"+v).addClass("widgetLink")}})}})},drawWidgets:function(w,v,u){var B=$("#"+v).find("[data-role=content]");var t=[];for(var A in u.linkDest){if(u.linkType[A]=="template"&&u.linkDest[A]==v){var z=fluid.main.project.pages.get(u.linkOrigin[A]).attributes.widgets;t=t.concat(z)}}var z=fluid.main.project.pages.get(v).attributes.widgets;widgetList=t.concat(z);for(var A=0;A<widgetList.length;A++){j.checkIntegrity(widgetList[A])}if(widgetList.length>0){var s=true;j.load(v,widgetList,s)}else{m.showBlankPage(v,u)}},showBlankPage:function(t,s){var u=$("#blankPage").find(".pageList").html();var v=$("#"+t).find(".widgetHolder");v.html(u);v.parent().addClass("blank");$(".blankPageBackButton",v).bind("click",m.navigateBack)},getPageIdForWidget:function(v){var u=l.get(g_preview);var s=u.pages;var t="";$.each(s,function(w,z){var A=l.get(z).widgets;$.each(A,function(C,B){if(B==v){t=z;return false}});if(t!=""){return false}});return t},orient:function(u,t,s){if(!window.g_embedded){try{if(p.isMobileDevice()){m._orientMobile(t,s)}else{m._orientParent(t,s)}m.scaleViewport(t);m.centerFrame()}catch(u){}}},_orientationData:function(D){var w=l.get(g_preview);var A=l.get(D.attr("id"));var u=w.pageWH||[320,480];var B=A.orientation?(A.orientation!="Landscape"):(A.width<=A.height);var s=B?A.width>A.height:A.width<=A.height;var t=$.event.special.orientationchange;var v=(t&&$.isFunction(t.orientation))?t.orientation()=="portrait":window.screen.width<window.screen.height;var z=u[1]>=u[0];var C=B&&z||!B&&!z;return{portrait:B,crossOriented:v!=B,multiOriented:m.multiOrientations,projectOriented:C,width:u[0],height:u[1]}},_orientMobile:function(u,s,v){v=v||m._orientationData(u);m.pageRotation=v.crossOriented?(v.portrait?-90:90):0;var t;if((v.portrait&&v.projectOriented)||(!v.portrait&&!v.projectOriented)){t="width"}else{t="height"}m.pageTranslation=m.pageRotation?(m.pageRotation>0?[0,-v[t]]:[-v[t],0]):[0,0];m.applyPageTransforms(u);if(n.OS=="iOS"){var z=window.screen.width*(m.viewportScaled?window.devicePixelRatio:1);var A=window.screen.height*(m.viewportScaled?window.devicePixelRatio:1);var w=v.portrait!=v.crossOriented;$(document.body).css({width:(w?Math.min(z,A):Math.max(z,A))+"px"})}else{if(p.hideBrowserBar()){window.scrollTo(0,1)}}},orientPrevPage:function(u,s,v){if(!s){return}var t,w=(v.portrait&&v.projectOriented)||(!v.portrait&&!v.projectOriented);translateSide=w?"width":"height";if(v.portrait){t="rotate(90deg) translate(0,-"+v[translateSide]+"px)"}else{t="rotate(-90deg) translate(-"+v[translateSide]+"px, 0)"}$(".widgetHolder",s).css({"-webkit-transform":t,"-moz-transform":t,transform:t})},_orientParent:function(v,t,z){var A=$("#previewPage",p.getParentWindow()?frameElement.ownerDocument:document);z=z||m._orientationData(v);if(z.crossOriented){if(!p.getParentWindow()&&window.g_preview){setTimeout(function(){m.orientPrevPage(v,t,z)},0)}else{m.orientPrevPage(v,t,z)}if(A&&A.length){m.hideNotes();var s=A[0],w=s.parentNode,u={};if(z.projectOriented){u.width=z.width;u.height=z.height}else{u.width=z.height;u.height=z.width}$(".widgetHolder",v).css({"-webkit-transform":"","-moz-transform":"",transform:"",width:u.width+"px",height:u.height+"px"});s.style.width=u.width+"px";s.style.height=u.height+"px";m.centerFrame(window.parent||window);if(z.portrait){w.classList.remove("to-landscape");w.classList.add("to-portrait")}else{w.classList.remove("to-portrait");w.classList.add("to-landscape")}}else{if(window.parent!==window){m._crossDomainCall(window.parent,"_orientParent",[null,null,z])}}}fluidEvent.triggerPreview("changeOrientation",{},true)},finishOrient:function(u,t,s){if(!window.g_embedded){try{if(!p.isMobileDevice()){m._finishOrient(t,s)}}catch(u){}}},clearPageOrientation:function(){m.pageRotation=0;m.pageTranslation=[0,0]},_finishOrient:function(t,s,u){var v=p.getParentWindow()&&window.parent&&$("#previewPage",window.parent.document);u=u||m._orientationData(t);if(p.getParentWindow()&&t){m.multiOrientations=u.multiOriented;m.updateNotes(t[0].id);m.debouncedPositionAndShowNotes()}if(s){m.clearPageOrientation();s.find(".widgetHolder").css({transform:"",webkitTransform:"",mosTransform:""});m.clearPageOrientation();m._crossDomainCall(window.parent,"_finishOrient",[null,null,u])}},bindMobileEvents:function(B){h.setup(B);function v(E,D){m.pageTransitioning=true;h.showPage.call(E.target,E)}function t(E,D){h.isScrolling=false;h.isDoubleTapping=false;h.isSwiping=false;m.pageTransitioning=false;m.finishOrient(E,$(E.target),D.prevPage);$(".ui-scrollview-clip",E.target).scrollview("option","rotate",m.pageRotation);setTimeout(function(){h.isTapHolding=false;if(p.hideBrowserBar()){window.scrollTo(0,1)}},350)}function A(D){m.orient(D,$.mobile.activePage);$(".ui-scrollview-clip",$.mobile.activePage).scrollview("option","rotate",m.pageRotation)}function w(H){h.isScrolling=false;h.isDoubleTapping=false;h.isTapHolding=false;h.isSwiping=true;var E={up:0,right:90,down:180,left:270};var D={0:"up",90:"right",180:"down",270:"left"};var G=H.type.substr(5);var F=D[(360+(E[G]-m.pageRotation))%360];m.handleUserInput("swipe"+F,$(H.currentTarget).attr("id"),B);return false}function s(D){D.stopImmediatePropagation();if(h.isSwiping){h.isSwiping=false}else{if(h.isScrolling){h.isScrolling=false}else{if(h.isDoubleTapping){h.isDoubleTapping=false}else{if(h.isTapHolding){h.isTapHolding=false}else{m.handleUserInput(D.type,$(D.currentTarget).attr("id"),B)}}}}}function C(E){h.isTapHolding=true;var D=$(E.currentTarget).attr("id");m.handleUserInput(E.type,D,B)}function z(E){h.isDoubleTapping=true;var D=$(E.target).parents(".pageWidget").attr("id");m.handleUserInput("doubletap",D,B)}function u(D){$(document).trigger("mouseup")}if(p.isMobileDevice()){if($.support.orientation){$(window).bind("orientationchange",A)}$(window).resize(function(){window.setTimeout(function(){m.scaleViewport($.mobile.activePage)},100)})}$("body").bind("pageinit",function(D){$(".pageWidget",D.target).doubletap(z)}).bind("pagebeforeshow",v).bind("pageshow",t).mouseleave(u);$(document).bind("touchmove",false);$(".pageWidget").live("swipeleft swiperight swipeup swipedown",w).live("vclick",function(D){D.preventDefault();s(D)}).live("taphold",C)},handleUserInput:function(v,z,t){var w=p.getParentWindow()&&p.getParentWindow().fluid.main.project||fluid.main.project;var t=w.get("links");if(h.isScrolling){return false}v=(v=="vclick"||v=="click")?"tap":v;var s=m.linkCheck(z,t);if(s>-1&&t.triggerType[s]==v){m.navigateSetIncompleted();var A=w.links.get(t.linkCanvId[s]).get("transType").split(":");var u=(A.length>1)?true:false;m.changePage("#"+t.linkDest[s],{transition:A[0],reverse:u})}else{}},alertCopyEmbedCode:function(s){notification.add("alert","Embed Code Copied");tracker.record("copiedEmbedCode",5,"",s)},showDebugInfo:function(t){var s=$("#divDebugInfo").html();if(s){t=s+t}$("#divDebugInfo").remove();$("body").append("<div id='divDebugInfo'>"+t+"<br/></div>")},getTrueHeight:function(){return(window.hasOwnProperty("innerHeight")?window.innerHeight:$(window).height())||480},linkCheck:function(u,s){do{var t=$.inArray(u,s.linkOrigin);if(t>-1){return t}u=l.get(u);if(u==null){return -1}u=u.of}while(u);return -1},linkShowRipple:function(u,t){var s=l.get(u);if(s&&s.segments==null){if(s.of==null){return}if(t!=s.of){if(m.linkShowRipple(s.of,t)){$("#"+u).addClass("widgetLink")}}if(t==s.of){return true}}},runDraw:function(E){var t=E;var w;if(typeof(E)=="string"){E=project.bundle(E);w=E[g_preview];if(!w||!w.pages){fluid.api.syncDown(previewId,false,false,m.parseDownload,m.parseDownload);return}}w=w||E[window.g_preview];m.loaded=true;m.navigationStackBack=[];m.navigationStackForward=[];m.navigationQueueNext=[];m.navigationQueueFlow=[];m.navigationCompleted=false;m.navigationDefaultTransition=w?w.defaultTransition:"none";m.draw(E);if(window.g_print){var C=20,u=w.pageWH[0];height=w.pageWH[1],printStyle="@page { size: "+w.orientation+"; margin: "+C+"px; }\n.printPageWrapper { width: "+u+"px; height: "+height+" }\n";for(var z=1;z>0;z-=0.1){z=z.toFixed(1);var B=Math.floor(u*z),s=Math.floor(height*z);printStyle+="@media print and (max-width: "+(B+C)+"px) {\n    .project-size .page { -webkit-transform: scale("+z+"); transform: scale("+z+"); }\n    .printPageWrapper.project-size { width: "+B+"px; height: "+s+"px}\n}\n"}for(var A=0;A<w.pages.length;A++){var v=w.pages[A],D=E[v];if(D.width===u&&D.height===height){continue}printStyle+="#print_"+v+" { width: "+D.width+"px; height: "+D.height+"px; }\n";for(var z=1;z>0;z=z-=0.1){z=z.toFixed(1);var B=Math.floor(D.width*z),s=Math.floor(D.height*z);printStyle+="@media print and (max-width: "+(B+C)+"px) {\n    #"+v+" { -webkit-transform: scale("+z+"); transform: scale("+z+"); }\n    #print_"+v+" { width: "+B+"px; height: "+s+"px; }\n}\n"}}$("head").append('<style type="text/css">'+printStyle+"</style>")}},restart:function(){m.changePage("#"+m.homePage,null,false,true)},hideMenu:function(){},navigateInit:function(t,s){m.navigationEnabled=true},navigateSetCompleted:function(){m.navigationQueueNext=[];m.navigationStackForward=[];m.navigationCompleted=true},navigateSetIncompleted:function(){m.navigationCompleted=false},navigateWithKeys:function(u){if((u.keyCode==27)&&(self!=top)&&(window.parent.lib!=undefined)){window.parent.lib.esc()}var t=p.getNavigationKeyDirection(u.keyCode);if(t==""){return}var s=top==self?document.getElementById("previewPage").contentWindow.preview:window.preview;if((!s)||(!s.navigationEnabled)){return}if((t=="top")||(t=="right")){s.navigateNext();return}s.navigateBack()},navigateNext:function(){if(m.navigationStackForward.length>0){var s=m.navigationStackForward.pop();m.changePage("#"+s.pageId,s.args);return}if(m.navigationQueueNext.length>0){var s=m.navigationQueueNext.shift();m.changePage("#"+s.pageId,s.args);return}if(m.navigationQueueFlow.length>0){var s=m.navigationQueueFlow.shift();m.changePage("#"+s.pageId,s.args);return}},navigateBack:function(){if(m.navigationStackBack.length>1){var A=m.navigationStackBack.pop();var z=m.navigationStackBack.pop();var s=$("#"+z.pageId).hasClass("blank");if(s){if(m.navigationStackBack.length>0){z=m.navigationStackBack.pop()}else{return}}if(m.navigationCompleted){var w=m.navigationQueueFlow.pop();m.navigationQueueFlow.splice(0,0,w);var t=m.navigationQueueFlow.pop();if(t.pageId!=z.pageId){m.navigationQueueFlow.push(t)}}else{m.navigationStackForward=$.grep(m.navigationStackForward,function(C,B){return C.pageId!=A.pageId});var v=$("#"+A.pageId).hasClass("blank");if(!v){var u={pageId:A.pageId,args:z.args};m.navigationStackForward.push(u)}}m.changePage("#"+z.pageId,z.args,1);return}if((m.navigationCompleted)&&(m.navigationQueueFlow.length>0)){var w=m.navigationQueueFlow.pop();m.changePage("#"+w.pageId,w.args,1)}},_crossDomainCall:function(u,t,s){u.postMessage(JSON.stringify({funcName:t,args:s}),"*")},_crossDomainCallListener:function(s){var t=JSON.parse(s.originalEvent.data);if($.isFunction(m[t.funcName])){m[t.funcName].apply(m,t.args)}},getNotesElement:function(u){u=u||window;var t=u.document.getElementById("inPreviewNotes");if(t){return t}try{if(u.frameElement){return m.getNotesElement(u.frameElement.ownerDocument.defaultView)}}catch(s){}return null},positionNotes:function(){var t=m.getNotesElement(),u=t&&t.clientWidth||0;if(t){var v=document.getElementById("previewPage")||window.frameElement,s=v.getClientRects()[0];if(!s){return}x=s.left;y=s.top;t.style.left=(x-u+1)+"px";t.style.top=Math.max(y,0)+"px"}},updateNotes:function(s){var t=m.getNotesElement();if(!t){return}var v=m.getNotesElement().querySelector("#previewNotesContent"),u=page.get(s,"notes");v.textContent=u&&u[3]||"This page has no notes"},showNotes:function(){notesElement=m.getNotesElement();notesElement&&notesElement.classList.remove("hide")},hideNotes:function(){notesElement=m.getNotesElement();notesElement&&notesElement.classList.add("hide")},toggleShare:function(){var s=document.getElementById("previewShare");s.classList.toggle("closed");m.setAvailableRect(m.calcAvailableRect());m.scaleFrame()},centerFrame:function(v){v=v||p.getParentWindow()||window;var B=v.document,u=B.getElementById("previewPage");if(!u){m._crossDomainCall(window.parent,"centerFrame");return}var z=u.parentNode,C=z.style,t=m.availableRect,s=$(u).outerWidth(),D=$(u).outerHeight(),w=t.width/2+t.left,A=t.height/2+t.top;C.marginLeft=-(s/2)+"px";C.marginTop=-(D/2)+"px";C.left="50%";C.top="50%";C.width=s+"px";C.height=D+"px";setTimeout(m.positionNotes,400)},calcAvailableRect:function(s){s=s||window;var t=s.document;return{width:s.innerWidth,height:s.innerHeight,left:0,top:0}},setFrameSize:function(t,s){$("#previewPage").css({width:t,height:s});m.scaleFrame()},availableRect:{width:(location.origin==="file://")?window.innerWidth:top.innerWidth,height:(location.origin==="file://")?window.innerHeight:top.innerHeight,top:0,left:0},setAvailableRect:function(s){s=s||m.calcAvailableRect();m.availableRect=s;if(m.canAccessFrame()&&$("#previewPage")[0].contentWindow.preview){$("#previewPage")[0].contentWindow.preview.availableRect=s}else{if($("#previewPage").length){m._crossDomainCall($("#previewPage")[0].contentWindow,"setAvailableRect",s)}}},canAccessFrame:function(){try{return !!(document.getElementById("previewPage").contentWindow.document)}catch(s){return false}},debouncedPositionAndShowNotes:q(function(){m.positionNotes();m.showNotes()},300,false)};function q(t,v,s){var u;return function(){var B=this,A=arguments;var z=function(){u=null;if(!s){t.apply(B,A)}};var w=s&&!u;clearTimeout(u);u=setTimeout(z,v);if(w){t.apply(B,A)}}}b.exports=m},{"./browserdetect":1,"./class-branding":3,"./class-dbStorage":6,"./class-scrollview":22,"./class-storage":24,"./class-widget":28,"./class-widgetEvents":29,"./class-widgetNewDraw":30,"./class-widgetNewMoving":31,"./utils":60}],19:[function(d,a,f){var i=d("./class-account");var l=d("./class-projectSettings");var h=d("./class-storage");var p=d("./fluid/fluid.i18n");var o=d("./utils");fluid.command=d("./fluid/fluid.command");var j=d("./class-page");var c=d("./class-notification");var m=d("./class-link");var b=d("./class-fluidMenu");var k=d("./class-lib");d("./class-wdgRenderer");var n={isInitialized:false,isModified:false,activeProjectTooltip:"",autoPreviewTimeout:300000,inactiveProjectTooltip:"This project is inactive. Editing is disabled.",colors:{hStart:5,hEnd:210,s:"90%",l:"50%"},unloadedProps:["name","created","updated","active","preview"],recentProjectDays:15,lastProjectClosed:false,orient:function(v,r){var r=v!=undefined?$(v.target).attr("data-for"):r;var s=n.get("pageWH");var z=parseInt(s[0],10);var w=parseInt(s[1],10);var t=Math.min(z,w);var A=Math.max(z,w);s=r=="Portrait"?[t,A]:[A,t];n.set({orientation:r});n.set({pageWH:s});var q=n.get("pages");for(var u in q){j.update({orientation:r,width:s[1],height:s[0]},q[u])}$(".screen").each(j.resizeAfterOrient);j.updateOptionsMenu()},isMultiOrientation:function(){var t=n.get("pages");var v=n.get("orientation");var s=false;if(!t||!t.length){return false}for(var r=0,q=t.length;r<q;r++){var u=j.get(t[r],"orientation");if(u!=v){s=true;break}}return s},setNumber:function(r,t){var s=fluid.main.projects.filter(function(v,u,w){if(v.get("removed")){return false}return true}).length;var q="All Projects ("+s+")";$(".projectSettingsButton").removeClass("buttonDisabled").find("span").text(q);$("#logout").removeClass("hidden")},hoverIn:function(){$(this).children(".foreground").addClass("projectHover");$(this).children(".popOutPage").addClass("popOutPageHover")},hoverOut:function(){$(this).children(".foreground").removeClass("projectHover");$(this).children(".popOutPage").removeClass("popOutPageHover")},_template:function(q,s){q.id=s;q.name=q.name||"New Project";q.date=fluid.i18n.formatDate(q.created);q.dateCreate=moment(q.created).format("YYYY/MM/DD HH:mm:ss");q.dateUpdate=moment(q.updated).format("YYYY/MM/DD HH:mm:ss");q.tooltip=q.active===false?n.inactiveProjectTooltip:n.activeProjectTooltip;q.nameLower=q.name.toLowerCase();var r=$("#tmplProjectThumb").tmpl(q);if(q.active===false){r.addClass("inactivePrj")}else{r.addClass("activePrj")}r.insertAfter("#projectAdd");l.updateThumbnail(s);delete q.dateCreate;delete q.dateUpdate;delete q.nameLower;return r},hasWidgets:function(){var r=i.get("lastOpenProject");var s=h.get(r);var q=false;if((s)&&(s.pages)){$.each(s.pages,function(t,v){var u=j.get(v,"widgets");if((u)&&(u.length>0)){q=true;return false}})}return q},hasLinks:function(){return(fluid.main.project&&fluid.main.project.links&&fluid.main.project.links.length)?true:false},get:function(q){return fluid.main.project.get(q)},set:function(q){var r=i.get("lastOpenProject");n.loadIfUnloaded(r,function(){var s=h.get(r);if(!s){return}for(var t in q){s[t]=q[t]}h.set(r,s)})},changeScreenSize:function(z,r){if(typeof r==="object"){var v=r[0];var q=r[1]}else{var v=parseInt($(".screenSize").filter(".width").val());var q=parseInt($(".screenSize").filter(".height").val())}var u=50;var w=50;if((isNaN(v))||(isNaN(q))){v=n.get("pageWH")[0];q=n.get("pageWH")[1];$(".screenSize").filter(".width").val(v);$(".screenSize").filter(".height").val(q)}else{v=v<u?u:v;q=q<w?w:q;v=parseInt(v,10);q=parseInt(q,10);n.set({pageWH:[v,q]});var s=q>=v?"Portrait":"Landscape";n.orient(null,s)}staticWidgets.zoomInBoundary();var t=$("#canvasPages .screen.active").attr("id");if(t){fluid.zoom.zoomToPage({pageId:t})}else{fluid.zoom.zoomToAllPages()}},save:function(){var r=n.get("id");var q=h.get(r);q.updated=new Date().getTime();h.set(r,q)},dragStart:function(F,A){var t=$(this).hasClass("inactiveProject");var s=$("#projects").outerHeight();var q=$("#projects").closest(".viewport").height();var D=$("#projects").parent().position().top;var u=t?$("#projectList"):$("#inactiveProjectList");var G=u.outerHeight();var B=u.children("h2, h3, h4, h5");var C=B.outerHeight(true)||50;var E=t?D+G:G-s+q-D;var J=E<C;var v=0;if(J){var H=t?-1:1;v=H*(E-C-B.position().top);if(t){v+=2;B.css({"-webkit-transform":"translate(0, "+(G-C-8)+"px)","-moz-transform":"translate(0, "+(G-C-8)+"px)"});u.children(".addProject, .project").css({"-webkit-transform":"translate(0, -"+(B.outerHeight()||0)+"px)","-moz-transform":"translate(0, -"+(B.outerHeight()||0)+"px)"})}u.removeClass("bouncing").css({top:E<0?E+4+"px":"","z-index":1}).addClass("bouncing scrolledIntoView");var r=parseInt(u.css("-webkit-transition-duration"));var z=E>=0?E/C:1;r=r*z+(r>1?"ms":"s");u.css({top:v+"px","-webkit-transition-duration":r,"-moz-transition-duration":r,"-webkit-animation-delay":r,"-moz-animation-delay":r});var w=$("#projects .project").first().outerHeight(true)||0;var I=v-H*w;$("#projects").data("popoutAreaHeight",w).data("popoutTranslateTop",I)}$("#projects").data("showDest",J)},drag:function(r,A){var z=$(this);var w=$("#fluidDropdown .viewport");if($("#projects").is(":visible")&&o.isMouseOver(r,w)){var q=$(this).hasClass("inactiveProject");var v=q?$("#projectList"):$("#inactiveProjectList");var u=$("#projects");var B=u.data("popoutAreaHeight");var t=u.data("popoutTranslateTop");var s=o.relativeMousePos(r,w).top;if(u.data("showDest")&&((q&&s<B)||(!q&&w.height()-s<B))){v.removeClass("bouncing").css({top:t+"px","-webkit-transition":"top 0.2s ease-in-out","-moz-transition":"top 0.2s ease-in-out"}).bind("webkitTransitionEnd",function(){v.unbind("webkitTransitionEnd")})}n._updateDroppables(r,z)}else{$("#projectList, #inactiveProjectList").removeClass("hover")}if(intersectTrash(z.data().draggable.helper)==true){$("#trash").addClass("droppableStyle")}else{$("#trash").removeClass("droppableStyle")}},_updateDroppables:function(s,r){var q=[{elem:$("#projectList"),accept:".inactiveProject"},{elem:$("#inactiveProjectList"),accept:".project:not(.inactiveProject)"}];$.each(q,function(t,v){var u=v.elem;if(o.isMouseOver(s,u)&&r&&r.is(v.accept)){if(!u.hasClass("hover")){u.addClass("hover")}}else{if(u.hasClass("hover")){u.removeClass("hover")}}})},dragStop:function(q){$("#projectList, #inactiveProjectList").removeClass("hover");$("#projects").data("showDest",false);var r=$(this).hasClass("inactiveProject")?$("#projectList"):$("#inactiveProjectList");r.removeClass("bouncing").animate({top:"0px"},200,function(){r.removeClass("scrolledIntoView").children("h2, h3, h4, h5, .addProject, .project").removeAttr("style")});$("#trash").removeClass("droppableStyle")},dropToActive:function(r,q){var q=q==undefined?false:true;var s=false;if(fluid.main.fire("project.beforeActivate")&&!q){if(n.isOpen(r)){c.removeAll("alert","projectInactive")}c.removeAll("alert","projectLimit");n._handleActiveInactiveDrop(r,false);tracker.record("dropActive",1);l.getItemById(r).removeClass("inactivePrj").addClass("activePrj");l.displayStatus(true);l.applyFilter();l.actionLoadVersions();$("#canvasPages .pageWidget").draggable("option","disabled",false);s=true}j.displayMenu();$("#projectList, #inactiveProjectList").removeClass("hover");return s},dropToInactive:function(q){var r=false;n._handleActiveInactiveDrop(q,true);c.removeAll("alert","projectLimit");tracker.record("dropInactive",1);j.displayMenu(false);$("#projectList, #inactiveProjectList").removeClass("hover");l.getItemById(q).addClass("inactivePrj").removeClass("activePrj");l.applyFilter();$("#canvasPages .pageWidget").draggable("option","disabled",true);r=true;return r},_handleActiveInactiveDrop:function(r,q){n.loadIfUnloaded(r,function(){var s=h.get(r);s.active=!q;s.updated=new Date().getTime();h.set(r,s);n.sync(r);n.setNumber()})},updateInactiveProjectList:function(){var w=$("#inactiveProjectList");var v=w.find(".inactiveProject");var r=w.children(".promptContainer");var q=r.css("display")!="none";var u=r.is(":visible");if(v.size()==0){if(!q){if(u){r.fadeIn(300)}else{r.show()}}}else{if(q){if(u){r.fadeOut(300)}else{r.hide()}}}var s=w.find(".projectPlaceholder");var t=s.size();s.hide().slice(-1*(t-v.size()%t)).fadeIn(300);w.removeWhitespace()},unbundle:function(q,r){r(q)},checkIntegrity:function(r){var u=h.get(r);if(u.unloaded){delete u.unloaded}n.save();if(!u){i.logout();localStorage.setItem("postloadMessage","loginAgain");location.reload()}if(!n.get("canvasWidth")){n.set({canvasWidth:24004})}if(!n.get("canvasHeight")){n.set({canvasHeight:16004})}if(!n.get("canvasPosX")&&n.get("canvasPosX")!==0){n.set({canvasPosX:1000})}if(!n.get("canvasPosY")&&n.get("canvasPosY")!==0){n.set({canvasPosY:1000})}if(typeof n.get("lastTransition")==="undefined"){n.set({lastTransition:"pop"})}if(typeof n.get("pageWH")==="undefined"){n.set({pageWH:[320,480]})}if(typeof n.get("orientation")==="undefined"){n.set({orientation:"Portrait"})}if(typeof n.get("defaultTransition")==="undefined"){n.set({defaultTransition:"slide"})}if(typeof n.get("defaultGesture")==="undefined"){n.set({defaultGesture:"tap"})}if(typeof n.get("widgetGroups")==="undefined"){n.set({widgetGroups:{}})}if(!u.pages){u.pages=[]}if(u.pages.length!==fluid.util._.uniq(u.pages).length){u.pages=fluid.util._.uniq(u.pages);n.set({pages:u.pages})}if(!h.get(u.homepage)&&u.pages.length){n.set({homepage:u.pages[0]})}for(var z=0;z<u.pages.length;z++){var s=h.get(u.pages[z]);if(!s){u.pages.splice(z,1);z--;continue}if(s.x>u.canvasWidth){j.update({x:s.x/4},u.pages[z])}if(s.y>u.canvasHeight){j.update({y:s.y/4},u.pages[z])}if(!s.height){j.update({height:480},u.pages[z])}if(!s.width){j.update({width:320},u.pages[z])}if(!s.orientation){j.update({orientation:"Portrait"},u.pages[z])}if(s.width!==~~s.width){j.update({width:~~s.width},u.pages[z])}if(s.height!==~~s.height){j.update({height:~~s.height},u.pages[z])}var w,q;if(!s.widgets){j.update({widgets:[]},u.pages[z]);s.widgets=[]}for(var v=0;v<s.widgets.length;v++){w=h.get(s.widgets[v]);if(!w){j.removeWidget(u.pages[z],s.widgets[v]);continue}else{if(w.upload&&w.upload==="y"){q=h.get(w.data);if(!q&&i.syncedUploads){continue}}}}}var B=fluid.main.project.links.toJSON();if(!B){B={linkCanvId:[],linkDest:[],linkOrigin:[],linkType:[],transType:[],triggerType:[]};u.links=B}if(typeof B.transType==="undefined"){B.transType=(B.linkType).slice(0);for(var z in B.transType){B.transType[z]=(B.linkType[z]=="ahref")?n.get("defaultTransition"):null}}if(typeof B.triggerType==="undefined"){B.triggerType=(B.linkType).slice(0);for(var z in B.triggerType){B.triggerType[z]=(B.linkType[z]=="ahref")?n.get("defaultGesture"):null}}var A=false;var t;for(var z=0;z<B.linkDest.length;z++){A=false;if(!h.get(B.linkDest[z])){B.linkCanvId.splice(z,1);B.linkDest.splice(z,1);B.linkOrigin.splice(z,1);B.linkType.splice(z,1);B.transType.splice(z,1);B.triggerType.splice(z,1);z--}else{if(!h.get(B.linkOrigin[z])){B.linkCanvId.splice(z,1);B.linkDest.splice(z,1);B.linkOrigin.splice(z,1);B.linkType.splice(z,1);B.transType.splice(z,1);B.triggerType.splice(z,1);z--}}}n.save()},bundle:function(r){if(fluid.main.project&&fluid.main.project.id===r){return fluid.main.project.bundle()}else{var q=fluid.main.projects.get(r);return q.bundle()}},notifySyncAttempt:function(q,r){},sync:function(t,s){if(i.get("accType")=="New"){return}var r=i.get("lastOpenProject");if(t===undefined||t===null){t=r}function q(u){if($.isFunction(s)){s.call(null,u)}}n.loadIfUnloaded(t,function(){var w=h.get(t,{returnModel:true});var v=t==r?!w.isSynced():true;n.notifySyncAttempt(v,t);if(v){var u=h.get(t);u.saved=new Date().getTime();h.set(t,u,false);var z=n.bundle(t);setTimeout(function(){fluid.api.projectSync(t,z,function(){q({data:z,synced:true})},function(){c.add("alert","Could not save your project to the server. Please check your connection.")})},2000)}else{q({synced:false})}if(t==r){fluid.main.project.setModified(false)}})},setName:function(r){var q=h.get(r.id);if(!q){return}q.name=r.name;h.set(r.id,q);if(i.get("lastOpenProject")==r.id){i.set({name:r.name})}},deletePage:function(t){var s=null;var q=n.get("pages");for(var r=0;r<q.length;r++){if(q[r]==t){s=r;break}}q.splice(s,1);n.set({pages:q});n._deletePageWidgets(t)},_deletePageWidgets:function(t){var s=h.get(t);if(s){for(var r=0,q=s.widgets.length;r<q;r++){h.remove(s.widgets[r])}}},sort:function(){var q=i.get("projectIds");var r=$.merge([],q);r.sort(function(t,s){var v=h.get(t)?h.get(t).created:0;var u=h.get(s)?h.get(s).created:0;return v-u});i.set({projectIds:r})},load:function(){i.setLoadingStep(2);if($(".submenuLink .fluidSubmenuActive").length==0){$("#fluidDropdownSubmenu a:first").addClass("fluidSubmenuActive")}n.sort();var t=i.get("accType");var s=i.get("projectIds");var z=i.get("maxActiveProjects");var A=0;if(z!=0&&n.activeProjectCount()>z){A=n.activeProjectCount()-z}l.displayFrame();$("#fluidDropdown .project").not(".addProject").remove();$(".projectThumb").not("#projectAdd").not("#profile .projectThumb").remove();l.resetFilter();for(var u=0,w=s.length;u<w;u++){var v=s[u];var r=h.get(v);if(r){r=n.ensureHeaderIntegrity(r);var q=r.active!==undefined?r.active:true;n._template(r,s[u])}fluid.main.fire("project.loaded",{step:u,count:s.length})}n.setNumber();this.updateInactiveProjectList()},ensureHeaderIntegrity:function(q){if(!q.name){q.name="New Project"}return q},windowClose:function(){h.commitCache();if(fluid.main.project.isEmpty()==false){n.sync()}},windowClose2:function(){alert("Close!");h.commitCache();if(!fluid.main.project.isEmpty()){n.sync()}},close:function(r){fluid.command.history.reset();fluid.command.create("hideButton").dispatchTo("fluid.controllers.timeline");j.detachFrame();var q=i.get("lastOpenProject");$("#canvas").removeClass("loaded");$(".project").removeClass("open");$(".projectThumb").removeClass("open");$(".screen").remove();$("#canvasLinks").empty();if($("#dragCanvas").length==0){$("#tmplDragCanv").tmpl({}).appendTo($("#canvas"))}if(q&&h.get(q)&&!fluid.main.projects.get(q).isEmpty()&&!n.lastProjectClosed){n.sync(null,r)}n.lastProjectClosed=true},open:function(q,s){fluid.main.fire("project.opening");$("#canvas").removeClass("loaded");n.afterOpenedCallback=s;n.openStartTime=new Date().getTime();n.uploadPreload=true;n.useLocalDb=true;fluid.command.history.reset();i.setLoadingStep(3);if($("#previewHolder").is(":visible")){preview.close()}$("#pagePreview",j.frame||document).parent().hide();c.removeAll("alert",["projectInactive","projectLimit"]);if(!n.lastProjectClosed){n.close()}if(q=="last"){q=i.get("lastOpenProject");var r=h.get(q);if(!q||!r){q=n.add("","New Project")}}i.set({lastOpenProject:q});n.lastProjectClosed=false;n.loadIfUnloaded(q,n.afterLoaded.bind(this,q),{buildModel:true,setAsMain:true});k.changeActiveTab(q)},drawThumbnail:function(u){var t=$("#profile");t.find(".projectThumb").remove();var r={id:"opened_"+u,name:n.get("name")||"New Project"};var v=$("#tmplProjectThumb").tmpl(r);v.addClass(n.get("active")===false?"inactivePrj":"activePrj");var s=n.get("preview");if(!n.get("pages")||n.get("pages").length===0){v.append('<div class="project-thumb">Project empty</div>')}else{if(s&&s.src){v.append('<img class="project-thumb" src="'+s.src+'">')}}var q=$("#tmplProjectSettingsFrame").tmpl();$(".selectedProjectName",q).text(v.attr("title"));$(q).click(fluid.util.debounce(function(){l.lastSelectedId=n.get("id");n.sync();l.goToSettingsUpdate();userSettings.open(null,$("#projectSettingsPanelSettings"))},500));q.css({opacity:0.75,display:"block"}).appendTo(v);v.addClass("selectedPrj");t.prepend(v)},adjustViewport:function(){var q=24004;var D=16004;var u=$("#viewport");var B=fluid.zoom.getPagesBounding();var C={width:q,height:q*u.height()/u.width()};if(C.height<B.maxY-B.minY+3000){C={height:B.maxY-B.minY+5000,width:u.width()*(B.maxY-B.minY+5000)/u.height()}}n.set({canvasWidth:C.width,canvasHeight:C.height});var w=B.minX+(B.maxX-B.minX)/2;var v=B.minY+(B.maxY-B.minY)/2;var s=C.width/2-w;var r=C.height/2-v;var t=n.get("pages");if(t.length){var A;for(var z=0;z<t.length;z++){A=h.get(t[z]);A.x=A.x+s;A.y=A.y+r;h.set(t[z],A)}}else{u.get(0).scrollTop=C.height/2*fluid.zoom.getFitParams().newScale*0.25;u.get(0).scrollLeft=C.width/2*fluid.zoom.getFitParams().newScale*0.25}},afterLoaded:function(q){if(h.get(i.get("id")).email.indexOf("@")===-1){$("#profile .projectThumb").remove()}else{n.drawThumbnail(q)}n.checkIntegrity(q);n.adjustViewport();$("#zoomedOutPages").get(0).innerHTML="";fluid.zoom.zoomToAllPages({instantSwitch:true,finishedCallback:function(r){n.preparePages(q)}})},preparePages:function(s){m.newLinks=true;function r(){var u=n.getPagesInViewport("init");if(u==0){n.centerOnHomepage();u=n.getPagesInViewport("init")}return u}var t=r();for(var q=0;q<t.length;q++){j.draw(t[q],"useCache")}n.onPagesPrepared(s);if(j.renderer&&j.renderer.countRemainingLoads()==0){fluid.main.fire("images.loaded")}},onPagesPrepared:function(r){n.updatePages(n.updateLinks);n.setSettingsPanelData();l.getItemById(r).addClass("open");document.title=n.get("name")+" :: Fluidui.com";$(".pageWidget").draggable("disable");$("#startMenu").delay(300).fadeIn(300);n.isInitialized=true;if(n.readOnly()){fluid.command.create("hideButton").dispatchTo("fluid.controllers.timeline");i.alertEditInactive();$("#canvasPages .pageWidget").draggable("option","disabled",true);b.setCanvasFirstPage()}else{if(n.get("pages").length>0){b.setCanvasFirstPage()}else{b.setCanvasNoPages()}}if(!n.previewRenderer){n.previewRenderer=new fluid.wdgRenderer()}n.previewRenderer.renderProjectPreview(n.bundle(r),function(t,s){n.onPreviewReady(t,s,"projectopen")});if(i.get("loggedIn")=="yes"){$("#projectName").hide().text(n.get("name")).fadeIn(1000).delay(1000).fadeOut(500)}var q=n.get("pages");if(!q||q.length==0){b.setCanvasNoPages(false)}if($.isFunction(n.afterOpenedCallback)){n.afterOpenedCallback.call(null);n.afterOpenedCallback=null}$("#zoomedOutPages").fadeIn(300);$("#canvas").addClass("loaded");$("#scaled-"+n.get("homepage")).addClass("homePage");fluid.main.fire("projectopened");fluid.main.fire("project.opened");if(_.keys(fluid.main.project.bundle().uploads).length===0){fluid.main.fire("images.loaded")}},onPreviewReady:function(w,r,u){$("#profile .projectThumb .loader-wrap").remove();var t=r.get(0).toDataURL();var q=h.get(w);if(!q||q.unloaded){return}q.preview={src:t};h.set(w,q,false);l.updateThumbnail(w);if(n.get("id")===w){var s=n.get("pages");if(!s||s.length===0){$("#profile .project-thumb").remove();$("#profile .projectThumb").prepend('<div class="project-thumb">Project empty</div>')}else{$("#profile div.project-thumb").remove();var v=$("#opened_"+w+"Thumb img.project-thumb");if(v.length){v.attr("src",t)}else{$("#profile .projectThumb").prepend('<img class="project-thumb" src="'+t+'">')}}}if(u!=="autopreviewgen"){n.renderMissingPreviews(u!=="projectopen"?w:null)}if(u==="projectopen"){setTimeout(n.initAutoPreviewGen.bind(this,w),n.autoPreviewTimeout)}},initAutoPreviewGen:function(q){if(i.get("lastOpenProject")!==q){return}n.previewRenderer.renderProjectPreview(n.bundle(i.get("lastOpenProject")),function(s,r){n.onPreviewReady(s,r,"autopreviewgen")});setTimeout(n.initAutoPreviewGen.bind(this,q),n.autoPreviewTimeout)},renderMissingPreviews:function(s){var q=$(".projectThumb div.preview").not(".empty");var r;if(q.length>0){r=l.getSelectedId(q.eq(0).parents(".projectThumb").attr("id"));n.renderPreview(r)}},renderPreview:function(q,s){if(q===fluid.main.project.id&&!fluid.main.project.modifiedSinceThumb){return}var r=s||"missingpreview";if(q===n.get("id")){$('<div class="loader-wrap"><img class="ajax-loader" src="img/ajax-loader.gif"/></div>').insertAfter("#profile .project-thumb")}n.loadIfUnloaded(q,function(){if(!n.previewRenderer){n.previewRenderer=new fluid.wdgRenderer()}n.previewRenderer.renderProjectPreview(n.bundle(q),function(u,t){n.onPreviewReady(u,t,r);if(!n.isOpen(u)){n.sync(u,function(){n.unload(u)})}})})},isOpen:function(q){if(!q){q=this.id}return q==i.get("lastOpenProject")},addWithoutLimit:function(q){n._freeSlotForProject();n.add(q,null,true)},add:function(A,q,C,B){var C=C==undefined?false:true;if((!i.canAddProjects())&&(!C)){c.removeAll("alert","projectLimit");var D;if(i.get("maxActiveProjects")<=1){D=i.alerts.projectLimitHit.onAddActive}else{D=i.alerts.projectLimitHit.onNeedHigherThanStandard}c.add("alert",D,{scope:"projectLimit",stopBuggingCallBack:n.addWithoutLimit});return false}var s;if(q==undefined){var q="";var w=h.get("projectsCount");var t=i.get("projectIds");if(!w){w=t.length+1}else{w+=1}function z(E){t.forEach(function(F){if(h.get(F).name===E){w+=1;E=z("Project "+w)}});return E}h.set("projectsCount",w);q=z("Project "+w)}var u=new Date().getTime();s=o.guid("p");var v={name:q,created:u,updated:u,canvasWidth:24004,canvasHeight:16004,canvasPosX:-2000*0.5,canvasPosY:-2000*0.5,orientation:"Portrait",pages:[],pageWH:[320,568],deviceModel:"iPhone5",lastTransition:"pop",defaultTransition:"pop",defaultGesture:"tap",links:{linkOrigin:[],linkDest:[],linkCanvId:[],linkType:[],transType:[],triggerType:[]}};if(!fluid.main.project){fluid.main.project=new fluid.models.project(v,{projectId:s});fluid.main.newProjectModel=fluid.main.project}else{fluid.main.newProjectModel=new fluid.models.project(v,{projectId:s})}fluid.main.projects.add(fluid.main.newProjectModel);i.addProjectId(s);h.set(s,v);fluid.main.newProjectModel.save(function(){if(B){B(s)}});var r=n._template(v,s);n.setNumber();l.applyFilter();n.sync(s,false);return s},addPage:function(r){var q=n.get("pages")||[];q.push(r);n.set({pages:q})},del:function(u,t){function s(){function v(){$("#fluidDropdown #"+u).draggable("destroy").fadeOut(300,function(){var A=$(this).hasClass("inactiveProject");$(this).remove();if(A){n.updateInactiveProjectList()}k.updateUploadsProjectsList()});var w=i.get("projectIds");w=fluid.util._.without(w,u);i.set({projectIds:w});var z=n.unload(u);h.remove(u);n.setNumber();l.displayFrame();l.getItemById(u).remove();l.refreshListHeader();if(t){t.call(null,z)}}fluid.api.remove(u,v,v)}var r=n.isOpen(u);if(r){n.close()}var q=h.get(u);q.removed=true;q.updated=new Date().getTime();h.set(u,q);if(n.isEmpty(u)){s()}else{n.sync(u,s)}c.removeAll("alert","projectAction");c.add("alert","Your project has been deleted.  In case you want to restore, please open the bin...",{scope:"projectAction"});fluid.controllers.bin.show()},_deleteProjectPages:function(u){var t=h.get(u);if((t)&&(t.pages!=undefined)&&!t.unloaded){for(var r=0,q=t.pages.length;r<q;r++){var s=t.pages[r];n._deletePageWidgets(s);h.remove(s)}}},rename:function(r){var s=userSettings.isOpen?l.lastSelectedId:$(r.target).closest(".project").attr("id");var q=$(r.target).val();n.setName({name:q,id:s});n.sync(s,false);if(n.isOpen(s)){document.title=n.get("name")+" :: Fluidui.com"}$(".title","#"+s).val(q);$(".selectedProjectName").text(q);l.getItemById(s).attr({"data-name":q.toLowerCase(),title:q,alt:q});fluid.main.trigger("projectNameChanged");return false},activeProjectCount:function(){var q=fluid.main.projects.filter(function(s,r,t){if(s.get("active")===false||s.get("removed")===true){return false}return true});return q.length},getLatestActiveProject:function(){var s;var r=i.get("projectIds");for(var q=r.length-1;q>=0;q--){if(h.get(r[q]).active!==false){s=r[q];break}}return s},readOnly:function(){return n.get("active")===false},storageChangeProjectHandler:function(r,q){if((!q)||(!q.timeUpdated)){return}if(/^[xwp]/.test(q.id)){if(/^p/.test(q.id)&&(q.id!=i.get("lastOpenProject"))){return}fluid.main.project.setModified(true)}},unload:function(s,q){return h.get(s);if(!q){q=h.get(s)}if(this.previewRenderer){this.previewRenderer.onProjectUnloaded(s)}if(!q.unloaded){n._deleteProjectPages(s);for(var r in q){if(q.hasOwnProperty(r)&&$.inArray(r,n.unloadedProps)==-1){delete q[r]}}q.unloaded=true;h.set(s,q)}return q},unloadOldest:function(){var z,t,s;var u=i.get("projectIds");for(var r=0,q=u.length;r<q;r++){var w=u[r];if(w!=i.get("lastOpenProject")){var v=h.get(w);if(!v.unloaded&&(!s||s>v.updated)){s=v.updated;z=w;t=v}}}if(t){n.unload(z,t)}else{throw"Could not find a project to unload"}},loadIfUnloaded:function(v,u,r){function s(){if($.isFunction(u)){u.apply(this,arguments)}}var t=h.get(v);if(t&&t.unloaded){function q(A){var D=JSON.parse(A);if(D.r==="f"){var E=h.get(v,{returnModel:true});if(E){E.set({unloaded:false})}s();return}var C=D.t;if(C.length){C=C[0].replace(/[\r\n]/g,"\\n")}else{C=C.replace(/[\r\n]/g,"\\n")}var z=JSON.parse(C);var E=fluid.main.projects.get(v);var w=fluid.main.projects.indexOf(E);z[v].unloaded=false;z[v].uniqueUploads=Object.keys(z.uploads);var B=fluid.main.project=new fluid.models.project(z,{parse:true,projectId:v});if(!r||r.setAsMain!==false){fluid.main.project=B}if(E&&E.get("active")===false){B.set({active:false})}fluid.main.projects.remove(E);fluid.main.projects.add(B,{at:w});s(B.bundle())}fluid.api.syncDown(v,false,false,q,q)}else{if(r&&r.setAsMain){fluid.main.project=fluid.main.projects.get(v);s()}else{s(n.bundle(v));return}}},resetCanvas:function(){var q=-1000,r=-1000;n.set({canvasPosY:r,canvasPosX:q});$("#viewport").get(0).scrollLeft=q;$("#viewport").get(0).scrollTop=r},centerOnHomepage:function(){var q=n.get("homepage");if(q){var w=h.get(q),t=o.getTLWH("#canvas"),s=o.getTLWH("#viewport");var r=fluid.zoom.getCurrentScale(),v=Math.max((w.x*r+(w.width*r-s.width)/2),10),u=Math.max((w.y*r+(w.height*r-s.height)/2),10);if(v+s.width-10>t.width){v=t.width-s.width-10}if(u+s.height-10>t.height){u=t.height-s.height-10}$("#viewport").get(0).scrollLeft=v;$("#viewport").get(0).scrollTop=u;n.set({canvasPosY:-u,canvasPosX:-v})}},updateOnSignup:function(){n.setNumber();n.previewRenderer.renderProjectPreview(n.bundle(i.get("lastOpenProject")),function(r,q){n.onPreviewReady(r,q,"projectopen")})},_freeSlotForProject:function(){var v=false;if(!i.canAddProjects()){var r=i.get("projectIds");for(var q in r){var u=r[q];var t=h.get(u);if(t){var s=t.active!==undefined?t.active:true;if(s){if(!n.isOpen(u)){n.dropToInactive($("#"+u));v=true;break}}}}}if(!v){n.dropToInactive($("#"+i.get("lastOpenProject")))}},getPagesInViewport:function(v){var A=[];var z=document.getElementById("viewport");var q=$.extend([],n.get("pages"));var E=fluid.zoom.getCurrentScale();var C={left:v==="init"?-n.get("canvasPosX")/E:z.scrollLeft/E,top:v==="init"?-n.get("canvasPosY")/E:z.scrollTop/E,width:window.innerWidth/E,height:window.innerHeight/E};C.right=C.left+C.width;C.bottom=C.top+C.height;var F,w,D,u,B,s;var r;for(var t=0;t<q.length;t++){r=q[t];q[t]=$.extend({},h.get(q[t]));F=q[t].x;w=q[t].x+q[t].width;D=q[t].y;u=q[t].y+q[t].height;B=q[t].width;s=q[t].height;if(v!=="strict"&&((F<=C.right)&&(C.left<=w)&&(D<=C.bottom)&&(C.top<=u))){A.push(r)}else{if(v==="strict"&&((w<=C.right)&&(C.left<=F)&&(u<=C.bottom)&&(C.top<=D))){A.push(r)}}}fluid.main.project.set({visiblePages:A});return A},getLinksInViewport:function(v){var t=n.getPagesInViewport(v);var s=fluid.main.project.links.toJSON();var u={linkCanvId:[],linkDest:[],linkOrigin:[],linkType:[],transType:[],triggerType:[]};var q;for(var r=0;r<s.linkCanvId.length;r++){q=h.get(s.linkOrigin[r],{returnModel:true});if(t.indexOf(s.linkDest[r])!==-1||(q&&t.indexOf(q.getPage().id)!==-1)){u.linkCanvId.push(s.linkCanvId[r]);u.linkDest.push(s.linkDest[r]);u.linkOrigin.push(s.linkOrigin[r]);u.linkType.push(s.linkType[r]);u.transType.push(s.transType[r]);u.triggerType.push(s.triggerType[r])}}return u},getActivePage:function(){return $("#canvasPages > .screen.active").first()},getActivePageId:function(){return n.getActivePage().attr("id")},updateThumbsActiveStatus:function(){$("#projectSettingsPanelMain .projectThumb").each(function(){var s=$(this);var q=s.attr("id");if(q.indexOf("Thumb")!==-1){q=q.substring(0,q.indexOf("Thumb"));var r=fluid.main.projects.get(q);if(r&&r.get("active")===false){s.removeClass("activePrj").addClass("inactivePrj")}else{s.removeClass("inactivePrj").addClass("activePrj")}}})},setSettingsPanelData:function(){var q=fluid.main.project.get("orientation");var r=$("#deviceSettingsMenu").find(".buttonSwitchContainer");if(r.length===0){r=$(j.menu).find("#deviceSettingsMenu .buttonSwitchContainer")}r.children().removeClass("activeOption");r.find("[data-for='"+q+"']").addClass("activeOption")},updatePages:function(z,w){var v=$(".screen");var u=n.getPagesInViewport();var s=n.get("pages");var q;var t=v.filter(function(){if(u.indexOf($(this).attr("id"))!==-1){return false}else{return true}});t=t.filter(function(A,B){if(B.getAttribute("id")!==n.getActivePageId()){return true}else{return false}});var r;w=w||fluid.zoom.getAllPagesParams().newScale;requestAnimationFrame(function(){if(s.length!==fluid.main.project.pages.length){return}for(var B=0;B<u.length;B++){r=v.filter("#"+u[B]);if(r.length===0){j.draw(u[B],"useCache")}else{if(!r.is(":visible")){r.show()}}}for(var B=0;B<s.length;B++){q=h.get(s[B]);$("#scaled-"+s[B]).css({top:q.y*w,left:q.x*w,width:q.width*w,height:q.height*w})}var A=fluid.zoom.getAllPagesParams();if(fluid.zoom.getCtx()!=="project"){$("#zoomedOutPages").css({"-webkit-transform":"scale("+$("#canvas").width()/(n.get("canvasWidth")*A.newScale)+")","-moz-transform":"scale("+$("#canvas").width()/(n.get("canvasWidth")*A.newScale)+")"});fluid.zoom.setLastTransScale($("#canvas").width()/(n.get("canvasWidth")*A.newScale))}if(z){z()}t.hide()})},updateLinks:function(r){var s=$(".link");var q=n.getLinksInViewport();var u=s.filter(function(){if(q.linkCanvId.indexOf($(this).attr("id"))!==-1){return false}else{return true}});var t;var v=fluid.zoom.getCurrentScale();requestAnimationFrame(function(){var w=n.get("links");var A=A={linkCanvId:[],linkDest:[],linkOrigin:[],linkType:[],transType:[],triggerType:[]};for(var z=0;z<q.linkCanvId.length;z++){t=s.filter("#"+q.linkCanvId[z]);if(t.length===0){A.linkCanvId.push(q.linkCanvId[z]);A.linkDest.push(q.linkDest[z]);A.linkOrigin.push(q.linkOrigin[z]);A.linkType.push(q.linkType[z]);A.transType.push(q.transType[z]);A.triggerType.push(q.triggerType[z])}}m.load(A);m.drawSome(q,v);u.hide();if(r){r()}})},lastProjectClosed:true};fluid.main.on("noprojectssynceddown",function(){n.add("","",null,function(q){n.open(q);n.setNumber()})});fluid.main.on("projects.synced",n.sort);fluid.main.on("uploads.synced",function(q,r){fluid.main.fire("projects.loading",{count:r.length});n.load();fluid.main.fire("projects.loaded")});fluid.main.on("editor.afterAccountRegister",n.updateOnSignup);fluid.main.on("afteruploadssynced",function(){var q=i.get("lastOpenProject");var r=i.get("projectIds");if(r.length>0){n.open((($.inArray(q,r)>-1&&q)||fluid.main.projects.getLatestActiveProject()||r[r.length-1]))}});a.exports=n},{"./class-account":2,"./class-fluidMenu":8,"./class-lib":12,"./class-link":13,"./class-notification":14,"./class-page":15,"./class-projectSettings":20,"./class-storage":24,"./class-wdgRenderer":27,"./fluid/fluid.command":34,"./fluid/fluid.i18n":37,"./utils":60}],20:[function(d,h,b){var j=d("./class-storage");var a=d("./class-event");var c=d("./class-panels");var i=d("./class-userSettings");var f={hasScroll:false,lastSelectedId:null,lastSettingsUpdateId:null,lastView:"Thumb",lastVersions:new Array(),mainDashTitles:{all:"All Projects",activePrj:"Active Projects",inactivePrj:"Inactive Projects",todayPrj:"Today's Projects",recentPrj:"Recent Projects"},hiddingElements:0,init:function(){$(".projectSettingsButton").live({click:_.debounce(f.open,500,true)});$("#projectSettingsFilter li").live({click:_.debounce(f.selectFilter,500,true)});$("#projectSettingsSearchBoxInput").live({focus:_.debounce(f.displayFilters,500,true),blur:_.debounce(f.displayFilters,500,true),keydown:function(k){if(k.keyCode==13){f.applyFilter()}}});$("#projectSettingsPanelMain").live({click:_.debounce(f.unselectProject,500,true)});$("#projectSettingsPanelMain .projectThumb").live({click:f.selectProject});$("#projectAdd").live({click:fluid.util.debounce(f.actionAdd,500,true)});$(".actionOpenProject").live({click:_.debounce(f.actionOpen,500,true)});$("#selectedProjectNameEdit").live({blur:_.debounce(f.actionRename,500,true)});$(".buttonSwitch","#projectSettingsSettingsTop").live({click:_.debounce(f.actionChangeStatus,500,true)});$(".dropDownStyled select").live({change:fluid.util._.debounce(function(k){if(k.target.id==="deviceModelTemplate"){f.lastSelectedId=project.get("id");f.actionChangeValue(k)}else{f.actionChangeValue(k)}},500,true)});$(".buttonSwitch","#projectSettingsValuesTop").live({click:_.debounce(f.actionChangeOrientation,500,true)});$(".projectSettingsButtonClone").live({click:_.debounce(f.actionClone,500,true)});$(".projectSettingsButtonDelete").live({click:_.debounce(f.actionDelete,500,true)});$(".projectSettingsVersionRestore").live({click:_.debounce(f.actionRestoreVersion,500,true)});$(".brandingSettingsRow").bind("change",f.onBrandingChange).bind("reset",f.onBrandingReset);$("#updateBranding").bind("click",function(k){f.onBrandingSubmit(k)});$("#brandingImageTable .chooseFile.disabled").live("click",function(k){notification.add("alert",account.alerts.projectLimitHit.onFeatureStandard,{scope:"projectLimitHit",stopBuggingCallBack:function(){}})});$(".projectOptionsButtonSettings").live({click:_.debounce(f.goToSettings,500,true)});$(".projectSettingsButtonShare, .projectSettingsButtonShared").live({click:_.debounce(f.goToShare,500,true)});$(document).on("click",".projectSettingsButtonDevice",fluid.util._.debounce(function(k){if(k.target.classList.contains("disabled")){notification.add("alert","You can only change the device type of the currently opened project.");return}f.goToValues(k)},500,true));$(".projectSettingsButtonBranding").live("click",_.debounce(f.goToBranding,500,true));$(".projectSettingsButtonVersions").live({click:_.debounce(f.goToVersions,500,true)});a.bindEditor("panelGoBack",f.goToBackEnhancer);$(window).resize(f._resizeScreen)},goToBackEnhancer:function(l,k){if(!k){return}if(k.panelId=="projectSettingsPanelMain"){f.lastSettingsUpdateId=null;setTimeout(f.autoSelectOnOpen,800,true);return}},open:function(l){var k=l?$(l.target):null;if((k)&&((k.hasClass("buttonDisabled"))||(k.parent().hasClass("buttonDisabled")))){return}f.unselectProject();f.refreshListHeader();i.open(null,$("#projectSettingsPanelMain"));f.adjustMainPanelSize();$("#projectSettingsFilter").hide();fluid.controllers.bin.showNonEmpty();setTimeout(f.autoSelectOnOpen,800)},autoSelectOnOpen:function(l){var k=l?f.lastSelectedId:account.get("lastOpenProject");f.actionSelectProject(f.getItemById(k))},close:function(){f.lastSelectedId=null;f.lastSettingsUpdateId=null;f.lastVersions=new Array();i.close(null,false)},adjustMainPanelSize:function(){var n=$("#projectSettingsPanelMain .projectThumb").not(".hidden").size();var k=3;var o=Math.ceil(n/k);var m=(o*180)-20;var l=$(window).height()-210;l=m<l?m:l;l=l>570?570:l;$("#projectSettingsMainTop").css({height:l+"px"});if(l<m){f.hasScroll=true;c.adjustScroll($("#projectSettingsMainTop"));$("#projectSettingsMainTop").removeClass("no-scroll");$(".scrollbar","#projectSettingsMainTop").fadeIn(300)}else{f.hasScroll=false;$("#projectSettingsMainTop").addClass("no-scroll").tinyscrollbar().tinyscrollbar_update();$(".scrollbar","#projectSettingsMainTop").hide()}},adjustVersionsPanelSize:function(){var m=$(".projectVersionItem").size();var l=(m*60);var k=$(window).height()-220;k=l<k?l:k;$("#projectSettingsVersionsTop").css({height:k+"px"})},selectProject:function(m){var n=$("#projectSettingsPanelMain .projectOptionsFrame");var l=$(m.target);l=l.hasClass("projectThumb")?l:l.parents(".projectThumb");var k=l.attr("id");if((n.is(":visible"))&&((k==n.parent().attr("id"))||(l.hasClass("projectOptionsFrame"))||(l.parents(".projectOptionsFrame").size()>0))){f.actionOpen(m);return false}f.actionSelectProject(l);m.stopPropagation()},actionSelectProject:function(k){if(k==undefined){f.unselectProject();return}if(f.hasScroll){f._scrollToSelected(k)}f.displayFrame(k)},unselectProject:function(k){if(k!=undefined){if($(k.target).hasClass("projectThumb")){k.stopPropagation();return false}if(($(k.target).hasClass("projectSettingsSearchBox"))||($(k.target).parents(".projectSettingsSearchBox").size()>0)){return true}}f.displayFrame()},displayFrame:function(m){var l=true;if((m==undefined)||(m.hasClass("projectPlaceholder")||m.parent().hasClass("projectPlaceholder"))){l=false}$(".projectThumb").removeClass("selectedPrj");$("#projectSettingsPanelMain .projectOptionsFrame").hide().remove();if(l){var k=$("#tmplProjectSettingsFrame").tmpl();$(".selectedProjectName",k).text(m.attr("title"));k.css({opacity:0.75}).appendTo(m);k.fadeIn(250);f.lastSelectedId=f.getSelectedId(m.attr("id"));m.addClass("selectedPrj")}else{var n=$("#projectSettingsPanelSettings").is(":visible");if(!n||f.lastSelectedId!=f.lastSettingsUpdateId){f.lastSelectedId=null}}},displayFilters:function(l){function k(){f.applyFilter();$("#projectSettingsFilter").hide()}if(!$("#projectSettingsFilter").is(":visible")){$("#projectSettingsFilter").fadeIn(250);return}setTimeout(k,200)},resetFilter:function(){$("#projectSettingsFilter li").removeClass("activeMenuOption");$("#projectSettingsSearchBoxInput").val("");f.applyFilter()},selectFilter:function(n){var m=$(n.target);var k=m.hasClass("activeMenuOption");var l=m.attr("data-filter")==undefined?"data-sort":"data-filter";if(k){m.removeClass("activeMenuOption")}else{$("#projectSettingsFilter li["+l+"]").removeClass("activeMenuOption");m.addClass("activeMenuOption")}if(l=="data-filter"){f.applyFilter()}else{f.applySort()}n.stopPropagation();return false},applyFilter:function(){if(f.hiddingElements>0){return}var p=$("#projectSettingsFilter li[data-filter].activeMenuOption");var n=p.size()==0?"all":p.attr("data-filter");var l=$.trim($("#projectSettingsSearchBoxInput").val().toLowerCase());var o=$(".projectThumb","#projectSettingsMainContent").not(".projectPlaceholder");var k=o;if(l!=""){k=o.filter("[data-name*='"+l.toLowerCase()+"']")}if((n=="todayPrj")||(n=="recentPrj")){f._refreshFilterAttributes()}if(n!="all"){k=k.filter("."+n)}var m=o.not(k);k.removeClass("hidden");m.each(f._hideProjectFromList);if(m.size()==0){f.postApplyFilter()}},postApplyFilter:function(){f.refreshListHeader();if($(".projectOptionsFrame").parent().hasClass("hidden")){f.unselectProject()}f.adjustMainPanelSize()},applySort:function(){var n=$("#projectSettingsFilter li[data-sort].activeMenuOption");var l=n.size()==0?"":n.attr("data-sort");var k=n.size()==0?"":n.attr("data-order");if(l!=""){var m=$(".projectThumb","#projectSettingsMainContent");if(k=="desc"){$("#projectSettingsMainContent").append(m.sort(function(p,o){return(p=$(p).attr("data-"+l),o=$(o).attr("data-"+l),p==undefined||p==""?-1:p==o?0:p>o?1:-1)}))}else{$("#projectSettingsMainContent").append(m.sort(function(p,o){return(p=$(p).attr("data-"+l),o=$(o).attr("data-"+l),p==undefined||p==""?-1:p==o?0:p<o?1:-1)}))}c.adjustScroll($("#projectSettingsMainTop"))}},_refreshFilterAttributes:function(){var m=$(".projectThumb","#projectSettingsMainContent").not(".projectPlaceholder");var k=moment().format("YYYY/MM/DD");var l=moment().subtract("days",project.recentProjectDays).format("YYYY/MM/DD");m.each(function(q,s){var u=f.getSelectedId($(s).attr("id"));var r=j.get(u);var t=moment(r.updated).format("YYYY/MM/DD HH:mm:ss");var n=t.split(" ")[0];var p=k==n;var o=n>l;$(s).attr("data-updated",t);if(p){$(s).addClass("todayPrj")}else{$(s).removeClass("todayPrj")}if(o){$(s).addClass("recentPrj")}else{$(s).removeClass("recentPrj")}})},actionDelete:function(k){if(!f.lastSelectedId){f.lastSelectedId=$("#selectedProjectNameEdit").attr("data-id")}fluid.command.create("drop",{id:f.lastSelectedId}).dispatchTo("fluid.controllers.bin");$("#"+f.lastSelectedId+"Thumb").remove();setTimeout(function(){f.open();setTimeout(function(){i._fixCloseButton(false)},500)},500)},actionAdd:function(l){var k=project.add(l);if(k){var m=f.getItemById(k);f.displayFrame(m);tracker.record("addProject",1,"",l);fluid.main.trigger("projectCreated")}return k},actionOpen:function(k){var l=f.lastSelectedId;if(f.lastSelectedId===project.get("id")&&!((l)&&(l!="")&&f.openingId!==l)){f.close()}if($(".actionOpenProject").hasClass("disabled")){return false}if((l)&&(l!="")&&f.openingId!==l){f.openingId=l;fluid.command.create("open",{id:l,onLoad:function(){account.afterLoading();tracker.record("openProject",10,l,k);f.close();f.openingId=null}}).dispatchTo("fluid.controllers.project")}},actionRename:function(k){project.rename(k);f.applyFilter();f.applySort()},actionActivateForced:function(){var k=$("#"+f.lastSelectedId);project.dropToActive(k,true)},actionChangeStatus:function(m){var l=$(m.target);if(l.hasClass("activeOption")){return false}function k(){var n=l.hasClass("switchOn")?true:false;var p=false;var o=$("#"+f.lastSelectedId);if(n){p=project.dropToActive(f.lastSelectedId);if(fluid.zoom.getCtx()!=="project"){$("#library").show()}else{$("#library").hide()}}else{if($("#tabLibrary").hasClass("open")){if(fluid.zoom.getCtx()!=="project"){$("#library").show()}else{$("#library").hide()}}p=project.dropToInactive(f.lastSelectedId)}if(!p){return false}f.displayStatus(n)}setTimeout(k,100)},actionTransferCallback:function(l,k){if(l&&l[0]==="{"){l=JSON.parse(l);if(l.r==="f"){k=l.t}}share.mailClear(k,l)},actionChangeValue:function(v){var p=$(v.target);var u=p.attr("data-for");if((u=="deviceModel")&&(f.isLastSelectedOpen())){var s=$(v.target);var q=s.find("option:selected").data("type"),o=project.get("deviceModel"),B=j.get(project.getLatestActiveProject()),C={};hasOldBranding=false,hasNewBranding=false;C.newDevice=q;C.oldDevice=o;for(var m in B){hasOldBranding=hasOldBranding||(m.indexOf(o)!==-1&&/Branding$/.test(m)&&B[m]);hasNewBranding=hasNewBranding||(m.indexOf(q)!==-1&&/Branding$/.test(m)&&B[m]);if(hasOldBranding&&hasNewBranding){break}}if(hasOldBranding&&!hasNewBranding){notification.add("alert",'You may need to update your <span class="inlineLink projectSettingsButtonBranding close"> branding graphics</span>')}var l=s.find("option:selected").val().split(",");if(C.newDevice==="Custom"){var A=$(".customDeviceSize.width input").val()|0,t=$(".customDeviceSize.height input").val()|0,r=$(".customDeviceSize.width input").attr("min"),D=$(".customDeviceSize.height input").attr("min");l[0]=A<r?r:A;l[1]=t<D?D:t;$(".customDeviceSize").show()}else{$(".customDeviceSize").hide()}l[0]=l[0]|0;l[1]=l[1]|0;C.newSize=l;C.oldSize=project.get("pageWH");fluid.command.create("settingDevice",C).dispatchTo("fluid.controllers.page");f._fixOrientationAfterDeviceChange(project.get("orientation"))}else{if(u=="deviceModel"){var n=p.children(":selected").attr("data-type");var k=p.val().split(",");var B=f.getLastSelectedObject();k=B.orientation=="Portrait"?k:k.reverse();f.actionChangeValueData(v,u,n,false);f.actionChangeValueData(v,"pageWH",k)}else{f.actionChangeValueData(v,u,p.val())}}if(u=="deviceModel"){var n=p.children(":selected").attr("data-type");var z=f.getDeviceLabel(n);$(".projectSettingsButtonDevice").text("Device Settings ("+z+")")}page.updateSettingsMenu()},actionChangeOrientation:function(n){var l=$(n.target);if(l.hasClass("activeOption")){return false}var k=l.attr("data-for");var m=f.getLastSelectedObject();if(f.isLastSelectedOpen()){f.actionChangeValueData(n,"orientation",k);project.updatePages();project.updateLinks()}else{f.actionChangeValueData(n,"orientation",k,false);f.actionChangeValueData(n,"pageWH",[m.pageWH[1],m.pageWH[0]])}l.siblings().removeClass("activeOption");l.addClass("activeOption");var o=$(".screen.active");if(o.length){staticWidgets.showStaticBoundary(o.attr("id"))}fluid.main.fire("project.orientantionchanged");page.detachFrame();page.attachFrameTo($(".screen.active").get(0))},actionChangeValueData:function(q,p,l,r){if(f.isLastSelectedOpen()){if(p=="orientation"){project.orient(q)}else{var n={};n[p]=l;project.set(n)}}else{var t=f.getLastSelectedObject();if((p=="pageWH")||(p=="orientation")){var m=t.pages;for(var o in m){if(p=="pageWH"){page.update({width:l[0],height:l[1]},m[o])}else{page.update({orientation:l},m[o])}}}t[p]=l;project.updated=new Date().getTime();j.set(f.lastSelectedId,t);t.isModified=true}var k=r==undefined?true:r;if(k){if((p=="deviceModel")||(p=="orientation")||(p=="pageWH")){var s=f.isLastSelectedOpen()?"autopreviewgen":"missingpreview";project.renderPreview(f.lastSelectedId,s);setTimeout(f.updateThumbnailMedium,3000)}else{project.sync(f.lastSelectedId)}}},actionClone:function(){if(c.isLastButtonDisabled()){return}var k=parseInt(fluid.main.account.get("maxActiveProjects"),10);var m=fluid.main.projects.filter(function(n){if(n.get("removed")){return false}else{return true}}).length;if(k!==0&&m>=k){notification.add("alert",account.alerts.projectLimitHit.onAddActive,{scope:"projectLimitHit",stopBuggingCallBack:function(){}});return}$(".actionOpenProject").addClass("disabled");c.hideErrors();c.lastSubmitButton=$(".projectSettingsButtonClone");c.enableLastButton(false,"projectClone");var l=project.bundle(f.lastSelectedId);fluid.api.projectSync(f.lastSelectedId,l,function(){fluid.api.projectDuplicate(f.lastSelectedId,f.actionCloneCallback,f.actionCloneCallback)},function(){notification.add("alert","Could not save your project to the server. Please check your connection.")});return false},actionCloneCallback:function(m,v){var s=function(){var A=new Date();q.created=q.updated=A.getTime();q.active=account.canAddProjects();account.addProjectId(n);j.set(n,q,false);account.set({lastOpenProject:n});project._template(q,n);project.setNumber();var B=f.getItemById(n);f.displayFrame(B);var C=moment().format("MMMM Do YYYY");$("#selectedProjectNameEdit").val("Copy of "+$("#selectedProjectNameEdit").val());$(".projectSettingsLastUpdateDate").text("Modified on "+C);$(".projectSettingsCreationDate").text("Created on "+C);f.displayStatus(q.active);if(q.active){$(".projectSettingsButtonVersions").text("Version History");f.actionLoadVersions()}if(q.active){c.setSuccessMessage("projectClone",$(".projectSettingsButtonClone"))}else{c.setSuccessMessage("projectClone",$("#selectedProjectNameEdit"))}function w(E){var F=JSON.parse(E).t;var D=JSON.parse(F);for(var G in D){if((G!="uploads")&&(G!=n)){if(D.hasOwnProperty(G)){j.set(G,D[G])}}}}fluid.api.syncDown(n,false,false,w,w);function z(){c.enableLastButton();$("#selectedProjectNameEdit").focus();$(".actionOpenProject").removeClass("disabled");fluid.main.trigger("projectCloned")}setTimeout(z,600)};var l=f._callbackSanitize(m,v,"defaultShort");if(l!=null){var r=new fluid.models.project(l.projectData,{parse:true,projectId:l.newProjectId});fluid.main.projects.add(r,{silent:true});var k=new Date().getTime();r.set({created:k,updated:k,active:account.canAddProjects()});var q=r.toJSON();var n=l.newProjectId;var u=JSON.parse(l.projectData);q=u[n];var t=u.uploads;var o=Object.keys(t).length;var p=0;if(t&&o){$.each(t,function(w){currentUpload=j.get(w);if(currentUpload.groups){if($.inArray(q.id,currentUpload.groups)===-1){currentUpload.groups.push(q.id)}}else{currentUpload.groups=[q.id]}j.set(w,currentUpload);p+=1;if(p===o){s()}})}else{s()}}return false},actionLoadVersions:function(){fluid.api.projectVersionList(f.lastSelectedId,f.actionLoadVersionsCallback,f.actionLoadVersionsCallback)},actionLoadVersionsCallback:function(m,l){var n=f._callbackSanitize(m,l);if(n!=null){f.lastVersions=n.versions;var k=n.versions.length-1;if(k<=0){k="No Older Versions Available"}else{k+=k==1?" Older Version":" Older Versions"}$(".projectSettingsButtonVersions").text(k)}},actionRestoreVersion:function(m){var l=$(m.target);var n=l.parents(".projectVersionItem");var k=n.attr("id");c.lastSubmitButton=l;fluid.api.projectVersionRestore(f.lastSelectedId,k,true,f.actionRestoreVersionCallback.bind(this,k),f.actionRestoreVersionCallback.bind(this,k))},actionRestoreVersionCallback:function(m,n,q){var k=f._callbackSanitize(n,q,"defaultShort");if(k!=null){var l=project.isOpen(f.lastSelectedId);if(l){project.close()}var o=JSON.parse(k.projectData);var p=fluid.main.projects.get(f.lastSelectedId);var s=fluid.main.projects.indexOf(p);o[f.lastSelectedId].unloaded=false;var r=new fluid.models.project(o,{parse:true,projectId:f.lastSelectedId});fluid.main.projects.remove(p);fluid.main.projects.add(r,{at:s});if(l){fluid.main.project=r;fluid.command.create("open",{id:f.lastSelectedId}).dispatchTo("fluid.controllers.project")}else{f.updateThumbnail(f.lastSelectedId);f.goToSettingsUpdate()}project.set({restoredFromDate:m});i.goBack(null,"projectRestore",$(".projectSettingsButtonVersions"))}},goToSettings:function(m,n,l){if(project.isOpen(f.lastSelectedId)){project.sync();f.goToSettingsUpdate()}else{project.loadIfUnloaded(f.lastSelectedId,f.goToSettingsUpdate,{buildModel:true})}function k(){c.setSuccessMessage(n,l)}i._panelDisplay($("#projectSettingsPanelSettings"),true,k,true);if(m!=undefined){m.stopPropagation()}return false},goToSettingsUpdate:function(){var m=f.getLastSelectedObject(),n=m.active==undefined?true:m.active,l=f.getDeviceLabel(m.deviceModel||"iPhone"),k=project.isOpen(m.id);f.lastSettingsUpdateId=m.id;$("#selectedProjectNameEdit").val(m.name).attr("data-id",m.id);$(".selectedProjectName").not("#profile .selectedProjectName").text(m.name);$(".projectSettingsLastUpdateDate").text("Modified on "+moment(m.updated).format("MMMM Do YYYY"));$(".projectSettingsCreationDate").text("Created on "+moment(m.created).format("MMMM Do YYYY"));$(".projectSettingsButtonDevice").text("Device Settings ("+l+")")[k?"removeClass":"addClass"]("disabled");f.displayStatus(n);f.updateThumbnailMedium();if(n){$(".projectSettingsButtonVersions").text("Version History");f.actionLoadVersions()}},goToShare:function(){fluid.main.trigger("projectSharingOpened");if($("#projectSettingsShareTop").children().size()==0){var k=$("#previewShareContainer").html();k=k.replace(/accordionPreviewSharing/g,"accordionProjectSharing");$("#projectSettingsShareTop").html(k)}share.init(f.lastSelectedId);i._panelDisplay($("#projectSettingsPanelShare"),true,null,true)},goToTransfer:function(){$(".projectSettingsTransferRecipients").val("");$(".projectSettingsTransferRemoveLocalInput").removeAttr("checked");if(f.isLastSelectedOpen()){$("#projectSettingsTransferRemoveLocalArea").hide()}else{$("#projectSettingsTransferRemoveLocalArea").show()}i._panelDisplay($("#projectSettingsPanelTransfer"),true,null,true)},goToBranding:function(){var o=document.getElementById("brandingImageTable"),p=branding.deviceScreen().screen,n=f.getLastSelectedObject(),k=n.deviceModel||"iPhone",l="tr.brandingSettingsRow[data-key=splash]";switch(k){case"iPhone":var m=o.querySelector(".brandingSettingsRow[data-key=splash] p[data-recommended]");m.setAttribute("data-recommended",branding.screens.iPhone4.splash.replace("x"," \u00D7 "));l="tr.brandingSettingsRow:not([data-key=splash]):not([data-key=icon])";break;case"iPhone5":var m=o.querySelector(".brandingSettingsRow[data-key=splash] p[data-recommended]");m.setAttribute("data-recommended",branding.screens.iPhone5.splash.replace("x"," \u00D7 "));l="tr.brandingSettingsRow:not([data-key=splash]):not([data-key=icon])";break;case"iPad":o.querySelector(".brandingSettingsRow[data-key=splashP] p[data-recommended]").setAttribute("data-recommended",branding.screens.iPadRetina.splashP.replace("x"," \u00D7 "));o.querySelector(".brandingSettingsRow[data-key=splashL] p[data-recommended]").setAttribute("data-recommended",branding.screens.iPadRetina.splashL.replace("x"," \u00D7 "));break;default:o.querySelector(".brandingSettingsRow[data-key=splashP] p[data-recommended]").setAttribute("data-recommended",n.pageWH[0]+"\u00D7"+n.pageWH[1]);o.querySelector(".brandingSettingsRow[data-key=splashL] p[data-recommended]").setAttribute("data-recommended",n.pageWH[0]+"\u00D7"+n.pageWH[1]);break}if(branding.screens[k]){o.querySelector(".brandingSettingsRow[data-key=icon] p[data-recommended]").setAttribute("data-recommended",branding.screens[k].icon+" \u00D7 "+branding.screens[k].icon)}else{o.querySelector(".brandingSettingsRow[data-key=icon] p[data-recommended]").setAttribute("data-recommended",branding.screens.iPhone5.icon+" \u00D7 "+branding.screens.iPhone5.icon)}_.each(o.querySelectorAll("tr.brandingSettingsRow"),function(r,q,s){r.style.display=""});_.each(o.querySelectorAll(l),function(r,q,s){r.style.display="none"});f.brandingUpdatePreview();branding.resetChange();i._panelDisplay($("#projectSettingsPanelBranding"),true,f.afterBrandingPanelShow,true)},afterBrandingPanelShow:function(){fluid.main.fire("branding.panelShow")},brandingUpdatePreview:function(){var o=document.getElementById("brandingImageTable"),q=o.querySelectorAll("tr.brandingSettingsRow"),l=o.getElementsByTagName("form");_.forEach(l,function(r){r.reset()});for(var n=0,k=q.length;n<k;n++){var m=q[n].getAttribute("data-key"),p;if(!/icon|splashiPhone/.test(m)){m+=f.getLastSelectedObject().deviceModel}p=branding.getUrl(m);if(p){q[n].getElementsByClassName("brandingPreview")[0].src=p;q[n].classList.add("set")}else{q[n].getElementsByClassName("brandingPreview")[0].src=q[n].getAttribute("data-default");q[n].classList.remove("set")}}},previewBrandingImage:function(k,n,m){var l=k.getAttribute("changeTime");if(l&&l>m){return}k.setAttribute("changeTime",m);k.src=n},onBrandingChange:function(n){var l=this.querySelector("img.brandingPreview"),m=this.getAttribute("data-key"),k=f.getLastSelectedObject().deviceModel;if(!/icon|splashiPhone/.test(m)){m+=k}if(n.target.files.length){var o=n.target.files[0];this.classList.add("set");branding.changeImage(m,o,function(p){f.previewBrandingImage(l,p,n.timeStamp)},function(p){f.onBrandingReset.call(this,p)})}else{f.onBrandingReset.call(this,n)}},onBrandingReset:function(m){var k=this.querySelector("img.brandingPreview"),l=this.getAttribute("data-key");if(l!=="icon"){l+=f.getLastSelectedObject().deviceModel}k.src=this.getAttribute("data-default");branding.resetChange(l);if(branding.get(l)){branding.changeImage(l,null)}this.classList.remove("set")},onBrandingSubmit:function(k){branding.update();i.goBack(k,"projectBranding",$(".projectSettingsButtonBranding"))},goToValues:function(k){if(k===undefined){k=true}project.loadIfUnloaded(f.lastSelectedId,function(){if($(".projectSettingsDevice").children().size()==0){$(".projectSettingsDevice").html($("#DeviceSizeTmpl",page.menu).html());$(".projectSettingsGesture").html($(".linkTriggerSelector").html());$(".projectSettingsTransition").html($(".transitionSelector").html())}var o=f.getLastSelectedObject(),n=o.deviceModel||"iPhone",l=o.orientation||"Portrait",r=o.defaultGesture||"tap",m=o.defaultTransition||"slide";var q=$(".projectSettingsDevice").children().filter("[data-type=Custom]");var p=$(".customDeviceSize");q.val(o.pageWH.join(","));q.text("Custom Display Size ("+o.pageWH.join("x")+")");if(n==="Custom"){p.show()}else{p.hide()}$(".projectSettingsDevice").children().filter("[data-type='"+n+"']").attr("selected",true);$(".projectSettingsGesture").children().filter("[value='"+r+"']").attr("selected",true);$(".projectSettingsTransition").children().filter("[value='"+m+"']").attr("selected",true);f._fixOrientationAfterDeviceChange(l);i._panelDisplay($("#projectSettingsPanelValues"),true,null,k)})},_fixOrientationAfterDeviceChange:function(k){var l=$(".projectSettingsOrientation").children();l.removeClass("activeOption");l.filter("[data-for='"+k+"']").addClass("activeOption")},goToVersions:function(){var l=f.lastVersions.length-1;if(l<=0){return}var k=$("#projectSettingsVersionsContent");k.children().remove();var n=j.get(project.get("id")).restoredFromDate;var q=false;for(var o=1;o<=l;o++){var p=f.lastVersions[o];p.updated=p.updated||Math.round(new Date().getTime()/1000);p.name=p.name||"Restored Project";p.dateUpdate=moment(p.updated).format("YYYY/MM/DD HH:mm:ss");p.sizeKb=(p.size/1024).toFixed(2);var m=$("#tmplProjectVersion").tmpl(p);if(n===p.date||(o===1&&!n)){m.addClass("activeVersion");q=true}m.appendTo(k)}if(!q){k.find(".projectVersionItem").eq(0).addClass("activeVersion")}$(".projectVersionsCount").text(l);f.adjustVersionsPanelSize();i._panelDisplay($("#projectSettingsPanelVersions"),true,null,true)},refreshListHeader:function(){var q=$("#projectSettingsFilter li[data-filter].activeMenuOption");var o=q.size()==0?"all":q.attr("data-filter");var n=$(".projectThumb","#projectSettingsMainContent").not(".projectPlaceholder ");var l=n.not(".hidden");var m=n.size()==l.size()?n.size():l.size()+" of "+n.size();$(".projectsListFilterAmount").text("("+m+")");$(".projectsListFilterLabel").text(f.mainDashTitles[o]);if(l.size()<3){$("li[data-sort], .separator","#projectSettingsFilter").hide()}else{$("li[data-sort], .separator","#projectSettingsFilter").show()}var p=$("#projectSettingsFilter li.activeMenuOption").size()==0?false:true;var k=$.trim($("#projectSettingsSearchBoxInput").val().toLowerCase());p=p||k!="";if(p){$("#projectSettingsSearchBoxInput").addClass("usingFilter")}else{$("#projectSettingsSearchBoxInput").removeClass("usingFilter")}},navigateWithKeys:function(q){if(f.lastSelectedId==null){f.actionSelectProject($(".projectThumb").not(".hidden").eq(1));return}var m=$(".projectThumb").not(".hidden").size();if(m<3){return}var p=utils.getNavigationKeyDirection(q.keyCode);if(p==""){if((q.keyCode==13)&&(q.target.tagName!="INPUT")&&($("#projectSettingsPanelMain").is(":visible"))){f.actionOpen()}return}var o=f.getLastSelectedItem();var k=3;var l=1;var r=true;if((p=="top")||(p=="bottom")){l=k}if((p=="top")||(p=="left")){r=false}var n=f._findItemToNavigate(o,l,r);f.actionSelectProject(n)},_findItemToNavigate:function(m,k,n){if(k==0){return m}if(n){var l=m.nextAll().not(".hidden");m=l.size()>0?l.eq(0):$(".projectThumb").not(".hidden").eq(1);k=l.size()>0?k-1:0}else{var l=m.prevAll().not(".hidden");m=l.size()>1?l.eq(0):$(".projectThumb").not(".hidden").last();k=l.size()>1>0?k-1:0}return f._findItemToNavigate(m,k,n)},displayStatus:function(l){$(".buttonSwitch","#projectSettingsSettingsTop").removeClass("activeOption");var m=l?"projectSettingsButtonActive":"projectSettingsButtonInactive";$("."+m).addClass("activeOption");var k=$("#projectSettingsPanelSettings");var n=$(".buttonForActive",k);if(l){$(".projectThumbMedium, .projectThumbButtonOpen",k).add("#fluidDropdown .projectThumb").removeClass("inactivePrj");n.show()}else{$(".projectThumbMedium, .projectThumbButtonOpen",k).add("#fluidDropdown .projectThumb").addClass("inactivePrj");n.hide()}},_resizeScreen:function(){if(!i.isOpen){return}if($("#projectSettingsPanelMain").is(":visible")){setTimeout(f.adjustMainPanelSize,600);return}else{if($("#projectSettingsPanelVersions").is(":visible")){setTimeout(f.adjustVersionsPanelSize,600);return}}},getSelectedId:function(k){if(k==undefined){return undefined}return k.replace(f.lastView,"")},getItemById:function(k){if(k==null){return undefined}return $("#"+k+f.lastView)},getLastSelectedItem:function(){return $("#"+f.lastSelectedId+f.lastView)},getObjectById:function(k){return j.get(k)},getLastSelectedObject:function(){return f.getObjectById(f.lastSelectedId)},isLastSelectedOpen:function(){if(f.lastSelectedId==null){return false}return project.isOpen(f.lastSelectedId)},getDeviceLabel:function(m){var l=$("#DeviceSizeTmpl",page.menu).children();var n=l.filter("[data-type='"+m+"']").text();var k=n.replace(/\(([^\)]+)\)/,"").trim();return k},_hideProjectFromList:function(k,l){f.hiddingElements++;var m=$(l);m.transition({width:0,height:0,"margin-left":100,"margin-top":80,opacity:0,"margin-right":0,complete:function(){m.addClass("hidden");m.removeAttr("style");f.hiddingElements=f.hiddingElements-1;if(f.hiddingElements<=0){f.postApplyFilter()}}},350)},_callbackSanitize:function(n,l,k){if(n==null){if(l!=""){c.displayError(l);return null}c.displayError();return null}try{var o=JSON.parse(n)}catch(m){return null}if(o.t===true||o.t==="true"){return o}else{var p=k==undefined?o.t:k;c.displayError(p)}return null},updateThumbnail:function(m){var k=f.getObjectById(m);var l=f.getItemById(m);f._updateThumbnail(l,k)},updateThumbnailMedium:function(){var k=f.getObjectById(f.lastSelectedId);var l=$(".projectThumbMedium");f._updateThumbnail(l,k)},_updateThumbnail:function(m,k,l){m.find(".preview").remove();if((!k.unloaded&&k.pages&&k.pages.length===0)){m.append($('<div class="preview empty">Project empty</div>'))}else{if(l||(k.preview&&k.preview.src)){var n=l!=undefined&&l!=null?l:k.preview.src;m.append($('<img class="preview" src="'+n+'">'))}else{m.append($('<div class="preview">Preview not available</div>'))}}},_scrollToSelected:function(m){var l=$("#projectSettingsPanelMain .projectThumb").not(".hidden");var t=l.size();if((m==undefined)||(m==null)||(t<4)||m.length===0){return}var B=l.eq(3).position().top;var n=$("#projectSettingsMainTop").height();var q=3;var s=parseInt($("#projectSettingsMainContent").css("top"),10);var w=30;var C=parseInt(t/q,10);C=C*3==t?C:C+1;var k=n/B;var r=B*(C-k)-10;var p=B*2>n?0:B;var A=Math.abs(s);var v=m.position().top-p;v=v>0?v:0;v=v<r?v:r;if(v!=A){var z=v-A;for(var o=1;o<=w;o++){var u=A+(z/w)*o;setTimeout(f._scrollStepToSelected,o*11,u)}}},_scrollStepToSelected:function(k){$("#projectSettingsMainTop").tinyscrollbar_update(k)}};h.exports=f},{"./class-event":7,"./class-panels":16,"./class-storage":24,"./class-userSettings":26}],21:[function(c,d,b){var a={init:function(){$("#tmplColorWheel").tmpl().appendTo($("#flatEditorView"));a.masterElements=$(".masterElementsHidable");a.hidablePropertyInspector=$(".piHidable");a.shapeProps=$(".shapeProps");a.textProps=$(".textProps");a.backgroundBorderHolder=$("#backgroundBorder");a.backgroundContainers=$("#captionBackground,#shapeBackground");a.borderContainers=$("#captionBorder,#shapeBorder");a.borderContainers.css({"pointer-events":"auto",opacity:1});a.shapeBorderControl=$("#shapeBorderControl");a.increaseBorderSize=$("#shapeBorderControl .increaseNumber").filter(".shapeBorderBtn");a.increaseRadiusSize=$("#shapeBorderControl .increaseNumber").filter(".shapeRadiusBtn");a.shapeSizeProperties=$("#shapeSizeProperties");a.shapeOpacityControl=$("#shapeOpacityControl");a.heightProps=$("#widgetHeight");a.heightProps.css({"pointer-events":"auto",opacity:1});a.widthProps=$("#widgetWidth");a.widthProps.css({"pointer-events":"auto",opacity:1});a.widgetBorderRadius=$("#widgetBorderRadius");a.widgetBorderRadius.css({"pointer-events":"auto",opacity:1});a.flatColorView=$(".flatColorView");a.gradientGallery=$(".gradientGallery");a.colorStopEditor=$(".colorStopEditor");a.advancedGradientEditor=$(".advancedGradientEditor");a.textColorPicker=$(".textColorPicker");a.borderColor=$(".borderColor");a.defaultColorFill="-linear-gradient(45deg, transparent,transparent 44%,#f00 45%,#f00 55%,transparent 56%,transparent)";a.defaultColor="background:-webkit"+a.defaultColorFill+";background:-moz"+a.defaultColorFill+";";$(".piClickable").click(a.toggle);a.initGradientGallery();a.pickerWidth=parseInt($("#rgbSelector").css("width"));a.pickerRadius=parseInt($("#rainbowColorPicker").css("width"))/2;a.rainbowColorDivPosition=$("#rainbowColorPicker").position();$("#rgbSelector").draggable({start:colorPicker.dragStart,drag:colorPicker.rgbDrag,stop:colorPicker.rgbDragStop});$("#hslSelector").draggable({start:colorPicker.dragStart,drag:colorPicker.hslDrag,stop:colorPicker.hslDragStop});$("#rgbSelector, #hslSelector").click(colorPicker.clickOnSelectorEdge);$("#colorHexValue").on("input",colorPicker.inputHex);$("#rgbArea").click(colorPicker.rgbClick);$("#hslArea").click(colorPicker.hslClick);$("#cPickerOptions").click(colorPicker.applyToWidget);$("#gradientTypeSelector").change(colorPicker.applyToWidget);$("#addColorStop").click(colorPicker.addColorStops);$("#gradientStop").click(a.gradientStopClick);$("#bgColorDisplay, #bgColorOriginal").click(colorPicker.sortApplyColors);$(".gradientStopSlider").live("change",colorPicker.changeColorStopSlider);$(".gradientStopSlider").live("mouseup",colorPicker.changeColorStopSlider);fluid.main.on("closeallpopoups",a.resetPropInspector)},colorStopNumber:false,gradientStopClick:function(j){var k=$(j.originalEvent.target);var i=k.parent(".colorStopOption");if(k.hasClass("colorStopButton")){a.colorStopNumber=k.attr("data-colorStop");var f="colorStopButton";a.toggle(null,f)}else{if(k.hasClass("colorStopDelete")){var h=$("#gradientStop .colorStopOption").index();if(h>0){colorPicker.removeColorStop(null,i)}}}},initGradientGallery:function(){var h=$([]);var m=["(rgba 0,0,0,0.0),(rgba 0,0,0,0.0))","radial-gradient(circle, #e6e6e6,#fafafa)","linear-gradient(#FBFBFB,#B9B9B9)","radial-gradient(circle, #F0F0F9,#A8A8B1)","linear-gradient(rgb(221,221,223),rgb(221,221,223) 15%,rgb(206,207,209) 49%,rgb(184,186,188) 50%,rgb(188,190,193))","radial-gradient(circle, #ABABAB,#7B7B7B)","linear-gradient(#A4A4A4,#848484)","linear-gradient(rgb(85,89,96),rgb(38,44,53) 49%,rgb(20,29,38) 50%,rgb(39,45,55))","linear-gradient(rgb(217,130,136),rgb(207,86,96) 49%,rgb(188,19,32) 50%,rgb(188,19,32))","linear-gradient(left, #B03247,#CB3157)","linear-gradient(left, #C55746,#E45D40)","linear-gradient(-45deg, #EF7165,#E94C3D,#E31E27)","linear-gradient(-45deg, #F9A665,#F68C3E,#F26D20)","linear-gradient(#E4D0A0,#EFCD64 49%,#EFBD22 50%,#F6DC23)","linear-gradient(-45deg, #BBD87D,#8EBF3F)","linear-gradient(#79BE80,#31AB3B 49%,#009E10 50%,#008F0B)","linear-gradient(+45deg, #84C185,#369946)","linear-gradient(left, #3E91A3,#49A9B9)","linear-gradient(left, #277EDF,#3691EC)","radial-gradient(circle, #0298DB,#065A9D)","linear-gradient(rgb(116,153,232),rgb(54,110,223) 49%,rgb(34,96,221) 50%,rgb(35,98,221))","linear-gradient(rgb(130,158,188),rgb(90,125,166) 49%,rgb(70,103,151) 50%,rgb(71,104,153))","radial-gradient(circle, #9CBDD3,#657E8F)","linear-gradient(-45deg, #6D90B3,#306393,#12477F)","linear-gradient(left, #6031B1,#6F3CBD)"];var l=[{bg:"l",bgc:["rgba(0,0,0,0.0)","rgba(0,0,0,0.0)"],bgd:[0,1]},{bg:"r",bgc:["#e6e6e6","#fafafa"],bgd:[0,1]},{bg:"l",bgc:["#FBFBFB","#B9B9B9"],bgd:[0,1]},{bg:"r",bgc:["#F0F0F9","#A8A8B1"],bgd:[0,1]},{bg:"l",bgc:["rgb(221,221,223)","rgb(221,221,223)","rgb(206,207,209)","rgb(184,186,188)","rgb(188,190,193)"],bgd:[0,0.15,0.49,0.5,1]},{bg:"r",bgc:["#ABABAB","#7B7B7B"],bgd:[0,1]},{bg:"l",bgc:["#A4A4A4","#848484"],bgd:[0,1]},{bg:"l",bgc:["rgb(85,89,96)","rgb(38,44,53)","rgb(20,29,38)","rgb(39,45,55)"],bgd:[0,0.49,0.5,1]},{bg:"l",bgc:["rgb(217,130,136)","rgb(207,86,96)","rgb(188,19,32)","rgb(188,19,32)"],bgd:[0,0.49,0.5,1]},{bg:"ld2",bgc:["#EF7165","#E94C3D","#E31E27"],bgd:[0,0.5,1]},{bg:"lrl",bgc:["#C55746","#E45D40"],bgd:[0,1]},{bg:"ld2",bgc:["#EF7165","#E94C3D","#E31E27"],bgd:[0,0.5,1]},{bg:"ld2",bgc:["#F9A665","#F68C3E","#F26D20"],bgd:[0,0.5,1]},{bg:"l",bgc:["#E4D0A0","#EFCD64","#EFBD22","#F6DC23"],bgd:[0,0.49,0.5,1]},{bg:"ld2",bgc:["#BBD87D","#8EBF3F"],bgd:[0,1]},{bg:"l",bgc:["#79BE80","#31AB3B","#009E10","#008F0B"],bgd:[0,0.49,0.5,1]},{bg:"ld",bgc:["#84C185","#369946"],bgd:[0,1]},{bg:"lrl",bgc:["#3E91A3","#49A9B9"],bgd:[0,1]},{bg:"lrl",bgc:["#277EDF","#3691EC"],bgd:[0,1]},{bg:"r",bgc:["#0298DB","#065A9D"],bgd:[0,1]},{bg:"l",bgc:["rgb(116,153,232)","rgb(54,110,223)","rgb(34,96,221)","rgb(35,98,221)"],bgd:[0,0.49,0.5,1]},{bg:"l",bgc:["rgb(130,158,188)","rgb(90,125,166)","rgb(70,103,151)","rgb(71,104,153)"],bgd:[0,0.49,0.5,1]},{bg:"r",bgc:["#9CBDD3","#657E8F"],bgd:[0,1]},{bg:"ld",bgc:["#6D90B3","#306393","#12477F"],bgd:[0,0.5,1]},{bg:"lrl",bgc:["#6031B1","#6F3CBD"],bgd:[0,1]}];for(var i=0;i<m.length;i++){var f=JSON.stringify(l[i]);var k={color:"-webkit-"+m[i],color3:"-moz-"+m[i],color2:f,size:36};h=h.add($("#tmplSwatchBox").tmpl(k))}h.appendTo($("#gradientColorPicker"))},removeInputFocus:function(){$("#colorHexValue").blur();a.masterElements.find(".numberInput").blur()},lastAction:false,menuButtonActions:{menuExpander:{to:"showShapeInspector",alsoFrom:["showGradientGallery","showBorder","showFlatColor","showColorStopEditor","showAdvancedGradientEditor","showBackground"],from:"hideInspectors"},textMenuExpander:{to:"showTextInspector",from:"hideInspectors"},shapeBackground:{to:"showBackground",alsoFrom:["showGradientGallery","showFlatColor","showColorStopEditor","showAdvancedGradientEditor"],from:"showShapeInspector"},shapeBorder:{to:"showBorder",from:"showShapeInspector"},textColor:{to:"showTextColor",from:"showTextInspector"},cgpButton:{to:"showGradientGallery",alsoFrom:["showAdvancedGradientEditor"],from:"showFlatColor"},swatchEdit:{to:"showAdvancedGradientEditor"},backButton:{to:"showGradientGallery",alsoFrom:["showColorStopEditor"],from:"showAdvancedGradientEditor"},captionBackground:{to:"showShapeInspector"},captionBorder:{to:"showShapeInspector"},colorStopButton:{to:"showColorStopEditor"}},toggle:function(k,f){if(k){var i=(k.target.id)?k.target.id:$(k.target).parent().attr("id")}else{var i=f}if(!a.menuButtonActions[i]){return}var h=$.inArray(a.lastAction,a.menuButtonActions[i].alsoFrom);var j=a.menuButtonActions[i].to;if((j==a.lastAction||h>-1)&&a.menuButtonActions[i].from){j=a.menuButtonActions[i].from}a.showCorrectScreen(j);contextMenu.removeOtherCmMenus(["staticWidgets"])},showCorrectScreen:function(f){a.position();a.lastAction=f;a.hidablePropertyInspector.hide();(a[f])();a.removeInputFocus()},resetPropInspector:function(){a.lastAction="hideInspectors";a.removeInputFocus()},hideInspectors:function(){a.masterElements.hide();a.hidablePropertyInspector.hide()},showTextColor:function(){a.masterElements.show();a.textColorPicker.show();$("#textColor").addClass("pickerOpen");colorPicker.getTextColor()},showBorder:function(){a.masterElements.show();a.removePickerHighlight();$("#shapeBorder").addClass("pickerOpen");a.borderColor.show();propInspectorCtrl.updateBackgroundBorderInfo();colorPicker.getBorderColor()},showBackground:function(){a.masterElements.show();a.removePickerHighlight();$("#shapeBackground").addClass("pickerOpen");var f=propInspectorCtrl.filterBackgroundTypes();a.showCorrectScreen(f)},showFlatColor:function(){a.flatColorView.show();$("#cgpButton").text("Gradient");$("#cgpButton").attr("alt","Edit Gradient").attr("title","Edit Gradient");propInspectorCtrl.updateBackgroundBorderInfo();colorPicker.getColorBackground()},showGradientGallery:function(){a.gradientGallery.show();$("#cgpButton").text("Color");$("#cgpButton").attr("alt","Edit Color").attr("title","Edit Color");propInspectorCtrl.updateBackgroundBorderInfo()},showAdvancedGradientEditor:function(){a.advancedGradientEditor.show();colorPicker.populateAdvancedGradient()},showColorStopEditor:function(){a.colorStopEditor.show();colorPicker.setColorStops()},showShapeInspector:function(){a.removePickerHighlight();a.masterElements.show();a.shapeProps.show();propInspectorCtrl.updateShapeProps();var f=true;propInspectorCtrl.updateBackgroundBorderInfo(f)},showTextInspector:function(){a.removePickerHighlight();a.masterElements.show();a.textProps.show();propInspectorCtrl.updateTextProps()},removePickerHighlight:function(){$("#textColor, #shapeBorder, #shapeBackground").removeClass("pickerOpen")},position:function(){var h=$("#propInspectors");var f=$("#propertyInspectorBtn, #propertyInspectorBtn2").not(":hidden").position();if(f&&f.left){h.css({top:45,left:f.left-168})}},update:function(j){propInspectorCtrl.saveSelection();var j=j||propInspectorCtrl.currentSelection;if(a.lastAction=="hideInspectors"||j.length==0){return}var i=propInspectorCtrl.filterTextOrShape();if(!i){return}else{var n=$.inArray(a.lastAction,i.showDefaults);if(n>-1){var l=i.showDefaults[n]}else{var l=i.showDefaults[0]}var m=["showGradientGallery","showFlatColor","showBackground","showAdvancedGradientEditor","showColorStopEditor","showTextColor","showBorder"];var h=$.inArray(a.lastAction,m);if(h>-1){if(i.showColorPicker==false){var l=i.showDefaults[0]}else{var f=m[h];var k=$.inArray(f,i.showColorPicker);if(k>-1){var l=i.showColorPicker[k]}else{var l=i.showColorPicker[0]}}}}a.showCorrectScreen(l)}};d.exports=a},{}],22:[function(c,d,b){var h=c("./class-storage");var a=c("./utils");var f={isScrolling:false,isSwiping:false,isDoubleTapping:false,isTapHolding:false,setup:function(i){$.mobile.scrollview.prototype._handleDragStart=(function(l){var k=$.mobile.scrollview.prototype._handleDragStart;return function j(n){var o=$.inArray($(n.target).closest(".pageWidget").attr("id"),i.linkOrigin);if(o==-1){o=$.inArray($(n.target).closest(".pageWidget").data("lockto"),i.linkOrigin)}var m=o>-1&&i.triggerType[o];if(m&&(m=="taphold"||m=="doubletap"||m.substr(0,5)=="swipe")){return true}k.apply(this,arguments)}}());$.mobile.scrollview.prototype._handleDragMove=(function(l){var k=$.mobile.scrollview.prototype._handleDragMove;return function j(m){f.isScrolling=true;k.apply(this,arguments)}}());$.mobile.scrollview.prototype._handleDragStop=(function(k){var j=$.mobile.scrollview.prototype._handleDragStop;return function l(m){setTimeout(function(){f.isScrolling=false},10);j.apply(this,arguments)}}())},showPage:function(o){var n=$(this);n.find(".ui-content").attr("data-"+$.mobile.ns+"scroll","y");var m=h.get(g_preview).pageWH;var p,j=$(n).attr("id");if(j=="home"){return}p=[h.get(j).width,h.get(j).height];if(m[0]>=p[0]&&m[1]>=p[1]){return}var q=h.get(g_preview).orientation;var k=h.get(j).orientation;var l=q==k;var i="xy";if(!l){p=[p[1],p[0]]}if(p[0]==m[0]){i=l?"y":"x"}if(p[1]==m[1]){i=l?"x":"y"}n.find(":jqmData(scroll):not(.ui-scrollview-clip)").each(function(){var u=$(this);var v=u.attr("id");if(u.hasClass("ui-scrolllistview")){u.scrolllistview();return true}var s=u.jqmData("scroll")+"";var s=u.jqmData("scroll")+"";var r=s&&s.search(/^[xy]p$/)!=-1;var t={direction:i||undefined,paging:r||undefined,scrollMethod:u.jqmData("scroll-method")||undefined};u.scrollview(t)});if(!l){m=[m[1],m[0]]}n.css({"min-height":a.getTrueHeight()+"px"}).children(".ui-content").css({width:m[0]+"px",height:m[1]+"px"})}};d.exports=f},{"./class-storage":24,"./utils":60}],23:[function(b,d,a){var f=b("./class-lib");var c={filter:function(){if(!c.filterDebounced){c.filterDebounced=_.debounce(c._filter,500)}c.filterDebounced()},_filter:function(){var m=$("#searchBox").val().trim().toLowerCase();var q=widgets.summary,j=[],l=[],n,o,k,h=[],t,s;t=$("#library .libraryWidget").removeClass("hidden"),s=$("#library .overview .setHeader").show();if(m!==""){var r=$("#uploadTabs li.libraryWidget");for(k in widgets.summary){n=q[k];if(n.g&&$.inArray(f.currentDisplay,n.g)>-1){if(q.hasOwnProperty(k)&&n.title){l=n.x?n.x.concat([]):[];l.push(n.title);for(o=0;o<l.length;o++){if(l[o].toLowerCase().indexOf(m)!==-1){j.push(k);h=h.concat(n.t)}}}}}j.forEach(function(u,i){t=t.not("#"+u).not(r.filter('[data-id="'+u+'"]'))});t.addClass("hidden");h=fluid.util._.compact(h);s.not(".libraryUploads");var p=$("#widgets .overview");h.forEach(function(i){s=s.not($("[data-groupName='"+i+"']",p).parents(".setHeader"))});if(f.currentDisplay=="Uploads"){s=s.not($("[data-groupName='Uploads']",p).parent())}s.hide();if(h.length){$(".emptyLibDisplay").hide()}else{$(".emptyLibDisplay").show()}}else{$(".emptyLibDisplay").hide()}setTimeout(f.updateScrollbar,10)},focus:function(){$("#searchBox").focus().select()}};d.exports=c},{"./class-lib":12}],24:[function(c,b,j){var h=c("./fluid/fluid.main");var i=c("./fluid/models/project");var d=c("./fluid/models/upload");var f=c("./fluid/models/account");var m=c("./class-dbStorage");var a=c("./class-event");var n=c("./utils").getParentWindow;var l={tempStorage:{},cachedUpdates:{},caching:false,lastUpdate:new Date().getTime(),get:function(p){if(k.tempStorage[p]){return k.tempStorage[p]}if(localStorage){var o=localStorage.getItem(p);if(o){k.tempStorage[p]=JSON.parse(o);return k.tempStorage[p]}}return null},tabSynchronisationCheckInterval:3000,lastTabSynchronisationCheck:null,set:function(v,s,o){if(!v||!s){return}var u=o==undefined?true:o;if(this.lastTabSynchronisationCheck+this.tabSynchronisationCheckInterval<new Date().getTime()){var q=localStorage.getItem("instanceId");if(q&&parseInt(q)!=g_instanceId){var t=localStorage.getItem("restoreMyInstanceId");if(t){k._setItem("instanceId",g_instanceId);localStorage.removeItem("restoreMyInstanceId");return}k._setItem("postloadMessage","tab");location.reload();return}}if(typeof(s)=="string"){s=JSON.parse(s)}k.lastUpdate=this.lastTabSynchronisationCheck=new Date().getTime();if((s)&&(u)){s.updated=k.lastUpdate}var p=JSON.stringify(s);try{if(this.caching){this.cachedUpdates[v]=s}else{k._setItem(v,p)}this.tempStorage[v]=s}catch(r){}a.triggerEditor("storageChanged",{id:v,obj:s,timeUpdated:u})},remove:function(o){delete this.tempStorage[o];delete this.cachedUpdates[o];localStorage.removeItem(o)},cacheStart:function(){this.caching=true},commitCache:function(){if(!this.caching){return}this.caching=false;for(var o in this.cachedUpdates){this.set(o,this.cachedUpdates[o]);delete (this.cachedUpdates[o])}},setTempItem:function(p,o){this.tempStorage[p]=o},removeItem:function(o){localStorage.removeItem(o)},clear:function(){tempStorage={};cachedUpdates={};localStorage.clear()},_setItem:function(r,o){var q=false;while(!q){try{localStorage.setItem(r,o);q=true}catch(p){if(p&&(p.name=="QUOTA_EXCEEDED_ERR"||p.name=="NS_ERROR_DOM_QUOTA_REACHED"||p.code===22)){project.unloadOldest()}else{throw p}}}}};var k={get:function(u,q){var s=u&&u.substr?u.substr(1,1):"";var p,t,o;if(!u){return false}if(u[0]==="p"&&(!fluid.main.project||fluid.main.project.id!==u)&&fluid.main.projects){p=fluid.main.projects.get(u,q);t=p?p.toJSON(q):null;return t}else{if(fluid.main&&fluid.main.project&&((s==="_"&&(u[0]==="p"||u[0]==="x"||u[0]==="w"||u[0]==="l"))||((u[0]==="p"||u[0]==="x"||u[0]==="w"||u[0]==="l")&&u.length===33))){t=fluid.main.project.get(u,q);if(t){return t}else{_.each(fluid.main.projects,function(z,v,A){var w=A.models[v].get(u,q);if(w){t=w}});return t}}else{if(fluid.main&&fluid.main.account&&((s==="_"&&u[0]==="u")||(u[0]==="u"&&u.length===33))){t=fluid.main.account.toJSON();return t}else{if(fluid.main&&fluid.main.uploads&&((s==="_"&&u[0]==="i")||(u[0]==="i")||u.length===33)){p=fluid.main.uploads.get(u);if(q&&q.returnModel){return p}else{return p?p.toJSON():false}}else{if(window.g_preview&&n&&window.top.storage){var r=window.top.storage.get(u,q);return r}}}}}o=l.get(u);if(u!=="accounts"&&u!=="bin"&&o){}if(o){return $.extend({},o)}else{return false}},set:function(u,t,p){t=_.clone(t);var s=u&&u.substr?u.substr(1,1):"";if(s==="_"||((u.length===33)&&(u[0]==="p"||u[0]==="x"||u[0]==="w"||u[0]==="i"||u[0]==="u"))){if(u[0]==="p"&&fluid.main.project){if(fluid.main.project.id===u){fluid.main.project.set(t);return true}else{var r=fluid.main.projects.get(u);if(r){r.set(t);return true}else{return false}}}else{if(u[0]==="u"){if(fluid.main.account&&fluid.main.account.id===u){fluid.main.account.set(t);return true}else{return false}}else{if(u[0]==="i"){if(!t.id){t.id=u}var o=fluid.main.uploads.get(u);if(o){o.set(t)}else{fluid.main.uploads.add(t)}delete t.id;return true}else{if(u[0]==="b"){var q=fluid.main.account.customwidgets.get(u);if(q){q.set(t)}else{fluid.main.account.customwidgets.add(t)}}else{if(fluid.main.project){fluid.main.project.setChild(u,t);return true}}}}}}l.set(u,t,p);return true},remove:function(p){var o=p.substr(0,2);if(o==="w_"){fluid.main.project.widgets.remove(p)}else{if(o==="x_"){fluid.main.project.pages.remove(p)}}return l.remove(p)},cacheStart:function(){return l.cacheStart()},commitCache:function(){return l.commitCache()},setTempItem:function(p,o){return l.setTempItem(p,o)},removeItem:function(o){return l.removeItem(o)},clear:function(){return l.clear()},_setItem:function(p,o){return l._setItem(p,o)},init:function(o){o=_.once(o);if(window.g_preview){o();return}fluid.main.projects=new fluid.Projects();fluid.main.uploads=new fluid.Uploads();m.onReady(function(){var p=k.get("accounts");if(p&&p.last){m.get("accounts",p.last,function(q){if(q.fetched.length){fluid.main.account=new fluid.models.Account(q.resultsObj[q.fetched[0]].data);m.get("uploadHeaders",fluid.main.account.id,function(t){if(t.fetched.length&&t.resultsArr[0]){var s=fluid.util._.toArray(t.resultsArr[0].data);fluid.main.uploads=new fluid.Uploads(s)}var v=fluid.main.account.get("lastOpenProject");var u=false;var r=fluid.main.account.get("projectIds");if(r.length){m.get("projects",r,function(B){if(B.fetched.length===0){o()}else{r=_.difference(r,B.failed);for(var A=0;A<B.resultsArr.length;A++){if(B.resultsArr[A]){var w=B.resultsArr[A].id,D=B.resultsArr[A].data,C=B.resultsArr[A].data[B.resultsArr[A].id];if(!C.id){C.id=w}if(w===v){u=true;fluid.main.project=new fluid.models.project(D,{parse:true,projectId:v});fluid.main.projects.add(fluid.main.project,{silent:true});if(fluid.main.project.get("removed")){fluid.main.project.set({removed:false})}r=_.without(r,B.resultsArr[A].id);if(D[v].unloaded){project.loadIfUnloaded(v,function(){if(r.length===0){o()}},{buildModel:true})}else{m.get("uploads",_.keys(D.uploads),function(G){if(G.fetched.length){var E;for(var F=0;F<G.resultsArr.length;F++){E=false;if(G.resultsArr[F]&&G.resultsArr[F].id){E=k.get(G.resultsArr[F].id,{returnModel:true})}if(E&&G.resultsArr[F]&&G.resultsArr[F].data){E.set({imgData:G.resultsArr[F].data},{})}}}if(r.length===0){o()}})}}else{if(C.unloaded){fluid.main.projects.add(C,{silent:true});r=_.without(r,B.resultsArr[A].id);if(r.length===0){o()}}else{var z=new fluid.models.project(D,{parse:true,projectId:w});fluid.main.projects.add(z,{silent:true});r=_.without(r,B.resultsArr[A].id);if(r.length===0){o()}}}}}if(!u){o()}}})}else{localStorage.clear();localStorage.setItem("badinit",true);m.clear();setTimeout(function(){location.reload()},200)}})}else{o()}})}else{o()}})},tempStorage:l.tempStorage};b.exports=k},{"./class-dbStorage":6,"./class-event":7,"./fluid/fluid.main":39,"./fluid/models/account":47,"./fluid/models/project":52,"./fluid/models/upload":53,"./utils":60}],25:[function(b,c,a){var d={enabled:false,defaultLevel:10,level:10,record:function(j,l,f,h,k){if(!d.enabled){return}l=l?l:d.defaultLevel;if(d.level<l){return false}var i={action:j,userId:account.get("id")};ajax.syncUp(i,"tracker","",k);return true},setLevel:function(f){f=f?f:d.defaultLevel;d.level=f},disable:function(){d.setLevel(0)}};c.exports=d},{}],26:[function(c,d,a){var b=c("./class-panels");var h=c("./class-payments");var f={isOpen:false,panelStack:new Array(),startPanel:null,helpLoaded:false,openMenuAfterExit:true,placeHolders:{feedbackFix:"Tell us a little more so we can fix the bug",feedbackNew:"Tell us a little more so we add more awesome features!",feedbackOther:"Tell us a little more so we can be more Fluid!"},init:function(){$("#userSettingsLink").live({click:f.open});$("input.upgrade").live({click:function(){if($(this).attr("id")==="upgradeLink"){fluid.main.fire("fluidMenuUpgradeLinkClicked")}f.goToUpgrade(null,undefined,undefined,true)}});$(".socialLinks .feedback").live({click:f.goToContact});$("#userSettingsChangeAccount").live({click:function(){fluid.main.fire("accountMenuUpgradeLinkClicked");f.goToUpgrade()}});$("#userSettingsChangeEmail").live({click:f.goToChangeEmail});$("#userSettingsChangePassword").live({click:f.goToChangePassword});$("#userSettingsPauseBilling").live({click:f.goToPauseBilling});$(".experienceType").click();$("#upgradeFormFree").submit(b.submitFree);$(".experienceType").click(b.rateEditor);$("#pauseBillingFeedback").click(f.proceedPauseBilling);$("#userSettingsContact").live({click:f.goToContact});$("#userSettingsBilling").live({click:f.goToBilling});$("#userSettingsBillingAddressBtn").live({click:f.goToBilling});$("#userSettingsBillingHistory").live({click:f.goToReceipts});$("#userSettingsCode").live({click:f.goToCode});$("#userSettingsRemoveAccount").live({click:f.goToRemoveAccount});$("#userSettingsRemoveAccountCancel, #userSettingsRemoveAccountConfirmCancel").live({click:f.reStart});$(".recoverPasswordSettings").live({click:f.goToResetPassword});$("#userSettingsChangeEmailForm").live({submit:f.actionChangeEmail});$("#userSettingsChangePasswordForm").live({submit:f.actionChangePassword});$("#userSettingsBillingForm").live({submit:f.actionBilling});$("#userSettingsCardYear, #userSettingsCardMonth").on("change",function(){$(this).trigger("blur")});$("#userSettingsContactForm").on("submit",f.actionContact).on("input",function(m){var l=document.getElementById("userSettingsContactMessage").value,k=document.getElementById("userSettincsContactSubmit");if(/(\s*\S\s*){3,}/.test(l)){k.removeAttribute("disabled")}else{k.setAttribute("disabled","")}});$("#userSettingsCodeForm").live({submit:f.actionCode});$("#userSettingsRemoveAccountForm").live({submit:f.actionRemoveAccount});$("#userSettingsRemoveAccountConfirmForm").live({submit:f.actionRemoveAccountConfirm});$("#userSettingsFeedbackForm").live({submit:f.actionFeedback});$("#userSettingsResetPasswordButton").live({click:f.actionResetPassword});$(".userSettingsFeedbackSetType").live({click:f.actionFeedbackSetType});$(".userSettingsMessageContainer").live({click:b.hideMessages});$("#userSettingsToggleMore").live({click:f.toggleMore});$("#updateBillingInfo").live("click",f.goToBilling);$("#userSettingsCardDetails").live("click",f.goToCardUpdate);$("#userSettingsCardSubmit").live("click",f.actionCardUpdate);$("#userSettingsBillingCountry").live("change",function(l){var k=l.target.options[l.target.selectedIndex].value;if(h.isVATApplicable(k)){$("#userSettingsVATSection").show()}else{$("#userSettingsVATSection").hide();$("#userSettingsBillingVAT").val("")}}).trigger("change");$("#monthlyEmailReceipt").live("click",function(){if(!account.get("emailReceiptEnabled")){account.set({emailReceiptEnabled:true})}else{account.set({emailReceiptEnabled:false})}f.toggeEmailReceiptmentForm.apply(this,arguments)});function i(k,l){var m=$(".form-error-area[data-for="+l.attr("id")+"]");if(m.size()>0){m.append(k)}}var j=$("#updateCardForm");h.validation.init({elem:{form:j,loginEmail:$("#userSettingsLoginEmail"),loginPassword:$("#userSettingsLoginPassword"),name:$("#userSettingsCardName"),number:$("#userSettingsCardNumber"),type:$("#userSettingsCardType"),logo:$("#userSettingsCardTypeLogo"),month:$("#userSettingsCardMonth"),year:$("#userSettingsCardYear"),cvv:$("#userSettingsCardCvv")},handler:{errorPlacement:function(k,l){switch(l.attr("id")){case"userSettingsCardNumber":k.insertAfter($("#userSettingsCardTypeLogo"));break;case"userSettingsCardMonth":k.insertAfter($("#userSettingsCardYear"));break;case"userSettingsCardYear":break;default:k.insertAfter(l)}}}});h.validation.init({elem:{form:$("#userSettingsBillingForm"),billingCompany:$("#userSettingsBillingCompany"),billingAddress:$("#userSettingsBillingAddress"),billingCountry:$("#userSettingsBillingCountry"),billingVAT:$("#userSettingsBillingVAT")},handler:{errorPlacement:i}});h.populateCardYears($("#userSettingsCardYear"),11);$(window).resize(f._resizeScreen);fluid.main.fire("userSettings.afterInit")},setInitialState:function(){$("#userSettingsBillingHistory, #userSettingsCardDetails, #userSettingsPauseBilling, #userSettingsBillingAddressBtn").hide();if(account.isFreeAccount()&&account.get("everUpgraded")===true){$("#userSettingsBillingHistory, #userSettingsBillingAddressBtn").show()}else{if(account.isFreeAccount()!==true){$("#userSettingsBillingHistory, #userSettingsCardDetails, #userSettingsPauseBilling, #userSettingsBillingAddressBtn").show()}}},reStartFromOutside:function(l,k){canvas2.setEditorVisibility(true);tracker.record("closedAccountPanel",1);var m=k!=undefined&&k.successMsg?k.successMsg:"";var i=k!=undefined&&k.successMsg!=undefined;if((i)||(f.isOpen)){f.isOpen=true;var j=f.startPanel==null?$("#userSettingsMain"):f.startPanel;f.reStart(l,m,$(".backFromUpgradeContainer",j))}else{fluidMenu.show()}},reStart:function(l,m,j){if(!f.isOpen){return}f.setInitialState();var k=f.startPanel==null?$("#userSettingsMain"):f.startPanel;if(k.is(":visible")){f.close();return}function i(){b.setSuccessMessage(m,j)}$(".currentEmail").text(account.get("email"));if(!$("#userSettingsContainer").is(":visible")){$("#userSettingsContainer").fadeIn(100)}$(".modalWindowContentWrapper").show();f._panelDisplay(k,true,i);f.panelStack=new Array()},open:function(l,k,i){account.setUpgradeLinkStatus();canvas2.setEditorVisibility(false);notification.removeAll("projectLimit");b.hideMessages();b.setWorkArea();var j=$(".modalWindowContentFrame:visible, .modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, .modalWindowContentFrameSmall:visible");j.hide();$("#userSettingsContainer").fadeIn(100);$(".modalWindowContentWrapper").show();if(!f.isOpen){f.isOpen=true;f.resetMore();f.panelStack=new Array();if((k!=undefined)&&(k.size()>0)){f.startPanel=k}else{f.startPanel=null}}if((k!=undefined)&&(k.size()>0)){f._panelDisplay(k,true,undefined,i)}else{f.reStart()}},close:function(k,i){f.openMenuAfterExit=f.openMenuAfterExit||i?true:false;canvas2.setEditorVisibility(true);var j=$(".modalWindowContentFrame:visible, .modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, .modalWindowContentFrameSmall:visible");if(!f.debouncedPanelHide){f.debouncedPanelHide=_.debounce(f.hide,500,true)}f._panelDisplay(j,false,f.debouncedPanelHide);f.startPanel=null;f.isOpen=false;if(!fluid.main.project||fluid.main.project.get("removed")){var l=account.get("projectIds");if(l.length){project.open(l[l.length-1])}else{project.add("","",null,function(m){project.open(m)})}}fluid.main.fire("userSettings.closePanels")},goBack:function(m,n,j){if(f.panelStack.length>1){var l=f.panelStack.pop();var k=f.panelStack.pop();function i(){fluidEvent.triggerEditor("panelGoBack",{panelId:k.attr("id")},true);b.setSuccessMessage(n,j)}f._panelDisplay(k,true,i);return}f.reStart(m,n,j)},hide:function(){$(".modalWindowContentWrapper").hide();$("#userSettingsContainer").fadeOut(200);if(f.openMenuAfterExit){fluidMenu.show()}else{fluidMenu.hide()}f.openMenuAfterExit=true},hideCurrentPanel:function(l,k){b.hideMessages();var i=$(".modalWindowContentFrame:visible, .modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, .modalWindowContentFrameSmall:visible");if(i.size()>0){f._panelDisplay(i,false,l)}else{var j=k==undefined?false:k;if(j){f.close()}l()}},resetMore:function(){$("#userSettingsBottomButtons").hide();$("#userSettingsToggleMore").text("More...")},toggleMore:function(){$("#userSettingsBottomButtons").slideToggle(400);var i=$("#userSettingsToggleMore");var j=i.text().indexOf("More")>-1?"...Less":"More...";i.text(j)},goToCreateAccount:function(j,i){if(f.isOpen){f.hideCurrentPanel(function(){account.startCreate(j,i)})}else{account.startCreate(j,i)}},goToUpgrade:function(m,o,l,n){var j={};if(!account.isFreeAccount()){j[account.get("accType")]=true}var k=fluid.util.tpl("upgradeDialogTmpl",j);var r=fluid.util.tpl("tipTemplate",{});document.getElementById("upgradeDialog").innerHTML=k;$("#upgradeDialog").parent().parent().append(r);var i=fluid.util.tpl("upgradeErrorTmpl");document.getElementById("upgradeError").innerHTML=i;if(f.isOpen){f.hideCurrentPanel(function(){upgrade.start(upgrade.init);f.open(null,$("#upgradeDialog"))})}else{upgrade.start(upgrade.init);$("body").keydown(preventDeleteBack);$("#form").show();upgrade.setUserData();var q=b.getCloseExternalWindowButtonLabel();var p=q=="Close"?"close":"back";$(".hud-button.userSettingsDone span").text(q);$(".hud-button.userSettingsDone").removeClass("close back").addClass(p);f.open(null,$("#upgradeDialog"));setTimeout(function(){f._fixCloseButton(true)},500)}},goToResetPassword:function(){f._panelDisplay($("#userSettingsPanelResetPassword"),true)},actionResetPassword:function(i){f.reStart(i,"resetPass");return false},goToChangeEmail:function(){$("#userSettingsChangeEmailNew").val("");$("#userSettingsChangeEmailPass").val("");f._panelDisplay($("#userSettingsPanelChangeEmail"),true)},actionChangeEmail:function(j){b.hideErrors();b.lastSubmitButton=$("#userSettingsChangeEmailSubmit");var i=$.trim($("#userSettingsChangeEmailNew").val());fluid.api.emailRegd(i,function(k){account.emailChecked(k)});return false},actionCheckedEmail:function(l,k){if(k.exists){b.displayError("emailUsed");return}var i=$.trim($("#userSettingsChangeEmailNew").val());var j=$.trim($("#userSettingsChangeEmailPass").val());if((i!="")&&(j!="")){fluid.api.changeEmail(i,j,f.actionChangeEmailCallback,f.actionChangeEmailCallback)}return false},actionChangeEmailCallback:function(k,i){if(k==null){if(i!=""){b.displayError(i);return false}b.displayError();return false}var l=JSON.parse(k);if(l.t===true||l.t==="true"){var j=$.trim($("#userSettingsChangeEmailNew").val());account.set({email:j});account.resetAccountFrame();f.reStart(null,"default",$("#userSettingsChangeEmail"))}else{if(l.t.indexOf("Unknown error")>-1){b.displayError()}else{b.displayError("passInvalid")}}return false},goToChangePassword:function(){$("#userSettingsChangePasswordOld").val("");$("#userSettingsChangePasswordNew").val("");f._panelDisplay($("#userSettingsPanelChangePassword"),true)},actionChangePassword:function(j){b.hideErrors();b.lastSubmitButton=$("#userSettingsChangePasswordSubmit");var i=$("#userSettingsChangePasswordOld").val();var k=$("#userSettingsChangePasswordNew").val();if(i==k){b.displayError("passNotChanged");return false}fluid.api.changePass(i,k,f.actionChangePasswordCallback,f.actionChangePasswordCallback);return false},actionChangePasswordCallback:function(j,i){if(j==null){if(i!=""){b.displayError(i);return false}b.displayError();return false}var k=JSON.parse(j);if(k.t===true||k.t==="true"){f.reStart(null,"default",$("#userSettingsChangePassword"))}else{b.displayError("oldPassInvalid")}return false},goToCardUpdate:function(i){$("#userSettingsCardName, #userSettingsCardNumber, #userSettingsCardCvv, #userSettingsCardType").val("");$("#updateCardForm")[0].reset();$("#userSettingsCardTypeLogo").removeClass("ccTypeLogoVISA ccTypeLogoMC ccTypeLogoAMEX");$("#userSettingsCardSubmit").removeAttr("disabled");h.validation.reset($("#updateCardForm"));f._panelDisplay($("#userSettingsPanelCard"),true);return false},actionCardUpdate:function(k){function l(){fluid.api.updateCard({name:$("#userSettingsCardName").val(),number:$("#userSettingsCardNumber").val(),month:$("#userSettingsCardMonth").val(),year:$("#userSettingsCardYear").val(),type:$("#userSettingsCardType").val(),cvv:$("#userSettingsCardCvv").val()},f.actionCardUpdateCallback,f.actionCardUpdateCallback)}function i(){b.displayError("Sign in failed. Please check your email and password and try again.");$("#userSettingsCardSubmit").removeAttr("disabled")}if($(k.target.form).valid()){b.hideErrors();b.lastSubmitButton=$("#userSettingsCardSubmit");if(account.get("loggedIn")!="yes"){var j={t:"login",strict:true,uid:account.get("currentUserId"),instanceId:localStorage.getItem("instanceId"),email:$("#userSettingsLoginEmail").val(),password1:$("#userSettingsLoginPassword").val(),tandc:"on"};$.ajax({url:"./index.php",type:"POST",data:j,timeout:15000,success:function(o,p,n){var m=JSON.parse(n.responseText);if(m.r=="s"){signup.ajaxSuccess(o,p,n);l()}else{i()}},error:function(){i()},timeOut:function(){i()}})}else{l()}$("#userSettingsCardSubmit").attr("disabled","disabled")}return false},actionCardUpdateCallback:function(j,i){if(j==null){if(i!=""){$(".userSettingsLogin").fadeOut(200);b.displayError(i);return false}b.displayError();return false}var k=JSON.parse(j);if(k.t===true||k.t==="true"){if(account.get("status")=="pendingCardUpdate"){account.set({status:"ok"});f.showCloseButton();$("#updateCardForced").hide()}f.reStart(null,"default",$("#userSettingsCardDetails"))}else{b.displayError()}return false},goToBilling:function(){$("#userSettingsBillingCompany").val(account.get("billingCompany"));$("#userSettingsBillingAddress").val(account.get("billingAddress"));$("#userSettingsBillingCountry").val(account.get("billingCountry"));$("#userSettingsBillingVAT").val(account.get("billingVAT"));$("#userSettingsBillingCountry").trigger("change");f._panelDisplay($("#userSettingsPanelBilling"),true);return false},toggeEmailReceiptmentForm:function(){$(this).toggleClass("pressed");$("#emailReceiptsForm").toggle()},goToReceipts:function(){fluid.api.getPayments(function(o){o=JSON.parse(o);$("#userSettingsReceiptEmail").val(account.get("receiptEmails"));if(account.get("emailReceiptEnabled")){f.toggeEmailReceiptmentForm()}if(!o.receiptAvailable){$("#downloadAllReceipts").removeClass("active")}else{$("#downloadAllReceipts").addClass("active")}var n=o.t;var r=$("#receiptList .overview");r.find(".receiptListItem, .receiptEmptyMsg").remove();if(n.length===0){r.append('<div class="receiptEmptyMsg">No payments found...</div>');$("#downloadAllReceipts").removeClass("active")}if(o.msg){r.append('<div class="receiptEmptyMsg">'+o.msg+"</div>")}var k=["January","February","March","April","May","June","July","August","September","October","November","December"];var q,s,l;for(var p=0;p<n.length;p++){q=new Date(n[p].date*1000);l=q.getDate();if(l>3){s="th"}else{if(l==3){s="rd"}else{if(l==2){s="nd"}else{if(l==1){s="st"}}}}n[p].amountIncVat=n[p].amountIncVat/100;n[p].date=q.getFullYear()+" "+k[q.getMonth()]+" "+l+s;if(!o.receiptAvailable){n[p].hiddenClass="not-available"}if(n[p].status==="SUCCESS"){$("#tmplPaymentListItem").tmpl(n[p]).appendTo(r)}}b.adjustScroll($("#receiptList"));$(".pdfReceipt").live("click",function(){if(window.invoiceUser){window.open(window.location.href+"invoice/"+$(this).parent(".receiptListItem").attr("id").split("-")[1]+"/userId/"+window.invoiceUser,"invoice")}else{window.open(window.location.href+"invoice/"+$(this).parent(".receiptListItem").attr("id").split("-")[1],"invoice")}});$("#downloadAllReceipts").on("click",function(){if(!$(this).hasClass("active")){notification.add("alert","No receipts to download!",{stopBuggingCallBack:true})}});$("#downloadAllReceipts.active").live("click",function(){window.open(window.location.href+"invoice/all","invoice")});function m(){var v=$("#userSettingsReceiptEmail").val().split(",");var u=true;for(var t=0;t<v.length;t++){v[t]=v[t].trim();if(!j(v[t])){u=false;break}}if(u){$("#updateReceiptEmails").val("Saving...");account.set({receiptEmails:v.join(", ")});account.syncUp(function(){$("#updateReceiptEmails").val("Saved")})}}function j(t){var i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return i.test(t)}$("#updateReceiptEmails").live("click",m);$("#userSettingsReceiptEmail").live("keyup",function(i){if(i.keyCode===13){m()}});$("#updateBillingInfo").live("click",function(){f.goBack(null,"",$(this))});f._panelDisplay($("#userSettingsPanelReceipts"),true)},function(){var i=$("#receiptList .overview");i.find(".receiptListItem, .receiptEmptyMsg").remove();i.append('<div class="receiptEmptyMsg">No payments found...</div>');$("#downloadAllReceipts").removeClass("active")})},showPauseBillingFirstStep:function(){$("#pauseBillingStep1").show();$("#confirmPass").val("");$("#confirmationFree").removeAttr("checked")},hidePauseBillingErrors:function(){$("#pauseBillingEntryError,#pauseBillingSystemError,#pauseBillingPasswordError,#pauseBillingSubmitError").hide()},hidePauseBillingScreens:function(){$("#pauseBillingStep1,#pauseBillingStep2").hide()},goToPauseBilling:function(){f.hidePauseBillingScreens();f.hidePauseBillingErrors();$("#submitButtonFreeUpgrade").val("Pause Billing");$("#cancelReason").val("");if(!f.isOpen){f.open(null,$("#userSettingsPanelPauseBilling"))}$("#upgradeAccountToFreeWarning").fadeIn(500);f._panelDisplay($("#userSettingsPanelPauseBilling"),true);f.showPauseBillingFirstStep()},proceedPauseBilling:function(){var j=$("#confirmPass").val();var i=$("#confirmationFree").is(":checked");var k=$("#submitButtonFreeUpgrade");k.removeAttr("disabled");k.val("Pause Billing");if(j.length<1||i===false){f.hidePauseBillingErrors();$("#pauseBillingEntryError").show();return}$("#pauseBillingStep1").hide();$("#pauseBillingSubmitError").hide();$("#pauseBillingStep2").show();$("#pauseBillingStep2").children().show()},actionBilling:function(o){if($(o.target).valid()){var m=$("#userSettingsBillingForm");b.hideErrors();b.lastSubmitButton=$("#userSettingsBillingSubmit");var l=$("#userSettingsBillingCompany").val(),k=$("#userSettingsBillingAddress").val(),n=m.find('[name="billingCountry"]').get(0),j=n.options[n.selectedIndex].value,i=$("#userSettingsBillingVAT").val();fluid.api.changeBilling({company:l,address:k,country:j,vat:i},f.actionBillingCallback,f.actionBillingCallback)}return false},actionBillingCallback:function(j,i){if(j==null){if(i!=""){b.displayError(i);return false}b.displayError();return false}var k=JSON.parse(j);if(k.t===true||k.t==="true"){account.set({billingCompany:k.billingCompany,billingCountry:k.billingCountry,billingAddress:k.billingAddress,billingVAT:k.billingVAT});f.reStart(null,"default",$("#userSettingsBillingHistory"))}else{b.displayError()}return false},goToContact:function(){if(!f.isOpen){f.open(null,$("#userSettingsPanelContact"))}var j=$("#userSettingsContactEmailContainer");var i=$("#userSettingsContactEmail");if(account.get("loggedIn")=="yes"){j.hide();i.val(account.get("email"))}else{j.show();i.val("")}$("#userSettingsContactMessage").val("");f._panelDisplay($("#userSettingsPanelContact"),true)},actionContact:function(k){b.hideErrors();var j=$("#userSettingsContactMessage").val();var i=$("#userSettingsContactEmail").val();fluid.api.contact(i,"Message from Contact Form",j,f.actionContactCallback,f.actionContactCallback)},actionContactCallback:function(){f.close();return false},goToCode:function(){$("#userSettingsCodeCode").val("");f._panelDisplay($("#userSettingsPanelCode"),true)},actionCode:function(i){b.hideErrors();f.reStart(i,"promoCode");return false},goToRemoveAccount:function(){$("#userSettingsRemoveAccountPassword").val("");f._panelDisplay($("#userSettingsPanelRemoveAccount"),true)},actionRemoveAccount:function(j){b.hideErrors();b.lastSubmitButton=$("#userSettingsRemoveAccountSubmit");var i=$.trim($("#userSettingsRemoveAccountPassword").val());fluid.api.validatePass(i,f.actionRemoveAccountPassValidated,f.actionRemoveAccountPassValidated);return false},actionRemoveAccountPassValidated:function(i){if(i==null){b.displayError();return false}var j=JSON.parse(i);if(j.t===true||j.t==="true"){f._panelDisplay($("#userSettingsPanelRemoveAccount"),false);f._panelDisplay($("#userSettingsPanelRemoveAccountConfirm"),true)}else{b.displayError("passInvalid")}return false},actionRemoveAccountConfirm:function(j){b.lastSubmitButton=$("#userSettingsRemoveAccountConfirmSubmit");var i=$("#userSettingsRemoveAccountPassword").val();fluid.api.removeAccount(account.get("id"),f.actionRemoveAccountConfirmCallback,f.actionRemoveAccountConfirmCallback);return false},actionRemoveAccountConfirmCallback:function(j,i){if(j==null){if(i!=""){b.displayError(i);return false}b.displayError();return false}var k=JSON.parse(j);if(k.t===true||k.t==="true"){account.logout();setTimeout(f.goToFeedback,500)}else{b.displayError()}return false},goToFeedback:function(i){$("#userSettingsFeedbackMessage").val("");f.actionFeedbackSetType();f._panelDisplay($("#userSettingsPanelFeedback"),true,null,false)},actionFeedback:function(l){b.hideErrors();var k=$("#userSettingsFeedbackType").val();var j=$("#userSettingsFeedbackMessage").val();var i="Feedback Message After Account removal - "+k;fluid.api.contact("",i,j,f.actionFeedbackCallback,f.actionFeedbackCallback)},actionFeedbackCallback:function(){f.close();return false},actionFeedbackSetType:function(k){var j=$("#userSettingsFeedbackOther");if(k!=undefined){j=$(k.target)}var l="";var i="";switch(j.attr("id")){case"userSettingsFeedbackFix":l=f.placeHolders.feedbackFix;i="Bug";break;case"userSettingsFeedbackNew":l=f.placeHolders.feedbackNew;i="Required Feature";break;default:l=f.placeHolders.feedbackOther;var i="Other";break}$("#userSettingsFeedbackMessage").attr("placeholder",l);$("#userSettingsFeedbackType").val(i);return false},goToHelp:function(i){window.open("/guide")},esc:function(i){if(i.target.tagName.toLowerCase()=="input"){$(i.target).blur();i.stopPropagation();return false}$(".userSettingsDone:visible").click()},showCloseButton:function(){$(".userSettingsDone").show()},hideCloseButton:function(){$(".userSettingsDone").hide()},_fixCloseButton:function(j){var m=f.startPanel==null?$("#userSettingsMain"):f.startPanel;var o=j==undefined?true:j;var k=m.is(":visible")||!o?"Close":"Back";var i=k=="Close"?"close":"back";var n=k=="Close"?f.close:f.goBack;var l=$("#userSettingsContainer .hud-button");$("#userSettingsContainer .hud-button span").text(k);l.removeClass("close back");l.addClass(i);l.attr("title",k);$(".userSettingsDone").unbind().bind("click",fluid.util.debounce(n,500))},_panelDisplay:function(k,j,m,i){if(j&&k.attr("id")==="projectSettingsPanelMain"){project.updateThumbsActiveStatus()}function l(){if(j){function n(){f._fixCloseButton(i);if($.isFunction(m)){m()}}if(k.attr("id")=="userSettingsPanelCard"){if(account.get("loggedIn")=="yes"){$(".userSettingsLogin").hide()}else{$(".userSettingsLogin").show()}}f.panelStack.push(k);b.display(k,350,n);return}b.hideSuccessMessage();b.hide(k,400,function(){m()})}if(j){f.hideCurrentPanel(l)}else{l()}},_resizeScreen:function(){if(!f.isOpen){return}b.setWorkArea();if($("#userSettingsPanelHelp").is(":visible")){setTimeout(f.goToHelp,1000);return}}};d.exports=f},{"./class-panels":16,"./class-payments":17}],27:[function(b,c,a){var d=b("./class-widget");var f=b("./class-storage");if(!Function.prototype.bind){Function.prototype.bind=function(h){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var l=Array.prototype.slice.call(arguments,1),k=this,i=function(){},j=function(){return k.apply(this instanceof i&&h?this:h,l.concat(Array.prototype.slice.call(arguments)))};i.prototype=this.prototype;j.prototype=new i();return j}}if(!window.fluid){window.fluid={}}fluid.wdgProvider=function(){var h=window.widgets?$.extend(true,{},widgets):null;return{getWidgets:function(k){var j=$.extend(true,{},h.summary);if(k){for(var i in j){if(j.hasOwnProperty(i)){j[i].originId=i}}}return j},getRootWidgets:function(l,k){var i=[];for(var j in h.summary){if(h.summary.hasOwnProperty(j)&&h.summary[j].g&&(l==undefined||h.summary[j].g.indexOf(l)!=-1)){i.push(h.summary[j]);if(k){i[i.length-1].originId=j}}}return i},getWdgGroups:function(){return $.extend(true,{},h.g)},getChildWidgets:function(j,m){var l=[];var n;var o;for(var k=0;k<j.ad.length;k++){n=j.ad[k][0];if(h&&h.summary[n]){o=$.extend(true,{},h.summary[n])}else{o=$.extend(true,{},widgets.summary[n])}if(m){o.originId=n}l.push(o)}return l},getById:function(i){if(h&&h.summary[i]){return $.extend(true,{},h.summary[i])}else{return $.extend({},widgets.summary[i])}},getChildById:function(l,k){parentChildren=k&&k.ad?k.ad:null;if(parentChildren&&parentChildren.length){for(var j=0;j<parentChildren.length;j++){if(l==parentChildren[j][0]){return parentChildren[j]}}}return false}}}();fluid.widget=function(){return{handleCollection:function(n,l,m){if(n.length==undefined){var h={};n=$.extend(true,{},n);m.unshift({});for(var k in n){if(n.hasOwnProperty(k)){m[0]=n[k];h[k]=l.apply(this,m)}}return h}else{var h=[];m.unshift({});for(var j=0;j<n.length;j++){m[0]=n[j];h.push(l.apply(this,m))}return h}},setSizeLimit:function(i,j,h){return this.handleCollection(i,function(l,m,k){if(!l.wh){l.wh=[m,k]}else{if(typeof l.wh[0]=="string"){l.wh[0]=m}if(typeof l.wh[1]=="string"){l.wh[1]=k}}return l},[j,h])},setRootSizeLimit:function(i,j,h){return this.handleCollection(i,function(l,m,k){if(!l.g){return l}if(!l.wh){l.wh=[m,k]}else{if(typeof l.wh[0]=="string"){l.wh[0]=m}if(typeof l.wh[1]=="string"){l.wh[1]=k}}return l},[j,h])},hasChildWidgets:function(h){return h.ad&&h.ad.length?true:false},hasSegments:function(h){return h.sc?true:false},isTextWidget:function(h){if(h.tc){return true}else{return false}},isShapeWidget:function(h){if(h.b||h.bg||h.bgc||h.bgd||h.i){return true}else{return false}},isUploadWidget:function(h){if(h.upload==="y"){return true}else{return false}}}}();fluid.wdgRenderer=function(h,i){this.canvasSize=[h||320,i||480];this.useCanvas=true;this.renderingQueue={};this.renditions={};this.imagesToLoad={};this.uploadsToLoad={};this.imagesLoaded={};this.canvases={};this.cropping={x:12004,y:9804,x2:0,y2:0};this.renderBlur=true;this.useOneCanvas=true;this.setCropping=function(j){if(j.x<this.cropping.x){this.cropping.x=j.x}if(j.y<this.cropping.y){this.cropping.y=j.y}if(j.x+j.width>this.cropping.x2){this.cropping.x2=j.x+j.width}if(j.y+j.height>this.cropping.y2){this.cropping.y2=j.y+j.height}};this.generateCanvas=function(k,j){this.canvas=$("<canvas>").attr({width:(j&&j.width!==undefined)?j.width:this.canvasSize[0],height:(j&&j.height!==undefined)?j.height:this.canvasSize[1]});if(k){this.canvas.attr({id:"pag-"+k})}this.canvases[k]=this.canvas;this.ctx=this.canvas.get(0).getContext("2d")};this.percentToPixel=function(l,m,j){var k;if(m.wh[0].indexOf&&m.wh[0].indexOf("%")!==-1){k=parseInt(m.wh[0],10)/100;k=k*j.box[2];l[2]=k}if(m.wh[1].indexOf&&m.wh[1].indexOf("%")!==-1){k=parseInt(m.wh[1],10)/100;k=k*j.box[3];l[3]=k}return l};this.getPixelDimensions=function(k,l,j){if(l.wh&&typeof l.wh[0]=="number"){k[2]=l.wh[0]}if(l.wh&&typeof l.wh[1]=="number"){k[3]=l.wh[1]}return k};this.parseBoxValue=function(l,k){if(typeof(l)==="number"&&!isNaN(l)){return l}else{var j=(parseFloat(l||0)/100)*(k||0);return isNaN(j)?0:j}};this.calculateBox=function(p,k,j){if(!k){k={box:[0,0,this.canvasSize[0],this.canvasSize[1]]}}var m=[0,0];var n;if(p.tlwh){m=[this.parseBoxValue(p.tlwh[1],k.box[2]),this.parseBoxValue(p.tlwh[0],k.box[3]),this.parseBoxValue(p.tlwh[2],k.box[2]),this.parseBoxValue(p.tlwh[3],k.box[3])];return m}if(!p.wh){m[2]=k.box[2];m[3]=k.box[3]}else{m=this.getPixelDimensions(m,p,k);m=this.percentToPixel(m,p,k)}if(j){if(!j[3]||j[3][1]=="l"){if(typeof j[1]=="number"){m[0]=j[1]}else{if(typeof j[1]=="string"){m[0]=(parseInt(j[1],10)/100)*k.box[2]}}}else{if(j[3][1]=="c"){var l;if(typeof j[1]=="number"){l=j[1]}else{l=(parseInt(j[1],10)/100)*k.box[2]}m[0]=(k.box[2]-m[2])/2+l}else{if(typeof j[1]=="number"){m[0]=k.box[2]-m[2]-j[1]}else{if(typeof j[1]=="string"){n=(parseInt(j[1],10)/100)*k.box[3];m[0]=k.box[2]-m[2]-n}}}}if(!j[3]||j[3][0]=="t"){if(typeof j[2]=="number"){m[1]=j[2]}else{if(typeof j[2]=="string"){m[1]=(parseInt(j[2],10)/100)*k.wh[1]}}}else{if(j[3][1]=="c"){var o;if(typeof j[2]=="number"){o=j[2]}else{o=(parseInt(j[2],10)/100)*k.box[3]}m[1]=(k.box[3]-m[3])/2+o}else{if(typeof j[2]=="number"){m[1]=k.box[3]-m[3]-j[2]}else{if(typeof j[2]=="string"){n=(parseInt(j[2],10)/100)*k.wh[1];m[1]=k.wh[1]-m[3]-n}}}}}m[0]=m[0]+k.box[0];m[1]=m[1]+k.box[1];return m};this.renderUpload=function(l,m,j){$canvas=m||this.canvas;function p(s,r){if(!l.box[2]||!l.box[3]){l.box[2]=r.width;l.box[3]=r.height}var q=s.get(0).getContext("2d");q.drawImage(r,l.box[0],l.box[1],l.box[2],l.box[3]);r.onload=null;r.onerror=null}function o(t,r,s){t.addClass("failureImage");var q=t.get(0).getContext("2d");q.font="32pt Arial";q.fillText("Image",35,50);q.fillText("not found",10,115)}function k(){o();d._convertCanvasToImg($(ctx.canvas),widgEl.find("img"),tmplVars)}function n(){var q=l.data||false;if(q&&q.substr(0,5)!="data:"){q=ajax.apiObjectUrl("img",l.data)}else{if(l.id){q=ajax.apiObjectUrl("img",l.id)}}return q||o()}if(j){p($canvas,j);return this.canvas}fluid.upload.get({id:l.data||l.id,callback:function(s,q){if(q.success){if(q.image){p.call(this,s,q.image)}else{if(q.imgData){var r=new Image();r.onload=p.bind(this,s,r);r.onerror=o.bind(this,s,r);r.src=q.imgData}}}else{var r=new Image();o.call(this,s,r)}}.bind(this,$canvas),priority:fluid.upload.priority.pageZoomedOut})};this.adjustWords=function(k){var l=[];for(var j=0;j<k.length;j++){if(k[j]!==""){l.push(k[j])}else{if(browserDetect.browser==="Firefox"){l[l.length-1]+=" "}}}return l};this.wrapText=function(A,v,m,t,q,B){if(m[3]<0){return 0}var r=v.split(" ");var C="";var j="";var z=0;var p,w;var o;var u=" ";var s=m[1];if(isNaN(t)){t=13}r=this.adjustWords(r);if(v.match(/[\u3131-\uCB4C]/)){u="";r=v.split("")}for(var k=0;k<r.length;k++){p=C+r[k]+u;w=A.measureText(p).width;if(browserDetect.browser!=="Firefox"){w=w+Math.round(-0.285714286*parseFloat(B)+0.075)}if(w>m[2]&&r.length!==1){j=r[k]+u;if(browserDetect.browser!=="Firefox"&&r[k].indexOf("-")!==-1){var l=C+r[k].substring(0,r[k].indexOf("-")+1);if(A.measureText(l).width<=m[2]){C=l;j=r[k].substring(r[k].indexOf("-")+1)+u}}if(s+t*0.5>m[1]+m[3]){return z}o=A.measureText(C).width;if(browserDetect.browser!=="Firefox"){o=o+Math.round(-0.285714286*parseFloat(B)+0.075)}if(o>m[2]&&C.indexOf(" ")===C.length-1&&browserDetect.browser!=="Firefox"){j=u+j}if(q&&q[1]==="c"){A.fillText(C,m[0]+(m[2]/2)-(o/2),s)}else{if(q&&q[1]==="r"){A.fillText(C,m[0]+m[2]-o,s)}else{A.fillText(C,m[0],s)}}C=j;s+=t;z++}else{C=p}}if(s+t*0.5>m[1]+m[3]){return z}o=A.measureText(C).width;o=o+Math.round(-0.285714286*parseFloat(B)+0.075);if(q&&q[1]==="c"){A.fillText(C,m[0]+(m[2]/2)-(o/2),s)}else{if(q&&q[1]==="r"){A.fillText(C,m[0]+m[2]-o,s)}else{A.fillText(C,m[0],s)}}return z};this.renderText=function(r,q){var F=r.ts.replace(/"/g,"");if(!this.useOneCanvas){if(this.renderingMode==="singlepage"){return $('<div class="widgetText" style="'+F+';width: 100%;height:100%;">'+r.tc+"</div>")}else{return $('<div class="widgetText" style="'+F+";width:"+(r.box[2]+3)+"px;height:"+r.box[3]+"px; top:"+r.box[1]+"px; left:"+r.box[0]+'px;">'+r.tc+"</div>")}}else{var t=0;var B=r.tc.replace(/&nbsp/g," ");var m=B.split("\n");var l;var q=q||this.canvas;var w=q.get(0).getContext("2d");var u=F.match(/font:[a-zA-Z0-9\s:\/]*;/);var k=F.match(/[0-9]+px/);if(k){k=parseInt(k[0],10)}if(u){u=u[0];u=u.replace("font:","");u=u.replace(";","")}else{var n="normal";if(F.indexOf("font-style")!==-1){n=F.substring(F.indexOf("font-style")+11,F.indexOf(";",F.indexOf("font-style"))).trim()}var p="normal";if(F.indexOf("font-variant")!==-1){p=F.substring(F.indexOf("font-variant")+13,F.indexOf(";",F.indexOf("font-variant"))).trim()}var s="normal";if(F.indexOf("font-weight")!==-1){s=F.substring(F.indexOf("font-weight")+12,F.indexOf(";",F.indexOf("font-weight"))).trim()}k=F.substring(F.indexOf("font-size")+10,F.indexOf(";",F.indexOf("font-size"))).trim();var H=F.substring(F.indexOf("font-family")+12,F.indexOf(";",F.indexOf("font-family"))).trim();l=F.substring(F.indexOf("line-height")+12,F.indexOf(";",F.indexOf("line-height"))).trim();u=n+" "+p+" "+s+" "+k+" "+H}var C=F.substring(F.indexOf("color")+6,F.indexOf(";",F.indexOf("color"))).trim();if(C.indexOf("rgb(")!==-1){C=utils.rgb2hex(C)}var o=F.indexOf(";",F.indexOf("text-align"))!==-1?F.substring(F.indexOf("text-align")+11,F.indexOf(";",F.indexOf("text-align"))).trim():F.substring(F.indexOf("text-align")+11).trim();var A="";if(F.indexOf("text-decoration")!==-1){A=F.substring(F.indexOf("text-decoration")+16,F.indexOf(";",F.indexOf("text-decoration"))).trim()}var I=0;if(F.indexOf("padding-top")!==-1){t=F.indexOf(";",F.indexOf("padding-top"));if(t!==-1){I=parseInt(F.substring(F.indexOf("padding-top")+12,t).trim(),10)}else{I=parseInt(F.substring(F.indexOf("padding-top")+12).trim(),10)}}var j=0;if(F.indexOf("margin-top")!==-1){t=F.indexOf(";",F.indexOf("margin-top"));if(t!==-1){j=parseInt(F.substring(F.indexOf("margin-top")+11,F.indexOf(";",F.indexOf("margin-top"))).trim(),10)}else{j=parseInt(F.substring(F.indexOf("margin-top")+11).trim(),10)}}w.fillStyle=C;w.font=u;w.textBaseline="top";var G=0;var v=0;if(l&&parseFloat(l)){G=Math.round(-0.07*parseFloat(k)+2.66);v=Math.round(0.5*(parseFloat(l)-parseFloat(k))-2.75);l=parseFloat(l)}else{if(u.indexOf("/")!==-1&&parseFloat(u.substring(u.indexOf("/")+1))){G=Math.round(-0.07*parseFloat(k)+2.66);l=parseFloat(u.substring(u.indexOf("/")+1))}else{l=Math.round(1.14*parseFloat(k))}}if(browserDetect.browser==="Firefox"){G=G+Math.round(0.148148148*parseFloat(k)+0.5)}var z=0;var J=[r.box[0],r.box[1]+G+v+I+j,r.box[2],r.box[3]];var D=r.ca||"lt";if(o==="center"){D=D[0]+"c"}else{if(o==="right"){D=D[0]+"r"}else{if(o==="left"){D=D[0]+"l"}}}if(m.length==1){this.wrapText(w,B,J,l,D,k)}else{for(var E=0;E<m.length;E++){z=z+this.wrapText(w,m[E],[J[0],J[1]+(E+z)*l,J[2],J[3]-(E+z)*l],l,D,k)}}return q}};this.paintCanvas=function(q,o){var u=this;if(!this.useOneCanvas){o=$("<canvas>").attr({width:this.renderingMode==="singlepage"?q.box[2]:this.canvasSize[0],height:this.renderingMode==="singlepage"?q.box[3]:this.canvasSize[1]})}else{if(!o){o=this.canvas}}var A=o.get(0).getContext("2d");var u=this;var p={blur:function(){if(q.blur){if(u.renderBlur){var F=document.createElement("img"),H=d.renderBlurLayerImmediate.call(u,q.id),D=jQuery.extend([],q.box),E,I;if(!H){return false}if(D[0]<0){D[0]=0}if(D[1]<0){D[1]=0}if(D[2]>H.width){D[2]=H.width}if(D[3]>H.height){D[3]=H.height}var G=f.get(q.id,{returnModel:true});if(G){I=G.getPage().getBox();if(D[0]+D[2]>I[2]){D[2]=I[2]-D[0]}if(D[1]+D[3]>I[3]){D[3]=I[3]-D[1]}}A.drawImage(H,D[0],D[1],D[2],D[3],D[0],D[1],D[2],D[3])}}},background:function(){A.save();function H(){var K=(q.bgc)?q.bgc:["#CAD1D7","#C4CBD3"];var M=[5,2];var L="v";if(q.bgd){L=q.bgd[0];M=[q.bgd[1],q.bgd[2]]}A.fillStyle=K[1];A.fill();A.fillStyle=K[0];if(L=="v"){for(var N=M[0];N<t;){A.fillRect(N,0,M[1],s);N+=M[0]}}else{for(var N=M[0];N<s;){A.fillRect(0,N,t,M[1]);N+=M[0]}}}if(!t){t=0}if(!s){s=0}if(q.bg=="c"){A.fillStyle=q.bgc[0];A.fill()}else{if(q.bg=="s"){H()}else{if(q.bg=="l"){var E=u.useOneCanvas?q.box[0]:0;var G=u.useOneCanvas?q.box[1]:0;var F=u.useOneCanvas?q.box[1]+q.box[3]:q.box[3];g=A.createLinearGradient(E,G,E,F);p._gradient(g,A,q)}else{if(q.bg=="lrl"){g=A.createLinearGradient(q.box[0],q.box[1],q.box[0]+q.box[2],q.box[1]);p._gradient(g,A,q)}else{if(q.bg=="ld"){g=A.createLinearGradient(q.box[0],q.box[1],q.box[0]+q.box[2],q.box[1]+q.box[3]);p._gradient(g,A,q)}else{if(q.bg=="ld2"){g=A.createLinearGradient(q.box[0]+q.box[2],q.box[1],q.box[0],q.box[1]+q.box[3]);p._gradient(g,A,q)}else{if(q.bg=="r"){var D=q.box[3]/2;var J=q.box[0]+q.box[2]/2;var I=q.box[1]+D;g=A.createRadialGradient(J,I,0,J,I,D);p._gradient(g,A,q)}}}}}}}A.restore()},border:function(I,E,F,D){var H=0,G=0;I.lineWidth=(typeof j)==="number"?j:B;I.strokeStyle=E.b[1];I.stroke();I.save()},path:function(ai,am,Q,O,M,D,H,L,P){ai.beginPath();var R=Math.floor(L/2);var ac=O+R;var ag=M+R;var ak=O+H-R;var ae=M+D-R;var Y=ae-ag;var W=ak-ac;var ab=["cloud","thumbsD","thumbsU"];if(P.sh&&P.sh[3]&&P.sh[2]){ac+=Math.floor(P.sh[3]-P.sh[2]/2);ag+=Math.floor(P.sh[3]-P.sh[2]/2);ak-=Math.floor(P.sh[3]+P.sh[2]/2);ae-=Math.floor(P.sh[3]+P.sh[2]/2)}if($.isArray(Q)){for(var ah=0;ah<4;ah++){Q[ah]=Q[ah]||0}}else{Q=[Q,Q,Q,Q]}if(am=="sq"){var aj=Math.min((ae-ag)/2,(ak-ac)/2);Q[0]=Math.min(Q[0],aj);Q[1]=Math.min(Q[1],aj);Q[2]=Math.min(Q[2],aj);Q[3]=Math.min(Q[3],aj);ai.moveTo(ag+Q[0],ac),ai.lineTo(ae-Q[1],ac),ai.quadraticCurveTo(ae,ac,ae,ac+Q[1]),ai.lineTo(ae,ak-Q[2]),ai.quadraticCurveTo(ae,ak,ae-Q[2],ak),ai.lineTo(ag+Q[3],ak),ai.quadraticCurveTo(ag,ak,ag,ak-Q[3]),ai.lineTo(ag,ac+Q[0]),ai.quadraticCurveTo(ag,ac,ag+Q[0],ac)}if(am=="arrU"){var T=(ae-ag)+(5/4);var G=(ag+ae)/2;var D=ae-ag;ai.moveTo(G,ac+L);ai.lineTo(ae-(L/2),ac+T);ai.lineTo(G+D*0.15,ac+T);ai.lineTo(G+D*0.15,ak);ai.lineTo(G-D*0.15,ak);ai.lineTo(G-D*0.15,ac+T);ai.lineTo(ag+(L/2),ac+T);ai.lineTo(G,ac+L)}if(am=="arrD"){var T=(ae-ag)+(5/4);var G=(ag+ae)/2;var D=ae-ag;var I=ak-ac;var V=(ae-ag)*1.5;if(I<=V){T=(ak-ac)/2}ai.moveTo(G,ak-L);ai.lineTo(ae-(L/2),ak-T);ai.lineTo(G+D*0.15,ak-T);ai.lineTo(G+D*0.15,ac);ai.lineTo(G-D*0.15,ac);ai.lineTo(G-D*0.15,ak-T);ai.lineTo(ag+(L/2),ak-T);ai.lineTo((ag+ae)/2,ak)}if(am=="arrR"){var T=(ak-ac)+(5/4);var F=(ac+ak)/2;var H=ak-ac;var J=ae-ag;var S=(ak-ac)*1.5;if(J<=S){T=(ae-ag)/2}ai.moveTo(ae-L,(ac+ak)/2);ai.lineTo(ae-T,ak-(L/2));ai.lineTo(ae-T,F+H*0.15);ai.lineTo(ag,F+H*0.15);ai.lineTo(ag,F-H*0.15);ai.lineTo(ae-T,F-H*0.15);ai.lineTo(ae-T,ac+(L/2));ai.lineTo(ae-L,(ac+ak)/2)}if(am=="arrL"){var T=(ak-ac)+(5/4);var F=(ac+ak)/2;var H=ak-ac;var J=ae-ag;var S=(ak-ac)*1.5;if(J<=S){T=(ae-ag)/2}ai.moveTo(ag+L,(ac+ak)/2);ai.lineTo(ag+T,ak-(L/2));ai.lineTo(ag+T,F+H*0.15);ai.lineTo(ae,F+H*0.15);ai.lineTo(ae,F-H*0.15);ai.lineTo(ag+T,F-H*0.15);ai.lineTo(ag+T,ac+(L/2));ai.lineTo(ag+L,(ac+ak)/2)}if(am=="image"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ag,ac-Math.floor(L/2));ai.moveTo(ag,ac);ai.lineTo(ae,ak);ai.moveTo(ae,ac);ai.lineTo(ag,ak)}else{if(am=="tri"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ac)}else{if(am=="tri"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ac)}else{if(am=="trR"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ag,ak);ai.lineTo(ag,ac)}else{if(am=="ttrL"){ai.moveTo(ae,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ae,ac)}else{if(am=="ttrR"){ai.moveTo(ag,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ag,ac)}else{if(am=="triU"){ai.moveTo((ag+ae)/2,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo((ag+ae)/2,ac)}else{if(am=="triD"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo((ag+ae)/2,ak);ai.lineTo(ag,ac)}else{if(am=="triR"){ai.moveTo(ag,ac);ai.lineTo(ae,(ac+ak)/2);ai.lineTo(ag,ak);ai.lineTo(ag,ac)}else{if(am=="triL"){ai.moveTo(ae,ac);ai.lineTo(ag,(ac+ak)/2);ai.lineTo(ae,ak);ai.lineTo(ae,ac)}else{if(am=="ribU"){ai.moveTo(ag,ac);ai.lineTo((ag+ae)/2,ac+(ak-ac)*0.25);ai.lineTo(ae,ac);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ag,ac)}else{if(am=="ribD"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ae,ak);ai.lineTo((ag+ae)/2,ac+0.75*(ak-ac));ai.lineTo(ag,ak);ai.lineTo(ag,ac)}else{if(am=="flagR"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ag+(4/5)*Y,(ac+ak)/2);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ag,ac)}else{if(am=="flagL"){ai.moveTo(ag,ac);ai.lineTo(ag+(1/5)*Y,(ac+ak)/2);ai.lineTo(ag,ak);ai.lineTo(ae,ak);ai.lineTo(ae,ac);ai.lineTo(ag,ac)}else{if(am=="houseU"){ai.moveTo((ag+ae)/2,ac);ai.lineTo(ae,ac+(3/7)*W);ai.lineTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ag,ac+(3/7)*W);ai.lineTo((ag+ae)/2,ac)}else{if(am=="houseD"){ai.moveTo((ag+ae)/2,ak);ai.lineTo(ae,ac+(4/7)*W);ai.lineTo(ae,ac);ai.lineTo(ag,ac);ai.lineTo(ag,ac+(4/7)*W);ai.lineTo((ag+ae)/2,ak)}else{if(am=="oct"){ai.moveTo(ag+(21/72)*Y,ac);ai.lineTo(ag+(51/72)*Y,ac);ai.lineTo(ae,ac+(21/72)*W);ai.lineTo(ae,ac+(51/72)*W);ai.lineTo(ag+(51/72)*Y,ak);ai.lineTo(ag+(21/72)*Y,ak);ai.lineTo(ag,ac+(51/72)*W);ai.lineTo(ag,ac+(21/72)*W);ai.lineTo(ag+(21/72)*Y,ac)}else{if(am=="star"){var G=(ag+ae)/2;var D=ae-ag;var H=ak-ac;ai.moveTo(G,ac);ai.lineTo(ag+(33/54)*D,ac+(39/102)*H);ai.lineTo(ae,ac+(39/102)*D);ai.lineTo(ag+(75/108)*D,ac+(63/102)*H);ai.lineTo(ag+(87/108)*D,ak);ai.lineTo(G,ac+(39/51)*H);ai.lineTo(ag+(21/108)*D,ak);ai.lineTo(ag+(33/108)*D,ac+(63/102)*H);ai.lineTo(ag,ac+(39/102)*H);ai.lineTo(ag+(21/54)*D,ac+(39/102)*H);ai.lineTo(G,ac)}else{if(am=="pgL"){ai.moveTo(ag,ak);ai.lineTo(ae,ak);ai.lineTo(ae,ac);ai.lineTo(ag+(ae-ag)/3,ac);ai.lineTo(ag,ac+(ak-ac)/4);ai.lineTo(ag,ak)}else{if(am=="pgR"){ai.moveTo(ae,ak);ai.lineTo(ag,ak);ai.lineTo(ag,ac);ai.lineTo(ag+(ae-ag)*0.66,ac);ai.lineTo(ae,ac+(ak-ac)*0.25);ai.lineTo(ae,ak)}else{if(am=="pointrL"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ag+(5/7)*Y,ac+(3/7)*W);ai.lineTo(ag+(5/7)*Y,ak);ai.lineTo(ag,ac)}else{if(am=="pointrR"){ai.moveTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ag+(2/7)*Y,ak);ai.lineTo(ag+(2/7)*Y,ac+(3/7)*W);ai.lineTo(ag,ac)}else{if(am=="ldL"){ai.moveTo(ag,ac);ai.lineTo(ag+2,ac);ai.lineTo(ae,ak);ai.lineTo(ae-2,ak);ai.lineTo(ag,ac)}else{if(am=="ldR"){ai.moveTo(ae,ac);ai.lineTo(ae-2,ac);ai.lineTo(ag,ak);ai.lineTo(ag+2,ak);ai.lineTo(ae,ac)}else{if(am=="dropD"){ai.moveTo((ag+ae)/2,ac);ai.lineTo(ag+Y/6,(ac+ak)/2);ai.bezierCurveTo(ag-(Y*(1.5/6)),ak+(W/6.2),ae+(Y*(1.5/6)),ak+(W/6.2),ag+Y*(5/6),(ac+ak)/2);ai.lineTo((ag+ae)/2,ac)}else{if(am=="dropU"){ai.moveTo((ag+ae)/2,ak);ai.lineTo(ag+Y/6,(ac+ak)/2);ai.bezierCurveTo(ag-(Y*(1.5/6)),ac-(W/6.2),ae+(Y*(1.5/6)),ac-(W/6.2),ag+Y*(5/6),(ac+ak)/2);ai.lineTo((ag+ae)/2,ak)}else{if(am=="oval"){ai.moveTo(ag,(ak+ac)/2);ai.bezierCurveTo(ag+Y*(1/4),ac-(W/7),ag+Y*(3/4),ac-(W/7),ae,(ak+ac)/2);ai.bezierCurveTo(ag+Y*(3/4),ak+(W/7),ag+Y*(1/4),ak+(W/7),ag,(ak+ac)/2)}else{if(am=="cloud"){ai.moveTo(ag+Y*(1.5/9),ak);ai.bezierCurveTo(ag,ak,ag,ac+W*(7/11),ag+Y*(1.6/9),ac+W*(7/11));ai.bezierCurveTo(ag+Y/9,ac+W/3,ag+Y/3,ac+W/6.3,ag+Y*(4/9),ac+W/3.2);ai.bezierCurveTo(ag+Y*(4.5/9),ac,ag+Y*(7.4/9),ac,ag+Y*(7.3/9),(ak+ac)/2);ai.bezierCurveTo(ae,(ak+ac)/2,ae,ak,ag+Y*(7.7/9),ak);ai.lineTo(ag+Y*(1.5/9),ak)}else{if(am=="person"){ai.moveTo(ag,ak);ai.bezierCurveTo((ag+ae)/16,(ac+ak)*(11/14),(ag+ae)*(3/16),(ac+ak)*(10/14),(ag+ae)*(6/16),(ak+ac)*(9/14));ai.bezierCurveTo((ag+ae)*(2.5/16),(ac+ak)*(4/7),(ag+ae)*(2.5/16),ac,(ag+ae)/2,ac);ai.bezierCurveTo((ag+ae)*(13.5/16),ac,(ag+ae)*(13.5/16),(ac+ak)*(4/7),(ag+ae)*(10/16),(ak+ac)*(9/14));ai.bezierCurveTo((ag+ae)*(13/16),(ac+ak)*(10/14),(ag+ae)*(15/16),(ac+ak)*(11/14),ae,ak);ai.lineTo(ag,ak)}else{if(am=="thumbsU"){ai.moveTo(ag,ac+W*(16/17));ai.lineTo(ag,ac+W*(15/34));ai.bezierCurveTo(ag+Y*(2/15),ac+W*(7/17),ag+Y*(9/30),ac+W*(4/17),ag+Y/3,ac+W*(3/34));ai.bezierCurveTo(ag+Y*(5.2/15),ac,ag+Y*(9/15),ac,ag+Y*(8.5/15),ac+W*(2/17));ai.lineTo(ag+Y*(7/15),ac+W*(11/34));ai.bezierCurveTo(ag+Y*(9/15),ac+W*(13/34),ag+Y*(11/15),ac+W*(13/34),ag+Y*(12/15),ac+W*(13/34));ai.bezierCurveTo(ae,ac+W*(13/34),ae,ac+W*(19/34),ag+Y*(12/15),ac+W*(19/34));ai.bezierCurveTo(ag+Y*(14/15),ac+W*(19/34),ag+Y*(27/30),ac+W*(12/17),ag+Y*(23/30),ac+W*(12/17));ai.bezierCurveTo(ag+Y*(13/15),ac+W*(12/17),ag+Y*(25/30),ac+W*(29/34),ag+Y*(11/15),ac+W*(29/34));ai.bezierCurveTo(ag+Y*(25/30),ac+W*(29/34),ag+Y*(12/15),ak,ag+Y*(8.5/15),ak);ai.bezierCurveTo((ag+ae)/2,ak,ag+Y/5,ak,ag,ac+W*(16/17))}else{if(am=="thumbsD"){ai.moveTo(ag,ac+W/17);ai.lineTo(ag,ac+W*(19/34));ai.bezierCurveTo(ag+Y*(2/15),ac+W*(10/17),ag+Y*(9/30),ac+W*(13/17),ag+Y/3,ac+W*(31/34));ai.bezierCurveTo(ag+Y*(5.2/15),ak,ag+Y*(9/15),ak,ag+Y*(8.5/15),ac+W*(15/17));ai.lineTo(ag+Y*(7/15),ac+W*(23/34));ai.bezierCurveTo(ag+Y*(9/15),ac+W*(21/34),ag+Y*(11/15),ac+W*(21/34),ag+Y*(12/15),ac+W*(21/34));ai.bezierCurveTo(ae,ac+W*(21/34),ae,ac+W*(15/34),ag+Y*(12/15),ac+W*(15/34));ai.bezierCurveTo(ag+Y*(14/15),ac+W*(15/34),ag+Y*(27/30),ac+W*(5/17),ag+Y*(23/30),ac+W*(5/17));ai.bezierCurveTo(ag+Y*(13/15),ac+W*(5/17),ag+Y*(25/30),ac+W*(5/34),ag+Y*(11/15),ac+W*(5/34));ai.bezierCurveTo(ag+Y*(25/30),ac+W*(5/34),ag+Y*(12/15),ac,ag+Y*(8.5/15),ac);ai.bezierCurveTo(ag+Y/2,ac,ag+Y/5,ac,ag,ac+W/17)}else{if(am=="arcL"){var D=ae-ag;var H=ak-ac;var ad=(H>=(D*2))?D:H/2;ai.moveTo(ag+ad,ac);ai.arcTo(ag,ac,ag,ac+ad,ad);ai.arcTo(ag,ac+(2*ad),ag+ad,ac+(2*ad),ad);ai.lineTo(ag+ad,ac)}else{if(am=="arcR"){var D=ae-ag;var H=ak-ac;var ad=(H>=(D*2))?D:H/2;ai.moveTo(ag,ac);ai.arcTo(ag+ad,ac,ag+ad,ac+ad,ad);ai.arcTo(ag+ad,ac+(2*ad),ag,ac+(2*ad),ad);ai.lineTo(ag,ac)}else{if(am=="arcU"){var D=ae-ag;var H=ak-ac;var ad=(D>=(H*2))?H:D/2;ai.moveTo(ag,ac+ad);ai.arcTo(ag,ac,ag+ad,ac,ad);ai.arcTo(ag+(2*ad),ac,ag+(2*ad),ac+(2*ad),ad);ai.lineTo(ag,ac+ad)}else{if(am=="arcD"){var D=ae-ag;var H=ak-ac;var ad=(D>=(H*2))?H:D/2;ai.moveTo(ag,ac);ai.arcTo(ag,ac+ad,ag+ad,ac+ad,ad);ai.arcTo(ag+(2*ad),ac+ad,ag+(2*ad),ac,ad);ai.lineTo(ag,ac)}else{if(am=="folder"){var D=ae-ag;var H=ak-ac;ai.moveTo(ag+(3/8)*D,ac+(2/15)*H);ai.lineTo(ae-Q[1],ac+(2/15)*H);ai.quadraticCurveTo(ae,ac+(2/15)*H,ae,(ac+(2/15)*H)+Q[1]);ai.lineTo(ae,ak-Q[2]);ai.quadraticCurveTo(ae,ak,ae-Q[2],ak);ai.lineTo(ag+Q[3],ak);ai.quadraticCurveTo(ag,ak,ag,ak-Q[3]);ai.lineTo(ag,ac+Q[0]);ai.quadraticCurveTo(ag,ac,ag+Q[0],ac);ai.lineTo(ag+(5/16)*D,ac);ai.lineTo(ag+(3/8)*D,ac+(2/15)*H)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(am=="speechRight"){ai.moveTo(ae-17,ak);ai.lineTo(ae-96,ak-13);ai.lineTo(ag,ak-13);ai.lineTo(ag,ac);ai.lineTo(ae,ac);ai.lineTo(ae,ak-13);ai.lineTo(ae-38,ak-13);ai.lineTo(ae-17,ak)}if(am=="speechLeft"){ai.moveTo(ag+17,ak);ai.lineTo(ag+96,ak-13);ai.lineTo(ae,ak-13);ai.lineTo(ae,ac);ai.lineTo(ag,ac);ai.lineTo(ag,ak-13);ai.lineTo(ag+38,ak-13);ai.lineTo(ag+17,ak)}else{if(am=="bubr"){right=M+D-1;bottom=O+H-2;tailSize=7;if(q.b){O=O+q.b[0]/2;M=M+q.b[0]/2;right=right-q.b[0]/2;bottom=bottom-q.b[0]/2}ai.moveTo(right-tailSize,bottom-7);ai.lineTo(right-tailSize,O+Q[1]);ai.quadraticCurveTo(right-tailSize,O,right-Q[1]-tailSize,O);ai.lineTo(M+Q[0],O);ai.quadraticCurveTo(M,O,M,O+Q[0]);ai.lineTo(M,bottom-Q[3]);ai.quadraticCurveTo(M,bottom,M+Q[3],bottom);ai.lineTo(right-19,bottom);ai.quadraticCurveTo(right-15,bottom-1,right-14,bottom-2);ai.quadraticCurveTo(right-7,bottom+1,right-1,bottom-2);ai.quadraticCurveTo(right-tailSize,bottom-3,right-tailSize,bottom-7)}else{if(am=="bubl"){right=M+D-1;bottom=O+H-2;tailSize=7;if(q.b){O=O+q.b[0]/2;M=M+q.b[0]/2;right=right-q.b[0]/2;bottom=bottom-q.b[0]/2}ai.moveTo(right,bottom-Q[2]);ai.lineTo(right,O+Q[1]);ai.quadraticCurveTo(right,O,right-Q[1],O);ai.lineTo(M+Q[0]+tailSize,O);ai.quadraticCurveTo(M+tailSize,O,M+tailSize,O+Q[0]);ai.lineTo(M+tailSize,bottom-6);ai.quadraticCurveTo(M+4,bottom-1,M+1,bottom-2);ai.quadraticCurveTo(M+2,bottom+2,M+13,bottom-2);ai.quadraticCurveTo(M+15,bottom,M+19,bottom);ai.lineTo(right-Q[2],bottom);ai.quadraticCurveTo(right,bottom,right,bottom-Q[2])}else{if(am=="arrowL"||am=="arrowR"||am=="arrowU"||am=="arrowD"){var al=2;if(P.aCurve){al=P.aCurve}var U=12;if(P.aSize){U=P.aSize}if(am=="arrowL"){ai.moveTo(ag+U,ac);ai.lineTo(ae-Q[1],ac);ai.quadraticCurveTo(ae,ac,ae,ac+Q[1]);ai.lineTo(ae,ak-Q[2]);ai.quadraticCurveTo(ae,ak,ae-Q[2],ak);ai.lineTo(ag+U,ak);ai.bezierCurveTo(ag+U-al,ak,ag,((ak+ac)/2)+al,ag,(ak+ac)/2);ai.bezierCurveTo(ag,((ak+ac)/2)-al,U-al+ag,ac,ag+U,ac)}else{if(am=="arrowR"){ai.moveTo(ag+Q[0],ac);ai.lineTo(ae-U,ac);ai.bezierCurveTo(ae-U+al,ac,ae,((ac+ak)/2)-al,ae,(ac+ak)/2);ai.bezierCurveTo(ae,((ac+ak)/2)+al,ae-U+al,ak,ae-U,ak);ai.lineTo(ag+Q[3],ak);ai.quadraticCurveTo(ag,ak,ag,ak-Q[3]);ai.lineTo(ag,ac+Q[0]);ai.quadraticCurveTo(ag,ac,ag+Q[0],ac)}else{if(am=="arrowD"){var K=(P.aW)?P.aW:K;var E=(ag+ae)/2;var af=K/2;ai.moveTo(ag+Q[0],ac);ai.lineTo(ae-Q[1],ac);ai.quadraticCurveTo(ae,ac,ae,ac+Q[1]);ai.lineTo(ae,ak-U-Q[2]);ai.quadraticCurveTo(ae,ak-U,ae-Q[2],ak-U);ai.lineTo(E+af,ak-U);ai.lineTo(E,ak);ai.lineTo(E-af,ak-U);ai.lineTo(ag+Q[3],ak-U);ai.quadraticCurveTo(ag,ak-U,ag,ak-U-Q[3]);ai.lineTo(ag,ac+Q[0]);ai.quadraticCurveTo(ag,ac,ag+Q[0],ac)}else{if(am=="arrowU"){var K=(P.aW)?P.aW:20;var E=(ag+ae)/2;var af=K/2;ai.moveTo(ag+Q[0],ac+U);ai.lineTo(E-af,ac+U);ai.lineTo(E,ac);ai.lineTo(E+af,ac+U);ai.lineTo(ae-Q[1],ac+U);ai.quadraticCurveTo(ae,ac+U,ae,ac+U+Q[1]);ai.lineTo(ae,ak-Q[2]);ai.quadraticCurveTo(ae,ak,ae-Q[2],ak);ai.lineTo(ag+Q[2],ak);ai.quadraticCurveTo(ag,ak,ag,ak-Q[3]);ai.lineTo(ag,ac+U+Q[0]);ai.quadraticCurveTo(ag,ac+U,ag+Q[3],ac+U)}}}}}else{if(am=="c"){var aa=D/2,Z=H/2,N=Math.min(aa,Z),X=Math.min(L|0,N),ad=N-X/2;j=X;ai.arc(M+aa,O+Z,ad,0,Math.PI*2,true)}}}}}ai.closePath()},_gradient:function(H,J,E){var D=["#ffffff","#000000"];var G=[0,1];if(E.bgc&&E.bgd){D=E.bgc;G=E.bgd}for(var F=0;F<D.length&&F<G.length;F++){try{H.addColorStop(G[F],D[F])}catch(I){}}J.fillStyle=H;J.fill()},_glaze:function(I,G){var M=5,J=u.useOneCanvas?2+G.box[1]:2,F=u.useOneCanvas?10+G.box[0]:10,E=G.box[2]-27,L=10,D=0,K=7;if(G.s=="bubl"){F+=K}p.path(I,"sq",M,J,F,E,L,D,G);var H=I.createLinearGradient(0,J+L,0,J);H.addColorStop(0,"rgba(231, 231, 231, 0.2)");H.addColorStop(0.59,"rgba(240, 240, 240, 0.25)");H.addColorStop(1,"rgba(249, 249, 249, 0.3)");I.fillStyle=H;I.fill();I.restore()},_shadow:function(E,D){E.shadowColor=D.sh[0];E.shadowOffsetX=D.sh[1];E.shadowOffsetY=D.sh[2];E.shadowBlur=D.sh[3]},_effect:function(P,J){var D=J.fx;for(var K=0;K<D.length;K++){var M=D[K];if(M[0]=="dots"){var T=M[1];var N=M[2];var S=M[3];P.fillStyle=M[4];var F=J.box[2];var E=J.box[3];var Q=T+N;var L=T+S;var R=parseInt(F/Q)+1;var O=parseInt(E/L)+1;var I=0;for(var H=0;H<O;H++){I=(I)?0:T;for(var G=0;G<R;G++){P.beginPath();P.arc((G*Q)+I,(H*L),T/2,0,2*Math.PI);P.closePath();P.fill()}}}}},_setImage:function(F,D){try{F.drawImage(F.canvas,0,0)}catch(E){}}};var n=this.renderingMode==="singlepage"?0:q.box[0];var r=this.renderingMode==="singlepage"?0:q.box[1];var t=q.box[2];var s=q.box[3];var B=0;var m=0;var v=q.b;var j=null;if(v){B=v[0];m=v.length>3?v.slice(2):v[2]}var l=q.s?q.s:"sq";A.save();if(!this.skipImages&&f.get(q.id)){p.blur()}p.path(A,l,m,r,n,t,s,B,q);if(q.sh){p._shadow(A,q)}if(q.bg){p.background(A,q)}A.restore();if(v&&B>0){p.border(A,q,t,s)}if(q.glaze&&q.glaze=="y"){p._glaze(A,q)}if(q.fx&&q.fx.length>0){p._effect(A,q)}if(q.i){for(var w=0;w<q.i.length;w++){var z=q.i[w];var C=new Image();function k(){var E=z[5];if(typeof(E)=="string"&&E.search("%")!=-1){E=(t*parseInt(E)/100)-z[3]/2}else{if(E<0){E=parseInt(t)+z[5]-z[3]}}var D=z[6];if(typeof(D)=="string"&&D.search("%")!=-1){D=(s*parseInt(D)/100)-z[4]/2}else{if(D<0){D=parseInt(s)+z[6]-z[4]}}if(u.imagesLoaded[z[0]]){A.drawImage(u.imagesLoaded[z[0]],z[1],z[2],q.box[2],q.box[3],E+n,D+r,q.box[2],q.box[3])}else{C.onload=function(){try{A.drawImage(C,z[1],z[2],q.box[2],q.box[3],E+n,D+r,q.box[2],q.box[3]);if(A.canvas.hasOwnProperty("onchange")){A.canvas.onchange()}}catch(F){}};C.src=z[0]}}$(C).ready(k)}}else{}if(!this.useCanvas){o=this.canvasToImg(o)}return o};this.canvasToImg=function(k){var j=k.get(0).toDataURL("image/png");return $('<img src="'+j+'">')};this.renderOne=function(k,p,m){var o={$rendition:{},childWidgets:[]};if(!k.box){k.box=this.calculateBox(k,p,m)}if(fluid.widget.isShapeWidget(k)){o.$shapeRendition=this.paintCanvas(k)}if(fluid.widget.isUploadWidget(k)){}if(fluid.widget.isTextWidget(k)){o.$textRendition=this.renderText(k)}if(fluid.widget.hasChildWidgets(k)){var n=fluid.wdgProvider.getChildWidgets(k,true);for(var l=0;l<n.length;l++){o.childWidgets.push(this.renderOne(n[l],k,k.ad[l]))}}if(fluid.widget.hasSegments(k)){o.segments=this.renderSegments(k)}if(!o.childWidgets.length){delete o.childWidgets}return o};this.renderSegments=function(k){var l=[];var j=[];for(var m=0;m<k.sc;m++){if(k.segments&&k.segments.length){l.push({wdgObj:f.get(k.segments[m].id),box:[]})}else{l.push({wdgObj:fluid.wdgProvider.getById(k.seg[m%k.seg.length]),box:[]})}}for(m=0;m<l.length;m++){if(l[m].wdgObj.wh){l[m].wdgObj.tlwh=[0,0,l[m].wdgObj.wh[0],l[m].wdgObj.wh[1]]}if(l[m].wdgObj.tlwh&&typeof(l[m].wdgObj.tlwh[2])==="number"){l[m].box[2]=l[m].wdgObj.tlwh[2]}else{if(l[m].wdgObj.tlwh){if(l[m].wdgObj.tlwh&&l[m].wdgObj.tlwh[2]==="a"){l[m].box[2]=k.box[2]/k.sc}else{if(l[m].wdgObj.tlwh[2].indexOf("%")!==-1){l[m].box[2]=(parseFloat(l[m].wdgObj.tlwh[2])/100)*k.box[2]}}}}if(l[m].wdgObj.tlwh&&typeof(l[m].wdgObj.tlwh[3])==="number"){l[m].box[3]=l[m].wdgObj.tlwh[3]}else{if(l[m].wdgObj.tlwh){if(l[m].wdgObj.tlwh&&l[m].wdgObj.tlwh[3]==="a"){l[m].box[3]=k.box[3]/k.sc}else{if(l[m].wdgObj.tlwh[3].indexOf("%")!==-1){l[m].box[3]=(parseFloat(l[m].wdgObj.tlwh[3])/100)*k.box[3]}}}}}if(k.sl=="h"){if(k.sa=="tl"||!k.sa){for(m=0;m<l.length;m++){l[m].box[0]=(m*(k.box[2]/k.sc));l[m].box[1]=0+k.sp[1]}}else{if(k.sa=="d"){for(m=0;m<l.length;m++){l[m].box[0]=(m*(k.box[2]/k.sc))+Math.max(k.box[2]/k.sc-l[m].box[2],0)/2;l[m].box[1]=(k.box?k.box[1]:0)+k.sp[1]}}}}else{for(m=0;m<l.length;m++){l[m].box[0]=k.box?k.box[0]:0;l[m].box[1]=(k.box?k.box[1]:0)+(m*l[m].box[3])}}for(m=0;m<l.length;m++){if(m===0&&l[m].wdgObj.bts){l[m].wdgObj.b=l[m].wdgObj.bts}else{if(m===l.length-1&&l[m].wdgObj.bbs){l[m].wdgObj.b=l[m].wdgObj.bbs}else{if(l[m].wdgObj.bms&&k.sl==="v"){l[m].wdgObj.b=l[m].wdgObj.bms}}}if(m===0&&l[m].wdgObj.bls){l[m].wdgObj.b=l[m].wdgObj.bls}else{if(m===l.length-1&&l[m].wdgObj.brs){l[m].wdgObj.b=l[m].wdgObj.brs}else{if(l[m].wdgObj.bms&&k.sl==="h"){l[m].wdgObj.b=l[m].wdgObj.bms}}}l[m].wdgObj.box=l[m].box;j.push(this.renderOne(l[m].wdgObj))}return j};this.renderRecursive=function(k,n){var m={};if(k.length){var j=[];for(var l=0;l<k.length;l++){this.generateCanvas(k[l].originId);m=this.renderOne(k[l],n);j.push(m)}}else{this.generateCanvas(k.originId);m=this.renderOne(k,n)}return j||m};this.onPageRenderFinish=function(m){this.renderingQueue[m]=null;if(this.afterPageRendered){var p=this.canvases[m].get(0).toDataURL("image/png");this.afterPageRendered(m,p,1,false)}else{var n=[];var l=project.get("id");var p=this.canvases[m].get(0).toDataURL("image/jpeg",0.5);var o=$("#"+m+"canvas.page-preview");var k=f.get(m);var j=f.get(m,{returnModel:true});if(!j){return}j.set({imgData:p});if(project.useLocalDb){n.push({id:m,data:p,project:l})}requestAnimationFrame(function(){if(!f.get(m)||!f.get(m).widgets||f.get(m).widgets.length===0){return}var q=$('<img class="page-preview" src="'+p+'">');var r=new Image();r.src=p;q.insertAfter(o);setTimeout(function(){o.remove()}.bind(o),650);r.onload=function(){var t=$("#scaled-"+m);var s=fluid.zoom.getAllPagesParams().newScale;t.get(0).innerHTML="";$("#scaled-"+m).append(r);t.css({top:k.y*s,left:k.x*s,width:k.width*s,height:k.height*s})}.bind(this)}.bind(this));if(project.useLocalDb){dbStorage.set("rastPages",n)}}};this.onRenderFinish=function(){if(typeof window.callPhantom==="function"){$("#canvas").css({top:(-this.cropping.y+15)+"px",left:(-this.cropping.x+15)+"px"});window.callPhantom({event:"finishedrendering",cropping:this.cropping})}else{if(!this.afterPageRendered){var k=[];var j=project.get("id");$("canvas.page-preview").each(function(){var n=$(this).parents(".screen").attr("id");var m=f.get(n);if(!m||!m.widgets||!m.widgets.length){return}var o=$(this).get(0).toDataURL("image/jpeg",0.5);var l=f.get(n,{returnModel:true});l.set({imgData:o});requestAnimationFrame(function(){var p=$('<img class="page-preview" src="'+o+'">');p.insertAfter($(this));setTimeout(function(){$(this).remove()}.bind(this),500)}.bind(this))})}}};this.countRemainingLoads=function(k){var l=0;if(k){for(var m in this.imagesToLoad[k]){l++}for(var m in this.uploadsToLoad[k]){l++}return l}else{for(var k in this.imagesToLoad){if(this.imagesToLoad.hasOwnProperty(k)){for(var j in this.imagesToLoad[k]){if(this.imagesToLoad[k].hasOwnProperty(j)){l++}}}}for(var k in this.uploadsToLoad){if(this.uploadsToLoad.hasOwnProperty(k)){for(var j in this.uploadsToLoad[k]){if(this.uploadsToLoad[k].hasOwnProperty(j)){l++}}}}return l}};this.onImgLoadErr=function(m,q,l){if(!l.src||l.src.indexOf("data/img")!==-1){if(this.imagesToLoad[m][q]){delete this.imagesToLoad[m][q]}if(this.uploadsToLoad[m][q]){delete this.uploadsToLoad[m][q]}var o=this.countRemainingLoads(m);if(o===0){for(var n=0;n<this.renderingQueue[m].length;n++){var k=this.renderingQueue[m][n];if(fluid.widget.isShapeWidget(k)){this.paintCanvas(k,this.canvases[m])}if(fluid.widget.isUploadWidget(k)){this.renderUpload(k,this.canvases[m],this.imagesLoaded[k.data])}if(fluid.widget.isTextWidget(k)){this.renderText(k,this.canvases[m])}}if(this.countRemainingLoads()===0){this.onRenderFinish()}}var j=this.countRemainingLoads();fluid.main.fire("image.loaded",{step:j,countdown:true});if(j==0){fluid.main.fire("images.loaded");this.onPageRenderFinish(m)}return}var p=new Image();p.onload=this.onImgLoad.bind(this,m,q);p.onerror=this.onImgLoadErr.bind(this,m,q);p.src="data/img/"+q};this.onImgLoad=function(l,j,p){this.imagesLoaded[j]=p;if(this.imagesToLoad[l][j]){delete this.imagesToLoad[l][j]}if(this.uploadsToLoad[l][j]){delete this.uploadsToLoad[l][j]}var m=this.countRemainingLoads(l);if(m===0){for(var o=0;o<this.renderingQueue[l].length;o++){var n=this.renderingQueue[l][o];if(fluid.widget.isShapeWidget(n)){this.paintCanvas(n,this.canvases[l])}if(fluid.widget.isUploadWidget(n)){this.renderUpload(n,this.canvases[l],this.imagesLoaded[n.data])}if(fluid.widget.isTextWidget(n)){this.renderText(n,this.canvases[l])}}this.onPageRenderFinish(l);if(this.countRemainingLoads()===0){this.onRenderFinish()}}var q=fluid.main.uploads&&fluid.main.uploads.get(j);if(q&&j.indexOf("i_")===0&&window.uploadsCache&&!window.uploadsCache[j]){if(!project.uploadCanvas||utils.isTaintedCanvas(project.uploadCanvas)){project.uploadCanvas=document.createElement("canvas")}project.uploadCanvas.width=p.naturalWidth;project.uploadCanvas.height=p.naturalHeight;project.uploadCanvasCtx=project.uploadCanvas.getContext("2d");project.uploadCanvasCtx.drawImage(evt.target,0,0);var k=project.uploadCanvas.toDataURL("image/png");if(q&&k){q.set({imgData:k})}}var r=this.countRemainingLoads();fluid.main.fire("image.loaded",{step:r,countdown:true});if(r==0){fluid.main.fire("images.loaded")}};this.pageRenderOne=function(l){var o={$rendition:{}};if(!this.skipImages){var k=this.countRemainingLoads()==0;if(!this.imagesToLoad[this.pageId]){this.imagesToLoad[this.pageId]={}}if(!this.uploadsToLoad[this.pageId]){this.uploadsToLoad[this.pageId]={}}var m=false;if(l.i&&!this.imagesToLoad[this.pageId][l.i[0][0]]){m=true}if(l.upload==="y"&&!this.uploadsToLoad[this.pageId][l.data]){m=true}if(m||this.renderingQueue[this.pageId].length>0){if(l.i&&!this.imagesToLoad[this.pageId][l.i[0][0]]){var j=new Image();this.imagesToLoad[this.pageId][l.i[0][0]]=true;j.onload=this.onImgLoad.bind(this,this.pageId,l.i[0][0],j);j.src=l.i[0][0];if(k){fluid.main.fire("images.loading")}}else{if(l.upload==="y"&&!this.uploadsToLoad[this.pageId][l.data]){var n=f.get(l.data);this.uploadsToLoad[this.pageId][l.data]=l.id;if(window.uploadsCache&&window.uploadsCache[l.data]){j.src=uploadsCache[l.data]}else{fluid.upload.get({id:l.data,callback:function(r,w,z){if(z.success){var t=new Image();t.onload=this.onImgLoad.bind(this,r,w,t);t.onerror=this.onImgLoadErr.bind(this,r,w,t);var u=atob(z.imgData.split(";base64,")[1]);var v=new Array(u.length);for(var s=0;s<u.length;s++){v[s]=u.charCodeAt(s)}var q=new Uint8Array(v);var p=new Blob([q],{type:"image/png"});t.src=URL.createObjectURL(p);if(k){fluid.main.fire("images.loading")}}else{var t=new Image();this.onImgLoadErr.call(this,r,w,t)}}.bind(this,this.pageId,l.data),priority:fluid.upload.priority.pageZoomedOut})}}}this.renderingQueue[this.pageId].push(l);o.$shapeRendition=this.canvas;return o}}if(fluid.widget.isShapeWidget(l)||l.segments){o.$shapeRendition=this.paintCanvas(l)}if(!this.skipImages&&fluid.widget.isUploadWidget(l)){o.$shapeRendition=this.renderUpload(l)}if(fluid.widget.isTextWidget(l)){o.$textRendition=this.renderText(l)}return o};this.calculatePageBox=function(j,k){return f.get(k,{returnModel:true}).getBox()};this.exceedsPage=function(k,j){if(k.box==undefined){return false}if(k.box[0]<0||k.box[1]<0){return true}if(k.box[0]+k.box[2]>j.width){return true}if(k.box[1]+k.box[3]>j.height){return true}return false};this.renderPage=function(k,j,m){if(this.renderingQueue[k.id]&&this.renditions[k.id]){return this.renditions[k.id]}else{this.renderingQueue[k.id]=[]}if(this.finishTimeout){clearTimeout(this.finishTimeout);delete this.finishTimeout}var o={};var l=[];var n=[];for(var p in k.widgets){k.widgets[p].id=p;k.widgets[p].box=this.calculatePageBox(k,p);if(!m){if(this.useOneCanvas&&this.exceedsPage(k.widgets[p],k)){n.push(p)}}}this.setCropping(k);this.generateCanvas(k.id);this.pageId=k.id;o=this.pageRenderOne({st:"b",ca:"tl",bg:"c",bgc:["#ffffff"],box:[0,0,this.canvasSize[0],this.canvasSize[1]],wg:[1],id:"dummy-bg-"+(new Date().getTime())});l.push(o);for(var p in k.widgets){if(k.widgets[p].st&&k.widgets[p].st==="b"){o=this.pageRenderOne(k.widgets[p]);o.id=p;o.lockTo=k.widgets[p].lockTo;o.box=k.widgets[p].box;l.push(o)}}for(var p in k.widgets){if((!k.widgets[p].st||k.widgets[p].st!=="b")&&!(j&&k.widgets[p].dm==="t")){o=this.pageRenderOne(k.widgets[p]);o.id=p;o.lockTo=k.widgets[p].lockTo;o.box=k.widgets[p].box;l.push(o)}}if(this.countRemainingLoads(k.id)===0){this.onPageRenderFinish(k.id)}if(this.countRemainingLoads()===0){this.finishTimeout=setTimeout(this.onRenderFinish.bind(this),200)}this.renditions[k.id]=l;return l};this.preparePage=function(l){var k=$.extend({id:l},f.get(l));k.widgets=k.widgets.reduce(function(n,m){n[m]=$.extend({},f.get(m));n[m].id=m;return n},{});for(var j in k.widgets){k.widgets[j].box=this.calculatePageBox(k,j)}return k},this.renderWdg=function(p,m){var j;var o=[0,0];m=$.extend({},m);m.widgets={};this.renderingQueue[p]=[];this.pageId=p;for(var k=0;m.ad&&k<m.ad.length;k++){j=m.ad[k][0];var l={wh:[widgets.summary[j].wh[0],widgets.summary[j].wh[1]]};(l.wh[0]=="a")&&(l.wh[0]="100%");(l.wh[1]=="a")&&(l.wh[1]="100%");l.tlwh=[m.ad[k][2],m.ad[k][1],l.wh[0],l.wh[1]];m.widgets[j]={id:j,box:this.calculateBox(l)};m.widgets[j]=$.extend(m.widgets[j],widgets.summary[j]);delete m.widgets[j].blur;o[0]=Math.max(o[0],m.widgets[j].box[0]+m.widgets[j].box[2]);o[1]=Math.max(o[1],m.widgets[j].box[1]+m.widgets[j].box[3])}var n=Math.max(o[0],o[1]);this.generateCanvas(p,{width:n,height:n});for(var k=0;m.ad&&k<m.ad.length;k++){this.renderSubWdg(m.widgets[m.ad[k][0]])}if(this.countRemainingLoads(p)===0){this.onPageRenderFinish(p)}},this.renderSubWdg=function(k){this.pageRenderOne(k);if(k.ad&&k.ad.length){var l,j;for(var m=0;m<k.ad.length;m++){l=k.ad[m][0];j=$.extend({},widgets.summary[l]);j.id=l;j.box=this.calculateBox(j,k,k.ad[m]);j.blur=false;this.renderSubWdg(j)}}else{if(k.sc){this.renderSegments(k)}}};this.renderWidgetsBelow=function(l,n,p){n=n||this.preparePage(this.pageId);var k=0,s=f.get(n.id).widgets,m=s.length,j=this.ctx;for(;k<m;k++){if(s[k]===l){break}var q=n.widgets[s[k]];if(!q.dm){if((fluid.widget.isUploadWidget(q)||q.i)&&p){var o=document.getElementById(s[k]),r=o?(o.querySelector("img")||o.querySelector("canvas")):null;if(r){j.drawImage(r,q.box[0],q.box[1],q.box[2],q.box[3])}}else{this.pageRenderOne(q)}}}if(this.countRemainingLoads(n.id)===0){this.onPageRenderFinish(n.id)}if(this.countRemainingLoads()===0){this.finishTimeout=setTimeout(this.onRenderFinish.bind(this),200)}};this.onProjectUnloaded=function(j){if(!this.canceledPreview){this.canceledPreview=[]}this.canceledPreview.push(j)};this.renderProjectPreview=function(A,r){A=$.extend({},A);if(this.currentProjectId&&A[this.currentProjectId]){return}this.previewSize={width:205,height:160};var H=$("<canvas></canvas>");var p=H.get(0).getContext("2d");this.canvas=H;var s=$('<canvas class="project-preview" width="'+this.previewSize.width+'" height="'+this.previewSize.height+'"></canvas>').css({position:"relative"});var C=s.get(0).getContext("2d");var q;var v;var k={};var G={};for(var o in A){if(A.hasOwnProperty(o)){if(o.indexOf("w_")===0||(o.indexOf("w")===0&&o.length==33)){G[o]=$.extend({},A[o])}else{if(o.indexOf("x_")===0||(o.indexOf("x")===0&&o.length==33)){k[o]=$.extend({},A[o])}else{if(o.indexOf("p_")===0||(o.indexOf("p")===0&&o.length==33)){q=$.extend({},A[o]);v=o}}}}}this.lastProjectId=v;this.currentProjectId=v;var u=q.pages;if(!u){r.call(this,v,s);this.currentProjectId=null;return}var l;var I={x:q.canvasWidth,y:q.canvasHeight,x2:0,y2:0};for(var E=0;E<u.length;E++){l=k[u[E]];if(!l){continue}if(l.x<I.x){I.x=l.x}if(l.y<I.y){I.y=l.y}if(l.x+l.width>I.x2){I.x2=l.x+l.width}if(l.y+l.height>I.y2){I.y2=l.y+l.height}}var J={x:this.previewSize.width/(I.x2-I.x),y:this.previewSize.height/(I.y2-I.y)};J.x=Math.min(J.x,J.y);J.y=Math.min(J.x,J.y);this.skipImages=true;var n=[];for(var E=0;E<u.length;E++){if(!k[u[E]]){continue}var l=$.extend({},k[u[E]]);n.push(l);if(l.widgets&&l.widgets.length>0){var F={};for(var D=0;D<l.widgets.length;D++){F[l.widgets[D]]=G[l.widgets[D]]}}l.widgets=l.widgets.length>0?F:[];l.id=u[E];this.canvasSize=[l.width||320,l.height||480];if(!this.widgetsCache){this.widgetsCache={}}if(!this.pagesCache){this.pagesCache={}}for(var o in l.widgets){if(l.widgets.hasOwnProperty(o)&&l.widgets[o]){l.widgets[o].id=o;l.widgets[o].box=this.calculatePageBox(l,o);this.widgetsCache[o]=l.id}}this.pagesCache[l.id]=l}var m=$.extend({},q.links);var B;var t;var w;for(var E=0;E<m.linkDest.length;E++){if(!this.pagesCache[m.linkDest[E]]){continue}B=this.widgetsCache[m.linkOrigin[E]];if(B===undefined){continue}t={x:this.pagesCache[B].x+this.pagesCache[B].width*0.5,y:this.pagesCache[B].y+this.pagesCache[B].height*0.5};t.x=(t.x-I.x)*J.x;t.y=(t.y-I.y)*J.y;w={x:this.pagesCache[m.linkDest[E]].x+this.pagesCache[m.linkDest[E]].width*0.5,y:this.pagesCache[m.linkDest[E]].y+this.pagesCache[m.linkDest[E]].height*0.5};w.x=(w.x-I.x)*J.x;w.y=(w.y-I.y)*J.y;C.beginPath();C.strokeStyle="#009ecc";C.moveTo(t.x,t.y);C.lineTo(w.x,w.y);C.stroke()}function z(L){l=n[L];H.attr({width:l.width,height:l.height});p.fillStyle="#ffffff";p.fillRect(0,0,l.width,l.height);this.canvasSize=[l.width||320,l.height||480];for(var N in l.widgets){if(l.widgets.hasOwnProperty(N)&&l.widgets[N]){l.widgets[N].id=N;l.widgets[N].box=this.calculatePageBox(l,N)}}C.fillStyle="#ffffff";C.fillRect((l.x-I.x)*J.x,(l.y-I.y)*J.y,l.width*J.x,l.height*J.y);var j=f.get(n[L].id,{returnModel:true});var M=j?j.get("imgData"):null;if(!j||!M){for(var N in l.widgets){if(l.widgets.hasOwnProperty(N)&&l.widgets[N]){if(l.widgets[N].st&&l.widgets[N].st==="b"){this.pageRenderOne(l.widgets[N])}}}for(var N in l.widgets){if(l.widgets.hasOwnProperty(N)&&l.widgets[N]){if(!l.widgets[N].st||l.widgets[N].st!=="b"){if(!j||!j.getBox()){page.calculateWdgPositions(l.id)}this.pageRenderOne(l.widgets[N])}}}}var K=new Image();if(!j||!M){K.src=H.get(0).toDataURL("image/jpeg")}else{K.src=M}K.onload=(function(S,Q,U,T,P,R){C.drawImage(S,Q,U,T,P);if(this.canceledPreview&&this.canceledPreview.indexOf(v)!==-1){var O=this.canceledPreview.indexOf(v);this.canceledPreview[O]=null}else{if(L<n.length-1){setTimeout(z.bind(this,L+1),100)}else{fluid.main.fire("thumbnailReady",v,s.get(0));r.call(this,v,s);this.currentProjectId=null}}}).bind(this,K,(l.x-I.x)*J.x,(l.y-I.y)*J.y,l.width*J.x,l.height*J.y,l.id)}if(n.length>0){setTimeout(z.bind(this,0),200)}else{r.call(this,v,s);this.currentProjectId=null}return s};this.flattenRenditions=function(k){if(k.length){var l=[];for(var j=0;j<k.length;j++){l.push(this.flattenRendition(k[j]))}return l}else{return[this.flattenRendition(k)]}};this.flattenRendition=function(k){var n=[];var m=k.childWidgets;var j=k.segments;n.push(k.$rendition);if(m&&m.length){for(var l=0;l<m.length;l++){n=n.concat(this.flattenRendition(m[l]))}}if(j&&j.length){for(l=0;l<j.length;l++){n=n.concat(this.flattenRendition(j[l]))}}return n}};d.getBlurBox=function(l,j,n){var m,r,p,q;q=f.get(l,{returnModel:true});if(q&&q.getPage){p=q.getPage().getBox()}else{var o=f.get(j);p=[0,0,o.width,o.height]}if(q&&q.getBox){r=q.getBox().slice(0)}else{if(l.indexOf("helper-")===0){r=[0,0,p[2],p[3]]}else{r=[0,0,1,1]}}var h=n*2;r[0]-=n;r[1]-=n;r[2]+=h;r[3]+=h;m=r;for(var k=0;k<2;k++){if(r[k]<0){m[k]=0;m[k+2]=m[k+2]+m[k]}}for(var k=2;k<=3;k++){if(r[k-2]+r[k]>p[k]){m[k]=p[k]-m[k-2]}}return m};d.renderBlurLayer=function(n,l,t,r){l=l||f.get(n,{returnModel:true}).getPage().id;var q=f.get(l),j=document.createElement("canvas"),p=j.getContext("2d"),i=(i=n.match(/^helper-(.+)/))&&i[1],o=(i?widgets.summary[i].blur:d.get(n).blur),s=d.getBlurBox(n,l,o);if(s[2]<=0||s[3]<=0){return null}var k=s[0]+s[2],m=s[1]+s[3],h=new fluid.wdgRenderer(k,m);q=h.preparePage(l);j.width=k;j.height=m;h.renderBlur=false;h.useOneCanvas=true;h.pageId=l;h.renderingQueue[l]=[];h.generateCanvas(l);h.ctx.fillStyle="white";h.ctx.fillRect(0,0,h.canvasSize[0],h.canvasSize[1]);h.afterPageRendered=function(u,w){p.drawImage(h.canvas[0],0,0);utils.blur.canvasRGB(j,s[0],s[1],s[2],s[3],o);if(t){try{return t(j.toDataURL(0,0))}catch(v){return r?r(v):v}}};h.renderWidgetsBelow(n,q,!t);p.drawImage(h.canvas[0],0,0);utils.blur.canvasRGB(j,s[0],s[1],s[2],s[3],o);return j.toDataURL()};d.renderBlurLayerImmediate=function(l,j){j=j||f.get(l,{returnModel:true}).getPage().id;var i=f.get(j),h=document.createElement("canvas"),k,n=(n=l.match(/^helper-(.+)/))&&n[1],m=(n?widgets.summary[n].blur:d.get(l).blur);h.width=i.width;h.height=i.height;k=d.getBlurBox(l,j,m);if(k[2]<=0||k[3]<=0){return null}if(this.canvases[j]){utils.blur.canvasRGB(h,k[0],k[1],k[2],k[3],m,this.canvases[j].get(0))}else{utils.blur.canvasRGB(h,k[0],k[1],k[2],k[3],m)}return h};d.setBlurBG=function(l,i,h){var j=d.blurLayers[l.id];if(j){var k=d.blurOffsets[l.id];if(!k){k=d.blurOffsets[l.id]={left:0,top:0}}if(typeof i!=="number"){i=0;h=0;k.left=parseInt(l.style.left,10);k.top=parseInt(l.style.top,10)}l.style.backgroundImage="url("+j+")";l.style.backgroundPosition=-(k.left+i)+"px "+-(k.top+h)+"px";l.style.backgroundRepeat="no-repeat"}else{l.style.backgroundImage="none"}};d.blurLayers={};d.blurOffsets={}},{"./class-storage":24,"./class-widget":28}],28:[function(b,c,a){var f=b("./class-storage");var d={editing:false,widgetOffset:null,locked:null,currSelection:null,useCanvas:false,get:function(i){var h;if(typeof widgets!=="undefined"){h=widgets.summary&&widgets.summary[i]&&$.extend(true,{id:i},widgets.summary[i])}if(h==undefined){h=f.get(i)}return h||false},set:function(i,l){var h=f.get(l,{getAll:true});if(!h){return false}for(var k in i){h[k]=i[k]}f.set(l,h)},containsText:function(l){var j,h;for(var k=0;k<l.length;k++){j=l.eq(k).attr("id");h=f.get(j,{returnModel:true}).containsText();if(h){return true}}return false},getSubTextElements:function(l){var j,i,k=[],h;h=l.id;j=f.get(h,{returnModel:true}).getSubTextElements();j.forEach(function(m){k.push(m.id)});i=$("#"+k.join(", #"));return i},getRoots:function(p,m){var o=[],l,j,k,n,h;$(p).each(function(){l=f.get(this.id,{returnModel:true});j=l.getRoot();if(j){o.push(l.getRoot().id)}else{k=l.collection.where({lockTo:l.get("lockTo")});k=_.reject(k,function(i){return !i.getParent()});for(n=0;h=k.length,n<h;n++){o.push(k[n].id)}}});o=$("#"+o.join(", #"));return o},getSegmentRoots:function(k){var j=[],i,h;$(k).each(function(){i=f.get(this.id,{returnModel:true});h=i.getSegmentRoot();if(h){j.push(h.id)}});j=$("#"+j.join(", #"));return j},getLockTos:function(j){var h=d.getRoots(j);var i=Array.prototype.reduce.call(h,function(l,k){_.forEach(document.querySelectorAll('[data-lockto="'+k.id+'"]'),function(m){if(l.indexOf(m)===-1){l.push(m)}});return l},[]);return $(i)},getSelectedOnly:function(j){function h(k){j.each(function(){if($(this).attr("data-segment")==$(this).attr("id")){if($(this).attr("data-lockto")==k){i=i.add($(this))}else{return}}})}var i=$([]);j.each(function(){if($(this).hasClass("ui-selected")){var k=d.get($(this).attr("id"));if(k.sc&&!k.bg){var l=$(this).attr("id");h(l)}else{i=i.add($(this))}}});return i},getDependentsCache:[],getDependents:function(j,p,k){var l=[],o,n=[];if(k&&d.getDependentsCache[j]){return d.getDependentsCache[j]}if(!k){d.getDependentsCache=[]}if(p){p.each(function(){n.push(f.get(this.id,{returnModel:true}))});p=n}else{p=f.get(j,{returnModel:true}).getLockTos()}for(var m=0,h=p.length;m<h;m++){if(p[m].get("of")===j){l.push(p[m].id)}}o=$("#"+l.join(", #"));d.getDependentsCache[j]=o;return o},resetCache:function(){d.getDependentsCache=[]},getAbsDimension:function(i,h){if(typeof i=="string"){if(i=="a"){return h||0}else{return(parseFloat(i||0)/100)*(h||0)}}else{return i}},getPagePos:function(i,n,k){if(!n){n={top:0,left:0}}var p=d.get(i),l=p.ca,m=(p.tlwh||p.dp).slice(),o=p.tlwh?p.tlwh.slice(2):d.wh.slice(),q=k.slice(),h=p.of&&p.of!=i;if(h){var j=d.getBoxSize(p.of);q[0]=d.getAbsDimension(j.width,k[0]);q[1]=d.getAbsDimension(j.height,k[1])}m[0]=d.getAbsDimension(m[0],q[1]);m[1]=d.getAbsDimension(m[1],q[0]);o[0]=d.getAbsDimension(o[0],q[0]);o[1]=d.getAbsDimension(o[1],q[1]);if(l[0]=="b"){m[0]=q[1]-m[0]-o[1]}else{if(l[0]=="c"){m[0]=q[1]/2+m[0]-o[1]/2}}if(l[1]=="r"){m[1]=q[0]-m[1]-o[0]}else{if(l[1]=="c"){m[1]=q[0]/2+m[1]-o[0]/2}}n.top+=m[0];n.left+=m[1];if(h){d.getPagePos(p.of,n,k)}return n},getBoxSize:function(j){var i={};var h=d.get(j),k=[h.tlwh[2],h.tlwh[3]]||h.wh;i.width=k[0];i.height=k[1];return i},saveTempFile:function(i,h){f.setTempItem(i+"_file",h)},getTempFile:function(h){return f.get(h+"_file")},removeTempFile:function(h){f.remove(h+"_file")},verticalAlign:function(j){var m=j.find(".widgetText");if(m.length==0){return}var q=parseInt(j.css("height"));var p=m.css("font-size");var h=m.css("font-family");m.contents().wrapAll("<span></span>");var l=m.find("span").eq(0);l.css("font-size",p);l.css("font-family",h);var k=parseFloat(l.css("height"));l.contents().eq(0).unwrap();var o=(parseFloat(m.css("top"))/q)*100;var i=(q-k)*o;i=(i<=0)?0:i;m.css("padding-top",i+"px");updateTLWH();var n=d.get(j.attr("id"));n.ts=m.attr("style");if(n.id){d.set(n,n.id)}},autoWidth:function(j,k){var h=[j.tlwh[2],j.tlwh[3]];var i=k!="library"?project.getActivePage().find(".widgetHolder").width():320;if(i==null&&h[0]=="a"){h[0]=320}else{if(h[0]=="a"){h[0]=i}}return h},addUploads:function(){var h=fluid.main.uploads.models;h.forEach(function(i){widgets.summary[i.id]=i.attributes})},_redraw:function(m,k,j){if(k.segment){var l=d.get(k.lockTo);var h=d._setupSegments(l);d._updateSegments(l,h,j)}var i=$(".screen.active").attr("id");var n=d._setTMPLVars(m.attr("id"),k,[0,0,parseInt(page.get(i,"width")),parseInt(page.get(i,"height"))]);d._drawCanvasOrImage(m,n)},hasOwnColorProperties:function(h){if(typeof h=="string"){h=d.get(h)}return !h.srps&&Boolean(h.bg||h.bgc)},serialize:function(k){function j(m,l){d.getDependents(m).each(function(){var n=$(this).attr("id");l[n]=f.get(n);j(n,l)})}function i(n){var m=_.clone(f.get(n));if(!m){return}var l={id:n};m.insertAfterId=$("#"+n).prev().attr("id");l[n]=m;f.set(n,m);if($("#"+n).prev().length==0){l[n].insertAfterId="first"}j(n,l);return l}var h;if($.isArray(k)){h=$.map(k,function(l){return i(l)})}else{h=i(k)}return JSON.stringify(h)},deserialize:function(k,m,l,j){function i(o){var t=o.id;var r=o[t];var q=$("#"+m);var n=q.find(".widgetHolder");var s=[0,0,n.outerWidth(),n.outerHeight()];var u=r.insertAfterId;d._save(t,r,q);d._draw(t,n,s,false,false,u);var p=l&&f.get(l);if(p&&p.seg&&"segment" in r&&r.segment==t){d._insertSegmentObj(p,t,r,j)}u=t;delete o.id;delete o[t];for(t in o){r=o[t];if(r){d._save(t,r,q);d._draw(t,n,s,false,false,u);u=t}}}if(k){var h=JSON.parse(k);if(h){if($.isArray(h)){$.each(h,function(n,o){i(o)})}else{i(h)}}}},checkIntegrity:function(k,i){var j=d.get(k);if(!j){return true}if(j.name){var h={blackSearch:"widget201010120",tablerowsliderlongblank:"widget201010120",pROGRESSBAR:"widget893",iconStatusBarDark:"widget730",iconStatusBarLight:"widget729",iconStatusBarTrans:"widget731",webLoading:"widget615",webUrlEntry:"widget613",webShortcuts:" widget614",barmapbottomwithtext:"widget910",iPHONEMENUSDARK1:"widget917",rOWCONTENTX1SELECTED:"widget926",spinner:"widget308",dIALINGPAD:"widget908",mEDIAPLAYER:"widget3071",buttonbackandnext:"widget919",switchonwithtext:"widget309",iconLibrary:"widget137",iconAdd:"widget127",iconNext:"widget133",iconRemove:"widget135",sortAlpha:"widget788",iconsorthandles:"widget789",iconAttach:"widget128",iconBack:"widget129",iconForward:"widget130",iconForward1:"widget1301293847",iconInfo:"widget131","'iconTick":"widget136",iconTick1:"widget1342343236",iconWorking:"widget132"};if(h[j.name]){d.replace(k,h[j.name])}}if(!j.tlwh){d.fixTLWH(k,j,i)}return true},load:function(i,k,o){var r=$("#"+i).find(".widgetHolder");var h=[0,0,r.outerWidth(),r.outerHeight()];if(o==true){var n=$("#"+i).find(".fixedWidgetHolderFront");var m=r}for(var l=0;l<k.length;l++){if(o==true){var q=d.get(k[l]);r=m;var p=false;if(q.st=="f"){p=staticWidgets.findPositionOnScreen($([]),k[l],o);if(p==true){r=n}}}d._draw(k[l],r,h,false,false,k[l].insertAfterId)}},fixTLWH:function(o,m,j){if(!m.wh){return false}var i=m.top.toString();var k=m.left.toString();if(i.indexOf("%")>-1){i=i.substring(0,i.indexOf("%")+1)}if(k.indexOf("%")>-1){k=k.substring(0,k.indexOf("%")+1)}if((m.lockTo!=o)&&(i.indexOf("%")==-1)){var h=d.get(m.lockTo);var n=(!h||isNaN(h.tlwh[0]))?0:h.tlwh[0];i=m.top-n}if((m.lockTo!=o)&&(k.indexOf("%")==-1)){var h=d.get(m.lockTo);var n=(!h||isNaN(h.tlwh[1]))?0:h.tlwh[1];k=m.left-n}if(i.toString().indexOf("%")==-1){i=parseFloat(i)}if(k.toString().indexOf("%")==-1){k=parseFloat(k)}if((m.wh[0]).toString().indexOf("%")==-1){m.wh[0]=parseFloat(m.wh[0])}if((m.wh[1]).toString().indexOf("%")==-1){m.wh[1]=parseFloat(m.wh[1])}if(m.st!="b"){var l=[i,k,m.wh[0],m.wh[1]];m.tlwh=l}m.ca="tl";delete m.top;delete m.left;delete m.wh;delete m.id;delete m.title;delete m.dp;delete m.x;f.set(o,m)}};c.exports=d},{"./class-storage":24}],29:[function(b,c,a){var d=b("./class-widget");d.hover=function(f){if(project.readOnly()){return false}if(!fluid.zoom.isEditMode()){return true}if(f.type==="mouseover"){d.hoverIn.call(this,f)}else{d.hoverOut.call(this,f)}};d.hoverOut=function(f){clearTimeout(d.hoverTimeout);if(d.$linksToFade){d.$linksToFade.fadeIn(100)}$(".link").removeClass("front")};d.hoverIn=function(f){d.hoverTimeout=setTimeout(d.fadeUnrelatedLinks.bind(this,f),500)};d.fadeUnrelatedLinks=function(i){var h=$(this).attr("id");var j=link.from(h);if(!j){return}var f=$(".link");d.$linksToFade=f.filter(function(){if(this.id===j){return false}else{return true}});d.$linksToFade.fadeOut(100);$("#"+j).addClass("front")};d.click=function(i){if(project.readOnly()){account.alertEditInactive();return false}var f=$(".pageWidget textarea");if(f.length===0){fluid.main.fire("widgetclicked",i)}if($(i.target).hasClass("dragging")){return}if(!$("#canvas").data("zooming")){if(fluid.zoom.getCtx()==="project"){return false}var h=$(this);if(f.length>0&&f.closest(".pageWidget").attr("id")!=h.attr("id")){d._stopEditingText()}page.hideOptionsMenu();if($("#fluidDropdown").is(":visible")){contextMenu.place();fluidMenu.hide()}}return false};d.addDefault=function(l,k,h){var i=$("#"+h);var j;if(i.length==1){var f=i.find(".widgetHolder");j=d.add(k,false,l,f);tracker.record("addWidget",1,l,null)}return j}},{"./class-widget":28}],30:[function(c,d,b){var f=c("./class-widget");var a=c("./utils");f._drawFromRoot=function(z,w,k,p,u){p=p||f.get(z);if(p.st=="g"){var v=p.ad;for(var s=0,o=v.length;s<o;s++){var t=v[s],q=t[0],A=f.get(q);f._drawFromRoot(q,w,k,A,[t[2],t[1],t[3]])}}else{var l=f._draw(z,w,k,p,u);if(p.seg&&p.sc){var j=f._setupSegments(p,k);for(var m=0,o=j.segments.length;m<o;m++){var n=j.segments[m];var h=[n.pos[0],n.pos[1],k[2],k[3]];f._drawFromRoot(n.wId,w,h,n.wObj,[l.absTLWH[0],l.absTLWH[1]])}}if(!(p.ad&&p.ad.length)){return l}for(var m=0,o=p.ad.length;m<o;m++){var q=(l.ad[m])[0];var r=(l.ad[m])[3]||"tl";var u=[(l.ad[m])[2],(l.ad[m])[1],r];var A=false;f._drawFromRoot(q,w,l.absTLWH,A,u)}}return l};f._draw=function(o,j,i,h,n,l){var h=h||f.get(o);if(!h){return false}var k=f._setTMPLVars(o,h,i,n);if(k.isHelperWidget&&k.upload&&k.upload==="y"){k.data=o}var m=$("#tmplWidget2").tmpl(k);f._drawCanvasOrImage(m,k);if(j){if(h.st=="b"){j.prepend(m)}else{if(l){if(l==="first"){j.prepend(m)}else{m.insertAfter($("#"+l))}}else{j.append(m)}}}return k};f.adjustHandlesScale=function(){var m=fluid.zoom.getCurrentScale();var n=Math.round(12/m),j=Math.round(8/m),k=Math.round(8/m),i=Math.round(7/m),l=Math.round(1/m),h=$(".ui-selected .ui-resizable-handle");l=Math.max(l,1);requestAnimationFrame(function(){h.filter(".ui-resizable-n").css({top:-j,height:n});h.filter(".ui-resizable-s").css({bottom:-j,height:n});h.filter(".ui-resizable-e").css({right:-j,width:n});h.filter(".ui-resizable-w").css({left:-j,width:n});h.filter(".ui-resizable-ne").css({top:-i,right:-i,width:k,height:k,"outline-width":l});h.filter(".ui-resizable-nw").css({top:-i,left:-i,width:k,height:k,"outline-width":l});h.filter(".ui-resizable-se").css({bottom:-i,right:-i,width:k,height:k,"outline-width":l});h.filter(".ui-resizable-sw").css({bottom:-i,left:-i,width:k,height:k,"outline-width":l});h.show()})};f._setTMPLVarsCache=[];f._setTMPLVars=function(j,o,m,q,i){if(i&&f._setTMPLVarsCache[j]){return f._setTMPLVarsCache[j]}if(!i){f._setTMPLVarsCache=[]}var l=$.extend(true,{},o);l.id=j;l.useCanvas=f.useCanvas;l.includeCanvasOrImage=(((l.b||l.bg)&&!l.srps)||l.upload||l.i)?true:false;l.isRootwidget=(j==l.lockTo)?true:false;l.isSegmentRoot=Boolean(l.seg&&l.sc);l.isLibaryWidget=(l.lockTo!=undefined)?true:false;l.of=(l.of)?l.of:l.lockTo;l.isText=(o.ts||o.tc)?true:false;l.isBackgroundWidget=(o.st=="b")?true:false;l.isStaticWidgetForeground=(o.st=="f")?true:false;if(o.ts){var n=o.ts.match(/width:\s*100\%;\s*height:\s*100%;\s*white-space:\s*pre-wrap/g);if(n&&n.length){l.addWH=false}else{l.addWH=true}var s;var p="";if(l.ts.indexOf("font-size")!==-1){s=l.ts.substring(o.ts.indexOf("font-size")+10,l.ts.indexOf(";",l.ts.indexOf("font-size"))).trim();s=parseFloat(s)}else{var k=l.ts.match(/font:[^;]*;/g);if(k.length){var r=k[0].match(/[0-9]*px/g);if(r.length){s=parseFloat(r[0])}if(r.length&&r.length>1){p=r[1]}}}if(p===""&&l.ts.indexOf("line-height")!==-1){p=l.ts.substring(l.ts.indexOf("line-height")+12,l.ts.indexOf(";",l.ts.indexOf("line-height"))).trim()}if(s&&p.indexOf("normal")!==-1){if(l.ts.indexOf("line-height")!==-1){l.ts=l.ts.replace(/line-height:\s*normal/g,"line-height: "+Math.round(s*1.14)+"px")}else{l.ts=l.ts.replace(/[0-9]*px\/[0-9]px/g,s+"px/"+Math.round(s*1.14)+"px")}}else{if(s&&p===""){l.ts=l.ts+"; line-height: "+Math.round(s*1.14)+"px;"}}}if(!l.tlwh){var h=l.wh||[m[2],m[3]];l.tlwh=[0,0,h[0],h[1]]}l.ca=(q)?q[2]||"tl":l.ca||"tl";l.absTLWH=f._getAbsTLWH(j,l,m,q);if(i){f._setTMPLVarsCache[j]=l}return l};f._getAbsTLWH=function(s,r,p,j){function m(F,G){var E=parseFloat(F);return Math.round(E*G/100)}if(!r.of||s==r.of){var q=$.extend([],p)}else{var q=$.extend([],p);var k=f.get(r.of);if(k){q=f._getAbsTLWH(r.of,k,p,false)}}var w,v;var h=Boolean(r.segment&&k&&k.sp);var D=h?k.sp[0]+k.sp[3]:0;var u=h?k.sp[1]+k.sp[2]:0;if(!r.tlwh){r.tlwh=[0,0,r.wh[0],r.wh[1]]}if((r.seg||r.segments)&&(r.tlwh[2]=="a"||r.tlwh[3]=="a")){var l=f._getSegmentRootTLWH(s,r);w=l[2];v=l[3]}else{var w=(r.tlwh[2]==="a")?"100%":r.tlwh[2];var v=(r.tlwh[3]==="a")?"100%":r.tlwh[3]}w=(typeof(w)==="string")?m(w,q[2]-D):w;v=(typeof(v)==="string")?m(v,q[3]-u):v;var C=(j)?j[0]:r.tlwh[0];var i=(j)?j[1]:r.tlwh[1];var o=(typeof(C)==="string")?m(C,q[3]-u):C;var n=(typeof(i)==="string")?m(i,q[2]-D):i;var t=r.ca||"tl";try{var B=(t[0]=="b")?q[3]-v-o:o;var A=(t[1]=="r")?q[2]-w-n:n}catch(z){var B=0;var A=0}B=(t[0]=="c")?o+q[3]/2-v/2:B;A=(t[1]=="c")?n+q[2]/2-w/2:A;B+=q[0];A+=q[1];return[Math.round(B),Math.round(A),Math.round(w),Math.round(v)]};f._drawCanvasOrImage=function(l,j){if(!j.includeCanvasOrImage){return false}var i={width:j.absTLWH[2],height:j.absTLWH[3]};var k=$("<canvas>").attr(i);var h=k[0].getContext("2d");f._paintCanvas(l,h,j);return true};f.getImageData=function(k,i){var j=storage.get(k);var h=k||false;if(h&&h.substr(0,5)!="data:"){if(i&&(!j||!j.storage||j.storage=="cloud")){h=imgCloudUrl+k+".png"}else{h=ajax.apiObjectUrl("img",k)}}else{if(tmplVars.id){if(i&&(!j||!j.storage||j.storage=="cloud")){h=imgCloudUrl+tmplVars.id+".png"}else{h=ajax.apiObjectUrl("img",tmplVars.id)}}}return h};f._drawPreviewImageUpload=function(j,h){j.get(0).innerHTML='<img class="preview-upload-image">';$imgEl=j.find("img");$imgEl.get(0).onerror=function(){if(this.src.indexOf("/data/img")===-1){this.onerror=function(){};this.src=f.getImageData(h.data,false)}};if(location.origin==="file://"){var i="";switch(h.type){case"image/svg+xml":i=".svg";break;default:i=".png";break}$imgEl.get(0).src="img/"+h.data+i}else{$imgEl.get(0).src=f.getImageData(h.data,true)}};f._drawImageUpload=function(q,k){var i={width:k.absTLWH[2],height:k.absTLWH[3]};var j=q.find("canvas");var l=j.size()>0?j:$("<canvas/>");l.attr(i);var r=l[0].getContext("2d");function n(u,t,s,w){if(!t.tlwh[2]||!t.tlwh[3]){t.tlwh[2]=this.width;t.tlwh[3]=this.height;u.css({width:t.tlwh[2],height:t.tlwh[3]});$(s.canvas).attr({width:t.tlwh[2],height:t.tlwh[3]});f.scale(u.closest(".widgetParts"),t)}if(w){var v=new Image();v.src=w;v.onload=function(){s.drawImage(v,0,0,t.tlwh[2],t.tlwh[3])}}else{s.drawImage(this,0,0,t.tlwh[2],t.tlwh[3])}}function p(t,s){if(this.src.indexOf("/data/img")===-1){var u=new Image();u.src=o(false);u.onload=n;img=u;u.onerror=function(){$(r.canvas).addClass("failureImage");r.font="32pt Arial";r.fillText("Image",35,50);r.fillText("not found",10,115)}}else{$(r.canvas).addClass("failureImage");r.font="32pt Arial";r.fillText("Image",35,50);r.fillText("not found",10,115)}this.onerror=null}function h(){if(this.src.indexOf("/data/img")===-1){delete this.crossOrigin;this.removeAttribute("crossorigin");this.src=o(false)}else{p.apply(this,arguments);f._convertCanvasToImg($(r.canvas),q.find("img"),k)}this.onerror=null}function o(t){var u=storage.get(k.data);var s=k.data||false;if(s&&s.substr(0,5)!="data:"){if(t&&(!u||!u.storage||u.storage=="cloud")){s=imgCloudUrl+k.data+".png"}else{s=ajax.apiObjectUrl("img",k.data)}}else{if(k.id){if(t&&(!u||!u.storage||u.storage=="cloud")){s=imgCloudUrl+k.id+".png"}else{s=ajax.apiObjectUrl("img",k.id)}}}return s||p()}if((j.length||q.find("img"))&&k.simpleUploadResize){return}var m=q.find("img").get(0);fluid.upload.get({id:k.data||k.id,image:m,callback:function(v,u,t,s){if(v.find("img").length===0&&s.imgData){n.call(s.image,v,u,t,s.imgData)}}.bind(this,q,k,r),priority:fluid.upload.priority.pageZoomedIn});return};f._convertCanvasToImg=function(k,j,i){function h(){var l=k[0].toDataURL("image/png");if(l!="data:,"){j.attr("src",l)}}h()};f._paintCanvas=function(A,t,m){var w={blur:function(){if(m.blur&&!((browserDetect.browser==="Chrome"||browserDetect.browser==="Safari")&&document.domain==="")){var G=A[0],C,D;if(window.g_preview||!storage.get(m.id).getPage){C=storage.get(window.g_preview||project.get("id")).pages;for(var E=0,B=C.length;E<B;E++){var F=C[E];if(storage.get(F).widgets.indexOf(m.id)!==-1){D=F;break}}D=D||document.querySelector(".canvasObject.active").id}else{D=storage.get(m.id,{returnModel:true}).getPage().id}f.renderBlurLayer(G.id,D,function(i){f.blurLayers[G.id]=i;f.setBlurBG(G)});if(f.blurLayers[G.id]){f.setBlurBG(G)}}},background:function(){t.save();function i(){var B=(m.bgc)?m.bgc:["#CAD1D7","#C4CBD3"];var D=[5,2];var C="v";if(m.bgd){C=m.bgd[0];D=[m.bgd[1],m.bgd[2]]}t.fillStyle=B[1];t.fill();t.fillStyle=B[0];if(C=="v"){for(var E=D[0];E<k;){t.fillRect(E,0,D[1],z);E+=D[0]}}else{for(var E=D[0];E<z;){t.fillRect(0,E,k,D[1]);E+=D[0]}}}if(!k){k=0}if(!z){z=0}if(m.bg=="c"){t.fillStyle=m.bgc[0];t.fill()}else{if(m.bg=="s"){i()}else{if(m.bg=="l"){g=t.createLinearGradient(0,0,0,z);w._gradient(g,t,m)}else{if(m.bg=="lrl"){g=t.createLinearGradient(0,0,k,0);w._gradient(g,t,m)}else{if(m.bg=="ld"){g=t.createLinearGradient(0,0,k,z);w._gradient(g,t,m)}else{if(m.bg=="ld2"){g=t.createLinearGradient(k,0,0,z);w._gradient(g,t,m)}else{if(m.bg=="r"){g=t.createRadialGradient(k/2,z/2,0,k/2,z/2,z/2);w._gradient(g,t,m)}}}}}}}t.restore()},border:function(F,B,C,i){var E=0,D=0;F.lineWidth=(typeof s)==="number"?s:j;F.strokeStyle=B.b[1];F.stroke();F.save()},path:function(ah,an,P,K,H,i,C,G,M){ah.beginPath();var ab=K+Math.floor(G/2);var af=H+Math.floor(G/2);var aj=K+C-Math.floor(G/2);var ad=H+i-Math.floor(G/2);if(M.sh&&M.sh[3]&&M.sh[2]){ab+=Math.floor(M.sh[3]-M.sh[2]/2);af+=Math.floor(M.sh[3]-M.sh[2]/2);aj-=Math.floor(M.sh[3]+M.sh[2]/2);ad-=Math.floor(M.sh[3]+M.sh[2]/2)}if($.isArray(P)){for(var ag=0;ag<4;ag++){P[ag]=P[ag]||0}}else{P=[P,P,P,P]}if(an=="sq"){var ai=Math.min((ad-af)/2,(aj-ab)/2);P[0]=Math.min(P[0],ai);P[1]=Math.min(P[1],ai);P[2]=Math.min(P[2],ai);P[3]=Math.min(P[3],ai);ah.moveTo(af+P[0],ab),ah.lineTo(ad-P[1],ab),ah.quadraticCurveTo(ad,ab,ad,ab+P[1]),ah.lineTo(ad,aj-P[2]),ah.quadraticCurveTo(ad,aj,ad-P[2],aj),ah.lineTo(af+P[3],aj),ah.quadraticCurveTo(af,aj,af,aj-P[3]),ah.lineTo(af,ab+P[0]),ah.quadraticCurveTo(af,ab,af+P[0],ab)}if(an=="arrU"){var S=(ad-af)+(5/4);D=aj-ab,U=(ad-af)*1.5;if(D<=U){S=(aj-ab)/2}var Z=[a.Vector((af+ad)/2,ab+G),a.Vector(ad-(G/2),ab+S),a.Vector((af+ad)*0.65,ab+S),a.Vector((af+ad)*0.65,aj),a.Vector((af+ad)*0.35,aj),a.Vector((af+ad)*0.35,ab+S),a.Vector(af+(G/2),ab+S)];a.drawVectors(ah,Z,P)}if(an=="arrD"){var S=(ad-af)+(5/4);var D=aj-ab;var U=(ad-af)*1.5;if(D<=U){S=(aj-ab)/2}var Z=[a.Vector((af+ad)/2,aj-G),a.Vector(ad-(G/2),aj-S),a.Vector((af+ad)*0.65,aj-S),a.Vector((af+ad)*0.65,ab),a.Vector((af+ad)*0.35,ab),a.Vector((af+ad)*0.35,aj-S),a.Vector(af+(G/2),aj-S),a.Vector((af+ad)/2,aj)];a.drawVectors(ah,Z,P)}if(an=="arrR"){var S=(aj-ab)+(5/4);var E=ad-af;var R=(aj-ab)*1.5;if(E<=R){S=(ad-af)/2}var Z=[a.Vector(ad-G,(ab+aj)/2),a.Vector(ad-S,aj-(G/2)),a.Vector(ad-S,(ab+aj)*0.65),a.Vector(af,(ab+aj)*0.65),a.Vector(af,(ab+aj)*0.35),a.Vector(ad-S,(ab+aj)*0.35),a.Vector(ad-S,ab+(G/2)),a.Vector(ad-G,(ab+aj)/2)];a.drawVectors(ah,Z,P)}if(an=="arrL"){var S=(aj-ab)+(5/4);var E=ad-af;var R=(aj-ab)*1.5;if(E<=R){S=(ad-af)/2}var Z=[a.Vector(af+G,(ab+aj)/2),a.Vector(af+S,aj-(G/2)),a.Vector(af+S,(ab+aj)*0.65),a.Vector(ad,(ab+aj)*0.65),a.Vector(ad,(ab+aj)*0.35),a.Vector(af+S,(ab+aj)*0.35),a.Vector(af+S,ab+(G/2)),a.Vector(af+G,(ab+aj)/2)];a.drawVectors(ah,Z,P)}if(an=="image"){ah.moveTo(af,ab);ah.lineTo(ad,ab);ah.lineTo(ad,aj);ah.lineTo(af,aj);ah.lineTo(af,ab);ah.moveTo(af,ab);ah.lineTo(af+1,ab);ah.lineTo(ad,aj-1);ah.lineTo(ad,aj);ah.lineTo(ad-1,aj);ah.lineTo(af,ab-1);ah.lineTo(af,ab);ah.moveTo(ad-1,ab);ah.lineTo(ad,ab);ah.lineTo(ad,ab-1);ah.lineTo(af+1,aj);ah.lineTo(af,aj);ah.lineTo(af,aj-1);ah.lineTo(ad-1,ab)}else{if(an=="tri"){var Z=[a.Vector(af,ab),a.Vector(ad,ab),a.Vector(ad,aj)];a.drawVectors(ah,Z,P)}else{if(an=="trR"){var Z=[a.Vector(af,ab),a.Vector(ad,ab),a.Vector(af,aj)];a.drawVectors(ah,Z,P)}else{if(an=="ttrL"){var Z=[a.Vector(ad,ab),a.Vector(ad,aj),a.Vector(af,aj)];a.drawVectors(ah,Z,P)}else{if(an=="ttrR"){var Z=[a.Vector(af,ab),a.Vector(ad,aj),a.Vector(af,aj)];a.drawVectors(ah,Z,P)}else{if(an=="triU"){var Z=[a.Vector((af+ad)/2,ab),a.Vector(ad,aj),a.Vector(af,aj)];a.drawVectors(ah,Z,P)}else{if(an=="triD"){var Z=[a.Vector(af,ab),a.Vector(ad,ab),a.Vector((af+ad)/2,aj)];a.drawVectors(ah,Z,P)}else{if(an=="triR"){var Z=[a.Vector(af,ab),a.Vector(ad,(ab+aj)/2),a.Vector(af,aj)];a.drawVectors(ah,Z,P)}else{if(an=="triL"){var Z=[a.Vector(ad,ab),a.Vector(af,(ab+aj)/2),a.Vector(ad,aj)];a.drawVectors(ah,Z,P)}else{if(an=="ribU"){ah.moveTo(af,ab);ah.lineTo((af+ad)/2,(ab+aj)/4);ah.lineTo(ad,ab);ah.lineTo(ad,aj);ah.lineTo(af,aj);ah.lineTo(af,ab)}else{if(an=="ribD"){ah.moveTo(af,ab);ah.lineTo(ad,ab);ah.lineTo(ad,aj);ah.lineTo((af+ad)/2,(3/4)*(ab+aj));ah.lineTo(af,aj);ah.lineTo(af,ab)}else{if(an=="flagR"){ah.moveTo(af,ab);ah.lineTo(ad,ab);ah.lineTo((4/5)*(af+ad),(ab+aj)/2);ah.lineTo(ad,aj);ah.lineTo(af,aj);ah.lineTo(af,ab)}else{if(an=="flagL"){ah.moveTo(af,ab);ah.lineTo((1/5)*(af+ad),(ab+aj)/2);ah.lineTo(af,aj);ah.lineTo(ad,aj);ah.lineTo(ad,ab);ah.lineTo(af,ab)}else{if(an=="houseU"){var Z=[a.Vector(ad,(3/7)*(ab+aj)),a.Vector(ad,aj),a.Vector(af,aj),a.Vector(af,(3/7)*(ab+aj)),a.Vector((af+ad)/2,ab)];a.drawVectors(ah,Z,P)}else{if(an=="houseD"){var Z=[a.Vector((af+ad)/2,aj),a.Vector(ad,(4/7)*(ab+aj)),a.Vector(ad,ab),a.Vector(af,ab),a.Vector(af,(4/7)*(ab+aj))];a.drawVectors(ah,Z,P)}else{if(an=="oct"){var al=21/72,J=51/72,O=af+ad,N=ab+aj,Z=[a.Vector(al*O,ab),a.Vector(J*O,ab),a.Vector(ad,al*N),a.Vector(ad,J*N),a.Vector(J*O,aj),a.Vector(al*O,aj),a.Vector(af,J*N),a.Vector(af,al*N)];a.drawVectors(ah,Z,P)}else{if(an=="star"){var Z=[a.Vector((af+ad)/2,ab),a.Vector((33/54)*(af+ad),(39/102)*(aj+ab)),a.Vector(ad,(39/102)*(aj+ab)),a.Vector((75/108)*(af+ad),(63/102)*(aj+ab)),a.Vector((87/108)*(af+ad),aj),a.Vector((af+ad)/2,(39/51)*(aj+ab)),a.Vector((21/108)*(af+ad),aj),a.Vector((33/108)*(af+ad),(63/102)*(aj+ab)),a.Vector(af,(39/102)*(aj+ab)),a.Vector((21/54)*(af+ad),(39/102)*(aj+ab))];a.drawVectors(ah,Z,P)}else{if(an=="pgL"){var Z=[a.Vector(af,aj),a.Vector(ad,aj),a.Vector(ad,ab),a.Vector((af+ad)/3,ab),a.Vector(af,(ab+aj)/4)];a.drawVectors(ah,Z,P)}else{if(an=="pgR"){var Z=[a.Vector(ad,aj),a.Vector(af,aj),a.Vector(af,ab),a.Vector((2/3)*(af+ad),ab),a.Vector(ad,(ab+aj)/4)];a.drawVectors(ah,Z,P)}else{if(an=="pointrL"){var Z=[a.Vector(af,ab),a.Vector(ad,ab),a.Vector((5/7)*(af+ad),(3/7)*(ab+aj)),a.Vector((5/7)*(af+ad),aj),a.Vector(af,ab)];a.drawVectors(ah,Z,P)}else{if(an=="pointrR"){var Z=[a.Vector(af,ab),a.Vector(ad,ab),a.Vector((2/7)*(af+ad),aj),a.Vector((2/7)*(af+ad),(3/7)*(ab+aj)),a.Vector(af,ab)];a.drawVectors(ah,Z,P)}else{if(an=="ldL"){ah.moveTo(af,ab);ah.lineTo(af+2,ab);ah.lineTo(ad,aj);ah.lineTo(ad-2,aj);ah.lineTo(af,ab)}else{if(an=="ldR"){ah.moveTo(ad,ab);ah.lineTo(ad-2,ab);ah.lineTo(af,aj);ah.lineTo(af+2,aj);ah.lineTo(ad,ab)}else{if(an=="dropD"){ah.moveTo((af+ad)/2,ab);ah.lineTo((af+ad)/6,(ab+aj)/2);ah.bezierCurveTo(af-((af+ad)*(1.5/6)),aj+((aj+ab)/6.2),ad+((af+ad)*(1.5/6)),aj+((aj+ab)/6.2),(af+ad)*(5/6),(ab+aj)/2);ah.lineTo((af+ad)/2,ab)}else{if(an=="dropU"){ah.moveTo((af+ad)/2,aj);ah.lineTo((af+ad)/6,(ab+aj)/2);ah.bezierCurveTo(af-((af+ad)*(1.5/6)),ab-((aj+ab)/6.2),ad+((af+ad)*(1.5/6)),ab-((aj+ab)/6.2),(af+ad)*(5/6),(ab+aj)/2);ah.lineTo((af+ad)/2,aj)}else{if(an=="oval"){ah.moveTo(af,(aj+ab)/2);ah.bezierCurveTo((af+ad)*(1/4),ab-((aj+ab)/7),(af+ad)*(3/4),ab-((aj+ab)/7),ad,(aj+ab)/2);ah.bezierCurveTo((af+ad)*(3/4),aj+((aj+ab)/7),(af+ad)*(1/4),aj+((aj+ab)/7),af,(aj+ab)/2)}else{if(an=="cloud"){ah.moveTo((af+ad)*(1.5/9),aj);ah.bezierCurveTo(af,aj,af,(ab+aj)*(7/11),(af+ad)*(1.6/9),(aj+ab)*(7/11));ah.bezierCurveTo((af+ad)/9,(aj+ab)/3,(af+ad)/3,(aj+ab)/6.3,(af+ad)*(4/9),(aj+ab)/3.2);ah.bezierCurveTo((af+ad)*(4.5/9),ab,(af+ad)*(7.4/9),ab,(af+ad)*(7.3/9),(aj+ab)/2);ah.bezierCurveTo(ad,(aj+ab)/2,ad,aj,(af+ad)*(7.7/9),aj);ah.lineTo((af+ad)*(1.5/9),aj)}else{if(an=="person"){ah.moveTo(af,aj);ah.bezierCurveTo((af+ad)/16,(ab+aj)*(11/14),(af+ad)*(3/16),(ab+aj)*(10/14),(af+ad)*(6/16),(aj+ab)*(9/14));ah.bezierCurveTo((af+ad)*(2.5/16),(ab+aj)*(4/7),(af+ad)*(2.5/16),ab,(af+ad)/2,ab);ah.bezierCurveTo((af+ad)*(13.5/16),ab,(af+ad)*(13.5/16),(ab+aj)*(4/7),(af+ad)*(10/16),(aj+ab)*(9/14));ah.bezierCurveTo((af+ad)*(13/16),(ab+aj)*(10/14),(af+ad)*(15/16),(ab+aj)*(11/14),ad,aj);ah.lineTo(af,aj)}else{if(an=="thumbsU"){ah.moveTo(af,(ab+aj)*(16/17));ah.lineTo(af,(ab+aj)*(15/34));ah.bezierCurveTo((af+ad)*(2/15),(ab+aj)*(7/17),(af+ad)*(9/30),(ab+aj)*(4/17),(af+ad)/3,(aj+ab)*(3/34));ah.bezierCurveTo((af+ad)*(5.2/15),ab,(af+ad)*(9/15),ab,(af+ad)*(8.5/15),(ab+aj)*(2/17));ah.lineTo((af+ad)*(7/15),(ab+aj)*(11/34));ah.bezierCurveTo((af+ad)*(9/15),(ab+aj)*(13/34),(af+ad)*(11/15),(ab+aj)*(13/34),(af+ad)*(12/15),(ab+aj)*(13/34));ah.bezierCurveTo(ad,(ab+aj)*(13/34),ad,(ab+aj)*(19/34),(af+ad)*(12/15),(ab+aj)*(19/34));ah.bezierCurveTo((af+ad)*(14/15),(ab+aj)*(19/34),(af+ad)*(27/30),(ab+aj)*(12/17),(af+ad)*(23/30),(ab+aj)*(12/17));ah.bezierCurveTo((af+ad)*(13/15),(ab+aj)*(12/17),(af+ad)*(25/30),(ab+aj)*(29/34),(af+ad)*(11/15),(ab+aj)*(29/34));ah.bezierCurveTo((af+ad)*(25/30),(ab+aj)*(29/34),(af+ad)*(12/15),aj,(af+ad)*(8.5/15),aj);ah.bezierCurveTo((af+ad)/2,aj,(af+ad)/5,aj,af,(ab+aj)*(16/17))}else{if(an=="thumbsD"){ah.moveTo(af,(ab+aj)/17);ah.lineTo(af,(ab+aj)*(19/34));ah.bezierCurveTo((af+ad)*(2/15),(ab+aj)*(10/17),(af+ad)*(9/30),(ab+aj)*(13/17),(af+ad)/3,(aj+ab)*(31/34));ah.bezierCurveTo((af+ad)*(5.2/15),aj,(af+ad)*(9/15),aj,(af+ad)*(8.5/15),(ab+aj)*(15/17));ah.lineTo((af+ad)*(7/15),(ab+aj)*(23/34));ah.bezierCurveTo((af+ad)*(9/15),(ab+aj)*(21/34),(af+ad)*(11/15),(ab+aj)*(21/34),(af+ad)*(12/15),(ab+aj)*(21/34));ah.bezierCurveTo(ad,(ab+aj)*(21/34),ad,(ab+aj)*(15/34),(af+ad)*(12/15),(ab+aj)*(15/34));ah.bezierCurveTo((af+ad)*(14/15),(ab+aj)*(15/34),(af+ad)*(27/30),(ab+aj)*(5/17),(af+ad)*(23/30),(ab+aj)*(5/17));ah.bezierCurveTo((af+ad)*(13/15),(ab+aj)*(5/17),(af+ad)*(25/30),(ab+aj)*(5/34),(af+ad)*(11/15),(ab+aj)*(5/34));ah.bezierCurveTo((af+ad)*(25/30),(ab+aj)*(5/34),(af+ad)*(12/15),ab,(af+ad)*(8.5/15),ab);ah.bezierCurveTo((af+ad)/2,ab,(af+ad)/5,ab,af,(ab+aj)/17)}else{if(an=="arcL"){var i=ad-af;var C=aj-ab;var ac=(C>=(i*2))?i:C/2;ah.moveTo(af+ac,ab);ah.arcTo(af,ab,af,ab+ac,ac);ah.arcTo(af,ab+(2*ac),af+ac,ab+(2*ac),ac);ah.lineTo(af+ac,ab)}else{if(an=="arcR"){var i=ad-af;var C=aj-ab;var ac=(C>=(i*2))?i:C/2;ah.moveTo(af,ab);ah.arcTo(af+ac,ab,af+ac,ab+ac,ac);ah.arcTo(af+ac,ab+(2*ac),af,ab+(2*ac),ac);ah.lineTo(af,ab)}else{if(an=="arcU"){var i=ad-af;var C=aj-ab;var ac=(i>=(C*2))?C:i/2;ah.moveTo(af,ab+ac);ah.arcTo(af,ab,af+ac,ab,ac);ah.arcTo(af+(2*ac),ab,af+(2*ac),ab+(2*ac),ac);ah.lineTo(af,ab+ac)}else{if(an=="arcD"){var i=ad-af;var C=aj-ab;var ac=(i>=(C*2))?C:i/2;ah.moveTo(af,ab);ah.arcTo(af,ab+ac,af+ac,ab+ac,ac);ah.arcTo(af+(2*ac),ab+ac,af+(2*ac),ab,ac);ah.lineTo(af,ab)}else{if(an=="folder"){var X=P[0],i=ad-ab,C=aj-ab,Q={x:(3/8)*(ad+af),y:(2/15)*(ab+aj)},L={x:(5/16)*(ad+af),y:ab},W={x:L.x+(Q.x-L.x)/2,y:ab+(Q.y-ab)/2},ak=Math.sqrt(W.x*W.x+W.y*W.y);P[1]=Math.min(X,(i-Q.x)/2,C/2);P[2]=Math.min(X,(aj-Q.y)/2,(Q.x-ab)/2);P[4]=Math.min(X,C/2,(L.x-af)/2),P[1]=P[4]=Math.min(P[1],P[4]);P[3]=Math.min(P[4],P[2]);P[0]=Math.min(X,ak,P[4]);P[5]=P[0];ah.moveTo(Q.x+P[0],Q.y);ah.lineTo(ad-P[1],Q.y);ah.quadraticCurveTo(ad,Q.y,ad,Q.y+P[1]);ah.lineTo(ad,aj-P[2]);ah.quadraticCurveTo(ad,aj,ad-P[2],aj);ah.lineTo(af+P[3],aj);ah.quadraticCurveTo(af,aj,af,aj-P[3]);ah.lineTo(af,ab+P[4]);ah.quadraticCurveTo(af,ab,af+P[4],ab);ah.lineTo(L.x-P[5],L.y);ah.quadraticCurveTo(L.x,L.y,W.x,W.y);ah.quadraticCurveTo(Q.x,Q.y,Q.x+P[0],Q.y)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(an=="speechRight"){ah.moveTo(ad-17,aj);ah.lineTo(ad-96,aj-13);ah.lineTo(af,aj-13);ah.lineTo(af,ab);ah.lineTo(ad,ab);ah.lineTo(ad,aj-13);ah.lineTo(ad-38,aj-13);ah.lineTo(ad-17,aj)}if(an=="speechLeft"){ah.moveTo(af+17,aj);ah.lineTo(af+96,aj-13);ah.lineTo(ad,aj-13);ah.lineTo(ad,ab);ah.lineTo(af,ab);ah.lineTo(af,aj-13);ah.lineTo(af+38,aj-13);ah.lineTo(af+17,aj)}else{if(an=="bubr"){right=i-1;bottom=C-2;tailSize=7;if(M.b){K=K+M.b[0]/2;H=H+M.b[0]/2;right=right-M.b[0]/2;bottom=bottom-M.b[0]/2}ah.moveTo(right-tailSize,bottom-7);ah.lineTo(right-tailSize,K+P[1]);ah.quadraticCurveTo(right-tailSize,K,right-P[1]-tailSize,K);ah.lineTo(H+P[0],K);ah.quadraticCurveTo(H,K,H,K+P[0]);ah.lineTo(H,bottom-P[3]);ah.quadraticCurveTo(H,bottom,H+P[3],bottom);ah.lineTo(right-19,bottom);ah.quadraticCurveTo(right-15,bottom-1,right-14,bottom-2);ah.quadraticCurveTo(right-7,bottom+1,right-1,bottom-2);ah.quadraticCurveTo(right-tailSize,bottom-3,right-tailSize,bottom-7)}else{if(an=="bubl"){right=i-1;bottom=C-2;tailSize=7;if(M.b){K=K+M.b[0]/2;H=H+M.b[0]/2;right=right-M.b[0]/2;bottom=bottom-M.b[0]/2}ah.moveTo(right,bottom-P[2]);ah.lineTo(right,K+P[1]);ah.quadraticCurveTo(right,K,right-P[1],K);ah.lineTo(H+P[0]+tailSize,K);ah.quadraticCurveTo(H+tailSize,K,H+tailSize,K+P[0]);ah.lineTo(H+tailSize,bottom-6);ah.quadraticCurveTo(H+4,bottom-1,H+1,bottom-2);ah.quadraticCurveTo(H+2,bottom+2,H+13,bottom-2);ah.quadraticCurveTo(H+15,bottom,H+19,bottom);ah.lineTo(right-P[2],bottom);ah.quadraticCurveTo(right,bottom,right,bottom-P[2])}else{if(an=="arrowL"||an=="arrowR"||an=="arrowU"||an=="arrowD"){var am=2;if(M.aCurve){am=M.aCurve}var T=12;if(M.aSize){T=M.aSize}if(an=="arrowL"){ah.moveTo(af+T,ab);ah.lineTo(ad-P[1],ab);ah.quadraticCurveTo(ad,ab,ad,ab+P[1]);ah.lineTo(ad,aj-P[2]);ah.quadraticCurveTo(ad,aj,ad-P[2],aj);ah.lineTo(af+T,aj);ah.bezierCurveTo(af+T-am,aj,af,((aj+ab)/2)+am,af,(aj+ab)/2);ah.bezierCurveTo(af,((aj+ab)/2)-am,T-am,ab,af+T,ab)}else{if(an=="arrowR"){ah.moveTo(af+P[0],ab);ah.lineTo(ad-T,ab);ah.bezierCurveTo(ad-T+am,ab,ad,((ab+aj)/2)-am,ad,(ab+aj)/2);ah.bezierCurveTo(ad,((ab+aj)/2)+am,ad-T+am,aj,ad-T,aj);ah.lineTo(af+P[3],aj);ah.quadraticCurveTo(af,aj,af,aj-P[3]);ah.lineTo(af,ab+P[0]);ah.quadraticCurveTo(af,ab,af+P[0],ab)}else{if(an=="arrowD"){var F=(M.aW)?M.aW:F;var B=(af+ad)/2;var ae=F/2;ah.moveTo(af+P[0],ab);ah.lineTo(ad-P[1],ab);ah.quadraticCurveTo(ad,ab,ad,ab+P[1]);ah.lineTo(ad,aj-T-P[2]);ah.quadraticCurveTo(ad,aj-T,ad-P[2],aj-T);ah.lineTo(B+ae,aj-T);ah.lineTo(B,aj);ah.lineTo(B-ae,aj-T);ah.lineTo(af+P[3],aj-T);ah.quadraticCurveTo(af,aj-T,af,aj-T-P[3]);ah.lineTo(af,ab+P[0]);ah.quadraticCurveTo(af,ab,af+P[0],ab)}else{if(an=="arrowU"){var F=(M.aW)?M.aW:20;var B=(af+ad)/2;var ae=F/2;ah.moveTo(af+P[0],ab+T);ah.lineTo(B-ae,ab+T);ah.lineTo(B,ab);ah.lineTo(B+ae,ab+T);ah.lineTo(ad-P[1],ab+T);ah.quadraticCurveTo(ad,ab+T,ad,ab+T+P[1]);ah.lineTo(ad,aj-P[2]);ah.quadraticCurveTo(ad,aj,ad-P[2],aj);ah.lineTo(af+P[2],aj);ah.quadraticCurveTo(af,aj,af,aj-P[3]);ah.lineTo(af,ab+T+P[0]);ah.quadraticCurveTo(af,ab+T,af+P[3],ab+T)}}}}}else{if(an=="c"){var aa=i/2,Y=C/2,I=Math.min(aa,Y),V=Math.min(G|0,I),ac=I-V/2;if(ac<0){ac=0}s=V;ah.arc(aa,Y,ac,0,Math.PI*2,true)}}}}}ah.closePath()},_gradient:function(F,H,D){var B=["#ffffff","#000000"];var E=[0,1];if(D.bgc&&D.bgd){B=D.bgc;E=D.bgd}for(var C=0;C<B.length&&C<E.length;C++){try{F.addColorStop(E[C],B[C])}catch(G){}}H.fillStyle=F;H.fill()},_glaze:function(F,C){var J=5,G=2,D=10,B=C.absTLWH[2]-27,I=10,i=0,H=7;if(C.s=="bubl"){D+=H}w.path(F,"sq",J,G,D,B,I,i,C);var E=F.createLinearGradient(0,G+I,0,G);E.addColorStop(0,"rgba(231, 231, 231, 0.2)");E.addColorStop(0.59,"rgba(240, 240, 240, 0.25)");E.addColorStop(1,"rgba(249, 249, 249, 0.3)");F.fillStyle=E;F.fill();F.restore()},_shadow:function(B,i){B.shadowColor=i.sh[0];B.shadowOffsetX=i.sh[1];B.shadowOffsetY=i.sh[2];B.shadowBlur=i.sh[3]},_effect:function(N,C){var B=C.fx;for(var I=0;I<B.length;I++){var K=B[I];if(K[0]=="dots"){var R=K[1];var L=K[2];var Q=K[3];N.fillStyle=K[4];var E=C.absTLWH[2];var D=C.absTLWH[3];var O=R+L;var J=R+Q;var P=parseInt(E/O)+1;var M=parseInt(D/J)+1;var H=0;for(var G=0;G<M;G++){H=(H)?0:R;for(var F=0;F<P;F++){N.beginPath();N.arc((F*O)+H,(G*J),R/2,0,2*Math.PI);N.closePath();N.fill()}}}}},_setImage:function(F,H,D){try{if(D.useCanvas){var i={width:D.absTLWH[2],height:D.absTLWH[3]};var B=F.find("canvas").attr(i);var E=B[0].getContext("2d");E.drawImage(H.canvas,0,0)}else{var C=F.find("img");f._convertCanvasToImg($(H.canvas),C,D)}}catch(G){}}};if(!A[0].classList.contains("ui-resizable-resizing")){w.blur()}if(typeof m.upload==="string"&&m.upload=="y"){if(window.g_preview){f._drawPreviewImageUpload(A,m)}else{f._drawImageUpload(A,m)}return}var v=0,n=0;var k=m.absTLWH[2];var z=m.absTLWH[3];var j=0;var l=0;var o=m.b;var s=null;if(o){j=o[0];l=o.length>3?o.slice(2):o[2]}var r=m.s?m.s:"sq";t.save();w.path(t,r,l,v,n,k,z,j,m);if(m.sh){w._shadow(t,m)}if(m.bg){w.background(t,m)}t.restore();if(o&&j>0){w.border(t,m,k,z)}if(m.glaze&&m.glaze=="y"){w._glaze(t,m)}if(m.fx&&m.fx.length>0){w._effect(t,m)}if(m.i){for(var q=0;q<m.i.length;q++){var u=m.i[q];var p=new Image();function h(){var B=u[5];if(typeof(B)=="string"&&B.search("%")!=-1){B=(k*parseInt(B)/100)-u[3]/2}else{if(B<0){B=parseInt(k)+u[5]-u[3]}}var i=u[6];if(typeof(i)=="string"&&i.search("%")!=-1){i=(z*parseInt(i)/100)-u[4]/2}else{if(i<0){i=parseInt(z)+u[6]-u[4]}}p.onload=function(){try{t.drawImage(p,u[1],u[2],u[3],u[4],B+n,i+v,u[3],u[4]);w._setImage(A,t,m);if(t.canvas.hasOwnProperty("onchange")){t.canvas.onchange()}}catch(C){}};p.src=u[0]}$(p).ready(h)}}else{w._setImage(A,t,m)}};f.scale=function(m,h){var j=10;var l;if(h.ls){l=h.ls}else{if(typeof h.wh==="undefined"){l=66/80}else{if(h.wh[0]=="a"||h.wh[1]=="a"){l=66/320}else{if(h.wh[0]=="100%"||h.wh[1]=="100%"){l=66/320}else{if(typeof(h.wh[0])==="string"||typeof(h.wh[1])==="string"){var k=parseInt(h.wh[0])/640;var i=parseInt(h.wh[1])/640;l=Math.max(k,i)}else{l=Math.min(1,66/h.wh[0],66/h.wh[1])}}}}}if(l<1){$(m).css({"-webkit-transform":"scale("+l+")","-moz-transform":"scale("+l+")"})}}},{"./class-widget":28,"./utils":60}],31:[function(b,c,a){var d=b("./class-widget");d.libraryDrag=function(h,f){d._libraryDrag(h,f,this)};d.libraryDragStart=function(h,f){if($("#pageMenu").is(":visible")){page.hideOptionsMenu()}};d.dragWidgetCreate=function(h,f){d._dragCreate(h,f,this)};d.dragWidgetStart=function(h,f){if(project.readOnly()){return false}page.hideOptionsMenu();d._dragStart(h,f,this);d.posScaleHelperInit(this)};d.dragWidget=function(h,f){d._drag(h,f,this)};d.dragWidgetStop=function(h,f){if(project.readOnly()){return false}d._dragStop(h,f,this)};d._dragSelection=null;d._originalDragPos=null;d._topDiff=null;d._leftDiff=null;d._dragCreate=function(i,f,h){if(!fluid.zoom.isEditMode()){$(h).draggable("disable")}};d.posScaleHelperInit=function(k,i){var f=-35;if(i){var j=$(k)}else{if(d._moveMultiSelection==true){var j=$("#multiSelBox")}else{if($(k).hasClass("rootWidget")){var j=$(k)}else{var h=$(k).attr("data-lockTo");var j=$("#"+h)}}}var l=$("#tmplPosHelper").tmpl().appendTo(j);l.css({"-webkit-transform":"scale("+(1/fluid.zoom.getCurrentScale())+")","-moz-transform":"scale("+(1/fluid.zoom.getCurrentScale())+")"})};d.posScaleHelperDrag=function(h,i){if(h){$("#TLindicator").show();return}if(i){var f=-35;$("#WHindicator").show()}};d.getRootsForDrag=function(i){d._activeGroup=false;var h=project.get("widgetGroups");var f=d.getRoots(i);if(h){var j=group.createSelArray(f,h);if(j.length==1&&j[0].charAt(0)=="g"){d._activeGroup=j[0]}f.each(function(){var p=$(this).attr("id");for(var n in h){var k=h[n];var o=k.indexOf(p);if(o>-1){for(var l=0;l<k.length;l++){var m=$("#"+k[l]);f=f.add(m)}}}})}return f};d._moveMultiSelection=null;d._dragStart=function(h,k,i){var i=$(i);var m=storage.get(i.attr("id"),{returnModel:true});if(m.get("blur")){m.clearBox()}var f=m.getBox();i.addClass("dragging");d.draggingFromId=i.parents(".screen").attr("id");d._originalDragPos={top:f[1]*fluid.zoom.getCurrentScale(),left:f[0]*fluid.zoom.getCurrentScale()};d._dragStartSelection=fluid.selection.getSelectedIds();i.parents(".screen").addClass("dragging-wdg-from");if(i.hasClass("ui-selected")||$("#"+i.attr("data-lockto")).hasClass("ui-selected")){i=i.add($(".ui-selected"))}var n=d.getRootsForDrag(i);d._moveMultiSelection=(n.length>1)?true:null;var j=n.map(function(){return this.id}).get();fluid.selection.select(j,{noContextMenu:true});var l=account.get("gridStatus");var o=account.get("snapToWidget");if(l=="on"||o=="on"){snap.setMovementConstant(i,k,l);if(o=="on"){grid.getPageProps();snap.selectedWidgSnapPos();snap.multiSelOffset(d._originalDragPos)}}contextMenu.place("hide");page.displayMenu(false);$("#canvasLinks").hide();d._dragSelection=$([]);$(n).not(".backgroundWidget").each(function(){var p=$('[data-lockto="'+$(this).attr("data-lockto")+'"]');d._dragSelection=d._dragSelection.add(p)});d._dragSelection.each(function(){var q=$(this);var p={top:parseInt(q.css("top")),left:parseInt(q.css("left"))};q.data("offset",p);q.addClass("ui-draggable-dragging");q.resizable("option","disabled",true)})};d.lastTime=null;d._drag=function(n,q,o){o=$(o);var p=o.data().draggable?o.data().draggable.position.top/fluid.zoom.getCurrentScale():parseInt(o.css("top"),10);var l=o.data().draggable?o.data().draggable.position.left/fluid.zoom.getCurrentScale():parseInt(o.css("left"),10);var t=account.get("snapToWidget");if(t=="on"){snap.snapToWidgEdges(o,p,l)}var r=account.get("gridStatus");if(r=="on"){snap.widgetSnapToGrid(o,p,l)}function s(){var u=$(this).data("offset");$(this).css({top:u.top+k/fluid.zoom.getCurrentScale()+"px",left:u.left+m/fluid.zoom.getCurrentScale()+"px"})}var k=(q.position.top-d._originalDragPos.top);var m=(q.position.left-d._originalDragPos.left);var j=(d._dragSelection).not(o);$.each(j,s);updateTLWH();var h=true;d.posScaleHelperDrag(h);intersectTrash(o,n);var f=document.querySelectorAll(".pageWidget.ui-selected"),i=((i=document.querySelector(".canvasObject.active"))&&i.id);_.forEach(f,function(v){var u=v.id;if(storage.get(u).blur){d.blurLayers[u]=d.blurLayers[u]||d.renderBlurLayer(u,i.id);d.setBlurBG(v,q.position.left-q.originalPosition.left,q.position.top-q.originalPosition.top)}})};d._dragStop=function(i,k,j){snap.removeAlignGuides();if(intersectTrash(j,i)){d.del(".ui-selected");$("#trash").removeClass("droppableStyle");d._dragSelection=null;return}function m(){var p=$(this);p.removeClass("rememberSelected");(d._moveMultiSelection==true)?p.resizable("option","disabled",true):p.resizable("option","disabled",false)}var l=fluid.selection.getSelectedEls();var o=fluid.selection.getSelectionModel().getRoots().getElements();var n=getHoverPageParams(i).pageId?getHoverPageParams(i).pageId:d.draggingFromId;var h=0,f=0;if(n!==d.draggingFromId){h=page.get(n,"x")-page.get(d.draggingFromId,"x");f=page.get(n,"y")-page.get(d.draggingFromId,"y")}$("#"+d.draggingFromId).removeClass("dragging-wdg-from");fluid.command.create("move",{id:fluid.selection.getSelectionModel().getRoots().getIds(),fromPage:d.draggingFromId,toPage:n,posFixX:h,posFixY:f,clientX:i.clientX,clientY:i.clientY}).dispatchTo("fluid.controllers.widget");group.select(o);d.draggingFromId=null;d._dragSelection.removeClass("ui-draggable-dragging");if(d._dragStartSelection.length){$.each(d._dragSelection,m)}$("#widgPosDragHelper").remove();$("#canvasLinks").fadeIn(200);if(d._dragStartSelection.length){contextMenu.place()}else{page.displayMenu();$(".ui-selected").removeClass("ui-selected")}d._dragSelection=null;setTimeout(function(){$(j).removeClass("dragging")},100)};d._savePosition=function(h){function f(j,k){var l=$(k).attr("id");var m=d.get(l);var i=$.extend([],m.tlwh);i[0]=parseInt($(k).css("top"));i[1]=parseInt($(k).css("left"));d.set({tlwh:i},l)}$.each(h,f)};d._libraryDrag=function(i,f,h){h=$(h);var j=0.9/(fluid.zoom.getCurrentScale()*fluid.zoom.getCurrentScale());h.data().draggable.position.top+=-3+j;h.data().draggable.position.left+=-3+j;if(h.parents("#uploadTabs").length==1||h.hasClass("userWidget")){intersectTrash($(f.helper),i)}};d.onWidgetAdded=function(j,h,i){var f=getHoverPageParams(j);if(f){fluid.command.create("create",{widgetId:$(h.helper[0]).attr("data-widget-id")||h.helper[0].id,pageId:f.pageId,offsetX:f.offsetX,offsetY:f.offsetY}).dispatchTo("fluid.controllers.widget");fluid.main.fire("uiWidgetAdded")}};d.moveTo=function(i,f){var h=d.get(i);d._moveBy(i,h,[f[0]-h.tlwh[0],f[1]-h.tlwh[1]])};d._moveBy=function(j,i,f,h){$('[data-lockto="'+j+'"]').css({top:"+="+f[0],left:"+="+f[1]});link.update($("#"+j).parent(".screen"));if(!(h&&h.debounce)){i.tlwh[0]+=f[0];i.tlwh[1]+=f[1];d.set({tlwh:i.tlwh.splice(0)},j)}else{if(!d.adjustWdgPosDebounced){d.adjustWdgPosDebounced=_.debounce(d.adjustWdgPos,500)}d.adjustWdgPosDebounced(j)}};d.adjustWdgPos=function(j){var f=fluid.selection.getSelectionModel().getRoots().getElements(),h=[],i=[];f.each(function(){var k=$(this),l;l=d.get(k.attr("id"));i.push([parseInt(k.css("top")),parseInt(k.css("left"))]);h.push([l.tlwh[0],l.tlwh[1]])});fluid.command.create("move",{id:fluid.selection.getSelectionModel().getRoots().getIds(),fromPage:storage.get(j,{returnModel:true}).getPage().id,toPage:storage.get(j,{returnModel:true}).getPage().id,fromPos:h,toPos:i,skipViewAdjustment:true}).dispatchTo("fluid.controllers.widget")};d.nudge=function(f){return d._nudge(f)};d._nudge=function(k){var i=k.keyCode;var m=(k.shiftKey||k.ctrlKey)?10:1;storage.cacheStart();var l=fluid.selection.getSelectionModel().filter(function(n){if(n.get("st")==="b"){return false}return true});var h=new fluid.Widgets();h.add(l);var j=h.getElements();var f=h.getRoots().getElements();if(j.children("textarea").length>0){return false}f.each(function(){var o=$(this).attr("id");var n=[0,0];switch(i){case"left":case 37:n[1]=-m;break;case"up":case 38:n[0]=-m;break;case"right":case 39:n[1]=+m;break;case"down":case 40:n[0]=+m;break}d._moveBy(o,d.get(o),n,{debounce:true})});updateTLWH()}},{"./class-widget":28}],32:[function(c,d,b){var f=c("../fluid.controller");c("../models/bin");c("../views/bin");var a=f.define("bin",function(k){var m={project:window.project,account:window.account,lib:window.lib,storage:window.storage,ajax:window.ajax,widgets:window.widgets};var n="bin";var p=new fluid.models.bin();var l=new fluid.views.bin();k.init=function(){p.bind("change",l.update,l).trigger("change");fluid.main.on("closeallpopups",function(q,s,r){if(!r){var r=$([]);if($(s.target).closest("#trashContents").length>0){r=r.add("#trashContents")}}if(!$("#trashContents").is(r)){fluid.controllers.bin.close()}})};k.open=function(){l.open()};k.close=function(){l.close()};k.clear=function(){p.clear();p.store(n)};k.isEmpty=function(){return p.items.length==0};k.hide=function(){l.hide()};k.show=function(){l.show()};k.hideEmpty=function(){if(this.isEmpty()){this.hide()}};k.showNonEmpty=function(){if(!this.isEmpty()){this.show()}};k.getItems=function(){var t=p.items,s={};for(var r=0,q=t.length;r<q;r++){s[t[r].obj.id]=t[r].obj.root}return s};function j(q){if(q){p.add({obj:q,ts:new Date().valueOf()});p.store(n);k.show()}}function h(q){q=JSON.parse(q);var s=o(q.id);if(s){var r=fluid.main.projects.get(q.id);r.set(s.obj);r.unset("removed");m.account.addProjectId(q.id);m.project.load();p.remove(s);p.store(n)}if(p.items.length==0){l.close()}}function i(r){var s=o(r.id);if(s){s.obj.upload.removed=0;m.storage.set(r.id,s.obj.upload);var q=m.account.get("uploads");q.splice(s.obj.index,0,{id:r.id,s:true});m.account.set({uploads:q});m.lib.draw("Uploads");p.remove(s);p.store(n,p)}if(p.items.length==0){l.close()}}function o(t){var s;for(var r=0,q=p.items.length;r<q;r++){if(p.items[r].obj.id==t){s=p.items[r];break}}return s}this.handleCommand("drop",function(q){var t=q.id.charAt(0);var r;switch(t){case"w":return;case"c":q.libId=fluid.controllers.widget.findLib(q.id);q.widgets=fluid.controllers.widget.deleteFromLib(q.id,q.libId);r={root:q.widgets[q.id],id:q.id,libId:q.libId,subs:{},thumb:q.thumb};for(var s in q.widgets){if(s!=q.id){r.subs[s]=q.widgets[s]}}j(r);return;case"x":return;case"p":m.project.del(q.id,function(u){u.id=q.id;j(u);fluid.main.trigger("projectRemoved")});break;case"i":m.account.removeUpload(q.id,function(u){u.id=q.id;j(u)});break;default:throw"Unexpected object id: "+q.id}});this.handleCommand("restore",function(s){var z=s.id.charAt(0);var w;switch(z){case"p":var v=parseInt(fluid.main.account.get("maxActiveProjects"),10);var u=fluid.main.projects.filter(function(A){return !A.get("removed")}).length;if(v!==0&&u>=v){notification.add("alert",account.alerts.projectLimitHit.onAddActive,{scope:"projectLimit",stopBuggingCallBack:function(){}});return}fluid.api.restore(s.id,h);break;case"i":ajax.apiCall("img/bin","post",s.id,{restore:true},i);break;case"c":for(var r=0,q=p.items.length;r<q;r++){if(p.items[r].obj.id==s.id){w=p.items[r];break}}if(w){var t=w.obj.subs;t[w.obj.id]=w.obj.root;p.remove(w);fluid.controllers.widget.restoreToLib(t,w.obj.libId);p.store(n);if(p.items.length==0){l.close()}}break;default:throw"Unexpected object id: "+s.id}});this.handleCommand("toggle",function(q){if(l.isOpen||p.items.length>0){l.toggle()}})});d.exports=a},{"../fluid.controller":35,"../models/bin":48,"../views/bin":57}],33:[function(c,a,f){var l=c("./lib/underscore");var h=[];var j=h.push;var k=h.slice;var d=h.splice;fluid.Collection=function(n,m){fluid.event.mixinTo(this);m||(m={});if(m.model){this.model=m.model}if(m.comparator!==void 0){this.comparator=m.comparator}this._reset();this.initialize.apply(this,arguments);if(n){this.reset(n,l.extend({silent:true},m))}this.afterInit.apply(this,arguments)};fluid.Collection.prototype.setOptions={add:true,remove:true,merge:false};fluid.Collection.prototype.addOptions={add:true,remove:false};fluid.Collection.prototype.afterInit=function(){};fluid.Collection.prototype.add=function(n,m){return this.set(n,l.extend({merge:false},m,this.addOptions))};fluid.Collection.prototype.set=function(D,n){n=l.defaults({},n,this.setOptions);if(n.parse){D=this.parse(D,n)}if(!l.isArray(D)){D=D?[D]:[]}var A,w,o,u,s,C;var q=n.at;var m=this.comparator&&(q==null)&&n.sort!==false;var B=l.isString(this.comparator)?this.comparator:null;var E=[],v=[],t={};var r=n.add,p=n.merge,F=n.remove;var z=!m&&r&&F?[]:false;for(A=0,w=D.length;A<w;A++){if(!(o=this._prepareModel(u=D[A],n))){continue}if(s=this.get(o)){if(F){t[s.cid]=true}if(p){u=u===o?o.attributes:n._attrs;s.set(u,n);if(m&&!C&&s.hasChanged(B)){C=true}}}else{if(r){E.push(o);o.on("all",this._onModelEvent,this);this._byId[o.cid]=o;if(o.id!=null){this._byId[o.id]=o}}}if(z){z.push(s||o)}delete n._attrs}if(F){for(A=0,w=this.length;A<w;++A){if(!t[(o=this.models[A]).cid]){v.push(o)}}if(v.length){this.remove(v,n)}}if(E.length||(z&&z.length)){if(m){C=true}this.length+=E.length;if(q!=null){d.apply(this.models,[q,0].concat(E))}else{if(z){this.models.length=0}j.apply(this.models,z||E)}}if(C){this.sort({silent:true})}if(n.silent){return this}for(A=0,w=E.length;A<w;A++){(o=E[A]).trigger("add",o,this,n)}if(C||(z&&z.length)){this.trigger("sort",this,n)}return this};fluid.Collection.prototype.get=function(m){if(m==null){return void 0}return this._byId[m.id]||this._byId[m.cid]||this._byId[m]};fluid.Collection.prototype.reset=function(p,n){n||(n={});for(var o=0,m=this.models.length;o<m;o++){this._removeReference(this.models[o])}n.previousModels=this.models;this._reset();this.add(p,l.extend({silent:true},n));if(!n.silent){this.trigger("reset",this,n)}return this};fluid.Collection.prototype._reset=function(){this.length=0;this.models=[];this._byId={}};fluid.Collection.prototype._prepareModel=function(o,n){if(o instanceof fluid.Model){if(!o.collection){o.collection=this}return o}n||(n={});n.collection=this;var m=new this.model(o,n);if(!m.validationError){return m}this.trigger("invalid",this,o,n);return false};fluid.Collection.prototype._onModelEvent=function(o,n,p,m){if((o==="add"||o==="remove")&&p!==this){return}if(o==="destroy"){this.remove(n,m)}if(n&&o==="change:"+n.idAttribute){delete this._byId[n.previous(n.idAttribute)];if(n.id!=null){this._byId[n.id]=n}}this.trigger.apply(this,arguments)};fluid.Collection.prototype._removeReference=function(m){if(this===m.collection){delete m.collection}m.off("all",this._onModelEvent,this)};fluid.Collection.prototype.toJSON=function(n){var m={};this.forEach(function(o){m[o.attributes[o.idAttribute]]=o.toJSON(n)});return m};fluid.Collection.prototype.allToJSON=function(n){var m={};this.forEach(function(o){m[o.attributes[o.idAttribute]]=o.allToJSON(n)});return m};var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];l.each(b,function(m){fluid.Collection.prototype[m]=function(){var n=k.call(arguments);n.unshift(this.models);return l[m].apply(l,n)}});fluid.Collection.prototype.remove=function(r,p){r=l.isArray(r)?r.slice():[r];p||(p={});var q,m,o,n;for(q=0,m=r.length;q<m;q++){n=this.get(r[q]);if(!n){continue}delete this._byId[n.id];delete this._byId[n.cid];o=this.indexOf(n);this.models.splice(o,1);this.length--;if(!p.silent){p.index=o;n.trigger("remove",n,this,p)}this._removeReference(n)}return this};fluid.Collection.prototype.where=function(m,n){if(l.isEmpty(m)){return n?void 0:[]}return this[n?"find":"filter"](function(o){for(var p in m){if(m[p]!==o.get(p)){return false}}return true})};fluid.Collection.prototype.at=function(m){if(m<0){m+=this.length}return this.models[m]};fluid.Collection.prototype.clone=function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})};var i=function(m,o){var n=this;var q;if(m&&l.has(m,"constructor")){q=m.constructor}else{q=function(){return n.apply(this,arguments)}}l.extend(q,n,o);var p=function(){this.constructor=q};p.prototype=n.prototype;q.prototype=new p;if(m){l.extend(q.prototype,m)}q.__super__=n.prototype;return q};fluid.Collection.extend=i;a.exports=fluid.Collection},{"./lib/underscore":46}],34:[function(b,c,a){fluid.command=fluid.command||{};fluid.command.history=fluid.command.history||{};fluid.command.helper=fluid.command.helper||{};(function(j){var f={};function h(k,l){return(k in f)&&f[k][l]||undefined}function i(l,k){this.name=l;this.context=$.isPlainObject(k)?k:{}}i.prototype.dispatchTo=function(k,m){if(typeof m=="undefined"){var l=h(k,this.name);m=l&&"revert" in l}d(k,this,"execute",m)};i.prototype.dispatchReverseTo=function(k){d(k,this,"revert",false)};function d(q,n,m,o){var p=h(q,n.name);if(!p){return}if(m in p){try{var u=p[m].call(p,n.context)}catch(r){if("message" in r){var l=(r.sourceURL||r.fileName)&&(" at "+(r.sourceURL||r.fileName))||"";var t=l&&(r.line||r.lineNumber)&&(":"+(r.line||r.lineNumber))||"";var s=r.stack&&("\nStack:\n\t"+r.stack.replace(/\n/g,"\n\t"));var k='"'+r.message+'"'+l+t+s}else{var k=$.isPlainObject(r)?JSON.stringify(r):r}throw new Error(q+":"+n.name+":"+m+": "+k)}if(u===false){j.history.remove()}}else{}if(o){j.history.add(n,q)}}j.create=function(l,k){return new i(l,k)};j.registerHandler=function(k,l,m){if(k&&l&&m){if($.isFunction(m)){m={execute:m}}if("execute" in m){(f[k]||(f[k]={}))[l]=m}}}})(fluid.command);(function(l){var d=100;var j=[{}];var k=1;var i=0;function h(o,m,n){this.command=o;this.receiverName=m;this.branchId=n;this.timestamp=new Date().getTime();this.user=account.get("id");this.synced=false}function f(){i++;return i}l.add=function(n,m){if(k<j.length){j.splice(k)}j.push(new h(n,m,i));if(j.length>d){j.shift();l.fire("")}else{k++}l.fire("add")};l.remove=function(){if(j.length>1){k--;j.splice(k,1)}};l.canUndo=function(){return k>2};l.undo=function(n){if(!l.canUndo()){return}var m=j[--k];m.command.dispatchReverseTo(m.receiverName);if(n!==false){l.fire("undo",l.currentPosition())}};l.canRedo=function(){return k<j.length};l.redo=function(n){if(!l.canRedo()){return}var m=j[k++];m.command.dispatchTo(m.receiverName,false);if(n!==false){l.fire("redo",l.currentPosition())}};l.switchBranch=function(o){o--;if(o>-1){var m=j[k-1];if("branches" in m&&o<m.branches.length){var p=j.splice(k);var n=m.branches.splice(o,1)[0];m.branches.unshift(p);$.merge(j,n);l.fire("branch.switch",n[0].branchId)}}};l.reset=function(){j=[{}];k=1;l.fire("reset")};l.length=function(){return j.length-1};l.currentPosition=function(){return k-j.length};fluid.event.mixinTo(l);l.traverse=function(u){var t=true;var m={point:j[0],branch:0,parentBranch:[],stop:function(){t=false}};var r=[];var n=j;var p=1;while(t){if(p<n.length){if(m.point&&"branches" in m.point){r.push({parent:n,pointIndex:p-1,branches:m.point.branches,branchIndex:0});m.parentBranch=n}m.point=n[p++];m.offset=1;if("next" in u){u.next.call(null,m)}}else{var q=true,s=false;m.offset=0;p--;while(q){if(p>0){m.point=n[--p];m.offset--}if(r.length==0){t=q=false;m.offset-=p-1;s=true}else{if(p==0||("branches" in m.point)){var o=r[r.length-1];if(!("branches" in m.point)){m.offset--}if(o.branchIndex<o.branches.length){n=o.branches[o.branchIndex++];m.branch=o.branchIndex;m.point=null;p=0;q=false}else{r.pop();n=o.parent;p=o.pointIndex}s=true}}if(s&&"back" in u){u.back.call(null,m);m.offset=0;s=false}}}}}})(fluid.command.history);(function(d){d.createEventHandler=function(f,h,i){return function(k){var j=$.extend({},i||{});j.event=k;fluid.command.create(h,j).dispatchTo(f)}}})(fluid.command.helper);c.exports=fluid.command},{}],35:[function(b,d,a){var c=b("./fluid.module");var f=c.define("fluid.controller",function(h){var i="fluid.controllers.";function j(k){return{name:k,handleCommand:function(l,m){fluid.command.registerHandler(k,l,m)}}}h.define=function(l,k){if(l.substr(0,i.length)!=i){l=i+l}$(document).ready(function(){c.define(l,k,j(l))})}});d.exports=f},{"./fluid.module":41}],36:[function(b,d,a){var c=b("./fluid.module");c.define("fluid.event",function(h){h.mixinTo=function(k){var l={};var i=typeof k=="object";function j(o,p){var o=o.split(/,\s*|\s+/);for(var n=0,m=o.length;n<m;n++){p.call(k,o[n])}}k.bind=k.on=function(o,n,m){j(o,function(q){var p=l[q]||(l[q]=[]);if(f(p,n)==-1){p.push({h:n,c:m||this,evtName:q})}});return this};k.unbind=k.off=function(n,m){j(n,function(q){var p=l[q];if(p){var o=f(p,m);if(o>-1){p.splice(o,1)}}});return this};k.trigger=k.fire=function(){var q,p=arguments[0],o=l[p],s=l.all;if(o){q=Array.prototype.slice.call(arguments,1);if(i){q.unshift(this)}for(var n=0,m=o.length;n<m;n++){var r=o[n];if(r&&r.h.apply(r.c,q)===false){return false}}if(i){q.shift()}}if(s){for(n=0,m=s.length;n<m;n++){var r=s[n];if(r.h.apply(r.c,arguments)===false){return false}}}return true}};function f(k,l){for(var j=0,i=k.length;j<i;j++){if(k[j].h===l){return j}}return -1}})},{"./fluid.module":41}],37:[function(b,d,a){var c=b("./fluid.module");c.define("fluid.i18n",function(f){var i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function h(o,n){var m=o.toString();var p="";if(!n||m.length<n){for(var l=0,k=n-m.length;l<k;l++){p+="0"}}return p+m}function j(k){if(typeof k=="number"){return new Date(k)}else{return k||new Date(0)}}f.formatDate=function(l){l=j(l);var k=l.getDate()+" "+i[l.getMonth()];var m=l.getFullYear();if(m!=new Date().getFullYear()){k+=", "+m}return k};f.formatTime=function(k){k=j(k);return k.getHours()+":"+h(k.getMinutes(),2)};f.formatDateTime=function(k){k=j(k);return f.formatDate(k)+", "+f.formatTime(k)};f.formatDateTimeRelative=function(m){m=j(m);var k;var l=new Date();var n=Math.floor((l.getTime()-m.getTime())/1000);if(n<60){k="just now"}else{if(n<120){k="a minute ago"}else{if(n<600){k=Math.floor(n/60).toString()+" minutes ago"}else{if(l.getDate()==m.getDate()){k="at "+f.formatTime(m)}else{if(l.getDate()-1==m.getDate()){k="yesterday, "+f.formatTime(m)}else{if(n<604800){k=f.formatDateTime(m)}else{k=f.formatDate(m)}}}}}}return k}});d.exports=fluid.i18n},{"./fluid.module":41}],38:[function(b,d,a){var c=b("./fluid.module");window.fluid=window.fluid||{};window.fluid.module=c;b("./fluid.util");b("./fluid.event");b("./modules/api");b("./fluid.main");b("./fluid.collection");b("./fluid.model")},{"./fluid.collection":33,"./fluid.event":36,"./fluid.main":39,"./fluid.model":40,"./fluid.module":41,"./fluid.util":43,"./modules/api":56}],39:[function(b,d,a){var c=b("./fluid.module");var f=b("./fluid.event");c.define("fluid.main",function(h){fluid.event.mixinTo(h);h.listProjects=function(){if(!fluid.main.projects.length){console.info("no projects found...")}fluid.main.projects.each(function(k,j,m){var i=k.get("pages"),l=k.get("unloaded"),n=k.get("id");if(n===fluid.main.project.get("id")){console.info(j,k.get("id"),l?"unloaded":"loaded",(i&&i.length)?i.length:0,k.toJSON({getAll:true}),fluid.main.project==k)}else{console.log(j,k.get("id"),l?"unloaded":"loaded",(i&&i.length)?i.length:0,k.toJSON({getAll:true}))}})}});d.exports=fluid.main},{"./fluid.event":36,"./fluid.module":41}],40:[function(b,a,d){var k=b("./fluid.module");var m=b("./lib/underscore");var f=[];var i=f.push;var l=f.slice;var c=f.splice;fluid.Model=function(n,p){fluid.event.mixinTo(this);var o=n||{};p||(p={});this.cid=m.uniqueId("c");this.attributes={};if(p.collection){this.collection=p.collection}if(p.parse){o=this.parse(o,p)||{}}if(defaults=m.result(this,"defaults")){o=m.defaults({},o,defaults)}this.set(o,p);this.initialize.apply(this,arguments)};fluid.Model.prototype.idAttribute="id";fluid.Model.prototype.attrBlackList=[];fluid.Model.prototype.parse=function(o,n){return o};fluid.Model.prototype.toJSON=function(n){if(n&&n.getAll){return m.clone(this.attributes)}return m.omit(this.attributes,this.attrBlackList)};fluid.Model.prototype.allToJSON=function(n){return m.clone(this.attributes)};fluid.Model.prototype._validate=function(o,n){return true};fluid.Model.prototype.get=function(n){return this.attributes[n]},fluid.Model.prototype.set=function(v,n,B){var t,w,z,u,s,A,p,r;if(v==null){return this}if(typeof v==="object"){w=v;B=n}else{(w={})[v]=n}B||(B={});if(!this._validate(w,B)){return false}z=B.unset;s=B.silent;u=[];A=this._changing;this._changing=true;if(!A){this._previousAttributes=m.clone(this.attributes);this.changed={}}r=this.attributes,p=this._previousAttributes;if(this.idAttribute in w){this.id=w[this.idAttribute]}for(t in w){n=w[t];if(!m.isEqual(r[t],n)){u.push(t)}if(!m.isEqual(p[t],n)){this.changed[t]=n}else{delete this.changed[t]}z?delete r[t]:r[t]=n}if(!s){if(u.length){this._pending=true}for(var q=0,o=u.length;q<o;q++){this.trigger("change:"+u[q],this,r[u[q]],B)}}if(A){return this}if(!s){while(this._pending){this._pending=false;this.trigger("change",this,B)}}this._pending=false;this._changing=false;return this};fluid.Model.prototype.unset=function(n,o){return this.set(n,void 0,m.extend({},o,{unset:true}))};fluid.Model.prototype.hasChanged=function(n){if(n==null){return !m.isEmpty(this.changed)}return m.has(this.changed,n)};fluid.Model.prototype.changedAttributes=function(p){if(!p){return this.hasChanged()?m.clone(this.changed):false}var r,q=false;var o=this._changing?this._previousAttributes:this.attributes;for(var n in p){if(m.isEqual(o[n],(r=p[n]))){continue}(q||(q={}))[n]=r}return q};fluid.Model.prototype.previous=function(n){if(n==null||!this._previousAttributes){return null}return this._previousAttributes[n]};fluid.Model.prototype.previousAttributes=function(){return m.clone(this._previousAttributes)};var j=["keys","values","pairs","invert","pick","omit"];m.each(j,function(n){fluid.Model.prototype[n]=function(){var o=l.call(arguments);o.unshift(this.attributes);return m[n].apply(m,o)}});var h=function(n,p){var o=this;var r;if(n&&m.has(n,"constructor")){r=n.constructor}else{r=function(){return o.apply(this,arguments)}}m.extend(r,o,p);var q=function(){this.constructor=r};q.prototype=o.prototype;r.prototype=new q;if(n){m.extend(r.prototype,n)}r.__super__=o.prototype;return r};fluid.Model.extend=h;a.exports=fluid.Model;k.define("fluid.model",function(p){var n={storage:window.storage};var q="fluid.models";var o={};o.store=function(r){r=r||this.id;if(r){n.storage.set(r,this);this.trigger("change")}return this};o.fetch=function(t){t=t||this.id;var r=n.storage.get(t);if(r){for(var s in r){this[s]=r[s]}}return this};o.remove=function(r){r=r||this.id;n.storage.remove(r);return this};o.validate=function(){};fluid.event.mixinTo(o);p.define=function(s,r){if(!r){r=function(){}}r.prototype=o;k.define(q)[s]=r;r.fetch=function(t){return new r().fetch(t)};r.remove=function(t){r.prototype.remove.call(null,t)};fluid.event.mixinTo(r)}})},{"./fluid.module":41,"./lib/underscore":46}],41:[function(b,d,a){var c={};c.define=function(j,i,m){var n;if(j){var k=j.split(".");n=window;for(var h=0,f=k.length;h<f;h++){var l=k[h];n=n[l]||(n[l]={})}}if(i){i.call(m,n)}return n};c.resolve=function(i){var k;if(i){var j=i.split(".");k=window;for(var h=0,f=j.length;h<f;h++){k=k[j[h]];if(!k){break}}}return k};d.exports=c},{}],42:[function(b,d,a){var c=b("./fluid.module");var f=b("./lib/mustache");c.define("fluid.util",function(h){h.tpl=function(k,j){var i=this.tpl;if(i.templates[k]){return i.templates[k](j)}else{return"<!-- template not found -->"}};h.tpl.templates={};$('[type="text/x-underscore"]').each(function(k,l){var j=$(l);var m=j.html().trim();var n=j.attr("id");if(typeof n==="string"&&n.length){h.tpl.templates[n]=f.compile(m)}})})},{"./fluid.module":41,"./lib/mustache":45}],43:[function(b,d,a){var c=b("./fluid.module");c.define("fluid.util",function(f){f.debounce=function(i,h){var j;return function(){var l=new Date().getTime();var k;if(!j||l-j>h){k=i.apply(this,arguments);j=l}return k||false}};f.dataUrlToBlob=function(k,j){var m=atob(k.split(",")[1]),l=[];for(var h=0;h<m.length;h++){l.push(m.charCodeAt(h))}return new Blob([new Uint8Array(l)],j)};f.resizeImage=function(l,h,p,n,m,o,k){var j=document.createElement("canvas"),q=j.getContext("2d");j.width=h;j.height=p;if(typeof l==="string"){var i=document.createElement("img");i.src=l;l=i}if(l instanceof Element){if(typeof n==="number"&&typeof m==="number"){q.drawImage(l,n,m,o,k,0,0,h,p)}else{q.drawImage(l,0,0,h,p)}return j.toDataURL()}};f.getGravatarHash=function(h){return f.md5(h.toLowerCase().trim())};f.md5=function(aw){function ah(h,i){return(h<<i)|(h>>>(32-i))}function ai(m,i){var j,o,n,l,h;n=(m&2147483648);l=(i&2147483648);j=(m&1073741824);o=(i&1073741824);h=(m&1073741823)+(i&1073741823);if(j&o){return(h^2147483648^n^l)}if(j|o){if(h&1073741824){return(h^3221225472^n^l)}else{return(h^1073741824^n^l)}}else{return(h^n^l)}}function ax(j,i,h){return(j&i)|((~j)&h)}function ay(j,i,h){return(j&h)|(i&(~h))}function az(j,i,h){return(j^i^h)}function aB(j,i,h){return(i^(j|(~h)))}function au(l,m,o,n,h,j,i){l=ai(l,ai(ai(ax(m,o,n),h),i));return ai(ah(l,j),m)}function aI(l,m,o,n,h,j,i){l=ai(l,ai(ai(ay(m,o,n),h),i));return ai(ah(l,j),m)}function al(l,m,o,n,h,j,i){l=ai(l,ai(ai(az(m,o,n),h),i));return ai(ah(l,j),m)}function av(l,m,o,n,h,j,i){l=ai(l,ai(ai(aB(m,o,n),h),i));return ai(ah(l,j),m)}function aJ(p){var i;var q=p.length;var m=q+8;var j=(m-(m%64))/64;var n=(j+1)*16;var h=Array(n-1);var l=0;var o=0;while(o<q){i=(o-(o%4))/4;l=(o%4)*8;h[i]=(h[i]|(p.charCodeAt(o)<<l));o++}i=(o-(o%4))/4;l=(o%4)*8;h[i]=h[i]|(128<<l);h[n-2]=q<<3;h[n-1]=q>>>29;return h}function an(h){var i="",l="",j,m;for(m=0;m<=3;m++){j=(h>>>(m*8))&255;l="0"+j.toString(16);i=i+l.substr(l.length-2,2)}return i}function aj(i){i=i.replace(/rn/g,"n");var l="";for(var j=0;j<i.length;j++){var h=i.charCodeAt(j);if(h<128){l+=String.fromCharCode(h)}else{if((h>127)&&(h<2048)){l+=String.fromCharCode((h>>6)|192);l+=String.fromCharCode((h&63)|128)}else{l+=String.fromCharCode((h>>12)|224);l+=String.fromCharCode(((h>>6)&63)|128);l+=String.fromCharCode((h&63)|128)}}}return l}var am=Array();var ad,aG,ak,at,aH,k,F,G,H;var aa=7,ac=12,af=17,ag=22;var ao=5,ap=9,aq=14,ar=20;var aA=4,aC=11,aD=16,aE=23;var I=6,Z=10,ab=15,ae=21;aw=aj(aw);am=aJ(aw);k=1732584193;F=4023233417;G=2562383102;H=271733878;for(ad=0;ad<am.length;ad+=16){aG=k;ak=F;at=G;aH=H;k=au(k,F,G,H,am[ad+0],aa,3614090360);H=au(H,k,F,G,am[ad+1],ac,3905402710);G=au(G,H,k,F,am[ad+2],af,606105819);F=au(F,G,H,k,am[ad+3],ag,3250441966);k=au(k,F,G,H,am[ad+4],aa,4118548399);H=au(H,k,F,G,am[ad+5],ac,1200080426);G=au(G,H,k,F,am[ad+6],af,2821735955);F=au(F,G,H,k,am[ad+7],ag,4249261313);k=au(k,F,G,H,am[ad+8],aa,1770035416);H=au(H,k,F,G,am[ad+9],ac,2336552879);G=au(G,H,k,F,am[ad+10],af,4294925233);F=au(F,G,H,k,am[ad+11],ag,2304563134);k=au(k,F,G,H,am[ad+12],aa,1804603682);H=au(H,k,F,G,am[ad+13],ac,4254626195);G=au(G,H,k,F,am[ad+14],af,2792965006);F=au(F,G,H,k,am[ad+15],ag,1236535329);k=aI(k,F,G,H,am[ad+1],ao,4129170786);H=aI(H,k,F,G,am[ad+6],ap,3225465664);G=aI(G,H,k,F,am[ad+11],aq,643717713);F=aI(F,G,H,k,am[ad+0],ar,3921069994);k=aI(k,F,G,H,am[ad+5],ao,3593408605);H=aI(H,k,F,G,am[ad+10],ap,38016083);G=aI(G,H,k,F,am[ad+15],aq,3634488961);F=aI(F,G,H,k,am[ad+4],ar,3889429448);k=aI(k,F,G,H,am[ad+9],ao,568446438);H=aI(H,k,F,G,am[ad+14],ap,3275163606);G=aI(G,H,k,F,am[ad+3],aq,4107603335);F=aI(F,G,H,k,am[ad+8],ar,1163531501);k=aI(k,F,G,H,am[ad+13],ao,2850285829);H=aI(H,k,F,G,am[ad+2],ap,4243563512);G=aI(G,H,k,F,am[ad+7],aq,1735328473);F=aI(F,G,H,k,am[ad+12],ar,2368359562);k=al(k,F,G,H,am[ad+5],aA,4294588738);H=al(H,k,F,G,am[ad+8],aC,2272392833);G=al(G,H,k,F,am[ad+11],aD,1839030562);F=al(F,G,H,k,am[ad+14],aE,4259657740);k=al(k,F,G,H,am[ad+1],aA,2763975236);H=al(H,k,F,G,am[ad+4],aC,1272893353);G=al(G,H,k,F,am[ad+7],aD,4139469664);F=al(F,G,H,k,am[ad+10],aE,3200236656);k=al(k,F,G,H,am[ad+13],aA,681279174);H=al(H,k,F,G,am[ad+0],aC,3936430074);G=al(G,H,k,F,am[ad+3],aD,3572445317);F=al(F,G,H,k,am[ad+6],aE,76029189);k=al(k,F,G,H,am[ad+9],aA,3654602809);H=al(H,k,F,G,am[ad+12],aC,3873151461);G=al(G,H,k,F,am[ad+15],aD,530742520);F=al(F,G,H,k,am[ad+2],aE,3299628645);k=av(k,F,G,H,am[ad+0],I,4096336452);H=av(H,k,F,G,am[ad+7],Z,1126891415);G=av(G,H,k,F,am[ad+14],ab,2878612391);F=av(F,G,H,k,am[ad+5],ae,4237533241);k=av(k,F,G,H,am[ad+12],I,1700485571);H=av(H,k,F,G,am[ad+3],Z,2399980690);G=av(G,H,k,F,am[ad+10],ab,4293915773);F=av(F,G,H,k,am[ad+1],ae,2240044497);k=av(k,F,G,H,am[ad+8],I,1873313359);H=av(H,k,F,G,am[ad+15],Z,4264355552);G=av(G,H,k,F,am[ad+6],ab,2734768916);F=av(F,G,H,k,am[ad+13],ae,1309151649);k=av(k,F,G,H,am[ad+4],I,4149444226);H=av(H,k,F,G,am[ad+11],Z,3174756917);G=av(G,H,k,F,am[ad+2],ab,718787259);F=av(F,G,H,k,am[ad+9],ae,3951481745);k=ai(k,aG);F=ai(F,ak);G=ai(G,at);H=ai(H,aH)}var aF=an(k)+an(F)+an(G)+an(H);return aF.toLowerCase()};f._=window._})},{"./fluid.module":41}],44:[function(b,d,a){var c=b("./fluid.module");c.define("fluid.view",function(i){var j="fluid.views";var f;var h={};i.define=function(l,k){f=l;if(!k){k=function(){}}c.define(j)[l]=k}})},{"./fluid.module":41}],45:[function(b,d,a){var c=b("../fluid.module");
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
;c.define("fluid.util",function(f){(function(h,i){if(typeof a==="object"&&a){i(a)}else{var j={};i(j);if(typeof define==="function"&&define.amd){define(j)}else{h.Mustache=j}}}(f,function(h){var m=/\s*/;var t=/\s+/;var r=/\S/;var p=/\s*=/;var v=/\s*\}/;var D=/#|\^|\/|>|\{|&|=|!/;var n=RegExp.prototype.test;function C(J,I){return n.call(J,I)}function o(I){return !C(r,I)}var F=Object.prototype.toString;var s=Array.isArray||function(I){return F.call(I)==="[object Array]"};function i(I){return typeof I==="function"}function l(I){return I.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function u(I){return String(I).replace(/[&<>"'\/]/g,function(J){return k[J]})}function E(I){this.string=I;this.tail=I;this.pos=0}E.prototype.eos=function(){return this.tail===""};E.prototype.scan=function(K){var J=this.tail.match(K);if(J&&J.index===0){var I=J[0];this.tail=this.tail.substring(I.length);this.pos+=I.length;return I}return""};E.prototype.scanUntil=function(K){var J=this.tail.search(K),I;switch(J){case -1:I=this.tail;this.tail="";break;case 0:I="";break;default:I=this.tail.substring(0,J);this.tail=this.tail.substring(J)}this.pos+=I.length;return I};function B(I,J){this.view=I==null?{}:I;this.parent=J;this._cache={".":this.view}}B.make=function(I){return(I instanceof B)?I:new B(I)};B.prototype.push=function(I){return new B(I,this)};B.prototype.lookup=function(I){var L;if(I in this._cache){L=this._cache[I]}else{var K=this;while(K){if(I.indexOf(".")>0){L=K.view;var M=I.split("."),J=0;while(L!=null&&J<M.length){L=L[M[J++]]}}else{L=K.view[I]}if(L!=null){break}K=K.parent}this._cache[I]=L}if(i(L)){L=L.call(this.view)}return L};function z(){this.clearCache()}z.prototype.clearCache=function(){this._cache={};this._partialCache={}};z.prototype.compile=function(K,I){var J=this._cache[K];if(!J){var L=h.parse(K,I);J=this._cache[K]=this.compileTokens(L,K)}return J};z.prototype.compilePartial=function(J,L,I){var K=this.compile(L,I);this._partialCache[J]=K;return K};z.prototype.getPartial=function(I){if(!(I in this._partialCache)&&this._loadPartial){this.compilePartial(I,this._loadPartial(I))}return this._partialCache[I]};z.prototype.compileTokens=function(K,J){var I=this;return function(L,N){if(N){if(i(N)){I._loadPartial=N}else{for(var M in N){I.compilePartial(M,N[M])}}}return w(K,I,B.make(L),J)}};z.prototype.render=function(K,I,J){return this.compile(K)(I,J)};function w(Q,K,I,T){var N="";function J(W){return K.render(W,I)}var L,R,S;for(var O=0,P=Q.length;O<P;++O){L=Q[O];R=L[1];switch(L[0]){case"#":S=I.lookup(R);if(typeof S==="object"||typeof S==="string"){if(s(S)){for(var M=0,V=S.length;M<V;++M){N+=w(L[4],K,I.push(S[M]),T)}}else{if(S){N+=w(L[4],K,I.push(S),T)}}}else{if(i(S)){var U=T==null?null:T.slice(L[3],L[5]);S=S.call(I.view,U,J);if(S!=null){N+=S}}else{if(S){N+=w(L[4],K,I,T)}}}break;case"^":S=I.lookup(R);if(!S||(s(S)&&S.length===0)){N+=w(L[4],K,I,T)}break;case">":S=K.getPartial(R);if(i(S)){N+=S(I)}break;case"&":S=I.lookup(R);if(S!=null){N+=S}break;case"name":S=I.lookup(R);if(S!=null){N+=h.escape(S)}break;case"text":N+=R;break}}return N}function H(O){var J=[];var N=J;var P=[];var L;for(var K=0,I=O.length;K<I;++K){L=O[K];switch(L[0]){case"#":case"^":P.push(L);N.push(L);N=L[4]=[];break;case"/":var M=P.pop();M[5]=L[2];N=P.length>0?P[P.length-1][4]:J;break;default:N.push(L)}}return J}function j(N){var K=[];var M,J;for(var L=0,I=N.length;L<I;++L){M=N[L];if(M){if(M[0]==="text"&&J&&J[0]==="text"){J[1]+=M[1];J[3]=M[3]}else{J=M;K.push(M)}}}return K}function A(I){return[new RegExp(l(I[0])+"\\s*"),new RegExp("\\s*"+l(I[1]))]}function G(Y,O){Y=Y||"";O=O||h.tags;if(typeof O==="string"){O=O.split(t)}if(O.length!==2){throw new Error("Invalid tags: "+O.join(", "))}var S=A(O);var K=new E(Y);var Q=[];var P=[];var N=[];var Z=false;var X=false;function W(){if(Z&&!X){while(N.length){delete P[N.pop()]}}else{N=[]}Z=false;X=false}var L,J,R,T,M,I;while(!K.eos()){L=K.pos;R=K.scanUntil(S[0]);if(R){for(var U=0,V=R.length;U<V;++U){T=R.charAt(U);if(o(T)){N.push(P.length)}else{X=true}P.push(["text",T,L,L+1]);L+=1;if(T=="\n"){W()}}}if(!K.scan(S[0])){break}Z=true;J=K.scan(D)||"name";K.scan(m);if(J==="="){R=K.scanUntil(p);K.scan(p);K.scanUntil(S[1])}else{if(J==="{"){R=K.scanUntil(new RegExp("\\s*"+l("}"+O[1])));K.scan(v);K.scanUntil(S[1]);J="&"}else{R=K.scanUntil(S[1])}}if(!K.scan(S[1])){throw new Error("Unclosed tag at "+K.pos)}M=[J,R,L,K.pos];P.push(M);if(J==="#"||J==="^"){Q.push(M)}else{if(J==="/"){I=Q.pop();if(!I){throw new Error('Unopened section "'+R+'" at '+L)}if(I[1]!==R){throw new Error('Unclosed section "'+I[1]+'" at '+L)}}else{if(J==="name"||J==="{"||J==="&"){X=true}else{if(J==="="){O=R.split(t);if(O.length!==2){throw new Error("Invalid tags at "+L+": "+O.join(", "))}S=A(O)}}}}}I=Q.pop();if(I){throw new Error('Unclosed section "'+I[1]+'" at '+K.pos)}return H(j(P))}h.name="mustache.js";h.version="0.7.3";h.tags=["{{","}}"];h.Scanner=E;h.Context=B;h.Writer=z;h.parse=G;h.escape=u;var q=new z();h.clearCache=function(){return q.clearCache()};h.compile=function(J,I){return q.compile(J,I)};h.compilePartial=function(J,K,I){return q.compilePartial(J,K,I)};h.compileTokens=function(J,I){return q.compileTokens(J,I)};h.render=function(K,I,J){return q.render(K,I,J)};h.to_html=function(L,J,K,M){var I=h.render(L,J,K);if(i(M)){M(I)}else{return I}}}))})},{"../fluid.module":41}],46:[function(b,c,a){(function(){var ai=this,ac=ai._,ae={},ar=Array.prototype,ab=Object.prototype,an=Function.prototype,aw=ar.push,ah=ar.slice,au=ar.concat,ak=ab.toString,aq=ab.hasOwnProperty,ad=ar.forEach,ag=ar.map,ao=ar.reduce,aa=ar.reduceRight,at=ar.filter,ap=ar.every,aj=ar.some,X=ar.indexOf,av=ar.lastIndexOf,Y=Array.isArray,ax=Object.keys,am=an.bind,Z=function(d){return d instanceof Z?d:this instanceof Z?(this._wrapped=d,void 0):new Z(d)};"undefined"!=typeof a?("undefined"!=typeof c&&c.exports&&(a=c.exports=Z),a._=Z):ai._=Z,Z.VERSION="1.4.4";var W=Z.each=Z.forEach=function(l,j,k){if(null!=l){if(ad&&l.forEach===ad){l.forEach(j,k)}else{if(l.length===+l.length){for(var f=0,h=l.length;h>f;f++){if(j.call(k,l[f],f,l)===ae){return}}}else{for(var d in l){if(Z.has(l,d)&&j.call(k,l[d],d,l)===ae){return}}}}}};Z.map=Z.collect=function(i,d,f){var h=[];return null==i?h:ag&&i.map===ag?i.map(d,f):(W(i,function(l,j,k){h[h.length]=d.call(f,l,j,k)}),h)};var H="Reduce of empty array with no initial value";Z.reduce=Z.foldl=Z.inject=function(j,f,h,i){var d=arguments.length>2;if(null==j&&(j=[]),ao&&j.reduce===ao){return i&&(f=Z.bind(f,i)),d?j.reduce(f,h):j.reduce(f)}if(W(j,function(m,l,k){d?h=f.call(i,h,m,l,k):(h=m,d=!0)}),!d){throw new TypeError(H)}return h},Z.reduceRight=Z.foldr=function(m,j,k,l){var f=arguments.length>2;if(null==m&&(m=[]),aa&&m.reduceRight===aa){return l&&(j=Z.bind(j,l)),f?m.reduceRight(j,k):m.reduceRight(j)}var h=m.length;if(h!==+h){var d=Z.keys(m);h=d.length}if(W(m,function(n,p,i){p=d?d[--h]:--h,f?k=j.call(l,k,m[p],p,i):(k=m[p],f=!0)}),!f){throw new TypeError(H)}return k},Z.find=Z.detect=function(i,d,f){var h;return Q(i,function(l,j,k){return d.call(f,l,j,k)?(h=l,!0):void 0}),h},Z.filter=Z.select=function(i,d,f){var h=[];return null==i?h:at&&i.filter===at?i.filter(d,f):(W(i,function(l,j,k){d.call(f,l,j,k)&&(h[h.length]=l)}),h)},Z.reject=function(h,d,f){return Z.filter(h,function(k,j,i){return !d.call(f,k,j,i)},f)},Z.every=Z.all=function(i,f,h){f||(f=Z.identity);var d=!0;return null==i?d:ap&&i.every===ap?i.every(f,h):(W(i,function(l,k,j){return(d=d&&f.call(h,l,k,j))?void 0:ae}),!!d)};var Q=Z.some=Z.any=function(i,f,h){f||(f=Z.identity);var d=!1;return null==i?d:aj&&i.some===aj?i.some(f,h):(W(i,function(l,k,j){return d||(d=f.call(h,l,k,j))?ae:void 0}),!!d)};Z.contains=Z.include=function(f,d){return null==f?!1:X&&f.indexOf===X?f.indexOf(d)!=-1:Q(f,function(h){return h===d})},Z.invoke=function(i,d){var f=ah.call(arguments,2),h=Z.isFunction(d);return Z.map(i,function(j){return(h?d:j[d]).apply(j,f)})},Z.pluck=function(f,d){return Z.map(f,function(h){return h[d]})},Z.where=function(h,d,f){return Z.isEmpty(d)?f?null:[]:Z[f?"find":"filter"](h,function(j){for(var i in d){if(d[i]!==j[i]){return !1}}return !0})},Z.findWhere=function(f,d){return Z.where(f,d,!0)},Z.max=function(i,d,f){if(!d&&Z.isArray(i)&&i[0]===+i[0]&&65535>i.length){return Math.max.apply(Math,i)}if(!d&&Z.isEmpty(i)){return -1/0}var h={computed:-1/0,value:-1/0};return W(i,function(m,k,l){var j=d?d.call(f,m,k,l):m;j>=h.computed&&(h={value:m,computed:j})}),h.value},Z.min=function(i,d,f){if(!d&&Z.isArray(i)&&i[0]===+i[0]&&65535>i.length){return Math.min.apply(Math,i)}if(!d&&Z.isEmpty(i)){return 1/0}var h={computed:1/0,value:1/0};return W(i,function(m,k,l){var j=d?d.call(f,m,k,l):m;h.computed>j&&(h={value:m,computed:j})}),h.value},Z.shuffle=function(i){var d,f=0,h=[];return W(i,function(j){d=Z.random(f++),h[f-1]=h[d],h[d]=j}),h};var al=function(d){return Z.isFunction(d)?d:function(f){return f[d]}};Z.sortBy=function(i,d,f){var h=al(d);return Z.pluck(Z.map(i,function(l,k,j){return{value:l,index:k,criteria:h.call(f,l,k,j)}}).sort(function(m,j){var k=m.criteria,l=j.criteria;if(k!==l){if(k>l||k===void 0){return 1}if(l>k||l===void 0){return -1}}return m.index<j.index?-1:1}),"value")};var P=function(l,h,j,k){var d={},f=al(h||Z.identity);return W(l,function(m,i){var n=f.call(j,m,i,l);k(d,n,m)}),d};Z.groupBy=function(h,d,f){return P(h,d,f,function(k,i,j){(Z.has(k,i)?k[i]:k[i]=[]).push(j)})},Z.countBy=function(h,d,f){return P(h,d,f,function(j,i){Z.has(j,i)||(j[i]=0),j[i]++})},Z.sortedIndex=function(p,j,k,l){k=null==k?Z.identity:al(k);for(var f=k.call(l,j),h=0,d=p.length;d>h;){var m=h+d>>>1;f>k.call(l,p[m])?h=m+1:d=m}return h},Z.toArray=function(d){return d?Z.isArray(d)?ah.call(d):d.length===+d.length?Z.map(d,Z.identity):Z.values(d):[]},Z.size=function(d){return null==d?0:d.length===+d.length?d.length:Z.keys(d).length},Z.first=Z.head=Z.take=function(h,d,f){return null==h?void 0:null==d||f?h[0]:ah.call(h,0,d)},Z.initial=function(h,d,f){return ah.call(h,0,h.length-(null==d||f?1:d))},Z.last=function(h,d,f){return null==h?void 0:null==d||f?h[h.length-1]:ah.call(h,Math.max(h.length-d,0))},Z.rest=Z.tail=Z.drop=function(h,d,f){return ah.call(h,null==d||f?1:d)},Z.compact=function(d){return Z.filter(d,Z.identity)};var G=function(h,d,f){return W(h,function(i){Z.isArray(i)?d?aw.apply(f,i):G(i,d,f):f.push(i)}),f};Z.flatten=function(f,d){return G(f,d,[])},Z.without=function(d){return Z.difference(d,ah.call(arguments,1))},Z.uniq=Z.unique=function(m,j,k,l){Z.isFunction(j)&&(l=k,k=j,j=!1);var f=k?Z.map(m,k,l):m,h=[],d=[];return W(f,function(i,n){(j?n&&d[d.length-1]===i:Z.contains(d,i))||(d.push(i),h.push(m[n]))}),h},Z.union=function(){return Z.uniq(au.apply(ar,arguments))},Z.intersection=function(f){var d=ah.call(arguments,1);return Z.filter(Z.uniq(f),function(h){return Z.every(d,function(i){return Z.indexOf(i,h)>=0})})},Z.difference=function(f){var d=au.apply(ar,ah.call(arguments,1));return Z.filter(f,function(h){return !Z.contains(d,h)})},Z.zip=function(){for(var i=ah.call(arguments),d=Z.max(Z.pluck(i,"length")),f=Array(d),h=0;d>h;h++){f[h]=Z.pluck(i,""+h)}return f},Z.object=function(j,f){if(null==j){return{}}for(var h={},i=0,d=j.length;d>i;i++){f?h[j[i]]=f[i]:h[j[i][0]]=j[i][1]}return h},Z.indexOf=function(j,f,h){if(null==j){return -1}var i=0,d=j.length;if(h){if("number"!=typeof h){return i=Z.sortedIndex(j,f),j[i]===f?i:-1}i=0>h?Math.max(0,d+h):h}if(X&&j.indexOf===X){return j.indexOf(f,h)}for(;d>i;i++){if(j[i]===f){return i}}return -1},Z.lastIndexOf=function(j,f,h){if(null==j){return -1}var i=null!=h;if(av&&j.lastIndexOf===av){return i?j.lastIndexOf(f,h):j.lastIndexOf(f)}for(var d=i?h:j.length;d--;){if(j[d]===f){return d}}return -1},Z.range=function(l,h,j){1>=arguments.length&&(h=l||0,l=0),j=arguments[2]||1;for(var k=Math.max(Math.ceil((h-l)/j),0),d=0,f=Array(k);k>d;){f[d++]=l,l+=j}return f},Z.bind=function(h,d){if(h.bind===am&&am){return am.apply(h,ah.call(arguments,1))}var f=ah.call(arguments,2);return function(){return h.apply(d,f.concat(ah.call(arguments)))}},Z.partial=function(f){var d=ah.call(arguments,1);return function(){return f.apply(this,d.concat(ah.call(arguments)))}},Z.bindAll=function(f){var d=ah.call(arguments,1);return 0===d.length&&(d=Z.functions(f)),W(d,function(h){f[h]=Z.bind(f[h],f)}),f},Z.memoize=function(h,d){var f={};return d||(d=Z.identity),function(){var i=d.apply(this,arguments);return Z.has(f,i)?f[i]:f[i]=h.apply(this,arguments)}},Z.delay=function(h,d){var f=ah.call(arguments,2);return setTimeout(function(){return h.apply(null,f)},d)},Z.defer=function(d){return Z.delay.apply(Z,[d,1].concat(ah.call(arguments,1)))},Z.throttle=function(p,j){var k,l,f,h,d=0,m=function(){d=new Date,f=null,h=p.apply(k,l)};return function(){var n=new Date,i=j-(n-d);return k=this,l=arguments,0>=i?(clearTimeout(f),f=null,d=n,h=p.apply(k,l)):f||(f=setTimeout(m,i)),h}},Z.debounce=function(j,f,h){var i,d;return function(){var l=this,k=arguments,m=function(){i=null,h||(d=j.apply(l,k))},n=h&&!i;return clearTimeout(i),i=setTimeout(m,f),n&&(d=j.apply(l,k)),d}},Z.once=function(h){var d,f=!1;return function(){return f?d:(f=!0,d=h.apply(this,arguments),h=null,d)}},Z.wrap=function(f,d){return function(){var h=[f];return aw.apply(h,arguments),d.apply(this,h)}},Z.compose=function(){var d=arguments;return function(){for(var f=arguments,h=d.length-1;h>=0;h--){f=[d[h].apply(this,f)]}return f[0]}},Z.after=function(f,d){return 0>=f?d():function(){return 1>--f?d.apply(this,arguments):void 0}},Z.keys=ax||function(h){if(h!==Object(h)){throw new TypeError("Invalid object")}var d=[];for(var f in h){Z.has(h,f)&&(d[d.length]=f)}return d},Z.values=function(h){var d=[];for(var f in h){Z.has(h,f)&&d.push(h[f])}return d},Z.pairs=function(h){var d=[];for(var f in h){Z.has(h,f)&&d.push([f,h[f]])}return d},Z.invert=function(h){var d={};for(var f in h){Z.has(h,f)&&(d[h[f]]=f)}return d},Z.functions=Z.methods=function(h){var d=[];for(var f in h){Z.isFunction(h[f])&&d.push(f)}return d.sort()},Z.extend=function(d){return W(ah.call(arguments,1),function(f){if(f){for(var h in f){d[h]=f[h]}}}),d},Z.pick=function(h){var d={},f=au.apply(ar,ah.call(arguments,1));return W(f,function(i){i in h&&(d[i]=h[i])}),d},Z.omit=function(i){var f={},h=au.apply(ar,ah.call(arguments,1));for(var d in i){Z.contains(h,d)||(f[d]=i[d])}return f},Z.defaults=function(d){return W(ah.call(arguments,1),function(f){if(f){for(var h in f){null==d[h]&&(d[h]=f[h])}}}),d},Z.clone=function(d){return Z.isObject(d)?Z.isArray(d)?d.slice():Z.extend({},d):d},Z.tap=function(f,d){return d(f),f};var L=function(j,w,d,m){if(j===w){return 0!==j||1/j==1/w}if(null==j||null==w){return j===w}j instanceof Z&&(j=j._wrapped),w instanceof Z&&(w=w._wrapped);var v=ak.call(j);if(v!=ak.call(w)){return !1}switch(v){case"[object String]":return j==w+"";case"[object Number]":return j!=+j?w!=+w:0==j?1/j==1/w:j==+w;case"[object Date]":case"[object Boolean]":return +j==+w;case"[object RegExp]":return j.source==w.source&&j.global==w.global&&j.multiline==w.multiline&&j.ignoreCase==w.ignoreCase}if("object"!=typeof j||"object"!=typeof w){return !1}for(var k=d.length;k--;){if(d[k]==j){return m[k]==w}}d.push(j),m.push(w);var q=0,h=!0;if("[object Array]"==v){if(q=j.length,h=q==w.length){for(;q--&&(h=L(j[q],w[q],d,m));){}}}else{var p=j.constructor,l=w.constructor;if(p!==l&&!(Z.isFunction(p)&&p instanceof p&&Z.isFunction(l)&&l instanceof l)){return !1}for(var A in j){if(Z.has(j,A)&&(q++,!(h=Z.has(w,A)&&L(j[A],w[A],d,m)))){break}}if(h){for(A in w){if(Z.has(w,A)&&!q--){break}}h=!q}}return d.pop(),m.pop(),h};Z.isEqual=function(f,d){return L(f,d,[],[])},Z.isEmpty=function(f){if(null==f){return !0}if(Z.isArray(f)||Z.isString(f)){return 0===f.length}for(var d in f){if(Z.has(f,d)){return !1}}return !0},Z.isElement=function(d){return !(!d||1!==d.nodeType)},Z.isArray=Y||function(d){return"[object Array]"==ak.call(d)},Z.isObject=function(d){return d===Object(d)},W(["Arguments","Function","String","Number","Date","RegExp"],function(d){Z["is"+d]=function(f){return ak.call(f)=="[object "+d+"]"}}),Z.isArguments(arguments)||(Z.isArguments=function(d){return !(!d||!Z.has(d,"callee"))}),"function"!=typeof/./&&(Z.isFunction=function(d){return"function"==typeof d}),Z.isFinite=function(d){return isFinite(d)&&!isNaN(parseFloat(d))},Z.isNaN=function(d){return Z.isNumber(d)&&d!=+d},Z.isBoolean=function(d){return d===!0||d===!1||"[object Boolean]"==ak.call(d)},Z.isNull=function(d){return null===d},Z.isUndefined=function(d){return d===void 0},Z.has=function(f,d){return aq.call(f,d)},Z.noConflict=function(){return ai._=ac,this},Z.identity=function(d){return d},Z.times=function(j,f,h){for(var i=Array(j),d=0;j>d;d++){i[d]=f.call(h,d)}return i},Z.random=function(f,d){return null==d&&(d=f,f=0),f+Math.floor(Math.random()*(d-f+1))};var K={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};K.unescape=Z.invert(K.escape);var C={escape:RegExp("["+Z.keys(K.escape).join("")+"]","g"),unescape:RegExp("("+Z.keys(K.unescape).join("|")+")","g")};Z.each(["escape","unescape"],function(d){Z[d]=function(f){return null==f?"":(""+f).replace(C[d],function(h){return K[d][h]})}}),Z.result=function(h,d){if(null==h){return null}var f=h[d];return Z.isFunction(f)?f.call(h):f},Z.mixin=function(d){W(Z.functions(d),function(f){var h=Z[f]=d[f];Z.prototype[f]=function(){var i=[this._wrapped];return aw.apply(i,arguments),U.call(this,h.apply(Z,i))}})};var J=0;Z.uniqueId=function(f){var d=++J+"";return f?f+d:d},Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,af={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;Z.template=function(h,q,d){var k;d=Z.defaults({},d,Z.templateSettings);var p=RegExp([(d.escape||z).source,(d.interpolate||z).source,(d.evaluate||z).source].join("|")+"|$","g"),j=0,m="__p+='";h.replace(p,function(n,s,v,i,w){return m+=h.slice(j,w).replace(V,function(o){return"\\"+af[o]}),s&&(m+="'+\n((__t=("+s+"))==null?'':_.escape(__t))+\n'"),v&&(m+="'+\n((__t=("+v+"))==null?'':__t)+\n'"),i&&(m+="';\n"+i+"\n__p+='"),j=w+n.length,n}),m+="';\n",d.variable||(m="with(obj||{}){\n"+m+"}\n"),m="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+m+"return __p;\n";try{k=Function(d.variable||"obj","_",m)}catch(f){throw f.source=m,f}if(q){return k(q,Z)}var l=function(i){return k.call(this,i,Z)};return l.source="function("+(d.variable||"obj")+"){\n"+m+"}",l},Z.chain=function(d){return Z(d).chain()};var U=function(d){return this._chain?Z(d).chain():d};Z.mixin(Z),W(["pop","push","reverse","shift","sort","splice","unshift"],function(f){var d=ar[f];Z.prototype[f]=function(){var h=this._wrapped;return d.apply(h,arguments),"shift"!=f&&"splice"!=f||0!==h.length||delete h[0],U.call(this,h)}}),W(["concat","join","slice"],function(f){var d=ar[f];Z.prototype[f]=function(){return U.call(this,d.apply(this._wrapped,arguments))}}),Z.extend(Z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],47:[function(d,f,b){var c=d("../fluid.model");var h=d("./customWidgets");var a=d("../../class-dbStorage");(function(){fluid.models.Account=fluid.Model.extend({_type:"accountModel",attrBlackList:["accountId"],idAttribute:"accountId",separateParams:["hint","tutorialLevel","billingCompany","billingCountry","billingAddress","billingVAT","gridStatus","gridSpacing","snapToWidget","receiptEmails","emailReceiptEnabled","lastOpenProject","everCreatedPage","everZoomedIntoPage","everAddedWidget","everMadeLink","everUsedPreview","everClosedPreview","upgradePromptCount","everUpgraded","pageLimitPromptClicks","projectLimitPromptClicks","screensExportPromptClicks","screenflowExportPromptClicks","htmlExportPromptClicks","reachedUpgradeSecondSection","reachedUpgradeThirdSection","upgradeFrameLoadingTime","editorLoadCountBeforeUpgrade"],defaults:{email:"New",accType:"New",name:"",recurrance:"never",libraryWidth:423,loggedIn:"no",maxActiveProjects:1,maxPages:10,projectIds:[],uploads:[],lastOpenProject:"",createDate:new Date().getTime()},initialize:function(i,j){this.on("all",this.onChange,this);if(!this.customwidgets){this.customwidgets=new fluid.CustomWidgets(null,{accountModel:this})}},onChange:function(j,i){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,50)}if(!this.debouncedSyncUpParams){this.debouncedSyncUpParams=_.debounce(this.syncUpParams,5000)}this.debouncedSave.apply(this,arguments);if(_.keys(_.pick(i.changedAttributes(),i.separateParams)).length!==0){this.debouncedSyncUpParams.apply(this,arguments)}},parse:function(o,k){if(!o){return{}}var m=["a","r","sessionId","settings","objects","intercomUserHash","lastProjectId","upgradeDate","lastPaymentDate","nextPaymentDate","lastPaymentResult"],j=["maxActiveProjects","maxPages"],n,l;n=_.omit(o,m);for(l=0;l<j.length;l++){if(n[j[l]]!==undefined){n[j[l]]=~~n[j[l]]}}return n},bundle:function(){return this.pick(this.separateParams)},save:function(){var j=this.allToJSON();var i={id:this.get("accountId"),data:j};a.set("accounts",i)},syncUpParams:function(){fluid.main.fire("accountParamsChanged")}})})()},{"../../class-dbStorage":6,"../fluid.model":40,"./customWidgets":49}],48:[function(b,c,a){if(!fluid.models){fluid.models={}}fluid.models.bin=fluid.Model.extend({initialize:function(){this.items=[]},add:function(d){this.items.unshift(d)},remove:function(h){for(var f=0,d=this.items.length;f<d;f++){if(this.items[f]===h){this.items.splice(f,1)}}},clear:function(){this.items=[]},isEmpty:function(){return this.items.length==0}})},{}],49:[function(c,d,a){var b=c("../fluid.model");if(!fluid.models){fluid.models={}}fluid.models.CustomWidgets=fluid.Model.extend({attrBlackList:[],initialize:function(f,h){}});fluid.CustomWidgets=fluid.Collection.extend({model:fluid.models.CustomWidgets,initialize:function(h,f){this.accountModel=f.accountModel}});d.exports=fluid.CustomWidgets},{"../fluid.model":40}],50:[function(b,c,a){if(!fluid.models){fluid.models={}}fluid.models.Link=fluid.Model.extend({idAttribute:"linkCanvId",initialize:function(d,f){},parse:function(f,d){return f}});fluid.Links=fluid.Collection.extend({model:fluid.models.Link,linkProps:["linkCanvId","linkDest","linkOrigin","linkType","transType","triggerType"],initialize:function(f,d){},toJSON:function(h){var d={};for(var j=0,f=this.linkProps.length;j<f;j++){d[this.linkProps[j]]=[]}this.forEach(function(m){for(var n=0,k=this.linkProps.length;n<k;n++){d[this.linkProps[n]].push(m.attributes[this.linkProps[n]])}},this);return d},deserialize:function(q){var k=(typeof q==="string")?JSON.parse(q):q;var p=[],n,o,h,f,m,d;for(h=0,d=k.linkCanvId.length;h<d;h++){n={};for(f=0,m=this.linkProps.length;f<m;f++){n[this.linkProps[f]]=k[this.linkProps[f]][h]}p.push(n)}this.set(p,{merge:true})}})},{}],51:[function(b,c,a){if(!fluid.models){fluid.models={}}(function(){fluid.models.Page=fluid.Model.extend({attrBlackList:["id","box","imgData"],omitedRedrawAttrs:["x","y","imgData"],initialize:function(d,f){this.on("change:x change:y change:width change:height",function(){this.clearBox()},this);this.on("change",function(j,i){var h=this.changedAttributes(),k;h=_.keys(h);k=_.difference(h,this.omitedRedrawAttrs);if(k.length>0){this.clearImgData()}},this);fluid.main.on("resolutionChanged",function(){if(this.collection.projectModel.id!==fluid.main.project.id){return}this.clearBox();this.clearImgData();var h=this.get("widgets");fluid.main.project.widgets.each(function(i){if(h.indexOf(i.get("id"))!==-1){i.clearBox()}})},this)},clearImgData:function(){this.set({imgData:null})},clearBox:function(){this.set({box:null},{silent:true})},getBox:function(){var d=this.get("box");if(d){return d}else{d=[this.get("x"),this.get("y"),this.get("width"),this.get("height")];this.set({box:d},{silent:true});return d}}});fluid.Pages=fluid.Collection.extend({model:fluid.models.Page,initialize:function(f,d){this.projectModel=d.projectModel}})})()},{}],52:[function(c,b,d){var f=c("../fluid.model");var h=c("../fluid.collection");var j=c("./page");var i=c("./widget");var a=c("./widgetGroup");var k=c("./link");var l=c("../../class-dbStorage");if(!fluid.models){fluid.models={}}fluid.models.project=fluid.Model.extend({attrBlackList:["visiblePages","uniqueUploads"],silentSyncAttrs:["updated","saved","preview","canvasPosX","canvasPosY","currentZoom","visiblePages","uniqueUploads"],silentSaveAttrs:["updated","saved","currentZoom"],initialize:function(m,n){if(!this.get("id")){if(n.projectId){this.set("id",n.projectId);this.id=n.projectId}}if(!this.pages){this.pages=new fluid.Pages(null,{projectModel:this})}if(!this.widgets){this.widgets=new fluid.Widgets(null,{projectModel:this})}if(!this.links){this.links=new fluid.Links(null,{projectModel:this})}if(!this.wdgGroups){this.wdgGroups=new fluid.WidgetGroups(null,{projectModel:this})}if(n&&n.syncOnChange!==false){this.pages.on("all",this.onChange,this);this.widgets.on("all",this.onChange,this);this.widgets.on("add",this.addUniqueUpload,this);this.widgets.on("remove",this.removeUniqueUpload,this);this.links.on("all",this.onChange,this);this.on("all",this.onChange,this);this.on("change:uniqueUploads",this.updateLibrary,this);this.on("change:name",this.updateLibraryTab,this);this.save();fluid.api.on("apicallsuccess",function(p,o){if(o.type==="projectSync"&&o.objectId===this.get("id")){this.synced=true}})}this.synced=false;fluid.main.on("thumbnailReady",function(o,p){if(p===this.id){this.modifiedSinceThumb=false}},this)},defaults:{uniqueUploads:[]},isSynced:function(){return this.synced},setModified:function(m){if(m===true||m===false){this.synced=!m}},onChange:function(q,n){if(!n.changedAttributes){return}var m=n.changedAttributes(),p,o;if(m){m=_.keys(m);p=_.difference(m,this.silentSyncAttrs);o=_.difference(m,this.silentSaveAttrs);if(p.length){this.setModified(true);this.synced=false;this.modifiedSinceThumb=true}if(o.length){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,50)}this.debouncedSave.apply(this,arguments)}}},addUniqueUpload:function(o,m){var p=m.attributes.data;if(p){var n=_.clone(this.get("uniqueUploads"));if(n.indexOf(p)===-1){n.push(p);this.set({uniqueUploads:n})}}},removeUniqueUpload:function(p,m){var r=m.attributes.data;if(r){var q=m.id;var o=this.widgets.find(function(s){return(s.id!==q&&s.attributes.data&&s.attributes.data===r)});if(!o){var n=this.get("uniqueUploads");n=_.without(n,r);this.set({uniqueUploads:n})}}},updateLibrary:function(o){var n=o.previousAttributes().uniqueUploads;var m=o.attributes.uniqueUploads;var p;if(n.length<m.length){p=_.difference(m,n);p.forEach(function(q){lib.addUploadToProjectTab(o.id,q)})}else{if(n.length>m.length){p=_.difference(n,m);p.forEach(function(q){lib.removeUploadFromProjectTab(o.id,q)})}}lib.setCounter(o.id,m.length)},updateLibraryTab:function(m){lib.changeNameOfActiveTab(m.id,m.attributes.name)},save:function(n){var m=this.bundle({getAll:true});l.set("projects",{id:this.id,data:m},function(){if(n&&n.call){n()}})},parse:function(w,m){var A;if(typeof w==="string"){w=JSON.parse(w)}if(m.projectId&&w[m.projectId]){A=w[m.projectId];A.id=m.projectId}else{var q=this.findProjectInBundle(w)[1];A=q[1];A.id=q[0]}var n=A.pages,s,u=[],z=[],E,C,D,F,v,G,p,o;if(n&&n.length){for(E=0,C=n.length;E<C;E++){v=n[E];if(!v){continue}if(w[v]){p=_.clone(w[v]);p.id=v;u.push(p);s=p.widgets;if(s.length){for(D=0,F=s.length;D<F;D++){G=s[D];if(w[G]&&w[G].lockTo&&!w[w[G].lockTo]){w[G]=null}if(w[G]&&w[G].of&&!w[w[G].of]){w[G]=null}if(fluid.main.uploads&&w[G]&&w[G].data&&!(w.uploads[w[G].data]&&fluid.main.uploads.get(w[G].data))){w[G]=null}if(w[G]){o=_.clone(w[G]);o.id=G;o.pageId=v;z.push(o)}else{s.splice(D,1);D--;F--}}}}else{n.splice(E,1);E--}}A.pages=n}else{A.pages=[]}if(A.homepage&&!w[A.homepage]){if(u.length){A.homepage=u[0].id}else{A.homepage=false}}this.pages=new fluid.Pages(u,{comparator:false,projectModel:this});this.widgets=new fluid.Widgets(z,{comparator:false,projectModel:this});var r=[],B,t;for(t in A.widgetGroups){if(A.widgetGroups.hasOwnProperty(t)){B={id:t,widgets:A.widgetGroups[t]}}r.push(B)}this.wdgGroups=new fluid.WidgetGroups(r,{comparator:false});this.links=new fluid.Links(null,{comparator:false});if(A.links){this.links.deserialize(A.links)}return A},get:function(n,r){var s=n.substr(0,1),o=r&&r.returnModel?true:false;if(n.substr(1,1)!=="_"&&this.attributes[n]!==undefined){return this.attributes[n]}else{if(s==="x"){var m=this.pages.get(n);if(!m){return false}return o?m:m.toJSON(r)}else{if(s==="w"){var q=this.widgets.get(n);if(!q){return false}return o?q:q.toJSON(r)}else{if(s==="l"){var p=this.links.get(n);if(!p){return false}return o?p:p.toJSON(r)}else{if(s==="p"){return o?this:this.toJSON(r)}}}}}},setChild:function(t,r){var m=t.substr(0,1);var n,q;if(m==="x"){q=this.pages;r.id=t;n=this.pages.get(t)}else{if(m=="w"){q=this.widgets;r.id=t;n=this.widgets.get(t)}else{if(m=="l"){q=this.links;n=this.links.get(t)}}}if(n){var p=_.clone(n.attributes);for(var s in p){if(typeof r[s]==="undefined"&&p.hasOwnProperty(s)){var o=["id","pageId","box","imgData"];if(o.indexOf(s)!==-1){n.unset(s,{silent:true})}}}n.set(r)}else{q.add(r)}},isEmpty:function(){return this.pages.length===0},findProjectInBundle:function(m){for(var n in m){if(m.hasOwnProperty(n)&&n.substr(0,2)==="p_"){return[n,m[n]]}}return false},bundle:function(n){var m={};m[this.attributes.id]=this.toJSON(n);if(this.links){_.extend(m[this.attributes.id],{links:this.links.toJSON(n)})}_.extend(m,this.pages?this.pages.toJSON(n):{});_.extend(m,this.widgets?this.widgets.toJSON(n):{});m.uploads={};if(this.widgets){this.widgets.each(function(p,o,s){if(!p.attributes.upload){return}var r=p.toJSON(),q;q=fluid.main.uploads.get(r.data).toJSON();m.uploads[r.data]=_.pick(q,"type","wh","title")},this)}return m}});fluid.Projects=fluid.Collection.extend({model:fluid.models.project,initialize:function(n,m){},getLatestActiveProject:function(){var m=this.map(function(n){if(n.get("active")||n.get("unloaded")){return n}else{return false}});if(m.length){return m[m.length-1].get("id")}else{return false}}})},{"../../class-dbStorage":6,"../fluid.collection":33,"../fluid.model":40,"./link":50,"./page":51,"./widget":54,"./widgetGroup":55}],53:[function(b,c,a){if(!fluid.models){fluid.models={}}(function(){fluid.models.Upload=fluid.Model.extend({attrBlackList:["imgData"],initialize:function(d,f){this.on("change",function(){var h=_.keys(this.changedAttributes());if(h.indexOf("imgData")!==-1){dbStorage.set("uploads",{id:this.id,data:this.get("imgData")})}},this);this.projects=new fluid.Projects(null)},parse:function(f,d){return f}});fluid.Uploads=fluid.Collection.extend({model:fluid.models.Upload,_type:"upload",initialize:function(f,d){this.on("all",this.onChange,this)},afterInit:function(f,d){if(d&&d.saveAfterInit){this.save()}},onChange:function(){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,300)}this.debouncedSave.apply(this)},save:function(){dbStorage.set("uploadHeaders",{id:fluid.main.account.id,data:this.toJSON()})}})})()},{}],54:[function(b,c,a){if(!fluid.models){fluid.models={}}(function(){fluid.models.Widget=fluid.Model.extend({attrBlackList:["id","pageId","box","imgData"],initialize:function(d,f){this.on("change:tlwh",function(){this.clearBox()});this.on("change",function(){this.getPage().clearImgData()},this)},clearBox:function(){var d=this.getChildren();this.set({box:null},{silent:true});d.forEach(function(f,i,h){f.clearBox()})},calculateBox:function(l){var j=[],i=this.get("tlwh"),k=this.get("ca");if(!i&&this.get("st")==="b"){i=[0,0,"a","a"]}function d(s){var t=this.get("segments"),r=0;if(t){var p=this.get("sp"),v=p?p[s-1]:0,q=p?p[s==2?3:2]:0;for(var w=0,u=t.length;w<u;w++){var o=widget.get(t[w].id);if(!o){o=widget.get(t[w].widget)}if(!o){return r}r+=o.tlwh?o.tlwh[s]:o.wh[s-2]}r+=v+q}else{return l[s]}return r}var f=i[2]==null?0:i[2];if(f&&typeof(f)==="number"){j[2]=f}else{if(f&&f.indexOf("%")!==-1){j[2]=(parseFloat(f)/100)*l[2]}else{if(f=="a"){j[2]=d.call(this,2)}else{j[2]=l[2]}}}var n=i[3]==null?0:i[3];if(n&&typeof(n)==="number"){j[3]=n}else{if(n&&n.indexOf("%")!==-1){j[3]=(parseFloat(n)/100)*l[3]}else{if(n=="a"){j[3]=d.call(this,3)}else{j[3]=l[3]}}}var m=i[0]==null?0:i[0];if(!k||k[0]=="t"){if(typeof(m)==="number"){j[1]=m+l[1]}else{if(m.indexOf("%")!==-1){j[1]=((parseFloat(m)/100)*l[3])+l[1]}else{j[1]=parseInt(m,10)+l[1]}}}else{if(k[0]=="c"){if(typeof(m)==="number"){j[1]=m+l[1]+l[3]/2-j[3]/2}else{if(m.indexOf("%")!==-1){j[1]=((parseFloat(m)/100)*l[3])+l[1]+l[3]/2-j[3]/2}else{j[1]=parseInt(m,10)+l[1]+l[3]/2-j[3]/2}}}else{if(k[0]=="b"){if(typeof(m)==="number"){j[1]=l[1]+l[3]-m-j[3]}else{if(m.indexOf("%")!==-1){j[1]=l[1]+l[3]-((parseFloat(m)/100)*l[3])-j[3]}else{j[1]=l[1]+l[3]-parseInt(m,10)}}}}}var h=i[1]==null?0:i[1];if(!k||k[1]=="l"){if(typeof(h)==="number"||h.indexOf("%")===-1){j[0]=h+l[0]}else{if(h.indexOf("%")!==-1){j[0]=((parseFloat(h)/100)*l[2])+l[0]}else{j[0]=parseInt(h,10)+l[0]}}}else{if(k[1]=="c"){if(typeof(h)==="number"){j[0]=h+l[0]+l[2]/2-j[2]/2}else{if(h.indexOf("%")!==-1){j[0]=((parseFloat(h)/100)*l[2])+l[0]+l[2]/2-j[2]/2}else{j[0]=parseInt(h,10)+l[0]+l[2]/2}}}else{if(k[1]=="r"){if(typeof(h)==="number"){j[0]=l[0]+l[2]-h-j[2]}else{if(h.indexOf("%")!==-1){j[0]=l[0]+l[2]-((parseFloat(h)/100)*l[2])-j[2]}else{j[0]=l[0]+l[0]-parseInt(h,10)}}}}}j[0]=~~j[0];j[1]=~~j[1];j[2]=~~j[2];j[3]=~~j[3];this.set({box:j});return j},getBox:function(){var i,j,h,d,f,k;d=this.get("box");if(d){return d}if(!this.get("of")){f=this.get("st");j=this.getPage();if(f&&(f==="f"||f==="fb")){k=this.getProject().get("pageWH");if(j.get("orientation")==="Landscape"){k=[k[1],k[0]]}i=[0,0,k[0],k[1]]}else{i=[0,0,j.get("width"),j.get("height")]}}else{h=this.getParent();i=h.getBox()}d=this.calculateBox(i);return d},getRoot:function(){if(this.get("of")&&this.getParent()){return this.getParent().getRoot()}else{return this}},getSegmentRoot:function(){if(this.get("segmentRoot")){return this.collection.get(this.get("segmentRoot"))}else{return this.getRoot()}},getDependents:function(){var d=this.collection.where({lockTo:this.id,of:this.id});return d},getLockTos:function(){var d=this.getRoot();var f=this.collection.where({lockTo:d.id});return f},getChildren:function(){var d=this.collection.where({of:this.id});return d},getParent:function(){return this.collection.get(this.get("of"))},getPage:function(){var d=this.getProject().pages.get(this.get("pageId"));if(this.get("pageId")&&d.get("widgets").indexOf(this.id)!==-1){return d}else{d=false;this.getProject().pages.every(function(i,h,f){if(i.get("widgets").indexOf(this.id)!==-1){d=i;this.set({pageId:i.id},{silent:true});return false}return true},this);return d}},getProject:function(){return this.collection.projectModel},containsText:function(f){var d=false;if(this.get("tc")){d=true}else{if(this.attributes.ad&&this.attributes.ad.length){this.attributes.ad.forEach(function(h){if(h&&h[0]){var j=h[0];var i=widgets.summary[j];if(i&&i.tc){d=true}}})}}return d},getSubTextElements:function(){var f=[],d=this.getDependents();d.forEach(function(h){f=f.concat(h.getSubTextElements())});if(this.get("tc")){f.push(this)}return f},getGroup:function(){var f=this.getProject().wdgGroups;var d=this.id;var h=f.find(function(i){if(i.get("widgets").indexOf(d)!==-1){return true}else{return false}});return h},getAllFromGroup:function(){var h=this.getGroup();var f=[];if(h){var d=h.get("widgets");f=fluid.main.project.widgets.filter(function(i){if(d.indexOf(i.id)!==-1){return true}return false})}return f}});fluid.Widgets=fluid.Collection.extend({model:fluid.models.Widget,initialize:function(f,d){if(d&&d.projectModel){this.projectModel=d.projectModel}},getIds:function(){return this.map(function(d){return d.id})},getElements:function(){return $("#"+this.getIds().join(", #"))},getRoots:function(){var d=new fluid.Widgets();this.each(function(h,f,i){d.add(h.getRoot())});return d},getLockTos:function(){var h=this.getRoots();var d=new fluid.Widgets();var f;h.each(function(i){f=fluid.main.project.widgets.where({lockTo:i.get("lockTo")});d.add(f)});return d}})})()},{}],55:[function(b,c,a){if(!fluid.models){fluid.models={}}fluid.models.WidgetGroup=fluid.Model.extend({initialize:function(d,f){},parse:function(f,d){return f}});fluid.WidgetGroups=fluid.Collection.extend({model:fluid.models.WidgetGroup,initialize:function(f,d){}})},{}],56:[function(c,f,a){var d=c("../fluid.module");var h=c("../fluid.event");var i=c("../../class-account");var b=c("../lib/underscore");d.define("fluid.api",function(j){b.extend(j,{_maxRetryCount:2,_interval:100,_timeoutShort:20,_timeoutLong:600,_pendingShort:false,_pendingObj:null,_queueShort:[],_queueLong:[],_logoutHandler:null,_RETRY:true,_NO_RETRY:false,_LOCK:true,_NO_LOCK:false});j.setLogoutHandler=function(k){j._logoutHandler=k};j.accountSettingsSync=function(m,k,l){j._call("accountSettingsSync",{data:m},j._RETRY,j._LOCK,k,l)};j.accountState=function(k,l){j._call("accountState",{objectId:i.get("id"),data:{instanceId:g_instanceId}},j._RETRY,j._LOCK,k,l)};j.changeBilling=function(m,k,l){j._call("changeBilling",{data:m},j._RETRY,j._LOCK,k,l)};j.changeEmail=function(m,n,k,l){j._call("changeEmail",{data:{info:m,validation:n}},j._RETRY,j._LOCK,k,l)};j.changePass=function(m,n,k,l){j._call("changePass",{data:{old:m,"new":n}},j._RETRY,j._LOCK,k,l)};j.contact=function(o,m,n,k,l){j._call("contact",{data:{from:o,subject:m,message:n}},j._RETRY,j._LOCK,k,l)};j.create=function(o,n,p,q,l,k,m){j._call("create",{tandc:q,email:o,password1:n,instanceId:p,strict:l},j._RETRY,j._LOCK,k,m)};j.emailRegd=function(m,k,l){j._call("emailRegd",{data:{email:m}},j._RETRY,j._LOCK,k,l)};j.getPayments=function(k,l){j._call("getPayments",{},j._RETRY,j._LOCK,k,l)};j.getLibrariesWhitelist=function(k,l){j._call("getLibrariesWhitelist",{},j._RETRY,j._LOCK,k,l)};j.imageSync=function(l,n,k,m){j._call("imageSync",{objectId:l,data:n},j._RETRY,j._NO_LOCK,k,m)};j.importUserPackage=function(m,k,l){j._call("importUserPackage",{},j._RETRY,j._LOCK,k,l)};j.libSync=function(l,n,k,m){j._call("libSync",{objectId:l,data:n},j._RETRY,j._NO_LOCK,k,m)};j.listProjects=function(m,k,l){j._call("listProjects",{data:{userId:m}},j._RETRY,j._LOCK,k,l)};j.updateCard=function(m,k,l){j._call("updateCard",m,j._RETRY,j._LOCK,k,l)};j.previewMail=function(n,m,k,l){j._call("previewMail",{email:n,p:m},j._RETRY,j._LOCK,k,l)};j.projectDuplicate=function(m,k,l){j._call("projectDuplicate",{data:{projectId:m}},j._RETRY,j._LOCK,k,l)};j.projectSync=function(l,n,k,m){j._call("projectSync",{objectId:l,data:n},j._RETRY,j._NO_LOCK,k,m)};j.projectTransfer=function(m,n,k,l){j._call("projectTransfer",{data:{projectId:m,emails:n}},j._RETRY,j._LOCK,k,l)};j.projectVersionList=function(m,k,l){j._call("projectVersionList",{data:{projectId:m}},j._RETRY,j._LOCK,k,l)};j.projectVersionRestore=function(o,n,l,k,m){j._call("projectVersionRestore",{data:{projectId:o,projectDate:n,createNew:l}},j._RETRY,j._LOCK,k,m)};j.remove=function(l,k,m){j._call("remove",{objectId:l},j._RETRY,j._LOCK,k,m)};j.removeAccount=function(l,k,m){j._call("removeAccount",{},j._RETRY,j._LOCK,k,m)};j.requestDiscountCoupon=function(l,k,m){j._call("requestDiscountCoupon",{},j._RETRY,j._LOCK,k,m)};j.restore=function(l,k,m){j._call("restore",{objectId:l},j._RETRY,j._LOCK,k,m)};j.shareLog=function(l,n,k,m){j._call("shareLog",{data:{objectId:l,target:n}},j._RETRY,j._LOCK,k,m)};j.syncDown=function(m,l,o,k,n){if(o){j._call("syncDown",{objectId:m,multiple:l,unloaded:o},j._RETRY,j._LOCK,k,n)}else{j._call("syncDown",{objectId:m,multiple:l},j._RETRY,j._LOCK,k,n)}};j.uploadExportForSafari=function(m,k,l){j._call("uploadExportForSafari",{},j._RETRY,j._LOCK,k,l)};j.validatePass=function(m,k,l){j._call("validatePass",{info:m},j._RETRY,j._LOCK,k,l)};j.verifyDiscountCoupon=function(m,k,l){j._call("verifyDiscountCoupon",{code:m},j._RETRY,j._LOCK,k,l)};j.login=function(n,m,o,k,l){j._call("login",{email:n,password1:m,instanceId:o},j._RETRY,j._LOCK,k,l)};j._call=function(p,q,l,o,k,m){var n=((o!==undefined)&&($.type(o)==="boolean"))?o:false;if(n){j._queueShort.push({type:p,data:q,retry:((l!==undefined)&&($.type(l)==="boolean"))?l:false,successCallback:((k!==undefined)&&($.isFunction(k)))?k:null,errorCallback:((m!==undefined)&&($.isFunction(m)))?m:null,_retries:0,_started:0,_finished:false,_ajax:null})}else{j._queueLong.push({type:p,data:q,retry:((l!==undefined)&&($.type(l)==="boolean"))?l:false,successCallback:((k!==undefined)&&($.isFunction(k)))?k:null,errorCallback:((m!==undefined)&&($.isFunction(m)))?m:null,_retries:0,_started:0,_finished:false,_ajax:null})}if(j._process===null){j.process()}};j.time=function(){return Math.floor(Date.now()/1000)};j._prepareBlock=function(k,l){var m={},n;for(n in l){if(l.hasOwnProperty(n)){m[n]=l[n]}}if(m.data&&typeof(m.data)!=="string"){m.data=JSON.stringify(m.data)}m.t=k;return m};j._delShort=function(l){var k=j._queueShort.indexOf(l);if(k===-1){return}j._queueShort.splice(k,1)};j._delLong=function(l){var k=j._queueLong.indexOf(l);if(k===-1){return}j._queueLong.splice(k,1)};j._processLong=function(l){if(j._queueLong[l]._retries>j._maxRetryCount){if(j._logoutHandler){return j._logoutHandler()}else{console.error("failed to call api ",type," method for ",j._queueLong[l]._retries," times");return false}}var k=j._prepareBlock(j._queueLong[l].type,j._queueLong[l].data);j._queueLong[l]._ajax=$.ajax({url:"index.php",data:k,type:"POST",timeout:j._timeoutLong*1000}).error(function(m,n,p,o){if(m.retry){if(m._retries<=j._maxRetryCount){m._retries++;j._processLong(m)}else{if(m.errorCallback!==null){m.errorCallback(p)}j._delLong(m)}}}.bind(this,j._queueLong[l])).success(function(m,o,p,n){if(m.successCallback!==null){m.successCallback(o,p)}j._delLong(m);this.fire("apicallsuccess",m.type)}.bind(this,j._queueLong[l]))};j._processShort=function(l){if(j._queueShort[l]._retries>j._maxRetryCount){if(j._logoutHandler){return j._logoutHandler()}else{console.error("failed to call api ",type," method for ",j._queueShort[l]._retries," times");return false}}var k=j._prepareBlock(j._queueShort[l].type,j._queueShort[l].data);j._queueShort[l]._ajax=$.ajax({url:"index.php",data:k,type:"POST",timeout:j._timeoutShort*1000}).error(function(m,n,p,o){if(m.retry){if(m._retries<=j._maxRetryCount){m._retries++;j._processShort(m)}else{if(m.errorCallback!==null){m.errorCallback(p)}j._delShort(m)}}}.bind(this,j._queueShort[l])).success(function(m,o,p,n){if(m.successCallback!==null){m.successCallback(o,p)}j._delShort(m);this.fire("apicallsuccess",m)}.bind(this,j._queueShort[l]))};j.process=function(){if(j._queueShort.length>0){if((j._queueShort[0]._ajax===null)){j._processShort(0)}}else{if(j._queueLong.length>0){for(var k in j._queueLong){if(j._queueLong[k]._ajax===null){j._processLong(k)}}}}j._process=setTimeout(j.process,j._interval)};j.init=function(){j.process()};fluid.event.mixinTo(j)})},{"../../class-account":2,"../fluid.event":36,"../fluid.module":41,"../lib/underscore":46}],57:[function(c,d,b){var a=c("../fluid.view");fluid.view.define("bin",function(){var n=300,k=300;var i=200,j=200;var m;function h(q){var o=m;if(m){$("#"+m).closest(".binItem").find(".restore").fadeOut(j);m=null}if(q){var p=q.attr("data-itemid");if(o!=p){q.find(".restore").fadeIn(i);m=p}}}function l(o){fluid.command.create("restore",{id:$(o.currentTarget).closest(".binItem").attr("data-itemid")}).dispatchTo("fluid.controllers.bin");o.stopPropagation()}function f(p){var o=p.data("ts");if(o){p.find(".timestamp").text(fluid.i18n.formatDateTimeRelative(o))}}this.isOpen=false;this.dropAreaElem=$("#trash");this.contentsElem=$("#trashContents").hide().bind("mousewheel",function(o){o.stopPropagation()});this.open=function(){if(this.isOpen){return}fluid.main.fire("closeallpopups",null,this.contentsElem);this.contentsElem.find(".binItem").each(function(){f($(this))});var o=this.contentsElem.css({"-webkit-transform":"scale(0.05)","-moz-transform":"scale(0.05)"}).show();this.updateScrollbar();var p=this;utils.animateRaf(function(q){p.contentsElem.css({"-webkit-transform":"scale("+q+")","-moz-transform":"scale("+q+")"})},n,"easeOutBack",function(){p.contentsElem.removeAttr("style").show()});this.isOpen=true};this.close=function(){if(!this.isOpen){return}var o=this;utils.animateRaf(function(p){o.contentsElem.css({"-webkit-transform":"scale("+(1-p)+")","-moz-transform":"scale("+(1-p)+")"})},k,"easeInOutQuad",function(){o.contentsElem.removeAttr("style").hide()});h();this.isOpen=false};this.toggle=function(){if(this.isOpen){this.close()}else{this.open()}};this.hide=function(){this.dropAreaElem.fadeOut(j);this.contentsElem.fadeOut(j)};this.show=function(){this.dropAreaElem.fadeIn(i)};this.updateScrollbar=function(o){$(".scrollHolder",this.contentsElem).tinyscrollbar_update(o||"relative")};this.update=function(z){var r=this.contentsElem.find(".overview").empty();var s=z&&z.items;if(!s||z.isEmpty()){$("#tmplBinEmpty").tmpl().appendTo(r)}else{for(var u=0,q=s.length;u<q;u++){var w=s[u];var t=w.obj.id.charAt(0);var o;switch(t){case"p":var p=new Date(w.obj.created);var v=$.extend(w.obj,{readonly:true,date:fluid.i18n.formatDate(p)});o=$("#tmplBinnedProject").tmpl(v).appendTo(r);o.find(".project").addClass("inactiveProject");break;case"i":o=$("#tmplBinnedUpload").tmpl(w.obj).appendTo(r);break;case"c":o=$("#tmplBinnedUserWidget").tmpl(w.obj).appendTo(r);window.lib.afterUserWdgRender("bin-"+w.obj.id,w.obj.thumb);break;default:continue}$("#tmplBinRestore").tmpl().on("click",l).appendTo(o);o.data("ts",w.ts).on("click",function(A){h($(A.currentTarget))})}this.dropAreaElem.removeClass("shown").show()}this.updateScrollbar()};$(".scrollHolder",this.contentsElem).tinyscrollbar()})},{"../fluid.view":44}],58:[function(d,b,f){var m=d("./class-dbStorage");var i=d("./class-widget");var j=d("./class-account");var c=d("./class-notification");var l=d("./class-project");var k=d("./class-preview");var a=d("./class-canvas");d("./jquery.bounce");b.exports.updateTLWH=function(n){var o=(n)?n:utils.getBoundingAreaRelative($("#canvasPages .ui-selected").not(".backgroundWidget"));$("#TLindicatorX").text(parseInt(o.left));$("#TLindicatorY").text(parseInt(o.top));$("#WHindicatorX").text(parseInt(o.right-o.left));$("#WHindicatorY").text(parseInt(o.bottom-o.top));i._selectionTLWH={width:o.right-o.left,height:o.bottom-o.top,top:o.top,left:o.left};i._selectionBoxCoord={top:o.top,left:o.left}};b.exports.getSelectionTLWH=function(){return utils.getBoundingAreaRelative($("#canvasPages .ui-selected").not(".backgroundWidget"))};b.exports.showPostLoadMessage=function(){if(!localStorage){return}var o=localStorage.getItem("postloadMessage");var n={tab:"Project updated. Please close other tabs or windows where the project may be open.",serverRefresh:"A newer version of a project has been found. Updated.",serverLogout:"This account appears to be open elsewhere and has been logged out to protect your changes.",loginAgain:'Something went wrong. Please <span class="inlineLink open-fluid-menu close">sign in</span> again.',panicRefresh:"Something went wrong. Application has been reloaded.",updateLogout:"Welcome back. We've made some changes since you've last been here &ndash; please <span class=\"inlineLink open-fluid-menu close\">sign in</span> again to get the latest version.",loginSyncFailed:'Application failed to sign in and sync all user data properly. Try to <span class="inlineLink open-fluid-menu close">sign in</span> again.'};if(n[o]){if(o==="serverLogout"){c.add("alert",n[o])}else{c.add("alert",n[o],{permanent:true})}}localStorage.removeItem("postloadMessage")};b.exports.cmLink2Helper=function(o){var n=$(this).data("clickDragHelper");return n||$("#tmplDragHelper").tmpl()};b.exports.setFocus=function(n){n.bounce().focus()};b.exports.keyD=function(q){if(q.ctrlKey&&q.altKey&&q.shiftKey&&q.keyCode==48){$("#console").toggle();q.preventDefault();q.stopImmediatePropagation();return}if(/^(input|textarea)$/i.test(q.target.nodeName)&&!((q.metaKey||q.ctrlKey)&&q.keyCode===68)){return}if((q.metaKey||q.ctrlKey)&&q.keyCode==65){utils.selectText("control+a");if(fluid.zoom.getCtx()!=="project"){var n=$(".screen.active").attr("id");fluid.selection.select(storage.get(n).widgets)}return true}if((q.metaKey||q.ctrlKey)&&q.keyCode==71&&!q.shiftKey){q.preventDefault();if(!$("#canvas").hasClass("zoomedOut")){var r=$("#canvasPages .ui-selected");var n=l.getActivePageId();if(r&&r.length>=2&&n){fluid.command.create("groupWidgets",{sel:r,pageId:n}).dispatchTo("fluid.controllers.widget")}}return true}if((q.metaKey||q.ctrlKey)&&q.keyCode==71&&q.shiftKey){q.preventDefault();if(!$("#canvas").hasClass("zoomedOut")){var r=$("#canvasPages .ui-selected");var n=l.getActivePageId();if(r&&r.length>=2&&n){fluid.command.create("ungroupWidgets",{sel:r,pageId:n}).dispatchTo("fluid.controllers.widget")}}return true}if(q.keyCode===27){lib.esc();userSettings.esc(q)}if(q.keyCode==13){if(userSettings.isOpen){projectSettings.navigateWithKeys(q)}}if(q.keyCode>=37&&q.keyCode<=40){i.nudge(q);contextMenu.place();return false}else{if(q.keyCode==46||q.keyCode==8){if(q.keyCode==8){$(".userSettingsDone:visible").click()}deleteObject(q.keyCode);return false}else{if(q.metaKey||q.ctrlKey){var p=$("#multiSelBox");if(p.is(":visible")){$("#canvasPages .backgroundWidget").css("z-index",-2);p.css("z-index",-1)}var o,s=true;switch(q.keyCode){case 67:o="copy";s=false;break;case 68:o="clone";break;case 86:o="paste";break;case 88:o="cut";break;case 89:fluid.command.history.redo();break;case 90:if(q.shiftKey){fluid.command.history.redo()}else{fluid.command.history.undo()}break;default:return true}if(o){fluid.command.create(o,{}).dispatchTo("fluid.controllers.widget",s);if(o==="paste"){fluid.main.fire("uiWidgetAdded")}}q.preventDefault()}}}};b.exports.keyU=function(o){if(/^(input|textarea)$/i.test(o.target.nodeName)){return}if(o.keyCode>=37&&o.keyCode<=40){if(o){var n=o.target.nodeName.toLowerCase();if((n=="input")||(n=="textarea")||(n=="select")){return false}}if(a.isEditorVisible()){contextMenu.place();page.navigateWithKeys(o)}else{if(userSettings.isOpen){projectSettings.navigateWithKeys(o)}else{k.navigateWithKeys(o)}}return false}$("#canvasPages .backgroundWidget").css("z-index","");$("#multiSelBox").css("z-index","")};b.exports.load=function(){var n=window.open("terms.html","","scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,location=no,status=yes")};b.exports.tidyUp=function(o){if(i._resizeEl){return}var n=$(o.target);if(n.attr("id")==="previewHolder"||n.parents("#previewHolder").length||n.parent(".share-toggle").length){fluid.main.fire("closeallpopups",o)}if(n.attr("id")==="previewHolder2"||n.parents("#previewHolder2").length){fluid.main.fire("closeallpopups",o)}if(o.target.type=="textarea"||o.target.type=="input"||o.target.id=="tsandcsLabel"||o.target.id=="tsandcs1"||n.hasClass("projectOptionsFrame")||n.hasClass("modalWindowContentFrame")||n.closest(".modalWindowContentFrame").length>0||n.parents("#viewport").length===0&&n.parents("#startMenu").length===0){return true}if($(o.target).hasClass("createAccount")||($(o.target).hasClass("libraryWidget"))||($(o.target).hasClass("libraryWidgetDisabled"))){return true}fluid.main.fire("closeallpopups",o);if(window.g_window_print&&!window.g_window_print.closed&&!$(o.target).hasClass("shareLinkPrint")){window.g_window_print.close();window.g_window_print=null}};b.exports.setValid=function(o){var n=o.next("aside");if(!n.hasClass("formCorrect")){n.fadeTo(0,1).addClass("formCorrect").bounce()}};b.exports.validateInput=function(q,r){var p=$(r);if(r==null||r==undefined){r=this;p=$(this)}if(!r.validity){return}$form=p.parents(".form").eq(0);if($form.hasClass("shareSendMail")){return}if($form.hasClass("shareToUser")){return}if(((r.validity.valid&&p.is(":checkbox")==false)||(p.attr("type")=="checkbox"&&p.prop("checked"))==true)&&p.attr("type")!="submit"){b.exports.setValid(p)}else{p.next("aside").fadeTo(200,0).removeClass("formCorrect")}if(!$form.hasClass("createForm")){var o=$form.find("input").not("[type=hidden], [type=submit]").length;var n=$form.find(".formCorrect").length;setSubmitStyle($form,o==n)}};b.exports.intersectTrash=function(r,q){if($("#trash").css("display")!="none"){r=$(r);var u=r[0].dataset.lockto;if(u&&u!==r[0].id){r=$("#"+u)}var o=utils.getTLWH(r);if(r.hasClass("screen")){var p=fluid.zoom.getCurrentScale(),n=$(".page",r);if(fluid.zoom.isEditMode()){return false}if(n.size()>0){o=utils.getTLWH(n)}o.width=o.width*p;o.height=o.height*p}var s=$("#libraryWidgetDragging");if(s.size()>0){if(s.hasClass("upload")){o.width=24;o.height=24}else{o=utils.getTLWH(s.find(".pageWidget"))}}var t=utils.getTLWH("#trash");if(q&&(o.width>200||o.height>200)){o.top=q.pageY;o.left=q.pageX;o.width=0;o.height=0}if((o.top+o.height>=t.top)&&(o.left+o.width>=t.left)){$("#trash").addClass("droppableStyle");return true}}$("#trash").removeClass("droppableStyle");return false};b.exports.dropInViewport=function(w,A){if(fluid.zoom.isZoomingNow()){return false}if(w.isPropagationStopped()||(w.originalEvent&&w.originalEvent.isPropagationStopped())){return}var B=$(A.draggable);var o=B.attr("id")||B.attr("data-id");if(B.hasClass("pageWidget")){return true}if($(A.draggable).hasClass("project")){l.open(o);return}if($("#trash").hasClass("droppableStyle")){var r=B.attr("data-id");if(r.indexOf("scaled-")!==-1){r=r.split("-")[1]}fluid.command.create("drop",{id:r,title:storage.get(r).title}).dispatchTo("fluid.controllers.bin");return}if(o=="canvas"){return true}if(B.hasClass("libraryWidget")&&w.pageX<j.get("libraryWidth")){return false}if(o=="cmLink2"){utils.prevent(w);$("#dragCanvas").fadeOut(200);var s=$("#addPage").offset();var C=$("#addPage").outerHeight();if(w.pageX>s.left&&w.pageY>s.top&&w.pageY<s.top+C){fluid.command.create("create",{offset:{x:w.offsetX,y:w.offsetY},pageCoords:{x:w.pageX,y:w.pageY},targetId:w.target.id,mode:"link"}).dispatchTo("fluid.controllers.page");i.resetSelection();return false}var z=null;if(B.hasClass("templateLink")){var z=B.parents(".page")}else{var z=$(".screen.activeZoomedOut")}page.enableSelectableWidgetHolder(false)}var v=A.draggable.add(A.helper).add($("#dragCanvas")).add(".pageWidget.ui-selected");var u=false;var t=getHoverPageParams(w);var n=t.pageId?t.pageId:false;var p=A.draggable.attr("id")||A.draggable.attr("data-id");if(n){var D=$("#"+n);if(o=="cmLink2"){var z=D;var q=fluid.zoom.getselectedBeforeZoomOut();fluid.command.create("create",{originId:q,destinationId:z.attr("id")}).dispatchTo("fluid.controllers.link");tracker.record("addLink",1,"",w);u=true}}if($(A.draggable).attr("id")==="cmLink2"){if(u){i.resetSelection()}}};b.exports.setSubmitStyle=function(p,o){var q=p.find(":submit");if(o===undefined){o=!q.hasClass("inactive")}if(o||p.attr("id")=="upgradeForm"){var n=p.data("existing")?"accept-existing":"accept";q.removeClass("inactive accept accept-existing").addClass(n).bounce()}else{q.removeClass("accept accept-existing").addClass("inactive")}};b.exports.deleteObject=function(n,p){function q(){var v=$(".ui-selected");if(v.length==0){return false}var u=[],t=[];$(v).each(function(){var A=$(this).attr("id");if(A==$(this).attr("data-segment")){t.push(A)}else{u.push(A);var z=fluid.main.project.widgets.get(A);var w=z.get("insertAfterId")?fluid.main.project.widgets.get(z.get("insertAfterId")):false;if(w===false){w=z.get("of")?fluid.main.project.widgets.get(z.get("of")):false}if(w&&w.get("blur")&&_.difference(w.getBox(),z.getBox()).length===0){u.push(w.get("id"))}}});if(u.length>0){fluid.command.create("delete",{id:u}).dispatchTo("fluid.controllers.widget")}if(t.length>0){fluid.command.create("deleteSegment",{id:t}).dispatchTo("fluid.controllers.widget")}contextMenu.hide();propInspector.resetPropInspector()}if((n==46||n==8||n=="delete")&&i.editing==false){return q()}if(!p||!p.draggable){return false}var s=$(p.helper);if(intersectTrash(s)==true){if(s.hasClass("pageWidget")){q();i._dragSelection=null}else{if(s.hasClass("userWidget")){var r=s.data("widget-id");fluid.command.create("drop",{id:r,thumb:$("#"+r+" img").attr("src")}).dispatchTo("fluid.controllers.bin")}else{if(s.hasClass("screen")){fluid.command.create("delete",{id:s.attr("id")}).dispatchTo("fluid.controllers.page")}else{if(s.hasClass("scaled-screen")){fluid.command.create("delete",{id:s.attr("id").split("-")[1]}).dispatchTo("fluid.controllers.page")}else{if(s.hasClass("project")){var o=j.get("projectIds");if(o.length>1){fluid.command.create("drop",{id:$(p.draggable).attr("id")}).dispatchTo("fluid.controllers.bin")}else{c.add("info","Sorry, the currently open project cannot be deleted. Please create another project before deleting this one.")}}}}}}$("#trash").removeClass("droppableStyle");return true}return false};b.exports.redraw=function(o){k.multiOrientations=l.isMultiOrientation();if(k.isOpen){k.setAvailableRect();k.scaleFrame()}$("#canvas").draggable("option","containment",a.setContainment());var n=l.getActivePage();if(n.size()>0&&n.hasClass("screen")&&!$(o.target).hasClass("pageWidget")){fluid.zoom.zoomToPage($("#canvasPages .screen.active"))}else{if(fluid.zoom.getCtx()==="project"){fluid.zoom.zoomToAllDebounced2()}}};function h(n,o){this.ms=n;this.callback=o;this.start()}b.exports.Timeout=h;b.exports.getHoverPageParams=function(r){var u=document.getElementById("viewport");if(fluid.zoom.getCtx()!=="project"&&r.pageX<=fluid.zoom.getLibWidth()){return false}var t=(u.scrollLeft+r.pageX)/fluid.zoom.getCurrentScale();var q=(u.scrollTop+r.pageY)/fluid.zoom.getCurrentScale();var n=fluid.main.project.pages.filter(function(v){if(t>=v.get("x")&&t<=v.get("x")+v.get("width")&&q>=v.get("y")&&q<=v.get("y")+v.get("height")){return true}else{return false}});if(fluid.zoom.getCtx()==="project"){n=n[n.length-1]}else{var p=_.map(n,function(v){return v.get("id")});var o=$("#"+p.join(", #"));var s=o.filter(".active");if(s.length){n=fluid.main.project.pages.get(s.attr("id"))}else{n=fluid.main.project.pages.get(o.last().attr("id"))}}if(n&&n.get("id")){return{pageId:n.get("id"),offsetX:t-n.get("x"),offsetY:q-n.get("y")}}else{return false}};h.prototype={start:function(){if(!this.timeout){this.msRemaining=this.ms;this.startTime=new Date().valueOf();this.isPaused=false;this.isComplete=false;this._setTimeout(this.ms)}},started:function(){return Boolean(this.timeout)},stop:function(){if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null;this.isPaused=false}},pause:function(){if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null;this.msRemaining-=new Date().valueOf()-this.startTime;this.isPaused=true}},paused:function(){return Boolean(this.isPaused)},resume:function(){if(this.isPaused&&!this.timeout){this.startTime=new Date().valueOf();this._setTimeout(this.msRemaining);this.isPaused=false}},timeRemaining:function(){if(this.isPaused){return this.msRemaining}else{return this.msRemaining-new Date().valueOf()+this.startTime}},exec:function(){this.stop();this.callback.call();this.isComplete=true},complete:function(){return Boolean(this.isComplete)},_setTimeout:function(n){this.timeout=window.setTimeout((function(o){return function(){if($.isFunction(o.callback)){o.isComplete=true;o.callback.call();o.timeout=null}}})(this),n)}};b.exports.rgb2hex=function(n){n=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function o(p){return("0"+parseInt(p).toString(16)).slice(-2)}return"#"+o(n[1])+o(n[2])+o(n[3])};b.exports.fetchSvgIcons=function(){var n=new XMLHttpRequest();n.open("GET","img/all_icons.svg",true);n.onload=function(p){var o=new XMLSerializer();var q=o.serializeToString(p.target.responseXML.documentElement);document.head.appendChild(p.target.responseXML.documentElement);m.onReady(function(){m.set("uiIcons",{id:"svgIcons",data:q})})};n.send(null)}},{"./class-account":2,"./class-canvas":4,"./class-dbStorage":6,"./class-notification":14,"./class-preview":18,"./class-project":19,"./class-widget":28,"./jquery.bounce":59}],59:[function(c,d,b){var a=c("./utils");(function(f){f.fn.extend({bounce:function(h){var i={size:[0.33,1.33,1,1.12,1,1.05,1],delay:[0,100,80,80,80,80,50],step:function(k){var m=k.data("bounce");if(m&&m.nextStep<m.size.length){var j=0;if(m.nextStep!=0){j=m.delay[m.nextStep]}var n=m.nextStep>0?m.size[m.nextStep-1]:0;var l=m.size[m.nextStep]-n;a.animateRaf(function(o){k.css({"-webkit-transform":"scale("+(n+l*o)+")","-moz-transform":"scale("+(n+l*o)+")"})},m.delay[m.nextStep],function(){h.step(k)});m.nextStep++}else{k.css({"-webkit-transform":"none","-moz-transform":"none"})}}};var h=f.extend(i,h);return this.each(function(){var j=f(this).data("bounce",{size:h.size,delay:h.delay,nextStep:0}).css({"-webkit-transform":"scale(0.01)","-moz-transform":"scale(0.01)"});h.step(j)})}})})(jQuery)},{"./utils":60}],60:[function(c,d,b){var f=c("./class-storage");(function(){var i=0;var j=["ms","moz","webkit","o"];for(var h=0;h<j.length&&!window.requestAnimationFrame;++h){window.requestAnimationFrame=window[j[h]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[j[h]+"CancelAnimationFrame"]||window[j[h]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(o,l){var k=new Date().getTime();var m=Math.max(0,16-(k-i));var n=window.setTimeout(function(){o(k+m)},m);i=k+m;return n}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(k){clearTimeout(k)}}}());var a={ensureInstanceId:function(){var h=localStorage.getItem("instanceId");if(typeof g_instanceId=="undefined"||!g_instanceId||!h||g_instanceId!=h){g_instanceId=1+parseInt(Math.random()*99999999);localStorage.setItem("instanceId",g_instanceId)}},reloadWithMessage:function(i){function h(){f._setItem("postloadMessage",i);location.reload()}if(fluid.main.deferReload){fluid.main.on("deferReloadRelease",h)}else{h()}},selectText:function(i){var h=(i=="control+a")?$(".ui-selected").find("textarea"):$(this);h.focus();h.select();return false},getTLWH:function(j){var l=$(j);if(l.length==0){return{top:0,left:0,width:0,height:0}}var i=l.offset();var k=l.outerWidth();var h=l.outerHeight();return{top:i.top,left:i.left,width:k,height:h}},getCenterPoint:function(h){var j=a.getTLWH(h);var k=Math.floor(j.top+(j.height/2));var i=Math.floor(j.left+(j.width/2));return{top:k,left:i}},getTranslateDistanceToCenter:function(C,z){var r=$(C).outerWidth();var A=$(C).outerHeight();var m=parseFloat($(C).css("top"));var q=parseFloat($(C).css("left"));var o=a.getCenterPoint(z);var B=a.getTLWH(z);var t=r-B.width;var s=A-B.height;var h=Math.max(0,t,s);var k=h==t?false:true;var i=h==s?false:true;var l=-parseFloat($("#viewport").get(0).scrollTop);var n=-parseFloat($("#viewport").get(0).scrollLeft);var p=i?m+A/2:m;var j=k?q+r/2:q;var w=o.top-p-l;var v=o.left-j-n;if(s>0){var u=0.5*B.height-95;w=w-u}return{top:w,left:v}},getBoundingAreaRelative:function(i){var j=$(i);if(j.length==0){return{top:0,left:0,bottom:0,right:0}}var h={top:null,left:null,right:null,bottom:null};$(j).each(function(){var m=$(this);var k={top:parseFloat(m.css("top")),left:parseFloat(m.css("left")),width:parseFloat(m.css("width")),height:parseFloat(m.css("height"))};if(m.hasClass("screen")){var l=$(".page",m);k={top:parseFloat(m.css("top")),left:parseFloat(m.css("left")),width:parseFloat(l.css("width")),height:parseFloat(l.css("height"))}}if((h.left>k.left)||h.left==null){h.left=~~k.left}if((h.top>k.top)||h.top==null){h.top=~~k.top}if((h.right<k.left+k.width)||h.right==null){h.right=~~(k.left+k.width)}if((h.bottom<k.top+k.height)||h.bottom==null){h.bottom=~~(k.top+k.height)}});return h},getBoundingArea:function(h){a.boundingLeft=null;a.boundingTop=null;a.boundingRight=null;a.boundingBottom=null;var j=$(h);if(j.length==0){return{top:0,left:0,bottom:0,right:0}}j.each(function(){var k=a.getTLWH(this);if((a.boundingLeft>k.left)||a.boundingLeft==null){a.boundingLeft=k.left}if((a.boundingTop>k.top)||a.boundingTop==null){a.boundingTop=k.top}if((a.boundingRight<k.left+k.width)||a.boundingRight==null){a.boundingRight=k.left+k.width}if((a.boundingBottom<k.top+k.height)||a.boundingBottom==null){a.boundingBottom=k.top+k.height}});var i={top:a.boundingTop,left:a.boundingLeft,bottom:a.boundingBottom,right:a.boundingRight};return i},guid:function(j){var m="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var n=32;var l="";for(var k=0;k<n;k++){var h=Math.floor(Math.random()*m.length);l+=m.substring(h,h+1)}return j+"_"+l},prevent:function(h){h.stopPropagation();h.preventDefault();return false},arraysEqual:function(k,j){var l=k.length==j.length;if(l){for(var i=0,h=k.length;i<h;i++){l=k[i]===j[i];if(!l){break}}}return l},hslToHex:function(p){function o(r,l,s){if(s<0){s+=1}else{if(s>1){s-=1}}if(s*6<1){return r+(l-r)*s*6}if(s*2<1){return l}if(s*3<2){return r+(l-r)*(2/3-s)*6}return r}var k=p.h/360,u=p.s/100,j=p.l/100;var t,q;if(j<=0.5){q=j*(1+u)}else{q=j+u-(j*u)}t=j*2-q;var i=o(t,q,k+1/3);var m=o(t,q,k);var n=o(t,q,k-1/3);i=Math.round(i*255);m=Math.round(m*255);n=Math.round(n*255);i=parseInt(i).toString(16);m=parseInt(m).toString(16);n=parseInt(n).toString(16);if(i.length<2){i="0"+i}if(m.length<2){m="0"+m}if(n.length<2){n="0"+n}return i+m+n},hex2rgba:function(j,h){if(!j[0]=="#"){return false}if(j.indexOf("rgba(")===0){return j}if(j.indexOf("rgb(")===0){var i;j=j.replace("rgb(","rgba(");i=j.split(",");i[i.length-1]=parseInt(i[i.length-1]);i.push("1)");j=i.join(",");return j}if(j.length=="4"){j="#"+j[1]+j[1]+j[2]+j[2]+j[3]+j[3]}return"rgba("+(parseInt(j.substr(1,2),16))+","+(parseInt(j.substr(3,2),16))+","+(parseInt(j.substr(5,2),16))+","+(h||1)+")"},rgb2hex:function(h){h=h.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function i(j){return("0"+parseInt(j).toString(16)).slice(-2)}return"#"+i(h[1])+i(h[2])+i(h[3])},toHSL:function(t){var t=(t)?t:"rgb(0, 0, 0)";t=t.replace(/ /g,"");if(t.match(/hsla/gi)){return{h:t.match(/[0-9]*/g)[5],s:t.match(/[0-9]*/g)[7],l:t.match(/[0-9]*/g)[10]}}if(t.match(/hsl/gi)){return{h:t.match(/[0-9]*/g)[4],s:t.match(/[0-9]*/g)[6],l:t.match(/[0-9]*/g)[9]}}if(t.match(/#/gi)){if(t.length==4){t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]}else{if(t.length!=7){t="#000000"}}var i=parseInt(t.substring(1,3),16);var o=parseInt(t.substring(3,5),16);var q=parseInt(t.substring(5,7),16)}else{if(t.match(/rgba/gi)){var i=t.match(/[0-9]*/g)[5];var o=t.match(/[0-9]*/g)[7];var q=t.match(/[0-9]*/g)[9]}else{if(t.match(/rgb/gi)){var i=t.match(/[0-9]*/g)[4];var o=t.match(/[0-9]*/g)[6];var q=t.match(/[0-9]*/g)[8]}}}i/=255,o/=255,q/=255;var j=Math.max(i,o,q);var m=Math.min(i,o,q);var n=0;var u=0;var k=(j+m)/2;if(j!=m){var p=j-m;u=(k<0.5)?p/(j+m):p/(2-j-m);switch(j){case i:n=(o-q)/p;break;case o:n=(q-i)/p+2;break;case q:n=(i-o)/p+4;break}n/=6;if(n<0){n+=1}}n=n*360;k=k*100;u=u*100;return{h:n,s:u,l:k}},replaceRgbaAlpha:function(i,h){var j=i.match(/rgba/i);if(j){ret=i.split(",");ret[ret.length-1]=h+")";ret=ret.join(",");return ret}return i},getRgbaAlpha:function(i){if(i[0]=="#"||i.indexOf("rgb(")!=-1){return 1}var h=i.split(",");h=h[h.length-1];h=parseFloat(h);return h},getAlphaFromColor:function(h){if(h[0]=="#"){return 1}else{if(h.indexOf("rgba(")===0){h=h.split(",");h=h[h.length-1].replace(")","");return h}}return 1},isMobileDevice:function(){var h=false;if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)){h=true}return h},hideBrowserBar:function(){var h=false;if(navigator.userAgent.match(/Android/i)){h=true}return h},isMouseOver:function(i,h){var j=h.offset();return i.pageX>=j.left&&i.pageX<(j.left+h.outerWidth())&&i.pageY>=j.top&&i.pageY<(j.top+h.outerHeight())},relativeMousePos:function(i,h){var j=h.offset();return{top:i.pageY-j.top,left:i.pageX-j.left}},animateRaf:function(h,l,p,k,r){if($.isFunction(p)){k=p;p=undefined}var i,n,m,q=false;var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(s){window.setTimeout(function(){s(new Date().valueOf())},16.667)};function j(u){if(!q&&u<946684800000){if(m){i=startTimeHiResClock;n=endTimeHiResClock;q=true}else{u=new Date().valueOf()}}var s=u-i;var t=n!=i?s/l:1;if(t<1){if(p){t=p(t,s,0,1,l)}h(t,r);o(j)}else{h(1,r);if(k&&$.isFunction(k)){window.setTimeout(k,10)}}}if(l===undefined){l=300}m=window.hasOwnProperty("performance")&&window.performance.hasOwnProperty("now");i=new Date().valueOf();startTimeHiResClock=m?window.performance.now():i;n=i+l;endTimeHiResClock=startTimeHiResClock+l;if(p){p=$.easing[p]}o(j)},toPercent:function(j,m,k){if(typeof j=="string"){var l=a.parsePercentString(j);j=l&&!isNaN(l)?l*m/100:parseFloat(j)}var h=j*100/m;var i=Math.pow(10,k);return(Math.round(h*i))/i},parsePercentString:function(j){var i=NaN;if(typeof j=="string"){var h=j.match(/^\s*(\d+(?:\.\d*)?|\.\d+)\s*\%\s*$/);if(h){i=parseFloat(h[1])}}return i},isPercentString:function(i){var h=a.parsePercentString(i);return Boolean(h)&&!isNaN(h)},fromPercentString:function(j,i){var h=a.parsePercentString(j);if(h&&!isNaN(h)){h*=i/100}return h},getNavigationKeyDirection:function(i){var h="";switch(i){case 37:h="left";break;case 38:h="top";break;case 39:h="right";break;case 40:h="bottom";break}return h},replaceTooltip:function(h){},Vector:(function(){function h(i,k,j){if(!(this instanceof h)){return new h(i,k,j)}if(i instanceof Object){k=i.y;j=i.z;i=i.x}j=j||0;if(typeof i!=="number"||typeof k!=="number"){i=k=j=0}this.x=i;this.y=k;this.z=j;h.created++}h.created=0;h.prototype={set:function(i,k,j){if(i instanceof Object){k=i.y;i=i.x;j=i.z}j=j||0;if(typeof i==="number"&&typeof k==="number"&&typeof j==="number"){this.x=i;this.y=k;this.z=j}return this},distanceTo:function(j){var i=this.x-j.x,l=this.y-j.y,k=this.z-j.z;return Math.sqrt(i*i+l*l+k*k)},distanceSqTo:function(j){var i=this.x-j.x,l=this.y-j.y,k=this.z-j.z;return i*i+l*l},plus:function(i){return new h(this.x+i.x,this.y+i.y,this.z+i.z)},minus:function(i){return new h(this.x-i.x,this.y-i.y,this.z-i.z)},scale:function(i){return new h(this.x*i,this.y*i,this.z*i)},dot:function(i){return this.x*i.x+this.y*i.y+this.z*i.z},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},angle:function(i){if(!i){i=h.I}else{return this.angle()-i.angle()}if(this.y<0){return 2*Math.PI-(new h(this.x,-this.y,this.y)).angle(i)}return Math.acos(this.dot(i)/(this.magnitude()*i.magnitude()))},rotateBy:function(i){if(i>Math.PI){return this.rotateBy(-(2*Math.PI-i))}else{if(i<-Math.PI){return this.rotateBy(2*Math.PI+i)}}return new h(this.x*Math.cos(i)-this.y*Math.sin(i),this.x*Math.sin(i)+this.y*Math.cos(i))},rotateTo:function(j){var i=j-this.angle();return this.rotateBy(i)},unitVector:function(){return this.scale(1/this.magnitude())},add:function(i){this.x+=i.x;this.y+=i.y;return this},sub:function(i){this.x-=i.x;this.y-=i.y;return this},mul:function(i){this.x*=i;this.y*=i;return this},rotBy:function(i){this.x=this.x*Math.cos(i)-this.y*Math.sin(i);this.y=this.x*Math.sin(i)+this.y*Math.cos(i);return this},rotTo:function(j){var i=j-this.angle();return this.rotBy(i)},copy:function(){return new h(this.x,this.y)}};h.I=Object.freeze(new h(1,0,0));h.J=Object.freeze(new h(0,1,0));h.K=Object.freeze(new h(0,0,1));return h}()),drawVectors:function(r,s,t){var n=[],j=[],o=t[0],m=[],p=s.length;for(var h=p-1,l=0;l<p;l++){j[h]=s[l].distanceTo(s[h]);h=l}for(var l=0,h=p-1;l<p;l++){m[l]=Math.min(o,j[h]/2,j[l]/2)}for(var h=p-1,l=0;l<p;l++){n[h]=s[l].minus(s[h]).unitVector().scale(m[h]);h=l}var q=s[0].plus(n[0]);r.moveTo(q.x,q.y);for(l=0;l<p;l++){var k=l<p-1?l+1:0;q=s[k].minus(n[l]);r.lineTo(q.x,q.y);q=s[k].plus(n[k]);r.quadraticCurveTo(s[k].x,s[k].y,q.x,q.y)}},getFitSize:function(k){var l,m,j=k.object.width>k.frame.width||k.object.height>k.frame.height,h=k.frame.width/k.frame.height,n=k.object.width/k.object.height;if(!j&&!k.expand){return k.object}var i={};if(h>n){l="height";m="width";i.top=0}else{l="width";m="height";i.left=0}i[l]=k.frame[l];i[m]=(k.frame[l]/k.object[l])*k.object[m];return i},isTaintedCanvas:function(i){i=i instanceof HTMLCanvasElement?i.getContext("2d"):i;try{return !i.getImageData(0,0,1,1)}catch(h){return h.code===18}}};a.getParentWindow=function(){var h;var j;try{h=window.frameElement.ownerDocument;j=h.defaultView}catch(i){j=null}return j};a.getTrueHeight=function(){return(window.hasOwnProperty("innerHeight")?window.innerHeight:$(window).height())||480};d.exports=a},{"./class-storage":24}]},{},[38]);