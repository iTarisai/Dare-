var model=require("../fluid.model");var custWdgs=require("./customWidgets");var dbStorage=require("../../class-dbStorage");(function(){fluid.models.Account=fluid.Model.extend({_type:"accountModel",attrBlackList:["accountId"],idAttribute:"accountId",separateParams:["hint","tutorialLevel","billingCompany","billingCountry","billingAddress","billingVAT","gridStatus","gridSpacing","snapToWidget","receiptEmails","emailReceiptEnabled","lastOpenProject","everCreatedPage","everZoomedIntoPage","everAddedWidget","everMadeLink","everUsedPreview","everClosedPreview","upgradePromptCount","everUpgraded","pageLimitPromptClicks","projectLimitPromptClicks","screensExportPromptClicks","screenflowExportPromptClicks","htmlExportPromptClicks","reachedUpgradeSecondSection","proceedBillingButtonClicked","failedUpgradeSecondSection","reachedUpgradeThirdSection","upgradeFrameLoadingTime","editorLoadCountBeforeUpgrade","zoomMode","zoomTo","zoomScroll"],defaults:{email:"New",accType:"New",name:"",recurrance:"never",libraryWidth:423,loggedIn:"no",maxActiveProjects:1,maxPages:10,projectIds:[],uploads:[],lastOpenProject:"",createDate:new Date().getTime(),zoomTo:"100",zoomMode:"Smart",zoomScroll:"ScrollOn"},initialize:function(a,b){this.on("all",this.onChange,this);if(!this.customwidgets){this.customwidgets=new fluid.CustomWidgets(null,{accountModel:this})}},onChange:function(b,a){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,50)}if(!this.debouncedSyncUpParams){this.debouncedSyncUpParams=_.debounce(this.syncUpParams,5000)}this.debouncedSave.apply(this,arguments);if(_.keys(_.pick(a.changedAttributes(),a.separateParams)).length!==0){this.debouncedSyncUpParams.apply(this,arguments)}},isForever:function(){if((this.get("loggedIn")==="yes")&&(this.get("accType")==="premium1")){return true}return false},isFree:function(){return this.get("accType")==="Free"},isStandard:function(){return !/^Free$|lite|lite_2$/.test(this.get("accType"))},isPro:function(){return !/^Free$|lite|lite_2|silver$/.test(this.get("accType"))},parse:function(f,b){if(!f){return{}}var d=["a","r","sessionId","settings","objects","intercomUserHash","lastProjectId","upgradeDate","lastPaymentDate","nextPaymentDate","lastPaymentResult"],a=["maxActiveProjects","maxPages"],e,c;e=_.omit(f,d);for(c=0;c<a.length;c++){if(e[a[c]]!==undefined){e[a[c]]=~~e[a[c]]}}return e},bundle:function(){return this.pick(this.separateParams)},save:function(){var b=this.allToJSON();var a={id:this.get("accountId"),data:b};dbStorage.set("accounts",a)},syncUpParams:function(){fluid.main.fire("accountParamsChanged")},findUpload:function(d){var c;var a=this.get("uploads");for(var b=0;b<a.length;b++){if(d==a[b].id){c={index:b,upload:a[b]};break}}return c}})})();