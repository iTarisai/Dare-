var storage=require("./class-storage");var propInspectorCtrl=require("./class-propertyInspectorController");var utils=require("./utils");var staticWidgets={initMenus:function(){staticWidgets.fixedWidget=$("#fixedWidget");staticWidgets.unfixedWidget=$("#unfixedWidget");staticWidgets.fixedWidgetMenu=$("#fixedWidgetMenu");staticWidgets.fixedWidgetsEditor=$("#contextMenuItems .fixedWidgetsEditor");staticWidgets.pinnedBtn=$("#pinnedBtn");staticWidgets.unpinnedBtn=$("#unpinnedBtn")},changeContextMenuIndicators:function(b){var a=staticWidgets.determineStatic(b);staticWidgets.unfixedWidget.hide();staticWidgets.fixedWidget.hide();(a==false)?staticWidgets.unfixedWidget.show():staticWidgets.fixedWidget.show()},updateMenu:function(){var c=fluid.selection.getSelectionModel().getElements().not(".backgroundWidget");staticWidgets.changeContextMenuIndicators(c);var a=staticWidgets.staticMenuOpen;staticWidgets.hideMenu();if(a==true){var b=utils.findPositionOnScreen(c);if(c.length>0&&b==true){staticWidgets.showMenu(c)}}},hideMenu:function(){staticWidgets.staticMenuOpen=false;staticWidgets.fixedWidgetsEditor.hide()},positionMenu:function(){var b=$("#staticWidgetBtn");var a=parseInt(b.css("left"));var d=parseInt(b.css("width"));var e=parseInt($("#fixedWidgMenuHolder").css("width"))+(2*(parseInt($("#fixedWidgMenuHolder").css("padding-left"))));var c=a+d-e;staticWidgets.fixedWidgetMenu.css("left",(c)).css("top",45)},showMenu:function(b){staticWidgets.positionMenu();staticWidgets.staticMenuOpen=true;if(!b){b=fluid.selection.getSelectionModel().getElements()}staticWidgets.fixedWidgetsEditor.show();var a=staticWidgets.determineStatic(b);staticWidgets.updateButtonStates(a,b)},updateButtonStates:function(a,c){function b(){staticWidgets.pinnedBtn.hide().removeClass("pinBtnActivated");staticWidgets.unpinnedBtn.removeClass("pinBtnActivated singlePinnedBtn");$("#fixedWidgMenuHolder").removeClass("smallFixedWidgMenu")}b();var d=utils.findPositionOnScreen(c);if(d==true){switch(a){case (false):staticWidgets.pinnedBtn.show();staticWidgets.unpinnedBtn.addClass("pinBtnActivated");break;case ("front"):staticWidgets.pinnedBtn.show().addClass("pinBtnActivated");break;case ("back"):staticWidgets.pinnedBtn.show().addClass("pinBtnActivated");break}}else{if(a=="front"||a=="back"){staticWidgets.pinnedBtn.show().addClass("pinBtnActivated")}else{$("#fixedWidgMenuHolder").addClass("smallFixedWidgMenu");staticWidgets.unpinnedBtn.addClass("pinBtnActivated singlePinnedBtn");staticWidgets.positionMenu()}}},staticMenuOpen:false,toggleStaticWidgetMenu:function(){if(staticWidgets.staticMenuOpen==true){staticWidgets.hideMenu()}else{staticWidgets.showMenu();fluid.main.fire("staticwdgmenushown")}},hideStaticBoundary:function(){$("#staticBoundary1, #staticBoundary2").remove()},drawBoundaries:function(e){var d=$("#staticBoundary1, #staticBoundary2, #staticBoundary3, #staticBoundary4");d.remove();$staticBoundary1=$('<div id="staticBoundary1"></div>');$staticBoundary2=$('<div id="staticBoundary2"></div>');$staticBoundary3=$('<div id="staticBoundary3"></div>');$staticBoundary4=$('<div id="staticBoundary4"></div>');utils.getActivePage().append($staticBoundary1,$staticBoundary2,$staticBoundary3,$staticBoundary4);var b=e.pageId,g=e.pageHeight,a=e.pageWidth,c=e.deviceWidth,h=e.deviceHeight,f=1/fluid.zoom.getCurrentScale()*2;if(f<1){f=1}if(g!==h){$staticBoundary1.css({width:c,height:h,background:"linear-gradient(to right, #3FA9F5 0%, #3FA9F5 40.70588%, transparent 40.70588%)",backgroundPosition:"0 bottom",backgroundSize:"30px "+f+"px",backgroundRepeat:"repeat-x"});$staticBoundary2.css({left:15,width:c-15,height:h,background:"linear-gradient(to right, #FFFFFF 0%, #FFFFFF 40.70588%, transparent 40.70588%)",backgroundPosition:"0 bottom",backgroundSize:"30px "+f+"px",backgroundRepeat:"repeat-x"})}if(a!==c){$staticBoundary3.css({width:c,height:h,background:"linear-gradient(to bottom, #3FA9F5 0%, #3FA9F5 40.70588%, transparent 40.70588%)",backgroundPosition:"right 0",backgroundSize:f+"px 30px",backgroundRepeat:"repeat-y"});$staticBoundary4.css({top:15,width:c,height:h-15,background:"linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 40.70588%, transparent 40.70588%)",backgroundPosition:"right 0",backgroundSize:f+"px 30px",backgroundRepeat:"repeat-y"})}},zoomInBoundary:function(){if(fluid.main.project.get("active")===false){return}staticWidgets.hideStaticBoundary();var a=utils.getActivePageId();if(a){staticWidgets.showStaticBoundary(a)}},hLimiter:false,vLimiter:false,currentPageId:false,showStaticBoundary:function(d){var c=storage.get(d).width;var g=storage.get(d).height;var a=fluid.main.project.get("pageWH");a=$.extend(true,[],a);var b=fluid.main.project.pages.get(d).get("orientation");var f=a[0];var h=a[1];var e=(f<h)?"Portrait":"Landscape";if(b!==e){f=a[1];h=a[0]}staticWidgets.drawBoundaries({pageId:d,pageHeight:g,pageWidth:c,deviceWidth:f,deviceHeight:h})},determineStatic:function(c){allStaticWidgetsFront=[];if(c){var b=c}else{var b=fluid.selection.getSelectionModel().getElements()}b=b.not(".backgroundWidget");var d=b.length;if(d==0){a=false;return}b.each(function(){var f=$(this).attr("id");var e=storage.get(f);if(e.st=="f"){allStaticWidgetsFront.push(f)}});var a=false;if(allStaticWidgetsFront.length==d){a="front"}return a},getSelection:function(){var a=fluid.selection.getSelectionModel().getLockTos().getElements().not(".backgroundWidget");return a},mapSelection:function(e){var f=$([]);for(var d=0;d<e.length;d++){var c=$("#"+e[d]);var b=c.attr("data-lockto");var a=$("#"+b);var g=widget.getLockTos($("#"+b));f=f.add(g,a)}return f},createZalignOrder:function(b){var a=[];b.each(function(){var c=$(this);var d=c.nextAll(".rootWidget").first().attr("id");a.push({id:c.attr("id"),fromNextId:d})});return a},pushToForeground:function(){var b=staticWidgets.getSelection();if(b.length==0||!b){return}var a=staticWidgets.determineStatic(b);if(a=="toFront"){return}fluid.command.create("staticToForeground",{direction:"toForeground",pastState:a,sel:b,order:staticWidgets.createZalignOrder(b)}).dispatchTo("fluid.controllers.widget")},removeStaticProperty:function(){var b=staticWidgets.getSelection();if(b.length==0||!b){return}var a=staticWidgets.determineStatic(b);if(a==false){return}fluid.command.create("removeStaticWidgets",{pastState:a,sel:b}).dispatchTo("fluid.controllers.widget")},zAlignWidgets:function(c,e,d){var a=fluid.main.project.widgets.getRoots(c,{returnEls:true});var b=(e=="toBackground")?"cmBack":"cmFront";fluid.main.fire("zalignmentchange",{direction:b,roots:a,renderBlurs:d,pageId:utils.getActivePageId()})},alignAll:function(c){c=c||utils.getActivePageId();if(!c){return}var e=storage.get(c);var g=e.widgets;var j=$([]);var h=false;var a;if(g){for(var d=0;d<g.length;d++){var b=g[d];var f=storage.get(b);if(f.st=="f"){a=$("#"+b);h=utils.findPositionOnScreen(a);if(h==true){j=j.add(a)}}}}var k=false;staticWidgets.zAlignWidgets(j,"toForeground",k)},create:function(c,d){var b="f";c.each(function(){var e=$(this).attr("id");storage.get(e,{returnModel:true}).set({st:b})});var a=staticWidgets.determineStatic(c);staticWidgets.changeContextMenuIndicators(c);staticWidgets.updateButtonStates(a,c)},destroy:function(b){b.each(function(d){var e=$(this).attr("id");var c=fluid.main.project.get(e,{returnModel:true});c.unset("st")});var a=staticWidgets.determineStatic(b);staticWidgets.changeContextMenuIndicators(b);staticWidgets.updateButtonStates(a,b)},undoZalign:function(b){for(var a=b.length-1;a>=0;a--){var f=b[a];var e=$('[data-lockto="'+f.id+'"]');if(f.fromNextId){e.detach().insertBefore("#"+f.fromNextId)}else{var d=e.parent();e.detach().appendTo(d)}}var c=utils.getActivePageId();page.renderBlurs(c)}};fluid.main.on("closeallpopups",staticWidgets.hideMenu);fluid.main.on("pageactivated",staticWidgets.zoomInBoundary);module.exports=staticWidgets;