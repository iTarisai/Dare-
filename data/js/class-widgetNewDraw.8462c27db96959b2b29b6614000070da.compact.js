var widget=require("./class-widgetNewSegments");var browserDetect=require("./browserdetect");var storage=require("./class-storage");var utils=require("./utils");widget._drawFromRoot=function(r,q,c,j,o){j=j||widget.get(r);if(j.st=="g"){var p=j.ad;for(var m=0,h=p.length;m<h;m++){var n=p[m],k=n[0],s=widget.get(k);widget._drawFromRoot(k,q,c,s,[n[2],n[1],n[3]])}}else{var d=widget._draw(r,q,c,j,o);if(j.seg&&j.sc){var b=widget._setupSegments(j,c);for(var e=0,h=b.segments.length;e<h;e++){var f=b.segments[e];var a=[f.pos[0],f.pos[1],c[2],c[3]];widget._drawFromRoot(f.wId,q,a,f.wObj,[d.absTLWH[0],d.absTLWH[1]])}}if(!(j.ad&&j.ad.length)){return d}for(var e=0,h=j.ad.length;e<h;e++){var k=(d.ad[e])[0];var l=(d.ad[e])[3]||"tl";var o=[(d.ad[e])[2],(d.ad[e])[1],l];var s=false;widget._drawFromRoot(k,q,d.absTLWH,s,o)}}return d};widget._draw=function(i,c,b,a,h,e){var a=a||widget.get(i);if(!a){return false}var d=widget._setTMPLVars(i,a,b,h);if(d.isHelperWidget&&d.upload&&d.upload==="y"){d.data=i}var f=$("#tmplWidget2").tmpl(d);widget._drawCanvasOrImage(f,d);if(c){if(a.st=="b"){c.prepend(f)}else{if(e){if(e==="first"){c.prepend(f)}else{f.insertAfter($("#"+e))}}else{c.append(f)}}}return d};widget.adjustHandlesScale=function(){var f=fluid.zoom.getCurrentScale();var h=Math.round(12/f),c=Math.round(8/f),d=Math.round(8/f),b=Math.round(7/f),e=Math.round(1/f),a=$(".ui-selected .ui-resizable-handle");e=Math.max(e,1);requestAnimationFrame(function(){a.filter(".ui-resizable-n").css({top:-c,height:h});a.filter(".ui-resizable-s").css({bottom:-c,height:h});a.filter(".ui-resizable-e").css({right:-c,width:h});a.filter(".ui-resizable-w").css({left:-c,width:h});a.filter(".ui-resizable-ne").css({top:-b,right:-b,width:d,height:d,"outline-width":e});a.filter(".ui-resizable-nw").css({top:-b,left:-b,width:d,height:d,"outline-width":e});a.filter(".ui-resizable-se").css({bottom:-b,right:-b,width:d,height:d,"outline-width":e});a.filter(".ui-resizable-sw").css({bottom:-b,left:-b,width:d,height:d,"outline-width":e});a.show()})};widget._setTMPLVarsCache=[];widget._setTMPLVars=function(c,i,f,k,b){if(b&&widget._setTMPLVarsCache[c]){return widget._setTMPLVarsCache[c]}if(!b){widget._setTMPLVarsCache=[]}var e=$.extend(true,{},i);e.id=c;e.useCanvas=widget.useCanvas;e.includeCanvasOrImage=(((e.b||e.bg)&&!e.srps)||e.upload||e.i)?true:false;e.isRootwidget=(c==e.lockTo)?true:false;e.isSegmentRoot=Boolean(e.seg&&e.sc);e.isLibaryWidget=(e.lockTo!=undefined)?true:false;e.of=(e.of)?e.of:e.lockTo;e.isText=(i.ts||i.tc)?true:false;e.isBackgroundWidget=(i.st=="b")?true:false;e.isStaticWidgetForeground=(i.st=="f")?true:false;if(i.ts){var h=i.ts.match(/width:\s*100\%;\s*height:\s*100%;\s*white-space:\s*pre-wrap/g);if(h&&h.length){e.addWH=false}else{e.addWH=true}var m;var j="";if(e.ts.indexOf("font-size")!==-1){m=e.ts.substring(i.ts.indexOf("font-size")+10,e.ts.indexOf(";",e.ts.indexOf("font-size"))).trim();m=parseFloat(m)}else{var d=e.ts.match(/font:[^;]*;/g);if(d.length){var l=d[0].match(/[0-9]*px/g);if(l.length){m=parseFloat(l[0])}if(l.length&&l.length>1){j=l[1]}}}if(j===""&&e.ts.indexOf("line-height")!==-1){j=e.ts.substring(e.ts.indexOf("line-height")+12,e.ts.indexOf(";",e.ts.indexOf("line-height"))).trim()}if(m&&j.indexOf("normal")!==-1){if(e.ts.indexOf("line-height")!==-1){e.ts=e.ts.replace(/line-height:\s*normal/g,"line-height: "+Math.round(m*1.14)+"px")}else{e.ts=e.ts.replace(/[0-9]*px\/[0-9]px/g,m+"px/"+Math.round(m*1.14)+"px")}}else{if(m&&j===""){e.ts=e.ts+"; line-height: "+Math.round(m*1.14)+"px;"}}}if(!e.tlwh){var a=e.wh||[f[2],f[3]];e.tlwh=[0,0,a[0],a[1]]}e.ca=(k)?k[2]||"tl":e.ca||"tl";e.absTLWH=widget._getAbsTLWH(c,e,f,k);if(b){widget._setTMPLVarsCache[c]=e}return e};widget._getAbsTLWH=function(n,m,k,c){function h(x,y){var e=parseFloat(x);return Math.round(e*y/100)}if(!m.of||n==m.of){var l=$.extend([],k)}else{var l=$.extend([],k);var d=widget.get(m.of);if(d){l=widget._getAbsTLWH(m.of,d,k,false)}}var r,q;var a=Boolean(m.segment&&d&&d.sp);var w=a?d.sp[0]+d.sp[3]:0;var p=a?d.sp[1]+d.sp[2]:0;if(!m.tlwh){m.tlwh=[0,0,m.wh[0],m.wh[1]]}if((m.seg||m.segments)&&(m.tlwh[2]=="a"||m.tlwh[3]=="a")){var f=widget._getSegmentRootTLWH(n,m);r=f[2];q=f[3]}else{var r=(m.tlwh[2]==="a")?"100%":m.tlwh[2];var q=(m.tlwh[3]==="a")?"100%":m.tlwh[3]}r=(typeof(r)==="string")?h(r,l[2]-w):r;q=(typeof(q)==="string")?h(q,l[3]-p):q;var v=(c)?c[0]:m.tlwh[0];var b=(c)?c[1]:m.tlwh[1];var j=(typeof(v)==="string")?h(v,l[3]-p):v;var i=(typeof(b)==="string")?h(b,l[2]-w):b;var o=m.ca||"tl";try{var u=(o[0]=="b")?l[3]-q-j:j;var t=(o[1]=="r")?l[2]-r-i:i}catch(s){var u=0;var t=0}u=(o[0]=="c")?j+l[3]/2-q/2:u;t=(o[1]=="c")?i+l[2]/2-r/2:t;u+=l[0];t+=l[1];return[Math.round(u),Math.round(t),Math.round(r),Math.round(q)]};widget._drawCanvasOrImage=function(e,c){if(!c.includeCanvasOrImage){return false}var b={width:c.absTLWH[2],height:c.absTLWH[3]};var d=$("<canvas>").attr(b);var a=d[0].getContext("2d");widget._paintCanvas(e,a,c);return true};widget.getImageData=function(d,b){var c=storage.get(d);var a=d||false;if(a&&a.substr(0,5)!="data:"){if(b&&(!c||!c.storage||c.storage=="cloud")){a=imgCloudUrl+d+".png"}else{a=apiObjectUrl("img",d)}}else{if(tmplVars.id){if(b&&(!c||!c.storage||c.storage=="cloud")){a=imgCloudUrl+tmplVars.id+".png"}else{a=apiObjectUrl("img",tmplVars.id)}}}return a};widget._drawPreviewImageUpload=function(c,a){c.get(0).innerHTML='<img class="preview-upload-image">';$imgEl=c.find("img");$imgEl.get(0).onerror=function(){if(this.src.indexOf("/data/img")===-1){this.onerror=function(){};this.src=widget.getImageData(a.data,false)}};if(location.origin==="file://"||location.origin==="null"){var b="";switch(a.type){case"image/svg+xml":b=".svg";break;default:b=".png";break}$imgEl.get(0).src="img/"+a.data+b}else{$imgEl.get(0).src=widget.getImageData(a.data,true)}};widget._drawImageUpload=function(k,d){var b={width:d.absTLWH[2],height:d.absTLWH[3]};var c=k.find("canvas");var e=c.size()>0?c:$("<canvas/>");e.attr(b);var l=e[0].getContext("2d");function h(o,n,m,q){if(!n.tlwh[2]||!n.tlwh[3]){n.tlwh[2]=this.width;n.tlwh[3]=this.height;o.css({width:n.tlwh[2],height:n.tlwh[3]});$(m.canvas).attr({width:n.tlwh[2],height:n.tlwh[3]});widget.scale(o.closest(".widgetParts"),n)}if(q){var p=new Image();p.src=q;p.onload=function(){m.drawImage(p,0,0,n.tlwh[2],n.tlwh[3])}}else{m.drawImage(this,0,0,n.tlwh[2],n.tlwh[3])}}function j(n,m){if(this.src.indexOf("/data/img")===-1){var o=new Image();o.src=i(false);o.onload=h;img=o;o.onerror=function(){$(l.canvas).addClass("failureImage");l.font="32pt Arial";l.fillText("Image",35,50);l.fillText("not found",10,115)}}else{$(l.canvas).addClass("failureImage");l.font="32pt Arial";l.fillText("Image",35,50);l.fillText("not found",10,115)}this.onerror=null}function a(){if(this.src.indexOf("/data/img")===-1){delete this.crossOrigin;this.removeAttribute("crossorigin");this.src=i(false)}else{j.apply(this,arguments);widget._convertCanvasToImg($(l.canvas),k.find("img"),d)}this.onerror=null}function i(n){var o=storage.get(d.data);var m=d.data||false;if(m&&m.substr(0,5)!="data:"){if(n&&(!o||!o.storage||o.storage=="cloud")){m=imgCloudUrl+d.data+".png"}else{m=apiObjectUrl("img",d.data)}}else{if(d.id){if(n&&(!o||!o.storage||o.storage=="cloud")){m=imgCloudUrl+d.id+".png"}else{m=apiObjectUrl("img",d.id)}}}return m||j()}if((c.length||k.find("img"))&&d.simpleUploadResize){return}var f=k.find("img").get(0);fluid.upload.get({id:d.data||d.id,image:f,callback:function(p,o,n,m){if(p.find("img").length===0&&m.imgData){h.call(m.image,p,o,n,m.imgData)}}.bind(this,k,d,l),priority:fluid.upload.priority.pageZoomedIn});return};widget._convertCanvasToImg=function(d,c,b){function a(){var e=d[0].toDataURL("image/png");if(e!="data:,"){c.attr("src",e)}}a()};widget._paintCanvas=function(t,o,f){var r={blur:function(){if(f.blur&&!((browserDetect.browser==="Chrome"||browserDetect.browser==="Safari")&&document.domain==="")){var y=t[0],u,v;if(window.g_preview||!storage.get(f.id).getPage){u=storage.get(window.g_preview||fluid.main.project.get("id")).pages;for(var w=0,c=u.length;w<c;w++){var x=u[w];if(storage.get(x).widgets.indexOf(f.id)!==-1){v=x;break}}v=v||document.querySelector(".canvasObject.active").id}else{v=storage.get(f.id,{returnModel:true}).getPage().id}widget.renderBlurLayer(y.id,v,function(i){widget.blurLayers[y.id]=i;widget.setBlurBG(y)});if(widget.blurLayers[y.id]){widget.setBlurBG(y)}}},background:function(){o.save();function c(){var u=(f.bgc)?f.bgc:["#CAD1D7","#C4CBD3"];var w=[5,2];var v="v";if(f.bgd){v=f.bgd[0];w=[f.bgd[1],f.bgd[2]]}o.fillStyle=u[1];o.fill();o.fillStyle=u[0];if(v=="v"){for(var x=w[0];x<d;){o.fillRect(x,0,w[1],s);x+=w[0]}}else{for(var x=w[0];x<s;){o.fillRect(0,x,d,w[1]);x+=w[0]}}}if(!d){d=0}if(!s){s=0}if(f.bg=="c"){o.fillStyle=f.bgc[0];o.fill()}else{if(f.bg=="s"){c()}else{if(f.bg=="l"){g=o.createLinearGradient(0,0,0,s);r._gradient(g,o,f)}else{if(f.bg=="lrl"){g=o.createLinearGradient(0,0,d,0);r._gradient(g,o,f)}else{if(f.bg=="ld"){g=o.createLinearGradient(0,0,d,s);r._gradient(g,o,f)}else{if(f.bg=="ld2"){g=o.createLinearGradient(d,0,0,s);r._gradient(g,o,f)}else{if(f.bg=="r"){g=o.createRadialGradient(d/2,s/2,0,d/2,s/2,s/2);r._gradient(g,o,f)}}}}}}}o.restore()},border:function(y,u,v,i){var x=0,w=0;y.lineWidth=(typeof n)==="number"?n:b;y.strokeStyle=u.b[1];y.stroke();y.save()},path:function(ac,ai,K,F,C,i,v,B,H){ac.beginPath();var W=F+Math.floor(B/2);var aa=C+Math.floor(B/2);var ae=F+v-Math.floor(B/2);var Y=C+i-Math.floor(B/2);if(H.sh&&H.sh[3]&&H.sh[2]){W+=Math.floor(H.sh[3]-H.sh[2]/2);aa+=Math.floor(H.sh[3]-H.sh[2]/2);ae-=Math.floor(H.sh[3]+H.sh[2]/2);Y-=Math.floor(H.sh[3]+H.sh[2]/2)}if($.isArray(K)){for(var ab=0;ab<4;ab++){K[ab]=K[ab]||0}}else{K=[K,K,K,K]}if(ai=="sq"){var ad=Math.min((Y-aa)/2,(ae-W)/2);K[0]=Math.min(K[0],ad);K[1]=Math.min(K[1],ad);K[2]=Math.min(K[2],ad);K[3]=Math.min(K[3],ad);ac.moveTo(aa+K[0],W),ac.lineTo(Y-K[1],W),ac.quadraticCurveTo(Y,W,Y,W+K[1]),ac.lineTo(Y,ae-K[2]),ac.quadraticCurveTo(Y,ae,Y-K[2],ae),ac.lineTo(aa+K[3],ae),ac.quadraticCurveTo(aa,ae,aa,ae-K[3]),ac.lineTo(aa,W+K[0]),ac.quadraticCurveTo(aa,W,aa+K[0],W)}if(ai=="arrU"){var N=(Y-aa)+(5/4);w=ae-W,P=(Y-aa)*1.5;if(w<=P){N=(ae-W)/2}var U=[utils.Vector((aa+Y)/2,W+B),utils.Vector(Y-(B/2),W+N),utils.Vector((aa+Y)*0.65,W+N),utils.Vector((aa+Y)*0.65,ae),utils.Vector((aa+Y)*0.35,ae),utils.Vector((aa+Y)*0.35,W+N),utils.Vector(aa+(B/2),W+N)];utils.drawVectors(ac,U,K)}if(ai=="arrD"){var N=(Y-aa)+(5/4);var w=ae-W;var P=(Y-aa)*1.5;if(w<=P){N=(ae-W)/2}var U=[utils.Vector((aa+Y)/2,ae-B),utils.Vector(Y-(B/2),ae-N),utils.Vector((aa+Y)*0.65,ae-N),utils.Vector((aa+Y)*0.65,W),utils.Vector((aa+Y)*0.35,W),utils.Vector((aa+Y)*0.35,ae-N),utils.Vector(aa+(B/2),ae-N),utils.Vector((aa+Y)/2,ae)];utils.drawVectors(ac,U,K)}if(ai=="arrR"){var N=(ae-W)+(5/4);var z=Y-aa;var M=(ae-W)*1.5;if(z<=M){N=(Y-aa)/2}var U=[utils.Vector(Y-B,(W+ae)/2),utils.Vector(Y-N,ae-(B/2)),utils.Vector(Y-N,(W+ae)*0.65),utils.Vector(aa,(W+ae)*0.65),utils.Vector(aa,(W+ae)*0.35),utils.Vector(Y-N,(W+ae)*0.35),utils.Vector(Y-N,W+(B/2)),utils.Vector(Y-B,(W+ae)/2)];utils.drawVectors(ac,U,K)}if(ai=="arrL"){var N=(ae-W)+(5/4);var z=Y-aa;var M=(ae-W)*1.5;if(z<=M){N=(Y-aa)/2}var U=[utils.Vector(aa+B,(W+ae)/2),utils.Vector(aa+N,ae-(B/2)),utils.Vector(aa+N,(W+ae)*0.65),utils.Vector(Y,(W+ae)*0.65),utils.Vector(Y,(W+ae)*0.35),utils.Vector(aa+N,(W+ae)*0.35),utils.Vector(aa+N,W+(B/2)),utils.Vector(aa+B,(W+ae)/2)];utils.drawVectors(ac,U,K)}if(ai=="image"){ac.moveTo(aa,W);ac.lineTo(Y,W);ac.lineTo(Y,ae);ac.lineTo(aa,ae);ac.lineTo(aa,W);ac.moveTo(aa,W);ac.lineTo(aa+1,W);ac.lineTo(Y,ae-1);ac.lineTo(Y,ae);ac.lineTo(Y-1,ae);ac.lineTo(aa,W-1);ac.lineTo(aa,W);ac.moveTo(Y-1,W);ac.lineTo(Y,W);ac.lineTo(Y,W-1);ac.lineTo(aa+1,ae);ac.lineTo(aa,ae);ac.lineTo(aa,ae-1);ac.lineTo(Y-1,W)}else{if(ai=="tri"){var U=[utils.Vector(aa,W),utils.Vector(Y,W),utils.Vector(Y,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="trR"){var U=[utils.Vector(aa,W),utils.Vector(Y,W),utils.Vector(aa,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="ttrL"){var U=[utils.Vector(Y,W),utils.Vector(Y,ae),utils.Vector(aa,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="ttrR"){var U=[utils.Vector(aa,W),utils.Vector(Y,ae),utils.Vector(aa,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="triU"){var U=[utils.Vector((aa+Y)/2,W),utils.Vector(Y,ae),utils.Vector(aa,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="triD"){var U=[utils.Vector(aa,W),utils.Vector(Y,W),utils.Vector((aa+Y)/2,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="triR"){var U=[utils.Vector(aa,W),utils.Vector(Y,(W+ae)/2),utils.Vector(aa,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="triL"){var U=[utils.Vector(Y,W),utils.Vector(aa,(W+ae)/2),utils.Vector(Y,ae)];utils.drawVectors(ac,U,K)}else{if(ai=="ribU"){ac.moveTo(aa,W);ac.lineTo((aa+Y)/2,(W+ae)/4);ac.lineTo(Y,W);ac.lineTo(Y,ae);ac.lineTo(aa,ae);ac.lineTo(aa,W)}else{if(ai=="ribD"){ac.moveTo(aa,W);ac.lineTo(Y,W);ac.lineTo(Y,ae);ac.lineTo((aa+Y)/2,(3/4)*(W+ae));ac.lineTo(aa,ae);ac.lineTo(aa,W)}else{if(ai=="flagR"){ac.moveTo(aa,W);ac.lineTo(Y,W);ac.lineTo((4/5)*(aa+Y),(W+ae)/2);ac.lineTo(Y,ae);ac.lineTo(aa,ae);ac.lineTo(aa,W)}else{if(ai=="flagL"){ac.moveTo(aa,W);ac.lineTo((1/5)*(aa+Y),(W+ae)/2);ac.lineTo(aa,ae);ac.lineTo(Y,ae);ac.lineTo(Y,W);ac.lineTo(aa,W)}else{if(ai=="houseU"){var U=[utils.Vector(Y,(3/7)*(W+ae)),utils.Vector(Y,ae),utils.Vector(aa,ae),utils.Vector(aa,(3/7)*(W+ae)),utils.Vector((aa+Y)/2,W)];utils.drawVectors(ac,U,K)}else{if(ai=="houseD"){var U=[utils.Vector((aa+Y)/2,ae),utils.Vector(Y,(4/7)*(W+ae)),utils.Vector(Y,W),utils.Vector(aa,W),utils.Vector(aa,(4/7)*(W+ae))];utils.drawVectors(ac,U,K)}else{if(ai=="oct"){var ag=21/72,E=51/72,J=aa+Y,I=W+ae,U=[utils.Vector(ag*J,W),utils.Vector(E*J,W),utils.Vector(Y,ag*I),utils.Vector(Y,E*I),utils.Vector(E*J,ae),utils.Vector(ag*J,ae),utils.Vector(aa,E*I),utils.Vector(aa,ag*I)];utils.drawVectors(ac,U,K)}else{if(ai=="star"){var U=[utils.Vector((aa+Y)/2,W),utils.Vector((33/54)*(aa+Y),(39/102)*(ae+W)),utils.Vector(Y,(39/102)*(ae+W)),utils.Vector((75/108)*(aa+Y),(63/102)*(ae+W)),utils.Vector((87/108)*(aa+Y),ae),utils.Vector((aa+Y)/2,(39/51)*(ae+W)),utils.Vector((21/108)*(aa+Y),ae),utils.Vector((33/108)*(aa+Y),(63/102)*(ae+W)),utils.Vector(aa,(39/102)*(ae+W)),utils.Vector((21/54)*(aa+Y),(39/102)*(ae+W))];utils.drawVectors(ac,U,K)}else{if(ai=="pgL"){var U=[utils.Vector(aa,ae),utils.Vector(Y,ae),utils.Vector(Y,W),utils.Vector((aa+Y)/3,W),utils.Vector(aa,(W+ae)/4)];utils.drawVectors(ac,U,K)}else{if(ai=="pgR"){var U=[utils.Vector(Y,ae),utils.Vector(aa,ae),utils.Vector(aa,W),utils.Vector((2/3)*(aa+Y),W),utils.Vector(Y,(W+ae)/4)];utils.drawVectors(ac,U,K)}else{if(ai=="pointrL"){var U=[utils.Vector(aa,W),utils.Vector(Y,W),utils.Vector((5/7)*(aa+Y),(3/7)*(W+ae)),utils.Vector((5/7)*(aa+Y),ae),utils.Vector(aa,W)];utils.drawVectors(ac,U,K)}else{if(ai=="pointrR"){var U=[utils.Vector(aa,W),utils.Vector(Y,W),utils.Vector((2/7)*(aa+Y),ae),utils.Vector((2/7)*(aa+Y),(3/7)*(W+ae)),utils.Vector(aa,W)];utils.drawVectors(ac,U,K)}else{if(ai=="ldL"){ac.moveTo(aa,W);ac.lineTo(aa+2,W);ac.lineTo(Y,ae);ac.lineTo(Y-2,ae);ac.lineTo(aa,W)}else{if(ai=="ldR"){ac.moveTo(Y,W);ac.lineTo(Y-2,W);ac.lineTo(aa,ae);ac.lineTo(aa+2,ae);ac.lineTo(Y,W)}else{if(ai=="dropD"){ac.moveTo((aa+Y)/2,W);ac.lineTo((aa+Y)/6,(W+ae)/2);ac.bezierCurveTo(aa-((aa+Y)*(1.5/6)),ae+((ae+W)/6.2),Y+((aa+Y)*(1.5/6)),ae+((ae+W)/6.2),(aa+Y)*(5/6),(W+ae)/2);ac.lineTo((aa+Y)/2,W)}else{if(ai=="dropU"){ac.moveTo((aa+Y)/2,ae);ac.lineTo((aa+Y)/6,(W+ae)/2);ac.bezierCurveTo(aa-((aa+Y)*(1.5/6)),W-((ae+W)/6.2),Y+((aa+Y)*(1.5/6)),W-((ae+W)/6.2),(aa+Y)*(5/6),(W+ae)/2);ac.lineTo((aa+Y)/2,ae)}else{if(ai=="oval"){ac.moveTo(aa,(ae+W)/2);ac.bezierCurveTo((aa+Y)*(1/4),W-((ae+W)/7),(aa+Y)*(3/4),W-((ae+W)/7),Y,(ae+W)/2);ac.bezierCurveTo((aa+Y)*(3/4),ae+((ae+W)/7),(aa+Y)*(1/4),ae+((ae+W)/7),aa,(ae+W)/2)}else{if(ai=="cloud"){ac.moveTo((aa+Y)*(1.5/9),ae);ac.bezierCurveTo(aa,ae,aa,(W+ae)*(7/11),(aa+Y)*(1.6/9),(ae+W)*(7/11));ac.bezierCurveTo((aa+Y)/9,(ae+W)/3,(aa+Y)/3,(ae+W)/6.3,(aa+Y)*(4/9),(ae+W)/3.2);ac.bezierCurveTo((aa+Y)*(4.5/9),W,(aa+Y)*(7.4/9),W,(aa+Y)*(7.3/9),(ae+W)/2);ac.bezierCurveTo(Y,(ae+W)/2,Y,ae,(aa+Y)*(7.7/9),ae);ac.lineTo((aa+Y)*(1.5/9),ae)}else{if(ai=="person"){ac.moveTo(aa,ae);ac.bezierCurveTo((aa+Y)/16,(W+ae)*(11/14),(aa+Y)*(3/16),(W+ae)*(10/14),(aa+Y)*(6/16),(ae+W)*(9/14));ac.bezierCurveTo((aa+Y)*(2.5/16),(W+ae)*(4/7),(aa+Y)*(2.5/16),W,(aa+Y)/2,W);ac.bezierCurveTo((aa+Y)*(13.5/16),W,(aa+Y)*(13.5/16),(W+ae)*(4/7),(aa+Y)*(10/16),(ae+W)*(9/14));ac.bezierCurveTo((aa+Y)*(13/16),(W+ae)*(10/14),(aa+Y)*(15/16),(W+ae)*(11/14),Y,ae);ac.lineTo(aa,ae)}else{if(ai=="thumbsU"){ac.moveTo(aa,(W+ae)*(16/17));ac.lineTo(aa,(W+ae)*(15/34));ac.bezierCurveTo((aa+Y)*(2/15),(W+ae)*(7/17),(aa+Y)*(9/30),(W+ae)*(4/17),(aa+Y)/3,(ae+W)*(3/34));ac.bezierCurveTo((aa+Y)*(5.2/15),W,(aa+Y)*(9/15),W,(aa+Y)*(8.5/15),(W+ae)*(2/17));ac.lineTo((aa+Y)*(7/15),(W+ae)*(11/34));ac.bezierCurveTo((aa+Y)*(9/15),(W+ae)*(13/34),(aa+Y)*(11/15),(W+ae)*(13/34),(aa+Y)*(12/15),(W+ae)*(13/34));ac.bezierCurveTo(Y,(W+ae)*(13/34),Y,(W+ae)*(19/34),(aa+Y)*(12/15),(W+ae)*(19/34));ac.bezierCurveTo((aa+Y)*(14/15),(W+ae)*(19/34),(aa+Y)*(27/30),(W+ae)*(12/17),(aa+Y)*(23/30),(W+ae)*(12/17));ac.bezierCurveTo((aa+Y)*(13/15),(W+ae)*(12/17),(aa+Y)*(25/30),(W+ae)*(29/34),(aa+Y)*(11/15),(W+ae)*(29/34));ac.bezierCurveTo((aa+Y)*(25/30),(W+ae)*(29/34),(aa+Y)*(12/15),ae,(aa+Y)*(8.5/15),ae);ac.bezierCurveTo((aa+Y)/2,ae,(aa+Y)/5,ae,aa,(W+ae)*(16/17))}else{if(ai=="thumbsD"){ac.moveTo(aa,(W+ae)/17);ac.lineTo(aa,(W+ae)*(19/34));ac.bezierCurveTo((aa+Y)*(2/15),(W+ae)*(10/17),(aa+Y)*(9/30),(W+ae)*(13/17),(aa+Y)/3,(ae+W)*(31/34));ac.bezierCurveTo((aa+Y)*(5.2/15),ae,(aa+Y)*(9/15),ae,(aa+Y)*(8.5/15),(W+ae)*(15/17));ac.lineTo((aa+Y)*(7/15),(W+ae)*(23/34));ac.bezierCurveTo((aa+Y)*(9/15),(W+ae)*(21/34),(aa+Y)*(11/15),(W+ae)*(21/34),(aa+Y)*(12/15),(W+ae)*(21/34));ac.bezierCurveTo(Y,(W+ae)*(21/34),Y,(W+ae)*(15/34),(aa+Y)*(12/15),(W+ae)*(15/34));ac.bezierCurveTo((aa+Y)*(14/15),(W+ae)*(15/34),(aa+Y)*(27/30),(W+ae)*(5/17),(aa+Y)*(23/30),(W+ae)*(5/17));ac.bezierCurveTo((aa+Y)*(13/15),(W+ae)*(5/17),(aa+Y)*(25/30),(W+ae)*(5/34),(aa+Y)*(11/15),(W+ae)*(5/34));ac.bezierCurveTo((aa+Y)*(25/30),(W+ae)*(5/34),(aa+Y)*(12/15),W,(aa+Y)*(8.5/15),W);ac.bezierCurveTo((aa+Y)/2,W,(aa+Y)/5,W,aa,(W+ae)/17)}else{if(ai=="arcL"){var i=Y-aa;var v=ae-W;var X=(v>=(i*2))?i:v/2;ac.moveTo(aa+X,W);ac.arcTo(aa,W,aa,W+X,X);ac.arcTo(aa,W+(2*X),aa+X,W+(2*X),X);ac.lineTo(aa+X,W)}else{if(ai=="arcR"){var i=Y-aa;var v=ae-W;var X=(v>=(i*2))?i:v/2;ac.moveTo(aa,W);ac.arcTo(aa+X,W,aa+X,W+X,X);ac.arcTo(aa+X,W+(2*X),aa,W+(2*X),X);ac.lineTo(aa,W)}else{if(ai=="arcU"){var i=Y-aa;var v=ae-W;var X=(i>=(v*2))?v:i/2;ac.moveTo(aa,W+X);ac.arcTo(aa,W,aa+X,W,X);ac.arcTo(aa+(2*X),W,aa+(2*X),W+(2*X),X);ac.lineTo(aa,W+X)}else{if(ai=="arcD"){var i=Y-aa;var v=ae-W;var X=(i>=(v*2))?v:i/2;ac.moveTo(aa,W);ac.arcTo(aa,W+X,aa+X,W+X,X);ac.arcTo(aa+(2*X),W+X,aa+(2*X),W,X);ac.lineTo(aa,W)}else{if(ai=="folder"){var S=K[0],i=Y-W,v=ae-W,L={x:(3/8)*(Y+aa),y:(2/15)*(W+ae)},G={x:(5/16)*(Y+aa),y:W},R={x:G.x+(L.x-G.x)/2,y:W+(L.y-W)/2},af=Math.sqrt(R.x*R.x+R.y*R.y);K[1]=Math.min(S,(i-L.x)/2,v/2);K[2]=Math.min(S,(ae-L.y)/2,(L.x-W)/2);K[4]=Math.min(S,v/2,(G.x-aa)/2),K[1]=K[4]=Math.min(K[1],K[4]);K[3]=Math.min(K[4],K[2]);K[0]=Math.min(S,af,K[4]);K[5]=K[0];ac.moveTo(L.x+K[0],L.y);ac.lineTo(Y-K[1],L.y);ac.quadraticCurveTo(Y,L.y,Y,L.y+K[1]);ac.lineTo(Y,ae-K[2]);ac.quadraticCurveTo(Y,ae,Y-K[2],ae);ac.lineTo(aa+K[3],ae);ac.quadraticCurveTo(aa,ae,aa,ae-K[3]);ac.lineTo(aa,W+K[4]);ac.quadraticCurveTo(aa,W,aa+K[4],W);ac.lineTo(G.x-K[5],G.y);ac.quadraticCurveTo(G.x,G.y,R.x,R.y);ac.quadraticCurveTo(L.x,L.y,L.x+K[0],L.y)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(ai=="speechRight"){ac.moveTo(Y-17,ae);ac.lineTo(Y-96,ae-13);ac.lineTo(aa,ae-13);ac.lineTo(aa,W);ac.lineTo(Y,W);ac.lineTo(Y,ae-13);ac.lineTo(Y-38,ae-13);ac.lineTo(Y-17,ae)}if(ai=="speechLeft"){ac.moveTo(aa+17,ae);ac.lineTo(aa+96,ae-13);ac.lineTo(Y,ae-13);ac.lineTo(Y,W);ac.lineTo(aa,W);ac.lineTo(aa,ae-13);ac.lineTo(aa+38,ae-13);ac.lineTo(aa+17,ae)}else{if(ai=="bubr"){right=i-1;bottom=v-2;tailSize=7;if(H.b){F=F+H.b[0]/2;C=C+H.b[0]/2;right=right-H.b[0]/2;bottom=bottom-H.b[0]/2}ac.moveTo(right-tailSize,bottom-7);ac.lineTo(right-tailSize,F+K[1]);ac.quadraticCurveTo(right-tailSize,F,right-K[1]-tailSize,F);ac.lineTo(C+K[0],F);ac.quadraticCurveTo(C,F,C,F+K[0]);ac.lineTo(C,bottom-K[3]);ac.quadraticCurveTo(C,bottom,C+K[3],bottom);ac.lineTo(right-19,bottom);ac.quadraticCurveTo(right-15,bottom-1,right-14,bottom-2);ac.quadraticCurveTo(right-7,bottom+1,right-1,bottom-2);ac.quadraticCurveTo(right-tailSize,bottom-3,right-tailSize,bottom-7)}else{if(ai=="bubl"){right=i-1;bottom=v-2;tailSize=7;if(H.b){F=F+H.b[0]/2;C=C+H.b[0]/2;right=right-H.b[0]/2;bottom=bottom-H.b[0]/2}ac.moveTo(right,bottom-K[2]);ac.lineTo(right,F+K[1]);ac.quadraticCurveTo(right,F,right-K[1],F);ac.lineTo(C+K[0]+tailSize,F);ac.quadraticCurveTo(C+tailSize,F,C+tailSize,F+K[0]);ac.lineTo(C+tailSize,bottom-6);ac.quadraticCurveTo(C+4,bottom-1,C+1,bottom-2);ac.quadraticCurveTo(C+2,bottom+2,C+13,bottom-2);ac.quadraticCurveTo(C+15,bottom,C+19,bottom);ac.lineTo(right-K[2],bottom);ac.quadraticCurveTo(right,bottom,right,bottom-K[2])}else{if(ai=="arrowL"||ai=="arrowR"||ai=="arrowU"||ai=="arrowD"){var ah=2;if(H.aCurve){ah=H.aCurve}var O=12;if(H.aSize){O=H.aSize}if(ai=="arrowL"){ac.moveTo(aa+O,W);ac.lineTo(Y-K[1],W);ac.quadraticCurveTo(Y,W,Y,W+K[1]);ac.lineTo(Y,ae-K[2]);ac.quadraticCurveTo(Y,ae,Y-K[2],ae);ac.lineTo(aa+O,ae);ac.bezierCurveTo(aa+O-ah,ae,aa,((ae+W)/2)+ah,aa,(ae+W)/2);ac.bezierCurveTo(aa,((ae+W)/2)-ah,O-ah,W,aa+O,W)}else{if(ai=="arrowR"){ac.moveTo(aa+K[0],W);ac.lineTo(Y-O,W);ac.bezierCurveTo(Y-O+ah,W,Y,((W+ae)/2)-ah,Y,(W+ae)/2);ac.bezierCurveTo(Y,((W+ae)/2)+ah,Y-O+ah,ae,Y-O,ae);ac.lineTo(aa+K[3],ae);ac.quadraticCurveTo(aa,ae,aa,ae-K[3]);ac.lineTo(aa,W+K[0]);ac.quadraticCurveTo(aa,W,aa+K[0],W)}else{if(ai=="arrowD"){var A=(H.aW)?H.aW:A;var u=(aa+Y)/2;var Z=A/2;ac.moveTo(aa+K[0],W);ac.lineTo(Y-K[1],W);ac.quadraticCurveTo(Y,W,Y,W+K[1]);ac.lineTo(Y,ae-O-K[2]);ac.quadraticCurveTo(Y,ae-O,Y-K[2],ae-O);ac.lineTo(u+Z,ae-O);ac.lineTo(u,ae);ac.lineTo(u-Z,ae-O);ac.lineTo(aa+K[3],ae-O);ac.quadraticCurveTo(aa,ae-O,aa,ae-O-K[3]);ac.lineTo(aa,W+K[0]);ac.quadraticCurveTo(aa,W,aa+K[0],W)}else{if(ai=="arrowU"){var A=(H.aW)?H.aW:20;var u=(aa+Y)/2;var Z=A/2;ac.moveTo(aa+K[0],W+O);ac.lineTo(u-Z,W+O);ac.lineTo(u,W);ac.lineTo(u+Z,W+O);ac.lineTo(Y-K[1],W+O);ac.quadraticCurveTo(Y,W+O,Y,W+O+K[1]);ac.lineTo(Y,ae-K[2]);ac.quadraticCurveTo(Y,ae,Y-K[2],ae);ac.lineTo(aa+K[2],ae);ac.quadraticCurveTo(aa,ae,aa,ae-K[3]);ac.lineTo(aa,W+O+K[0]);ac.quadraticCurveTo(aa,W+O,aa+K[3],W+O)}}}}}else{if(ai=="c"){var V=i/2,T=v/2,D=Math.min(V,T),Q=Math.min(B|0,D),X=D-Q/2;if(X<0){X=0}n=Q;ac.arc(V,T,X,0,Math.PI*2,true)}}}}}ac.closePath()},_gradient:function(y,A,w){var u=["#ffffff","#000000"];var x=[0,1];if(w.bgc&&w.bgd){u=w.bgc;x=w.bgd}for(var v=0;v<u.length&&v<x.length;v++){try{y.addColorStop(x[v],u[v])}catch(z){}}A.fillStyle=y;A.fill()},_glaze:function(y,v){var C=5,z=2,w=10,u=v.absTLWH[2]-27,B=10,i=0,A=7;if(v.s=="bubl"){w+=A}r.path(y,"sq",C,z,w,u,B,i,v);var x=y.createLinearGradient(0,z+B,0,z);x.addColorStop(0,"rgba(231, 231, 231, 0.2)");x.addColorStop(0.59,"rgba(240, 240, 240, 0.25)");x.addColorStop(1,"rgba(249, 249, 249, 0.3)");y.fillStyle=x;y.fill();y.restore()},_shadow:function(u,i){u.shadowColor=i.sh[0];u.shadowOffsetX=i.sh[1];u.shadowOffsetY=i.sh[2];u.shadowBlur=i.sh[3]},_effect:function(G,v){var u=v.fx;for(var B=0;B<u.length;B++){var D=u[B];if(D[0]=="dots"){var K=D[1];var E=D[2];var J=D[3];G.fillStyle=D[4];var x=v.absTLWH[2];var w=v.absTLWH[3];var H=K+E;var C=K+J;var I=parseInt(x/H)+1;var F=parseInt(w/C)+1;var A=0;for(var z=0;z<F;z++){A=(A)?0:K;for(var y=0;y<I;y++){G.beginPath();G.arc((y*H)+A,(z*C),K/2,0,2*Math.PI);G.closePath();G.fill()}}}}},_setImage:function(y,A,w){try{if(w.useCanvas){var i={width:w.absTLWH[2],height:w.absTLWH[3]};var u=y.find("canvas").attr(i);var x=u[0].getContext("2d");x.drawImage(A.canvas,0,0)}else{var v=y.find("img");widget._convertCanvasToImg($(A.canvas),v,w)}}catch(z){}}};if(!t[0].classList.contains("ui-resizable-resizing")){r.blur()}if(typeof f.upload==="string"&&f.upload=="y"){if(window.g_preview){widget._drawPreviewImageUpload(t,f)}else{widget._drawImageUpload(t,f)}return}var q=0,h=0;var d=f.absTLWH[2];var s=f.absTLWH[3];var b=0;var e=0;var j=f.b;var n=null;if(j){b=j[0];e=j.length>3?j.slice(2):j[2]}var m=f.s?f.s:"sq";o.save();r.path(o,m,e,q,h,d,s,b,f);if(f.sh){r._shadow(o,f)}if(f.bg){r.background(o,f)}o.restore();if(j&&b>0){r.border(o,f,d,s)}if(f.glaze&&f.glaze=="y"){r._glaze(o,f)}if(f.fx&&f.fx.length>0){r._effect(o,f)}if(f.i){for(var l=0;l<f.i.length;l++){var p=f.i[l];var k=new Image();function a(){var i=p[5];if(typeof(i)=="string"&&i.search("%")!=-1){i=(d*parseInt(i)/100)-p[3]/2}else{if(i<0){i=parseInt(d)+p[5]-p[3]}}var c=p[6];if(typeof(c)=="string"&&c.search("%")!=-1){c=(s*parseInt(c)/100)-p[4]/2}else{if(c<0){c=parseInt(s)+p[6]-p[4]}}k.onload=function(){try{o.drawImage(k,p[1],p[2],p[3],p[4],i+h,c+q,p[3],p[4]);r._setImage(t,o,f);if(o.canvas.hasOwnProperty("onchange")){o.canvas.onchange()}}catch(u){}};k.src=p[0]}$(k).ready(a)}}else{r._setImage(t,o,f)}};widget.scale=function(f,a){var c=10;var e;if(a.ls){e=a.ls}else{if(typeof a.wh==="undefined"){e=66/80}else{if(a.wh[0]=="a"||a.wh[1]=="a"){e=66/320}else{if(a.wh[0]=="100%"||a.wh[1]=="100%"){e=66/320}else{if(typeof(a.wh[0])==="string"||typeof(a.wh[1])==="string"){var d=parseInt(a.wh[0])/640;var b=parseInt(a.wh[1])/640;e=Math.max(d,b)}else{e=Math.min(1,66/a.wh[0],66/a.wh[1])}}}}}if(e<1){$(f).css({"-webkit-transform":"scale("+e+")","-moz-transform":"scale("+e+")"})}};module.exports=widget;function apiObjectUrl(b,c){var a="data/"+b+(c?"/"+c:"");return a};