var ajax={maxSyncRetryCount:2,submit:function(h){var j=$(this);var l=j.attr("id");var f=j.hasClass("createForm");var b=j.hasClass("shareSendMail");var a=j.hasClass("shareSendToUser");if(l!="feedbackForm"&&!f&&!(b&&$(".shareSend").attr("disabled")===undefined)&&!(a&&$(".shareToUser").attr("disabled")===undefined)&&l!=="upgradeForm"&&l!=="errorContact"){return false}if(j.find(":submit").hasClass("inactive")){return false}var c=j.find("input").not(":hidden, :submit").length;var g=j.find(".formCorrect").length;if(b){fluid.main.fire("beforeShareMail")}if(c==g){if(b||a){j.find(":submit").val("Sending...").removeClass("accept")}else{j.find(":submit").val("Sending...").removeClass("accept").addClass("inactive")}}else{if(b||a){j.find(":submit").removeClass("accept")}else{j.find(":submit").removeClass("accept").addClass("inactive")}}try{}catch(k){}if(a){var i=j.find(".shareSendMailReceipients").val();if(i===fluid.main.account.get("email")){projectSettings.actionTransferCallback(null,"Use clone in project settings. Unable to send to own account.")}else{fluid.api.projectTransfer(fluid.main.project.get("id"),i,projectSettings.actionTransferCallback,projectSettings.actionTransferCallback)}}else{var d=j.serialize();$.ajax({url:"./index.php",type:"POST",data:d,complete:ajax.complete,error:ajax.error})}return false},syncUp:function(d,c,a,g,b){if(a){fluid.main.fire("ajaxbeforesyncup",a,c)}var f=JSON.stringify(d);var e={t:c,data:f,objectId:a};$.ajax({url:"./index.php",type:"POST",data:e,success:function(h,k,j){var i=JSON.parse(h);if(i.r=="f"&&i.t=="retry"){if(b===undefined){b=ajax.maxSyncRetryCount}if(b>0){ajax.syncUp(d,c,a,g,--b);return}}else{if(i.r=="f"&&i.t=="forceSyncDown"&&c==="projectSync"){fluid.main.project.set({unloaded:true});if(fluid.main.project.get("id")===a){project.open(a);return}else{project.loadIfUnloaded(a,function(){if($.isFunction(g)){g(h)}});return}}}ajax.syncSuccess(h,k,j,c,a);if($.isFunction(g)){g(h)}},error:function(h,j,i){ajax.syncError(h,j,i,c,a)},complete:function(h,i){ajax.syncComplete(h,i,c,a)}})},syncDown:function(b,d,f,c){if($.isFunction(d)){c=arguments[2];f=arguments[1];d=false}var a=$.isArray(b);var e={t:"syncDown",objectId:a?b.join(","):b,multiple:a};if(d){e.unloaded=true}$.ajax({url:"./index.php",type:"POST",data:e,success:f,error:c||ajax.syncError})},snapshot:function(a,b,d){var c={t:"snapshot",objectId:a,type:b};$.ajax({url:"./index.php",type:"POST",data:c,success:d,error:ajax.snapshotError})},remove:function(a,c){var b={t:"remove",objectId:a};$.ajax({url:"./index.php",type:"POST",data:b,success:c,error:ajax.syncError})},restore:function(a,c){var b={t:"restore",objectId:a};$.ajax({url:"./index.php",type:"POST",data:b,success:c,error:ajax.syncError})},syncSuccess:function(g,h,f,e,b){switch(e){case"imageSync":var d=fluid.main.account.findUpload(b);if(d){d.upload.s=true}break;case"emailRegd":account.emailChecked(g);break;case"accountState":var a=$.parseJSON(f.responseText);if(a.r==="s"){var c=fluid.main.account.get("status");account.set({status:a.status});account.doAccountStatusAction(c);$("body").addClass("signed-in")}else{$("body").removeClass("signed-in")}account.requireRefresh(a);break}},syncError:function(c,e,d,b,a){},syncComplete:function(c,d,b,a){if(a){fluid.main.fire("afterajaxsynccomplete",a)}},complete:function(b,d){var a;try{a=$.parseJSON(b.responseText)}catch(c){return false}switch(a.a){case"contact":upgrade.errorSubmitted(a);break;case"feedback":fluidMenu.feedbackAjaxResponse(a);break;case"login":account.login(a);break;case"previewMail":share.actionMailSent(a);break}return false},apiCall:function(c,g,a,e,d,f){var h={},i=e;if(e instanceof Blob){var b=new FormData();b.append("file",e);e=b;g="post";h={processData:false,contentType:false};fluid.main.fire("ajaxapicall",a,c)}$.ajax($.extend(h,{url:this.apiObjectUrl(c,a),type:g?g.toUpperCase():"POST",data:e,success:function(l,m,k){if(g=="post"){var j=fluid.main.account.findUpload(a);if(j){j.upload.s=true;fluid.main.fire("uploadsynced",a)}}if($.isFunction(d)){d(l,a,i)}},error:function(j,l,k){ajax.syncError(j,l,k,c,a);if($.isFunction(f)){f(e,a,i)}},complete:function(j,k){fluid.main.fire("ajaxapicallcomplete",a)}}))},apiObjectUrl:function(b,c){var a="data/"+b+(c?"/"+c:"");return a},generalRequest:function(c,b,e,d){var a=d?$.extend({t:b},c):{t:b,data:JSON.stringify(c)};$.ajax({url:"index.php",type:"POST",data:a,success:function(g,h,f){if($.isFunction(e)){e(g)}},error:function(f,h,g){if($.isFunction(e)){e(null,g)}}})},userSettingsRequest:function(b,a,d,c){return ajax.generalRequest(b,a,d,c)}};module.exports=ajax;